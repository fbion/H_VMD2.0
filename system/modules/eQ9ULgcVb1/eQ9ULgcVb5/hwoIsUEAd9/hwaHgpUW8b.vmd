{"vmdversion":"vmd2.0.6.200119","vmdlayout":"{\"components\":[{\"cid\":\"viewport\",\"id\":\"MainViewport\",\"layoutConfig\":{},\"userConfig\":{\"layout\":\"border\",\"height\":500,\"width\":500,\"afterrender\":\"MainViewport_afterrender\"},\"cn\":[{\"cid\":\"container\",\"id\":\"div\",\"layoutConfig\":{},\"userConfig\":{\"x\":220,\"y\":50,\"region\":\"center\",\"height\":621,\"layout\":\"border\",\"autoScroll\":false,\"style\":\"overflow-x: hidden;    overflow-y: auto;\"},\"cn\":[{\"cid\":\"container\",\"id\":\"hwDiv\",\"layoutConfig\":{},\"userConfig\":{\"afterrender\":\"hwDiv_afterrender\",\"layout\":\"fit\",\"region\":\"center\"}},{\"cid\":\"container\",\"id\":\"hwDiv1\",\"layoutConfig\":{},\"userConfig\":{\"region\":\"south\",\"height\":200,\"layout\":\"border\",\"border\":false},\"cn\":[{\"cid\":\"container\",\"id\":\"hwDiv2\",\"layoutConfig\":{},\"userConfig\":{\"region\":\"west\",\"width\":438,\"layout\":\"absolute\",\"border\":false},\"cn\":[{\"cid\":\"label\",\"id\":\"hwLabel\",\"layoutConfig\":{},\"userConfig\":{\"text\":\"显示名称：\",\"region\":\"center\",\"x\":20,\"y\":80,\"height\":20}},{\"cid\":\"label\",\"id\":\"hwLabel1\",\"layoutConfig\":{},\"userConfig\":{\"region\":\"west\",\"x\":20,\"y\":50,\"text\":\"注释：\"}},{\"cid\":\"label\",\"id\":\"hwLabel3\",\"layoutConfig\":{},\"userConfig\":{\"x\":20,\"y\":20,\"text\":\"字段名称：\",\"height\":30}},{\"cid\":\"label\",\"id\":\"hwLabel4\",\"layoutConfig\":{},\"userConfig\":{\"x\":170,\"y\":20,\"text\":\"主键：\",\"height\":30}},{\"cid\":\"label\",\"id\":\"hwLabel5\",\"layoutConfig\":{},\"userConfig\":{\"x\":170,\"y\":50,\"text\":\"非空：\"}},{\"cid\":\"label\",\"id\":\"hwLabel6\",\"layoutConfig\":{},\"userConfig\":{\"x\":20,\"y\":110,\"text\":\"计量单位：\"}},{\"cid\":\"label\",\"id\":\"hwLabel7\",\"layoutConfig\":{},\"userConfig\":{\"x\":20,\"y\":140,\"text\":\"显示单位：\",\"height\":20}},{\"cid\":\"label\",\"id\":\"hwLabel8\",\"layoutConfig\":{},\"userConfig\":{\"x\":170,\"y\":80,\"text\":\"类型：\",\"height\":20}},{\"cid\":\"textfield\",\"id\":\"txt_name\",\"layoutConfig\":{},\"userConfig\":{\"x\":80,\"y\":70,\"width\":90,\"id\":\"txt_name\",\"blur\":\"txt_name_blur\"}},{\"cid\":\"textfield\",\"id\":\"txt_unit\",\"layoutConfig\":{},\"userConfig\":{\"x\":80,\"y\":130,\"width\":90,\"id\":\"txt_unit\",\"blur\":\"txt_unit_blur\"}},{\"cid\":\"checkbox\",\"id\":\"ch_pk\",\"layoutConfig\":{},\"userConfig\":{\"x\":210,\"y\":20,\"boxLabel\":\"\",\"id\":\"ch_pk\",\"disabled\":false,\"beforerender\":\"ch_pk_beforerender\"}},{\"cid\":\"checkbox\",\"id\":\"ch_nullable\",\"layoutConfig\":{},\"userConfig\":{\"x\":210,\"y\":50,\"boxLabel\":\"\",\"id\":\"ch_nullable\",\"disabled\":false,\"beforerender\":\"ch_nullable_beforerender\"}},{\"cid\":\"label\",\"id\":\"lb_name\",\"layoutConfig\":{},\"userConfig\":{\"x\":83,\"y\":20,\"id\":\"lb_name\"}},{\"cid\":\"label\",\"id\":\"lb_cname\",\"layoutConfig\":{},\"userConfig\":{\"x\":83,\"y\":50,\"id\":\"lb_cname\"}},{\"cid\":\"label\",\"id\":\"lb_unit\",\"layoutConfig\":{},\"userConfig\":{\"x\":83,\"y\":110,\"id\":\"lb_unit\"}},{\"cid\":\"label\",\"id\":\"lb_type\",\"layoutConfig\":{},\"userConfig\":{\"x\":210,\"y\":80,\"id\":\"lb_type\"}},{\"cid\":\"label\",\"id\":\"hwLabel9\",\"layoutConfig\":{},\"userConfig\":{\"x\":170,\"y\":110,\"text\":\"长度：\"}},{\"cid\":\"label\",\"id\":\"lb_cd\",\"layoutConfig\":{},\"userConfig\":{\"x\":210,\"y\":110,\"id\":\"lb_cd\",\"height\":20}},{\"cid\":\"label\",\"id\":\"hwLabel11\",\"layoutConfig\":{},\"userConfig\":{\"x\":170,\"y\":140,\"text\":\"精度：\",\"height\":20}},{\"cid\":\"label\",\"id\":\"lb_jd\",\"layoutConfig\":{},\"userConfig\":{\"x\":210,\"y\":140,\"id\":\"lb_jd\"}},{\"cid\":\"label\",\"id\":\"hwLabel10\",\"layoutConfig\":{},\"userConfig\":{\"x\":20,\"y\":170,\"width\":370,\"text\":\"注：转换配置用于配置字段的实际值与显示值的代码转换关系。\",\"style\":\"color:red;\"}},{\"cid\":\"label\",\"id\":\"hwLabel12\",\"layoutConfig\":{},\"userConfig\":{\"x\":280,\"y\":20,\"text\":\"转换配置：\"}},{\"cid\":\"label\",\"id\":\"hwLabel13\",\"layoutConfig\":{},\"userConfig\":{\"x\":290,\"y\":50,\"text\":\"数据集：\"}},{\"cid\":\"label\",\"id\":\"hwLabel14\",\"layoutConfig\":{},\"userConfig\":{\"x\":290,\"y\":80,\"text\":\"实际值：\"}},{\"cid\":\"label\",\"id\":\"hwLabel15\",\"layoutConfig\":{},\"userConfig\":{\"x\":290,\"y\":110,\"text\":\"显示值：\"}},{\"cid\":\"vmdComlist\",\"id\":\"com_store\",\"layoutConfig\":{},\"userConfig\":{\"x\":330,\"y\":40,\"width\":90,\"selectChanged\":\"com_store_selectChanged\",\"beforerender\":\"com_store_beforerender\",\"id\":\"com_store\"}},{\"cid\":\"vmdComlist\",\"id\":\"com_valueFile\",\"layoutConfig\":{},\"userConfig\":{\"x\":330,\"y\":70,\"width\":90,\"id\":\"com_valueFile\",\"beforerender\":\"com_valueFile_beforerender\"}},{\"cid\":\"vmdComlist\",\"id\":\"com_displayFile\",\"layoutConfig\":{},\"userConfig\":{\"x\":330,\"y\":100,\"width\":90,\"id\":\"com_displayFile\",\"beforerender\":\"com_displayFile_beforerender\"}}]},{\"cid\":\"container\",\"id\":\"hwDiv3\",\"layoutConfig\":{},\"userConfig\":{\"region\":\"center\",\"layout\":\"border\",\"border\":false},\"cn\":[{\"cid\":\"label\",\"id\":\"hwLabel2\",\"layoutConfig\":{},\"userConfig\":{\"region\":\"west\",\"text\":\"   默认值：\",\"height\":39,\"html\":\"<br>默认值:\",\"width\":48}},{\"cid\":\"container\",\"id\":\"hwDiv4\",\"layoutConfig\":{},\"userConfig\":{\"region\":\"center\",\"border\":true,\"height\":156,\"layout\":\"fit\",\"margins\":\"10 5 10 0\"},\"cn\":[{\"cid\":\"textarea\",\"id\":\"hwTextArea\",\"layoutConfig\":{},\"userConfig\":{\"readOnly\":true,\"afterrender\":\"hwTextArea_afterrender\"}}]}]}]}]},{\"cid\":\"container\",\"id\":\"div2\",\"layoutConfig\":{},\"userConfig\":{\"x\":290,\"y\":250,\"region\":\"south\",\"layout\":\"border\",\"border\":false,\"hidden\":false},\"cn\":[{\"cid\":\"container\",\"id\":\"div3\",\"layoutConfig\":{\"align\":\"middle\",\"pack\":\"start\"},\"userConfig\":{\"region\":\"west\",\"layout\":\"hbox\",\"border\":false},\"cn\":[{\"cid\":\"checkbox\",\"id\":\"hwCheckbox\",\"layoutConfig\":{},\"userConfig\":{\"margins\":\"0 0 0 20\",\"boxLabel\":\"启用校验\",\"hidden\":true}},{\"cid\":\"vmdButton\",\"id\":\"button3\",\"layoutConfig\":{},\"userConfig\":{\"margins\":\"0 0 0 30\",\"text\":\"编辑校验规则\",\"type\":\"primary\",\"click\":\"button3_click\",\"hidden\":true}}]},{\"cid\":\"container\",\"id\":\"div4\",\"layoutConfig\":{\"align\":\"middle\",\"pack\":\"end\"},\"userConfig\":{\"region\":\"center\",\"layout\":\"hbox\",\"border\":false},\"cn\":[{\"cid\":\"vmdButton\",\"id\":\"button1\",\"layoutConfig\":{},\"userConfig\":{\"margins\":\"0 20 0 0\",\"text\":\"保存\",\"type\":\"primary\",\"click\":\"button1_click\"}}]}]},{\"cid\":\"container\",\"id\":\"div1\",\"layoutConfig\":{\"align\":\"middle\"},\"userConfig\":{\"region\":\"north\",\"border\":false,\"layout\":\"hbox\",\"hidden\":true},\"cn\":[{\"cid\":\"checkbox\",\"id\":\"hwCheckbox1\",\"layoutConfig\":{},\"userConfig\":{\"boxLabel\":\"启用校验\",\"margins\":\"0 0 0 30\"}},{\"cid\":\"vmdButton\",\"id\":\"button\",\"layoutConfig\":{},\"userConfig\":{\"text\":\"编辑校验规则\",\"type\":\"primary\",\"size\":\"small\",\"margins\":\"0 0 0 30\"}},{\"cid\":\"vmdButton\",\"id\":\"button2\",\"layoutConfig\":{},\"userConfig\":{\"margins\":\"0 0 0 30\",\"text\":\"保存\",\"type\":\"primary\"}},{\"cid\":\"vmdAceEditor\",\"id\":\"MyAce\",\"layoutConfig\":{},\"userConfig\":{}}]}]},{\"cid\":\"vmddataset\",\"id\":\"数据\",\"layoutConfig\":{},\"userConfig\":{}},{\"cid\":\"vmdvariable\",\"id\":\"变量\",\"layoutConfig\":{},\"userConfig\":{}},{\"cid\":\"vmdsubviewport\",\"id\":\"SubView_Window\",\"layoutConfig\":{},\"userConfig\":{}}]}","vmdevents":"\nvar dhgrid;\nvar sfileDic = []\nfor (var i = 0; i <200; i++) {\n    var row ={}\n    row.defaultValue = \"wwwwwwwwwww\";\n    row.primary =\"wwwwwwwwwwww\";\n    row.nullable = \"wwwwwwwwwww\";\n    row.dunit = 555;\n    row.dname = \"wwwwwwwwwwwwwww\";\n    row.flaStore = 777;\n    row.flaValueField = 888;\n    row.flaDisplayField = 999;\n    row.flaDisplayField = 1;\n    sfileDic.push(row)\n}\nvar rows = [];\n\nfunction button1_click(sender, e) {\ndebugger\n    myDataStore.add({defaultValue : 2222,\n    primary :333,\n    nullable : 444,\n    dunit :555,\n    dname : 666,\n    flaStore : 777,\n    flaValueField : 888,\n    flaDisplayField : 999,\n    flaDisplayField : 1})\n    \n}\n\nfunction hwreport_afterrender(render) {\n    hwreport.query();\n}\n\nvar myDataStore = new dhtmlXDataStore();\n\nfunction MainViewport_afterrender(sender) {\n    //设置默认值\n    lb_name.setText(\"\");\n    lb_cname.setText(\"\");\n    txt_name.setValue(\"\");\n    ch_pk.setValue(\"\");\n    ch_nullable.setValue(\"\");\n    lb_type.setText(\"\");\n    lb_cd.setText(\"\");\n    lb_jd.setText(\"\");\n    lb_unit.setText(\"\");\n    txt_unit.setValue(\"\");\n    hwTextArea.setValue(\"\");\n\n    //初始化网格数据\n    dhgrid = new dhtmlXGridObject(hwDiv.el.dom);\n    dhgrid.setImagePath(\"/lib/dhtmlx/codebase/imgs/\");\n    var header = \"序号,汉字注释,显示名称,主键,可为空,类型,长度,精度,计量单位,显示单位,默认值,代码表,值字段,显示字段\";\n    var width = \"100,100,100,50,50,80,50,50,60,60,120,60,60,60\";\n    //var colType = \"ro,ed,ch,ch,co,ed,ed,ed\";\n    var colType = \"cntr,ro,ro,ch,ch,ro,ro,ro,ro,ro,txt,ro,ro,ro\";\n    var strType = \"str,str,str,str,str,str,int,int,str,str,str,str,str,str\";\n    var colId = \"name,cname,dname,primary,nullable,type,length,precision,unit,dunit,defaultValue,flaStore,flaValueField,flaDisplayField\";\n    dhgrid.setHeader(header);\n    dhgrid.setInitWidths(width);\n    dhgrid.setColumnIds(colId)\n    dhgrid.setColTypes(colType)\n    dhgrid.enableSmartRendering(true);\n    dhgrid.init();\n    myDataStore.parse(sfileDic);\n    dhgrid.sync(myDataStore)\n    //dhgrid.attachEvent(\"onCheckbox\", doOnCheck);\n    dhgrid.setEditable(false)\n    dhgrid.attachEvent(\"onBeforeSelect\", rowSelect);\n    //dhgrid.attachEvent(\"onXLE\", function(){\n    for (var i = 0; i < dhgrid.getRowsNum(); i++) {\n        dhgrid.cells2(i, 3).cell.firstChild.onclick = null; //.setDisabled(true);\n        dhgrid.cells2(i, 4).cell.firstChild.onclick = null; //.setDisabled(true);\n    }\n}\nvar dValue = \"\";\nvar selRowId = \"\";\n\nfunction rowSelect(new_row, old_row, new_col_index) {\n    selRowId = new_row;\n    setGridValue(old_row)\n    //设置下方显示选中行信息\n    lb_name.setText(dhgrid.cells(new_row, 0).getValue());\n    lb_cname.setText(dhgrid.cells(new_row, 1).getValue());\n    txt_name.setValue(dhgrid.cells(new_row, 2).getValue());\n    ch_pk.setDisabled(false)\n    ch_pk.setValue(dhgrid.cells(new_row, 3).getValue());\n    ch_pk.setDisabled(true)\n    ch_nullable.setDisabled(false)\n    ch_nullable.setValue(dhgrid.cells(new_row, 4).getValue());\n    ch_nullable.setDisabled(true)\n    lb_type.setText(dhgrid.cells(new_row, 5).getValue());\n    lb_cd.setText(dhgrid.cells(new_row, 6).getValue());\n    lb_jd.setText(dhgrid.cells(new_row, 7).getValue());\n    lb_unit.setText(dhgrid.cells(new_row, 8).getValue());\n    txt_unit.setValue(dhgrid.cells(new_row, 9).getValue());\n    hwTextArea.setValue(dhgrid.cells(new_row, 10).getValue() || dValue);\n    //\n    com_store.setValue(dhgrid.cells(new_row, 11).getValue() || \"\")\n    com_store_selectChanged()\n    com_valueFile.setValue(dhgrid.cells(new_row, 12).getValue() || \"\")\n    com_displayFile.setValue(dhgrid.cells(new_row, 13).getValue() || \"\")\n    \n    \n    return true;\n}\n\n// function doOnCheck(rowId, cellInd, state) {\n//     var tf = \"\"\n//     if (!state)\n//         tf = \"Y\"\n//     if (cellInd == \"3\")\n//         myDataStore.item(rowId).primary = tf\n//     if (cellInd == \"4\")\n//         myDataStore.item(rowId).nullable = tf\n//     return true;\n// }\n\nfunction button3_click(sender, e) {\n    window.open(\"/system/modules/eQ9ULgcVb1/eQ9ULgcVb5/hwoIsUEAd9/hw5f8b2870.html\", \"_blank\", \"width=800,height=600\")\n    //记录日志信息 \n    //vmd.webBase.syslog(loginfo,logtype,operationtype,function(res){}) \n}\n\nfunction hwDiv_afterrender(sender) {\n\n}\n\nfunction ch_pk_beforerender(sender) {\n    ch_pk.readOnly = true;\n}\n\nfunction ch_nullable_beforerender(sender) {\n\n    ch_nullable.readOnly = true;\n}\n\nfunction setGridValue(rowid) {\n    if (rowid) {\n        var rowdate = myDataStore.item(rowid);\n        if (rowdate) {\n            //设置数据集\n            rowdate.dname = txt_name.getValue() || lb_cname.text\n            rowdate.dunit = txt_unit.getValue() || lb_unit.text;\n            rowdate.defaultValue = hwTextArea.getValue();\n            //设置转换的配置信息\n            rowdate.flaStore = com_store.getValue();\n            rowdate.flaValueField = com_valueFile.getValue();\n            rowdate.flaDisplayField = com_displayFile.getValue();\n            //设置显示\n            dhgrid.cells(rowid, 2).setValue(txt_name.getValue() || lb_cname.text);\n            dhgrid.cells(rowid, 9).setValue(txt_unit.getValue() || lb_unit.text);\n            dhgrid.cells(rowid, 10).setValue(hwTextArea.getValue())\n            dhgrid.cells(rowid, 11).setValue(com_store.getValue());\n            dhgrid.cells(rowid, 12).setValue(com_valueFile.getValue());\n            dhgrid.cells(rowid, 13).setValue(com_displayFile.getValue())\n        }\n    }\n}\n\nfunction txt_name_blur(sender, e) {\n    setGridValue(selRowId)\n}\n\nfunction txt_unit_blur(sender, e) {\n\n    setGridValue(selRowId)\n}\n\nfunction hwTextArea_afterrender(sender) {\n    hwTextArea.on(\"focus\", function() {\n        var mygrid = dhgrid;\n        var win = new Ext.Window({\n            title: \"参数值代码编辑\",\n            modal: true,\n            maximized: false,\n            height: 400,\n            width: 500,\n            maximizable: true,\n            resizable: true,\n            bodyStyle: \"background-color:#fff\",\n            closeAction: 'close'\n        })\n        win.editor = new vmd.comp.Ace({\n            language: 'javascript'\n        })\n        win.add(win.editor);\n        //关闭\n        win.hidefn = function() {\n            var value = win.editor.getValue()\n            mygrid.cells(selRowId, 10).setValue(value)\n            myDataStore.item(selRowId).defaultValue = value\n            hwTextArea.setValue(value); // .item(rowId).defaultValue = value\n        }\n        win.on('hide', win.hidefn);\n        var dValue = hwTextArea.getValue();\n        if (dValue == \"\") {\n            dValue = \"//var date=new Date(dateTime.getValue()) //获取标准日期 \\r\\n\" +\n                \"//date.setDate(date.getDate()-1)//前移或后移天数  \\r\\n\" +\n                \"//date.setMonth(date.getMonth()+n)//前移或后移月数  \\r\\n\" +\n                \"//date.setFullYear(date.getFullYear()+n)//前移或后移年数  \\r\\n\" +\n                \"//value = vmd.Date.format(date,'Y-m-d')//返回查询日期  \\r\\n\" +\n                \"//value = vmd.Date.format(date,'Ym')//返回查询年月  \\r\\n\" +\n                \"//value = vmd.Date.format(date,'Y')//返回查询年度  \\r\\n\" +\n                \"//返回值 \\r\\n return \\\"\\\"\"\n        }\n        win.editor.value = dValue;\n        win.show();\n        Ext.defer(function() {\n            win.editor.focus();\n            win.editor.el.dom.click()\n        }, 100)\n\n    });\n}\n//\n//处理下拉，数据集的列表。字段列表\nvar storelistData = []\nvar storelist = new vmd.data.Store({\n    data: storelistData,\n    fields: ['id', 'name']\n})\nvar storeFileListData = []\nvar storeFileList = new vmd.data.Store({\n    data: storeFileListData,\n    fields: ['id', 'name']\n})\n\nif (parent && parent.xds.vmd.getStoreNames)\n    var stores = parent.xds.vmd.getStoreNames()\nfor (var i = 0; i < stores.length; i++) {\n    storelistData.push({\n        id: stores[i],\n        name: stores[i]\n    })\n}\nstorelist.loadData(storelistData)\n\nfunction com_store_selectChanged(sender, combo, record, index) {\n    var storename = com_store.getValue();\n    if (storename && parent && parent.xds.vmd.getStoreFieldNames) {\n        var Fields = parent.xds.vmd.getStoreFieldNames(storename)\n        for (var i = 0; i < Fields.length; i++) {\n            storeFileListData.push({\n                id: Fields[i],\n                name: Fields[i]\n            })\n        }\n    }\n    storeFileList.loadData(storeFileListData)\n}\n\nfunction com_store_beforerender(sender) {\n    com_store.store = storelist;\n    com_store.displayField = \"name\";\n    com_store.valueField = \"id\";\n}\n\nfunction com_valueFile_beforerender(sender) {\n    com_valueFile.store = storeFileList;\n    com_valueFile.displayField = \"name\";\n    com_valueFile.valueField = \"id\";\n}\n\nfunction com_displayFile_beforerender(sender) {\n    com_displayFile.store = storeFileList;\n    com_displayFile.displayField = \"name\";\n    com_displayFile.valueField = \"id\";\n}","vmdcss":"","vmdprops":"\"\"","type":"module","vmdresource":"{\"components\":[{\"cid\":\"vmdrescsss\",\"layoutConfig\":{},\"userConfig\":{}},{\"cid\":\"vmdresjss\",\"layoutConfig\":{},\"userConfig\":{},\"cn\":[{\"cid\":\"resjs\",\"id\":\"project.config.js\",\"layoutConfig\":{},\"userConfig\":{}}]},{\"cid\":\"vmdresimgs\",\"layoutConfig\":{},\"userConfig\":{}}]}"}