{"vmdversion":"2.0.4.190627","vmdlayout":"{\"components\":[{\"cid\":\"viewport\",\"id\":\"MainViewport\",\"layoutConfig\":{},\"userConfig\":{\"layout\":\"fit\",\"afterrender\":\"MainViewport_afterrender\"},\"cn\":[{\"cid\":\"container\",\"id\":\"div3\",\"layoutConfig\":{},\"userConfig\":{\"region\":\"center\",\"layout\":\"border\",\"border\":false,\"width\":825,\"style\":\"font-size:14px;\"},\"cn\":[{\"cid\":\"container\",\"id\":\"div2\",\"layoutConfig\":{},\"userConfig\":{\"x\":30,\"y\":-2,\"width\":680,\"height\":76,\"layout\":\"absolute\",\"region\":\"north\",\"border\":false},\"cn\":[{\"cid\":\"label\",\"id\":\"label\",\"layoutConfig\":{},\"userConfig\":{\"region\":\"center\",\"x\":20,\"y\":15,\"text\":\"名称：\"}},{\"cid\":\"label\",\"id\":\"label1\",\"layoutConfig\":{},\"userConfig\":{\"x\":20,\"y\":45,\"text\":\"说明：\"}},{\"cid\":\"textfield\",\"id\":\"hwText\",\"layoutConfig\":{},\"userConfig\":{\"x\":60,\"y\":10,\"width\":430}},{\"cid\":\"textfield\",\"id\":\"hwText1\",\"layoutConfig\":{},\"userConfig\":{\"x\":60,\"y\":40,\"width\":430}}]},{\"cid\":\"container\",\"id\":\"div4\",\"layoutConfig\":{},\"userConfig\":{\"x\":80,\"y\":150,\"height\":90,\"region\":\"center\",\"layout\":\"border\",\"border\":false},\"cn\":[{\"cid\":\"label\",\"id\":\"label2\",\"layoutConfig\":{},\"userConfig\":{\"x\":20,\"y\":100,\"text\":\"规则：\",\"region\":\"north\",\"style\":\"margin-left: 20px;\"}},{\"cid\":\"container\",\"id\":\"div5\",\"layoutConfig\":{},\"userConfig\":{\"x\":790,\"y\":170,\"width\":731,\"height\":311,\"region\":\"center\",\"style\":\"padding: 5px 20px 5px 20px;\",\"layout\":\"fit\",\"border\":false},\"cn\":[{\"cid\":\"container\",\"id\":\"div\",\"layoutConfig\":{},\"userConfig\":{\"afterrender\":\"div_afterrender\"}}]}]},{\"cid\":\"container\",\"id\":\"div6\",\"layoutConfig\":{\"align\":\"middle\",\"pack\":\"end\"},\"userConfig\":{\"x\":850,\"y\":360,\"region\":\"south\",\"layout\":\"hbox\",\"border\":false},\"cn\":[{\"cid\":\"vmdButton\",\"id\":\"button\",\"layoutConfig\":{},\"userConfig\":{\"margins\":\"0 30 0 0\",\"type\":\"primary\",\"text\":\"确定\",\"click\":\"button_click\"}}]}]}]},{\"cid\":\"vmddataset\",\"id\":\"数据集\",\"layoutConfig\":{},\"userConfig\":{}},{\"cid\":\"vmdvariable\",\"id\":\"变量\",\"layoutConfig\":{},\"userConfig\":{}},{\"cid\":\"vmdsubviewport\",\"id\":\"SubView_Window\",\"layoutConfig\":{},\"userConfig\":{}}]}","vmdevents":"//变量数组\r\nwindow.vars = parent.xds.vmd.getVarNames()\r\nvar stores = parent.xds.vmd.getStoreNames()\r\n//数据集信息\r\nwindow.allStoreFields = [];\r\nvar storeName = getUrlParam(\"storename\")\r\nvar storeFields = [];\r\nvar store = parent.xds.vmd.getStoreByDsName(storeName, true);\r\nif (store.component && store.component.userConfig && store.component.userConfig.storeConfig) {\r\n    storeFields = JSON.parse(store.component.userConfig.storeConfig).fields\r\n    var bstorefields = [];\r\n    for (var j = 0; j < storeFields.length; j++) {\r\n        bstorefields.push([storeFields[j].cname || storeFields[j].name, storeFields[j].name])\r\n    }\r\n    var allfields = {\r\n        name: storeName,\r\n        fields: bstorefields\r\n    }\r\n    window.allStoreFields.push(allfields)\r\n}\r\n//编辑的规则内容\r\nif (parent && parent.rulesEditWin_editRule) {\r\n    window.editRule = parent.rulesEditWin_editRule\r\n}\r\n\r\nfunction div_afterrender(sender) {\r\n    div.update(\"<iframe  id='iframe_page' src='/lib/blockly/vmdcode/index.html' width=100% height=100% frameborder=0  ></iframe>\")\r\n}\r\n\r\nfunction button_click(sender, e) {\r\n    if (hwText.getValue() == \"\") {\r\n        Ext.Msg.alert('错误', '规则名称不能为空')\r\n        return\r\n    }\r\n    //获取的定义信息\r\n    var childWindow = $(\"#iframe_page\")[0].contentWindow;\r\n    var code = childWindow.Blockly.JavaScript.workspaceToCode(childWindow.Code.workspace);\r\n    var xmlDom = childWindow.Blockly.Xml.workspaceToDom(childWindow.Code.workspace);\r\n    var xmlText = childWindow.Blockly.Xml.domToPrettyText(xmlDom);\r\n    parent.rulesEditWin_changeRule(code, base64Encode(xmlText), hwText.getValue(), hwText1.getValue())\r\n}\r\n\r\nfunction MainViewport_afterrender(sender) {\r\n    //设置默认blockly内容\r\n    window.setTimeout(function() {\r\n        //设置 数据集/变量的块/解析脚本等信息\t\t\t\t\t\t\t\r\n        var childWindow = $(\"#iframe_page\")[0].contentWindow\r\n        childWindow.addStoreBlock(window.allStoreFields)\r\n        childWindow.addVarBlock(window.vars)\r\n        //设置默认编辑显示内容\r\n        if (window.editRule) {\r\n            hwText.setValue(editRule.name)\r\n            hwText1.setValue(editRule.remark)\r\n            var xmlTextarea = childWindow.document.getElementById('content_xml');\r\n            xmlTextarea.value = base64Decode(window.editRule.xml);\r\n            var xmlDom = childWindow.Blockly.Xml.textToDom(xmlTextarea.value);\r\n            if (xmlDom) {\r\n                childWindow.Code.workspace.clear();\r\n                childWindow.Blockly.Xml.domToWorkspace(xmlDom, childWindow.Code.workspace);\r\n                if (div && div.getWidth())\r\n                    div.setWidth(div.getWidth() - 1)\r\n            }\r\n        }\r\n    }, 1000)\r\n}\r\n\r\n\r\nfunction getFileType(field) {\r\n    //\r\n    var returntype = \"0\"; //0 string；1 num 2 date\r\n    var fieldType = \"string\";\r\n    if (storeFields.length > 0) {\r\n        for (var i = 0; i < storeFields.length; i++) {\r\n            if (field == storeFields[i].name) {\r\n                fieldType = storeFields[i].type\r\n                break\r\n            }\r\n        }\r\n    }\r\n    if (fieldType.toLowerCase() == \"number\" || fieldType.toLowerCase() == \"int\" || fieldType.toLowerCase() == \"float\" || fieldType.toLowerCase() == \"decimal\") {\r\n        return \"1\"\r\n    } else if (fieldType.toLowerCase() == \"date\" || fieldType.toLowerCase() == \"datetime\") {\r\n        return \"0\"\r\n    } else\r\n        return \"2\"\r\n\r\n}\r\nwindow.blocklyGetFileType = getFileType;","vmdcss":".serverlist-info {\n    padding: 8px 17px;\n    margin: 2px;\n    line-height: 0.25em;\n    height: 5px;\n    width: 150px;\n    border-top: 5px solid transparent;\n    cursor: pointer;\n    font-size:14px;\n}\n\n.btn-margin\n{\n    margin: 2px 3px 2px 3px;\n    width:30px;\n}","vmdprops":"\"\"","type":"module","vmdresource":"{\"components\":[{\"cid\":\"vmdrescsss\",\"layoutConfig\":{},\"userConfig\":{}},{\"cid\":\"vmdresjss\",\"layoutConfig\":{},\"userConfig\":{},\"cn\":[{\"cid\":\"resjs\",\"id\":\"project.config.js\",\"layoutConfig\":{},\"userConfig\":{}}]},{\"cid\":\"vmdresimgs\",\"layoutConfig\":{},\"userConfig\":{}}]}"}