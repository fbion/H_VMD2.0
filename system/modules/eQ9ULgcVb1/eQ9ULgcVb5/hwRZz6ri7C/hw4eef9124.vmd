{"vmdversion":"2.0.4.190627","vmdlayout":"{\"components\":[{\"cid\":\"viewport\",\"id\":\"MainViewport\",\"layoutConfig\":{},\"userConfig\":{\"layout\":\"border\",\"afterrender\":\"MainViewport_afterrender\"},\"cn\":[{\"cid\":\"container\",\"id\":\"div\",\"layoutConfig\":{},\"userConfig\":{\"x\":140,\"y\":70,\"region\":\"center\",\"border\":false,\"layout\":\"border\"},\"cn\":[{\"cid\":\"container\",\"id\":\"div5\",\"layoutConfig\":{},\"userConfig\":{\"region\":\"center\",\"border\":false,\"autoScroll\":false,\"afterrender\":\"div5_afterrender\"}},{\"cid\":\"container\",\"id\":\"div6\",\"layoutConfig\":{\"align\":\"middle\"},\"userConfig\":{\"region\":\"north\",\"border\":false,\"layout\":\"hbox\"},\"cn\":[{\"cid\":\"label\",\"id\":\"label1\",\"layoutConfig\":{},\"userConfig\":{\"text\":\"值定义：\",\"margins\":\"0 0 0 20\",\"style\":\"font-size: 14px;    font-weight: bold;    color: #5e5e5e;\"}}]}]},{\"cid\":\"container\",\"id\":\"div1\",\"layoutConfig\":{},\"userConfig\":{\"x\":260,\"y\":250,\"region\":\"north\",\"height\":180,\"layout\":\"border\",\"border\":false},\"cn\":[{\"cid\":\"container\",\"id\":\"div3\",\"layoutConfig\":{},\"userConfig\":{\"region\":\"center\",\"border\":false,\"afterrender\":\"div3_afterrender\"}},{\"cid\":\"container\",\"id\":\"div4\",\"layoutConfig\":{\"align\":\"middle\"},\"userConfig\":{\"region\":\"north\",\"border\":false,\"layout\":\"hbox\"},\"cn\":[{\"cid\":\"label\",\"id\":\"label\",\"layoutConfig\":{},\"userConfig\":{\"text\":\"条件设置：\",\"margins\":\"0 0 0 20\",\"style\":\"font-size: 14px;    font-weight: bold;    color: #5e5e5e;\"}}]}]},{\"cid\":\"container\",\"id\":\"div2\",\"layoutConfig\":{\"align\":\"middle\",\"pack\":\"end\"},\"userConfig\":{\"region\":\"south\",\"layout\":\"hbox\",\"border\":true,\"style\":\"border-top: 1px ;\"},\"cn\":[{\"cid\":\"vmdButton\",\"id\":\"button\",\"layoutConfig\":{},\"userConfig\":{\"margins\":\"0 30 0 0\",\"type\":\"primary\",\"text\":\"确定\",\"click\":\"button_click\"}},{\"cid\":\"vmdAceEditor\",\"id\":\"MyAce\",\"layoutConfig\":{},\"userConfig\":{\"width\":10,\"height\":10,\"hidden\":true}}]}]},{\"cid\":\"vmddataset\",\"id\":\"数据集\",\"layoutConfig\":{},\"userConfig\":{}},{\"cid\":\"vmdvariable\",\"id\":\"变量\",\"layoutConfig\":{},\"userConfig\":{}},{\"cid\":\"vmdsubviewport\",\"id\":\"SubView_Window\",\"layoutConfig\":{},\"userConfig\":{}}]}","vmdevents":"//初始化处理ace的api\r\nif (parent.init_def_platformControlData) {\r\n    parent.init_def_platformControlData();\r\n    def_platformControl = parent.def_platformControl;\r\n}\r\nif (parent.allPublicMethods)\r\n    window.allPublicMethods = parent.allPublicMethods;\r\nelse\r\n    window.allPublicMethods = {};\r\nif (parent.publicMethodsType)\r\n    window.publicMethodsType = parent.publicMethodsType;\r\nelse\r\n    window.publicMethodsType = {};\r\nif (parent.init_def_platformFun) {\r\n    parent.init_def_platformFun({\r\n        vmd: allPublicMethods\r\n    });\r\n    parent.init_def_platformVmd();\r\n    def_platformWidget = parent.def_platformWidget;\r\n}\r\n//ext框架类自动识别\r\ndef_platformExtjs = parent.def_platformExtjs;\r\nvar configs = parent.edValue;\r\nif (!configs.store) {\r\n    Ext.Msg.alert('未配置数据准备所需的数据集', '错误')\r\n    return\r\n}\r\nvar storeObj = parent.xds.vmd.getStoreByDsName(configs.store, true)\r\nvar storeConfigStr = storeObj.component.getConfigValue(\"storeConfig\")\r\nvar storeConfig = JSON.parse(storeConfigStr);\r\nvar fileDic = storeConfig.fields;\r\nvar paramDic = storeConfig.getMethods;\r\n//获取已配置的信息\r\nvar sconfig = configs.dataConfig || \"{}\";\r\nvar sconfigObj = JSON.parse(sconfig);\r\nvar sparamconfigObj = sconfigObj.params || [];\r\nvar sfielsconfigObj = sconfigObj.values || [];\r\n\r\nvar paramgrid;\r\nvar fieldgrid;\r\nvar sfileDic = [];\r\nvar sparamDic = [];\r\nfor (var i = 0; i < fileDic.length; i++) {\r\n\r\n    var value = \"\";\r\n    for (var j = 0; j < sfielsconfigObj.length; j++) {\r\n        if (sfielsconfigObj[j].id == fileDic[i].name) {\r\n            value = sfielsconfigObj[j].value\r\n            break;\r\n        }\r\n    }\r\n    var row = {\r\n        xh: i + 1,\r\n        id: fileDic[i].name,\r\n        name: fileDic[i].cname,\r\n        type: fileDic[i].type,\r\n        value: value\r\n    }\r\n    sfileDic.push(row)\r\n}\r\nfor (var i = 0; i < paramDic.length; i++) {\r\n    var value = \"\";\r\n    for (var j = 0; j < sparamconfigObj.length; j++) {\r\n        if (sparamconfigObj[j].id == paramDic[i].id) {\r\n            value = sparamconfigObj[j].value\r\n            break;\r\n        }\r\n    }\r\n    var row = {\r\n        xh: i + 1,\r\n        id: paramDic[i].id,\r\n        name: paramDic[i].type || \"\",\r\n        type: paramDic[i].type || \"string\",\r\n        value: value\r\n    }\r\n    sparamDic.push(row)\r\n}\r\nstoreConfig.fields;\r\nvar rows = [];\r\nvar myParamDataStore = new dhtmlXDataStore();\r\nvar myFieldDataStore = new dhtmlXDataStore();\r\n\r\nfunction div3_afterrender(sender) {}\r\n\r\nfunction MainViewport_afterrender(sender) {\r\n    //创建参数的网格\r\n    paramgrid = new dhtmlXGridObject(div3.el.dom);\r\n    paramgrid.setImagePath(\"/lib/dhtmlx/codebase/imgs/\");\r\n    var header = \"序号,参数id,参数名,参数类型,值\";\r\n    var width = \"80,100,120,100,150\";\r\n    //var colType = \"ro,ed,ch,ch,co,ed,ed,ed\";\r\n    var colType = \"ro,ro,ro,ro,txt\";\r\n    var strType = \"str,str,str,str,str\";\r\n    var colId = \"xh,id,name,type,value\";\r\n    paramgrid.setHeader(header);\r\n    paramgrid.setInitWidths(width);\r\n    paramgrid.setColumnIds(colId)\r\n    paramgrid.setColTypes(colType)\r\n    //paramgrid.enableAutoHeight(true, null, true);\r\n    paramgrid.init();\r\n    myParamDataStore.parse(sparamDic);\r\n    paramgrid.sync(myParamDataStore)\r\n    paramgrid.setEditable(false)\r\n    paramgrid.attachEvent(\"onBeforeSelect\", paramsrowSelect);\r\n    //创建字段配置的网格\r\n    fieldgrid = new dhtmlXGridObject(div5.el.dom);\r\n    fieldgrid.setImagePath(\"/lib/dhtmlx/codebase/imgs/\");\r\n    var header1 = \"序号,字段id,字段名称,参数类型,值\";\r\n    var width1 = \"80,100,120,100,150\";\r\n    //var colType = \"ro,ed,ch,ch,co,ed,ed,ed\";\r\n    var colType1 = \"ro,ro,ro,ro,txt\";\r\n    var strType1 = \"str,str,str,str,str\";\r\n    var colId1 = \"xh,id,name,type,value\";\r\n    fieldgrid.setHeader(header1);\r\n    fieldgrid.setInitWidths(width1);\r\n    fieldgrid.setColumnIds(colId1)\r\n    fieldgrid.setColTypes(colType1)\r\n    //fieldgrid.enableAutoHeight(true, null, true);\r\n    fieldgrid.init();\r\n    myFieldDataStore.parse(sfileDic);\r\n    fieldgrid.sync(myFieldDataStore)\r\n    fieldgrid.setEditable(false)\r\n    fieldgrid.attachEvent(\"onBeforeSelect\", fieldrowSelect);\r\n}\r\n\r\nfunction paramsrowSelect(new_row, old_row, new_col_index) {\r\n    if (new_col_index == \"4\") {\r\n        valueEditFrm(paramgrid, new_row, new_col_index, myParamDataStore);\r\n    }\r\n}\r\n\r\nfunction fieldrowSelect(new_row, old_row, new_col_index) {\r\n    if (new_col_index == \"4\") {\r\n        valueEditFrm(fieldgrid, new_row, new_col_index, myFieldDataStore);\r\n    }\r\n}\r\n\r\nfunction valueEditFrm(grid, rowId, cellInd, store) {\r\n    var mygrid = grid;\r\n    var win = new Ext.Window({\r\n        title: \"参数值代码编辑\",\r\n        modal: true,\r\n        maximized: false,\r\n        height: 400,\r\n        width: 500,\r\n        maximizable: true,\r\n        resizable: true,\r\n        bodyStyle: \"background-color:#fff\",\r\n        closeAction: 'close'\r\n    })\r\n    win.editor = new vmd.comp.Ace({\r\n        language: 'javascript'\r\n    })\r\n    win.add(win.editor);\r\n    //关闭\r\n    win.hidefn = function() {\r\n        var value = win.editor.getValue()\r\n        mygrid.cells(rowId, cellInd).setValue(value)\r\n        store.item(rowId).value = value\r\n    }\r\n    win.on('hide', win.hidefn);\r\n    var dValue = mygrid.cells(rowId, cellInd).getValue();\r\n    if (dValue == \"\") {\r\n        dValue = \"//var date=new Date(dateTime.getValue()) //获取标准日期 \\r\\n\" +\r\n            \"//date.setDate(date.getDate()-1)//前移或后移天数  \\r\\n\" +\r\n            \"//date.setMonth(date.getMonth()+n)//前移或后移月数  \\r\\n\" +\r\n            \"//date.setFullYear(date.getFullYear()+n)//前移或后移年数  \\r\\n\" +\r\n            \"//value = vmd.Date.format(date,'Y-m-d')//返回查询日期  \\r\\n\" +\r\n            \"//value = vmd.Date.format(date,'Ym')//返回查询年月  \\r\\n\" +\r\n            \"//value = vmd.Date.format(date,'Y')//返回查询年度  \\r\\n\" +\r\n            \"//返回值 \\r\\n return \\\"\\\"\"\r\n    }\r\n    win.editor.value = dValue;\r\n    win.show();\r\n    Ext.defer(function() {\r\n        win.editor.focus();\r\n        win.editor.el.dom.click()\r\n    }, 100)\r\n}\r\n\r\nfunction button_click(sender, e) {\r\n    var params = []\r\n    var values = []\r\n    for (var i = 0; i < myFieldDataStore.data.order.length; i++) {\r\n        id = myFieldDataStore.data.order[i]\r\n        if (myFieldDataStore.data.pull[id].value != \"\")\r\n            values.push({\r\n                id: myFieldDataStore.data.pull[id].id,\r\n                value: myFieldDataStore.data.pull[id].value\r\n            });\r\n    }\r\n    for (var i = 0; i < myParamDataStore.data.order.length; i++) {\r\n        id = myParamDataStore.data.order[i]\r\n        if (myParamDataStore.data.pull[id].value != \"\")\r\n            params.push({\r\n                id: myParamDataStore.data.pull[id].id,\r\n                value: myParamDataStore.data.pull[id].value\r\n            });\r\n    }\r\n    // parent.xds.active.component.setConfig(\"config\",{\r\n    //     params: params,\r\n    //      values: values\r\n    //  })\r\n    window.vmdReturnValue = Ext.encode({\r\n        params: params,\r\n        values: values\r\n    })\r\n    parent.edClose(true);\r\n}\r\n\r\nfunction div5_afterrender(sender) {\r\n\r\n}","vmdcss":"","vmdprops":"\"\"","type":"module","vmdresource":"{\"components\":[{\"cid\":\"vmdrescsss\",\"layoutConfig\":{},\"userConfig\":{}},{\"cid\":\"vmdresjss\",\"layoutConfig\":{},\"userConfig\":{},\"cn\":[{\"cid\":\"resjs\",\"id\":\"project.config.js\",\"layoutConfig\":{},\"userConfig\":{}}]},{\"cid\":\"vmdresimgs\",\"layoutConfig\":{},\"userConfig\":{}}]}"}