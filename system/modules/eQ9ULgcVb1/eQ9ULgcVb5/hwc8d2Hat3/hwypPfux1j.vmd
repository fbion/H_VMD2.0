{"vmdlayout":"{\"components\":[{\"cid\":\"viewport\",\"id\":\"MyViewport\",\"layoutConfig\":{},\"userConfig\":{\"layout\":\"border\",\"afterrender\":\"MyViewport_afterrender\"},\"cn\":[{\"cid\":\"panel\",\"id\":\"panel2\",\"layoutConfig\":{},\"userConfig\":{\"region\":\"north\",\"height\":29,\"border\":false,\"header\":false,\"layout\":\"absolute\"},\"cn\":[{\"cid\":\"label\",\"id\":\"label\",\"layoutConfig\":{},\"userConfig\":{\"text\":\"请选择要注册的子系统：\",\"x\":5,\"y\":5}}]},{\"cid\":\"panel\",\"id\":\"panel\",\"layoutConfig\":{},\"userConfig\":{\"region\":\"center\",\"layout\":\"border\",\"header\":false,\"border\":false},\"cn\":[{\"cid\":\"panel\",\"id\":\"panel3\",\"layoutConfig\":{},\"userConfig\":{\"border\":false,\"header\":false,\"region\":\"center\",\"height\":619,\"layout\":\"fit\"},\"cn\":[{\"cid\":\"vmdTree\",\"id\":\"hwTree\",\"layoutConfig\":{},\"userConfig\":{\"style\":\"margin-left:  5px;    margin-top:  5px;    margin-bottom: 10px;    margin-right: 10px;\",\"afterrender\":\"hwTree_afterrender\",\"region\":\"center\"}}]},{\"cid\":\"panel\",\"id\":\"panel4\",\"layoutConfig\":{},\"userConfig\":{\"region\":\"south\",\"header\":false,\"border\":false,\"height\":50,\"layout\":\"absolute\"},\"cn\":[{\"cid\":\"label\",\"id\":\"label1\",\"layoutConfig\":{},\"userConfig\":{\"text\":\"虚拟目录：\",\"x\":10,\"y\":10}},{\"cid\":\"textfield\",\"id\":\"MyField\",\"layoutConfig\":{},\"userConfig\":{\"x\":80,\"y\":10,\"width\":240}}]}]},{\"cid\":\"panel\",\"id\":\"panel1\",\"layoutConfig\":{\"align\":\"top\",\"pack\":\"center\"},\"userConfig\":{\"region\":\"south\",\"header\":false,\"border\":false,\"height\":40,\"layout\":\"hbox\"},\"cn\":[{\"cid\":\"vmdButton\",\"id\":\"button\",\"layoutConfig\":{},\"userConfig\":{\"region\":\"west\",\"text\":\"注册\",\"type\":\"info\",\"size\":\"small\",\"click\":\"button_click\"}},{\"cid\":\"container\",\"id\":\"div\",\"layoutConfig\":{},\"userConfig\":{\"width\":100,\"border\":false}},{\"cid\":\"vmdButton\",\"id\":\"button1\",\"layoutConfig\":{},\"userConfig\":{\"text\":\"取消\",\"click\":\"button1_click\"}}]}]},{\"cid\":\"vmddataset\",\"id\":\"数据集\",\"layoutConfig\":{},\"userConfig\":{}},{\"cid\":\"vmdvariable\",\"id\":\"变量\",\"layoutConfig\":{},\"userConfig\":{}}]}","vmdevents":"function hwTree_afterrender(sender) {\n    //初始化数据\n    myMask = new Ext.LoadMask(Ext.getCmp(\"hwTree\").el, {\n        msg: \"数据加载中,请稍后...\",\n        msgCls: 'z-index:10000;'\n    });\n    myMask.show();\n    var mytree = hwTree;\n    mytree.deleteChildItems(0);\n    mytree.loadJSONObject({\n        id: 0,\n        text: \"我的项目\",\n        item: []\n    });\n    //mytree.enableRadioButtons(true)\n    //mytree.enableSingleRadioMode(true)\n    hwDas.ajax({\n        das: {\n            idedas: true\n        },\n        url: \"zjsjyjcywgl系统/pt/hqzxt\",\n        type: 'get',\n        timeout: 5000,\n        params: {},\n        success: function(result) {\n            var datajson = result.data[0].datas;\n            for(var i = 0; i < datajson.length; i++) {\n                mytree.insertNewChild(0, datajson[i].subsysid, datajson[i].subsysname);\n                mytree.setItemImage2(datajson[i].subsysid, \"tree/model.png\", \"tree/model.png\", \"tree/model.png\");\n            }\n            myMask.hide();\n        },\n        error: function(msg) {\n            myMask.hide();\n            Ext.Msg.alert(\"提示\", \"获取平台子系统信息失败\", function() {})\n        }\n    })\n}\n\nfunction button_click(sender) {\n    var mytree = hwTree;\n    //将节点信息传递到设计页面\n    var selId = mytree.getSelectedItemId();\n    var myPtree = parent.hwTree;\n    var selPId = parent.hwTree.getSelectedItemId();\n    var selNode = myPtree.itemObj[selPId];\n    var proId = selNode.projectId;\n    var data = [{\n        subsysid: selId,\n        moduleguid: selNode.id,\n        modulename: selNode.text,\n        moudelinfo: selNode.remark,\n        moduletype: 1,\n        startname: \"/release\" + selNode.path + \".html\",\n        enable: 1,\n        args: \"\"\n    }];\n\n    hwDas.ajax({\n        das: {\n            idedas: true\n        },\n        url: \"zjsjyjcywgl系统/pt/zcmk\",\n        type: \"save\",\n        timeout: 5000,\n        data: data,\n        success: function(result) {\n            myMask.msg = \"正在发布页面！\";\n            var path = vmd.core.getVirtualPath() + \"modules\" + selNode.path + \"_r.html\";\n            var releasePath = \"release\" + selNode.path + \".html\";\n            var virtualPath = \"\";\n            if(MyField.getValue() != \"\")\n                virtualPath = \"/\" + MyField.getValue();\n            vmd.core.createReleaseHtml(path, releasePath, virtualPath, function() {\n                myMask.hide();\n                Ext.Msg.alert(\"提示\", \"注册模块信息成功\", function() {\n                parent.openWinFrom.hide();})\n            });\n            hwDas.copy(\"vmd\",\"modules/\" + proId + \"/img\", \"release/\" + proId + \"/img\",function(){},function(){});\n            hwDas.copy(\"vmd\",\"modules/\" + proId + \"/css\", \"release/\" + proId + \"/css\",function(){},function(){});\n            hwDas.copy(\"vmd\",\"modules/\" + proId + \"/js\", \"release/\" + proId + \"/js\",function(){},function(){});\n        },\n        error: function(msg) {\n            myMask.hide();\n            Ext.Msg.alert(\"提示\", \"注册模块信息失败\", function() {})\n            parent.openWinFrom.hide();\n        }\n    })\n}\n\nfunction button1_click(sender) {\n    parent.openWinFrom.hide();\n}\n\nfunction MyViewport_afterrender(sender) {\n    var vp = vmd.core.getVirtualPath().replace(window.location.origin + \"/\", \"\");\n    if(vp.lastIndexOf(\"/\") > 0)\n        MyField.setValue(vp.substr(0, vp.lastIndexOf(\"/\")));\n    else\n        MyField.setValue(\"\");\n}","vmdcss":"","vmdprops":"\"\"","type":"module"}