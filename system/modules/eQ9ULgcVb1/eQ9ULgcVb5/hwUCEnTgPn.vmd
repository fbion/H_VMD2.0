{"vmdversion":"2.0.3.20190124","vmdlayout":"{\"components\":[{\"cid\":\"viewport\",\"id\":\"MyViewport\",\"layoutConfig\":{},\"userConfig\":{\"layout\":\"border\",\"afterrender\":\"MyViewport_afterrender\",\"beforerender\":\"MyViewport_beforerender\"},\"cn\":[{\"cid\":\"panel\",\"id\":\"panel2\",\"layoutConfig\":{},\"userConfig\":{\"region\":\"north\",\"height\":54,\"border\":false,\"header\":false,\"layout\":\"vbox\",\"style\":\"background-color: lightblue;\",\"bodyStyle\":\"background-color: lightblue;\"},\"cn\":[{\"cid\":\"container\",\"id\":\"div6\",\"layoutConfig\":{},\"userConfig\":{\"x\":0,\"y\":0,\"style\":\"background-color: white;    width: 100%\",\"height\":30,\"width\":1400,\"layout\":\"absolute\"},\"cn\":[{\"cid\":\"label\",\"id\":\"label5\",\"layoutConfig\":{},\"userConfig\":{\"x\":235,\"y\":5,\"height\":20,\"text\":\"平台库：\"}},{\"cid\":\"label\",\"id\":\"label4\",\"layoutConfig\":{},\"userConfig\":{\"x\":10,\"y\":5,\"text\":\"平台类型：\"}},{\"cid\":\"vmdComlist\",\"id\":\"comlist\",\"layoutConfig\":{},\"userConfig\":{\"x\":290,\"y\":2,\"width\":130,\"style\":\"background-color: white;\",\"cls\":\"\",\"store\":\"store1\",\"valueField\":\"id\",\"displayField\":\"name\",\"selectChanged\":\"comlist_selectChanged\"}},{\"cid\":\"radiogroup\",\"id\":\"hwRadioGroup\",\"layoutConfig\":{},\"userConfig\":{\"x\":75,\"y\":0,\"height\":40},\"cn\":[{\"cid\":\"radio\",\"id\":\"r_pt4\",\"layoutConfig\":{},\"userConfig\":{\"boxLabel\":\"平台4\",\"fieldLabel\":\"\",\"width\":71,\"id\":\"r_pt4\",\"checked\":true,\"x\":0,\"y\":0}},{\"cid\":\"radio\",\"id\":\"r_pt5\",\"layoutConfig\":{},\"userConfig\":{\"fieldLabel\":\"\",\"boxLabel\":\"平台5\",\"width\":69,\"id\":\"r_pt5\",\"x\":0,\"y\":0,\"checked\":false,\"afterrender\":\"r_pt5_afterrender\"}}]}]},{\"cid\":\"label\",\"id\":\"label\",\"layoutConfig\":{},\"userConfig\":{\"text\":\"请选择要注册的子系统：\",\"x\":20,\"y\":35,\"margins\":\"5 0 0 10\"}}]},{\"cid\":\"panel\",\"id\":\"panel\",\"layoutConfig\":{},\"userConfig\":{\"region\":\"center\",\"layout\":\"border\",\"header\":false,\"border\":false},\"cn\":[{\"cid\":\"panel\",\"id\":\"panel3\",\"layoutConfig\":{},\"userConfig\":{\"border\":true,\"header\":false,\"region\":\"center\",\"height\":619,\"layout\":\"anchor\"},\"cn\":[{\"cid\":\"container\",\"id\":\"div1\",\"layoutConfig\":{},\"userConfig\":{\"anchor\":\"100% 45%\",\"layout\":\"fit\",\"style\":\"padding-bottom: 8px;\"},\"cn\":[{\"cid\":\"vmdTreeEx\",\"id\":\"tree\",\"layoutConfig\":{},\"userConfig\":{\"x\":180,\"y\":10,\"store\":\"store\",\"parentField\":\"parentid\",\"valueField\":\"subsysid\",\"textField\":\"subsysname\",\"loadType\":\"全部加载\",\"rootValue\":\"0\",\"hideRoot\":true,\"rootText\":\"子系统\",\"leafImg\":\"/system/modules/eQ9ULgcVb1/img/folderClosed.gif\"}}]},{\"cid\":\"container\",\"id\":\"div3\",\"layoutConfig\":{},\"userConfig\":{\"anchor\":\"100% 55%\",\"layout\":\"border\"},\"cn\":[{\"cid\":\"container\",\"id\":\"div4\",\"layoutConfig\":{},\"userConfig\":{\"region\":\"north\",\"border\":false,\"layout\":\"column\",\"height\":73},\"cn\":[{\"cid\":\"label\",\"id\":\"label2\",\"layoutConfig\":{},\"userConfig\":{\"x\":8,\"y\":20,\"text\":\"数据服务地址:\"}},{\"cid\":\"textfield\",\"id\":\"txt_dataserverip\",\"layoutConfig\":{},\"userConfig\":{\"x\":90,\"y\":10,\"width\":180,\"columnWidth\":0.5,\"id\":\"txt_dataserverip\"}},{\"cid\":\"label\",\"id\":\"label3\",\"layoutConfig\":{},\"userConfig\":{\"x\":310,\"y\":20,\"text\":\"工作流地址：\"}},{\"cid\":\"textfield\",\"id\":\"txt_workflowip\",\"layoutConfig\":{},\"userConfig\":{\"x\":390,\"y\":10,\"width\":180,\"columnWidth\":0.5,\"id\":\"txt_workflowip\"}},{\"cid\":\"label\",\"id\":\"label6\",\"layoutConfig\":{},\"userConfig\":{\"x\":310,\"y\":20,\"text\":\"消息中心地址:\"}},{\"cid\":\"textfield\",\"id\":\"txt_msg\",\"layoutConfig\":{},\"userConfig\":{\"x\":390,\"y\":10,\"width\":180,\"columnWidth\":0.5,\"id\":\"txt_msg\"}}]},{\"cid\":\"container\",\"id\":\"div5\",\"layoutConfig\":{},\"userConfig\":{\"region\":\"center\",\"layout\":\"border\"},\"cn\":[{\"cid\":\"container\",\"id\":\"div2\",\"layoutConfig\":{},\"userConfig\":{\"anchor\":\"100% 10%\",\"border\":false,\"layout\":\"absolute\",\"region\":\"north\",\"height\":26,\"style\":\"background-color: lightblue;\"},\"cn\":[{\"cid\":\"label\",\"id\":\"title\",\"layoutConfig\":{},\"userConfig\":{\"anchor\":\"\",\"height\":20,\"id\":\"title\",\"text\":\"   设置资源服务器：\",\"autoHeight\":false,\"width\":100,\"y\":5,\"x\":5,\"autoWidth\":true}}]},{\"cid\":\"container\",\"id\":\"DivResource\",\"layoutConfig\":{},\"userConfig\":{\"anchor\":\"100% 30%\",\"id\":\"DivResource\",\"layout\":\"fit\",\"region\":\"center\"},\"cn\":[{\"cid\":\"panel\",\"id\":\"palResource\",\"layoutConfig\":{},\"userConfig\":{\"border\":false,\"header\":false,\"id\":\"palResource\",\"layout\":\"anchor\",\"autoScroll\":true},\"cn\":[{\"cid\":\"vmd.ux.PublishResource\",\"id\":\"PublishResource\",\"layoutConfig\":{},\"userConfig\":{\"anchor\":\"100% \"}}]}]}]}]}]},{\"cid\":\"panel\",\"id\":\"panel4\",\"layoutConfig\":{\"align\":\"middle\",\"pack\":\"start\"},\"userConfig\":{\"region\":\"south\",\"header\":false,\"border\":false,\"height\":35,\"layout\":\"hbox\"},\"cn\":[{\"cid\":\"label\",\"id\":\"label1\",\"layoutConfig\":{},\"userConfig\":{\"text\":\"虚拟目录：\",\"x\":10,\"y\":10}},{\"cid\":\"textfield\",\"id\":\"MyField\",\"layoutConfig\":{},\"userConfig\":{\"x\":80,\"y\":5,\"width\":240}},{\"cid\":\"label\",\"id\":\"label7\",\"layoutConfig\":{},\"userConfig\":{\"x\":390,\"y\":20,\"text\":\"注：在项目配置信息中对注册发布的数据信息、资源、服务等进行设置。\",\"style\":\"color:red;font-weight: bold;\"}}]}]},{\"cid\":\"panel\",\"id\":\"panel1\",\"layoutConfig\":{\"align\":\"top\",\"pack\":\"center\"},\"userConfig\":{\"region\":\"south\",\"header\":false,\"border\":false,\"height\":40,\"layout\":\"hbox\"},\"cn\":[{\"cid\":\"vmdButton\",\"id\":\"button\",\"layoutConfig\":{},\"userConfig\":{\"region\":\"west\",\"text\":\"注册\",\"type\":\"info\",\"size\":\"small\",\"click\":\"button_click\"}},{\"cid\":\"container\",\"id\":\"div\",\"layoutConfig\":{},\"userConfig\":{\"width\":100,\"border\":false}},{\"cid\":\"vmdButton\",\"id\":\"button1\",\"layoutConfig\":{},\"userConfig\":{\"text\":\"取消\",\"click\":\"button1_click\"}}]}]},{\"cid\":\"vmddataset\",\"id\":\"数据集\",\"layoutConfig\":{},\"userConfig\":{},\"cn\":[{\"cid\":\"vmdJsonStore\",\"id\":\"store\",\"layoutConfig\":{},\"userConfig\":{\"storeConfig\":\"{\\\"id\\\":\\\"bl11rwaUwv\\\",\\\"callcode\\\":\\\"vmdCode\\\",\\\"url\\\":\\\"CDEServcie/pt/getSubSystem\\\",\\\"host\\\":\\\"\\\",\\\"isHwRest\\\":true,\\\"name\\\":\\\"获取子系统\\\",\\\"getMethods\\\":[{\\\"id\\\":\\\"pttype\\\",\\\"value1\\\":\\\"return pttype.getValue()\\\",\\\"value2\\\":\\\"\\\"},{\\\"id\\\":\\\"ptdb\\\",\\\"value1\\\":\\\"return comlist.getValue();\\\",\\\"value2\\\":\\\"\\\"}],\\\"postMethods\\\":[],\\\"putMethods\\\":[],\\\"deleteMethods\\\":[],\\\"saveMethods\\\":[],\\\"fields\\\":[{\\\"name\\\":\\\"subsysname\\\",\\\"type\\\":\\\"string\\\"},{\\\"name\\\":\\\"subsysid\\\",\\\"type\\\":\\\"string\\\"},{\\\"name\\\":\\\"parentid\\\",\\\"type\\\":\\\"string\\\"}]}\",\"autoLoad\":false},\"cn\":[{\"cid\":\"datafield\",\"layoutConfig\":{},\"userConfig\":{\"cid\":\"datafield\",\"name\":\"subsysname\"},\"name\":\"subsysname\"},{\"cid\":\"datafield\",\"layoutConfig\":{},\"userConfig\":{\"cid\":\"datafield\",\"name\":\"subsysid\"},\"name\":\"subsysid\"},{\"cid\":\"datafield\",\"layoutConfig\":{},\"userConfig\":{\"cid\":\"datafield\",\"name\":\"parentid\"},\"name\":\"parentid\"}]},{\"cid\":\"vmdJsonStore\",\"id\":\"store1\",\"layoutConfig\":{},\"userConfig\":{\"cid\":\"vmdJsonStore\",\"storeConfig\":\"{\\\"id\\\":\\\"madJo1582v\\\",\\\"callcode\\\":\\\"vmdCode\\\",\\\"url\\\":\\\"CDEServcie/pt/getdataresource\\\",\\\"host\\\":\\\"\\\",\\\"isHwRest\\\":true,\\\"name\\\":\\\"获取数据资源\\\",\\\"getMethods\\\":[{\\\"id\\\":\\\"datasource_id\\\",\\\"value1\\\":\\\"\\\",\\\"value2\\\":\\\"\\\"}],\\\"postMethods\\\":[],\\\"putMethods\\\":[],\\\"deleteMethods\\\":[],\\\"saveMethods\\\":[],\\\"fields\\\":[{\\\"name\\\":\\\"id\\\",\\\"type\\\":\\\"string\\\"},{\\\"name\\\":\\\"name\\\",\\\"type\\\":\\\"string\\\"}]}\",\"load\":\"store1_load\"},\"cn\":[{\"cid\":\"datafield\",\"layoutConfig\":{},\"userConfig\":{\"cid\":\"datafield\",\"name\":\"id\"},\"name\":\"id\"},{\"cid\":\"datafield\",\"layoutConfig\":{},\"userConfig\":{\"cid\":\"datafield\",\"name\":\"name\"},\"name\":\"name\"}]}]},{\"cid\":\"vmdvariable\",\"id\":\"变量\",\"layoutConfig\":{},\"userConfig\":{},\"cn\":[{\"cid\":\"vmdVariable\",\"id\":\"pttype\",\"layoutConfig\":{},\"userConfig\":{\"value\":\"return \\\"\\\"\",\"id\":\"pttype\"}}]},{\"cid\":\"vmdsubviewport\",\"id\":\"SubView_Window\",\"layoutConfig\":{},\"userConfig\":{}}]}","vmdevents":"var workspaceid = getUrlParam(workspaceid)\nif(workspaceid) {\n    vmd.core.getWorkSpaceServer(workspaceid);\n}\n\n//根据选择的平台4还是5 进行数据集动态刷新，并获取对应平台的子系统信息\nfunction loadSubSys(projectId) {\n    if(r_pt5.checked) {\n        pttype.setValue(\"5\");\n        tree.leafImg = vmdSettings.systemPath+\"/img/folderClosed.gif\";\n    } else {\n        pttype.setValue(\"4\");\n        tree.leafImg = \"/lib/dhtmlx/imgs/dhxtree_material/tree/model.png\";\n    }\n    store.toRefresh(function() {\n        if(projectId) {\n            var selNode = tree.getNodeById(projectId);\n            if(selNode) {\n                tree.expandPath(selNode.getPath());\n                selNode.select();\n            }\n        }\n    });\n}\n\nfunction button_click(sender) {\n    var listPublishResourceServers = [];\n    var objlistResourceNameIP = {};\n    for(var i = 0; i < listPublishResourceComps.length; i++) {\n        var Serversinfo = listPublishResourceComps[i].getText();\n        listPublishResourceServers.push(Serversinfo);\n    }\n    for(var i = 0; i < listResourceNameIP.length; i++) {\n        for(var j = 0; j < listPublishResourceServers.length; j++) {\n            if(listResourceNameIP[i].oldip == listPublishResourceServers[j].oldIP) {\n                listResourceNameIP[i].newip = listPublishResourceServers[j].newIP || listPublishResourceServers[j].oldIP\n                objlistResourceNameIP[listResourceNameIP[i].name] = \"http://\" + listResourceNameIP[i].newip + \"/\" + (vmdSettings.resourceCode || \"resource\");\n                break;\n            }\n        }\n    }\n    //var mytree = hwTree;\n    //将节点信息传递到设计页面\n    var selId = tree.getSelNodeId(); //mytree.getSelectedItemId();\n    if(!selId) {\n        Ext.Msg.alert(\"提示\", \"请选择模块要注册到的子系统！\", function() {})\n        return;\n    }\n    var myPtree = parent.hwTree;\n    var selPId = parent.hwTree.getSelectedItemId();\n    var selNode = myPtree.itemObj[selPId];\n    var proId = selNode.projectId;\n    var data = [{\n        subsysid: selId,\n        moduleguid: selNode.id,\n        modulename: selNode.text,\n        moudelinfo: selNode.remark,\n        moduletype: 1,\n        ptdb: comlist.getValue() || \"pt\",\n        startname: \"/release\" + selNode.path + \".html\",\n        enable: 1,\n        args: \"\"\n    }];\n    var zcurl = \"CDEServcie/pt/zcmk\";\n    if(r_pt5.checked)\n        zcurl = \"CDEServcie/pt/ptfivezcmk\";\n\n    //虚拟目录获取\n    var virtualPath = \"\";\n    if(MyField.getValue() != \"\")\n        virtualPath = \"/\" + MyField.getValue();\n    //注册模块成功之后的逻辑处理 \n    var regSuccFun = function(result) {\n        var path = vmd.core.getVirtualPath() + \"modules\" + selNode.path + \"_r.html\";\n        var releasePath = \"release\" + selNode.path + \".html\";\n        createReleaseFun(path, releasePath, selNode.id)\n        hwDas.copy(\"vmd\", \"modules/\" + proId + \"/img\", \"release/\" + proId + \"/img\", function() {}, function(msg) {\n            console.log(msg)\n        });\n        hwDas.copy(\"vmd\", \"modules/\" + proId + \"/css\", \"release/\" + proId + \"/css\", function() {}, function(msg) {\n            console.log(msg)\n        });\n        hwDas.copy(\"vmd\", \"modules/\" + proId + \"/js\", \"release/\" + proId + \"/js\", function() {}, function(msg) {\n            console.log(msg)\n        });\n    }\n    //处理模块信息的递归处理\n    var createReleaseFun = function(path, releasePath, moduleid) {\n        vmd.core.createReleaseHtml(path, releasePath, virtualPath, function() {}, objlistResourceNameIP, selNode.projectId);\n        //调用服务获取当前模块是否存在子页面  通过moduleid进行服务处理\n        hwDas.get(\"CDEServcie/module/getchildmodule\", {}, {\n            mainmoduleid: moduleid\n        }, function(result) {\n            if(result.data.length > 0 && result.data[0].size > 0) {\n                var count = 0,\n                    length = result.data[0].size;\n                for(var i = 0; i < result.data[0].size; i++) {\n                    var r_path = result.data[0].datas[i].filepath;\n                    var r_moduleid = result.data[0].datas[i].id;\n                    vmd.core.createReleaseHtml(vmd.core.getVirtualPath() + \"modules\" + r_path + \"_r.html\", \"release\" + r_path + \".html\", virtualPath, function() {\n                        count++\n                        if(count == length)\n                            vmd.tip('注册模块成功！', 'success');\n                    }, objlistResourceNameIP, selNode.projectId)\n                }\n            } else {\n                vmd.tip('注册模块成功！', 'success');\n            }\n        }, function(msg) {\n            console.log(msg)\n        })\n    }\n    //调用服务进行平台模块注册\n    hwDas.ajax({\n        das: {\n            idedas: true\n        },\n        url: zcurl,\n        type: \"save\",\n        timeout: 50000,\n        data: data,\n        success: function(result) {\n            regSuccFun(result)\n        },\n        error: function(msg) {\n            Ext.Msg.alert(\"提示\", \"注册模块信息失败\", function() {})\n            parent.openWinFrom.hide();\n        }\n    })\n\n    // // 保存配置信息\n    // var saveVmdConfig = function(filename, bodyStr) {\n    //     Ext.Ajax.request({\n    //         url: vmd.vmdUploadPath + 'FileService',\n    //         timeout: 50000,\n    //         success: function(result) {},\n    //         failure: function(result) {\n    //             Ext.Msg.alert('错误', '网络超时，保存项目配置信息失败！')\n    //         },\n    //         headers: {\n    //             FileName: 'release/' + selNode.projectId + \"/\" + filename,\n    //         },\n    //         params: {\n    //             body: bodyStr\n    //         }\n    //     })\n    // }\n\n    // var bodyStr = 'vmd.workspace={\\n';\n    // bodyStr += \"dataServiceIp: \\\"\" + (txt_dataserverip.getValue()) + \"\\\",\\n\";\n    // bodyStr += \"workflowIp: \\\"\" + (txt_workflowip.getValue()) + \"\\\",\\n\";\n    // bodyStr += \"msgIp: \\\"\" + (txt_msg.getValue()) + \"\\\"\\n\";\n    // bodyStr += '}' + \"\\n\";\n    // //objlistResourceNameIP\n    // bodyStr += 'vmd.resourceSettings={\\n';\n    // for(g in objlistResourceNameIP) {\n    //     bodyStr += \"\\\"\" + g + \"\\\":\\\"\" + objlistResourceNameIP[g] + \"\\\",\\n\";\n    // }\n    // bodyStr += '}' + \"\\n\";\n\n    // if(txt_msg.getValue() != \"\") {\n    //     bodyStr += \"hwMSC.host=\\\"\" + (txt_msg.getValue()) + \"\\\"\\n\";\n    // }\n\n    // if(txt_dataserverip.getValue() != \"\") {\n    //     bodyStr += \"hwDas.hosts=[\\\"\" + (txt_dataserverip.getValue()) + \"\\\"]\\n\";\n    // }\n    // //处理项目的配置文件\n    // saveVmdConfig(\"config.js\", bodyStr);\n}\n\nfunction button1_click(sender) {\n    parent.openWinFrom.hide();\n}\n\nvar listPublishResourceComps = []; //记录动态添加的组件列表。\nvar listResourceIP = []; //记录当前模块所有的资源服务器地址\nvar listResourceNameIP = []; //记录资源的名称和ip信息\nvar r_pt5checked = false; //记录是否选中了pt5\n\nvar defaultPtdb = \"pt\"\n\nfunction MyViewport_afterrender(sender) {\n\n\n    //先获取项目的发布配置信息，\n    var projectId = parent.btnProjectName.projectId; //\"hw38ca28ed\"; //vmd.workspace.projectid;\n    hwDas.get(\"DataServiceWorkSpace/projectInfo/projectreginfo\", {}, {\n        projectid: projectId\n    }, function(result) {\n        var subsysid;\n        var resourceserver = [];\n        if(result.data && result.data.length > 0 && result.data[0].datas && result.data[0].datas.length > 0) {\n            if(result.data[0].datas[0].pttype == \"5\") { //处理设置的为平台4还是平台5，并选中对应的类型\n                r_pt5checked = true;\n                r_pt5.checked = true;\n                r_pt5.setValue(true);\n                r_pt4.checked = false;\n                r_pt4.setValue(false);\n            } else {\n                r_pt5checked = false;\n            }\n            //设置默认的数据源  初始化时，如数据源下来未加载完，则需要设置default 变量为对应的id，在下拉初始化完成后再设置\n            if(result.data[0].datas[0].ptdb == \"\" && result.data[0].datas[0].pttype == \"5\") {\n                comlist.setValue(\"newpt\")\n                defaultPtdb = \"newpt\"\n            } else if(result.data[0].datas[0].ptdb == \"\") {\n                comlist.setValue(\"pt\")\n                defaultPtdb = \"pt\"\n            } else {\n                comlist.setValue(result.data[0].datas[0].ptdb)\n                defaultPtdb = result.data[0].datas[0].ptdb;\n            }\n            //获取配置的项目发布的其他信息\n            subsysid = result.data[0].datas[0].subsysid;\n            txt_dataserverip.setValue(result.data[0].datas[0].dasserver)\n            txt_workflowip.setValue(result.data[0].datas[0].wfserver)\n            txt_msg.setValue(result.data[0].datas[0].msgserver)\n            MyField.setValue(result.data[0].datas[0].virtualdir)\n            resourceserver = Ext.decode(result.data[0].datas[0].resourceserver);\n        }\n        loadSubSys(subsysid);\n        //添加radio的check事件，在此处添加的原因为防止初始化时，设置radio选中会触发事件，调用loadSubSys，导致加载两次树\n        addCheckEvent();\n        //设置界面中文本框的虚拟目录\n        var vp = \"\"\n        if(!window.location.origin) {\n            window.location.origin = window.location.protocol + \"//\" + window.location.hostname + (window.location.port ? ':' + window.location.port : '');\n        }\n        vp =vmd.core.getVirtualPath().replace(window.location.origin + \"/\", \"\");\n        if(vp.lastIndexOf(\"/\") > 0)\n            MyField.setValue(vp.substr(0, vp.lastIndexOf(\"/\")));\n\n        //递归添加地址对应组件，并设置内容\n        //通过当前模块id获取配置的资源中心信息\n        hwDas.get(\"DataServiceWorkSpace/projectInfo/getResSerByModuleId\", {}, {\n            module_id: parent.hwTree.getSelectedItemId() //\"hw87960710\" \n        }, function(result) {\n            //如果配置了，则处理配置的资源中心地址\n            if(result.data && result.data.length > 0 && result.data[0].datas && result.data[0].datas.length > 0) {\n                //遍历 添加的资源地址  \n                for(var i = 0; i < result.data[0].datas.length; i++) {\n                    if(listResourceIP.indexOf(result.data[0].datas[i].resource_server_ip) < 0) {\n                        listResourceIP.push(result.data[0].datas[i].resource_server_ip);\n                        var ipresource = new vmd.ux.PublishResource({\n                            id: \"PublishResource\" + i,\n                            anchor: \"100% \"\n                        });\n                        //动态添加地址替换组件，根据有多少不同的地址进行添加\n                        palResource.add(ipresource)\n                        var newip = \"\";\n                        //获取替换的服务的新老地址\n                        for(var j = 0; j < resourceserver.length; j++) {\n                            if(resourceserver[j].oldip == result.data[0].datas[i].resource_server_ip)\n                                newip = resourceserver[j].newip;\n                        }\n                        //将新老地址赋给替换组件进行替换\n                        ipresource.setText(result.data[0].datas[i].resource_server_ip, newip, result.data[0].datas[i].fullname.replace('&&', '/'));\n                        listPublishResourceComps.push(ipresource)\n                    }\n                    listResourceNameIP.push({\n                        name: result.data[0].datas[i].fullname,\n                        oldip: result.data[0].datas[i].resource_server_ip,\n                        newip: \"\"\n                    })\n                }\n                PublishResource.hide();\n                palResource.onBodyResize()\n            } else { //如果没有设置资源中新，则读取本地默认的资源中心地址，处理逻辑与上述处理一致\n                //调用获取资源中新的公共方法\n                vmd.core.getModuleResourceServices(parent.hwTree.getSelectedItemId(), function(serverlist) {\n                    //遍历 默认的资源地址  \n                    for(var i = 0; i < serverlist.length; i++) {\n                        if(serverlist[i].children && serverlist[i].children.length > 0) {\n                            for(var ii = 0; ii < serverlist[i].children.length; ii++) {\n                                var fullname = serverlist[i].name + '&&' + serverlist[i].children[ii].name;\n                                if(listResourceIP.indexOf(serverlist[i].children[ii].address) < 0) {\n                                    listResourceIP.push(serverlist[i].children[ii].address);\n                                    var ipresource = new vmd.ux.PublishResource({\n                                        id: \"PublishResource\" + i + ii,\n                                        anchor: \"100% \"\n                                    });\n                                    //动态添加地址替换组件，根据有多少不同的地址进行添加\n                                    palResource.add(ipresource)\n                                    var newip = \"\";\n                                    //获取替换的服务的新老地址\n                                    for(var j = 0; j < resourceserver.length; j++) {\n                                        if(resourceserver[j].oldip == serverlist[i].children[ii].address)\n                                            newip = resourceserver[j].newip;\n                                    }\n                                    //将新老地址赋给替换组件进行替换\n                                    ipresource.setText(serverlist[i].children[ii].address, newip, fullname.replace('&&', '/'));\n                                    listPublishResourceComps.push(ipresource)\n                                }\n                                listResourceNameIP.push({\n                                    name: fullname,\n                                    oldip: serverlist[i].children[ii].address,\n                                    newip: \"\"\n                                })\n                            }\n                        }\n                    }\n                    PublishResource.hide();\n                    palResource.onBodyResize()\n                }, function(msg) {})\n            }\n        }, function(msg) {});\n    }, function(msg) {})\n}\n\nfunction addCheckEvent() {\n    r_pt4.on('check', function(radio, checked) {\n        changept(radio, checked);\n    })\n    r_pt5.on('check', function(radio, checked) {\n        changept(radio, checked);\n    })\n}\n\nfunction changept(snder, checked) {\n    if(r_pt5.checked) {\n        pttype.setValue(\"5\");\n        tree.leafImg = vmdSettings.systemPath+\"/img/folderClosed.gif\";\n    } else {\n        pttype.setValue(\"4\");\n        tree.leafImg = \"/lib/dhtmlx/imgs/dhxtree_material/tree/model.png\";\n    }\n    store.toRefresh();\n    loadSubSys()\n}\n\nfunction r_pt5_afterrender(sender) {}\n\nfunction comlist_selectChanged(sender, combo, record, index) {\n    loadSubSys()\n}\n\nfunction store1_load(sender, records, options) {\n    //设置默认平台库\n    comlist.setValue(defaultPtdb)\n}\n\nfunction MyViewport_beforerender(sender) {\n    label1.hide();\n    MyField.hide();\n    panel2.height = 30;\n    div6.hide();\n    div3.hide();\n    div1.anchor = \"100% 100%\"\n    div1.doLayout()\n}","vmdcss":"","vmdprops":"\"\"","type":"module","vmdresource":"{\"components\":[{\"cid\":\"vmdrescsss\",\"layoutConfig\":{},\"userConfig\":{}},{\"cid\":\"vmdresjss\",\"layoutConfig\":{},\"userConfig\":{}},{\"cid\":\"vmdresimgs\",\"layoutConfig\":{},\"userConfig\":{}}]}"}