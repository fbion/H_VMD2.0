{"vmdversion":"vmd2.0.6.200119","vmdlayout":"{\"components\":[{\"cid\":\"viewport\",\"id\":\"MainViewport\",\"layoutConfig\":{},\"userConfig\":{\"layout\":\"absolute\"},\"cn\":[{\"cid\":\"label\",\"id\":\"hwLabel\",\"layoutConfig\":{},\"userConfig\":{\"x\":170,\"y\":10,\"text\":\"选择项目基础镜像\",\"style\":\"font-size: 14px;\"}},{\"cid\":\"label\",\"id\":\"hwLabel1\",\"layoutConfig\":{},\"userConfig\":{\"x\":20,\"y\":115,\"text\":\"vmd基础镜像列表：\",\"style\":\"font-size: 14px;\"}},{\"cid\":\"grid\",\"id\":\"MyGrid\",\"layoutConfig\":{},\"userConfig\":{\"x\":20,\"y\":135,\"width\":440,\"height\":190,\"header\":false,\"border\":true,\"style\":\"font-size: 14px;    border: 1px solid #c5c5c5\",\"enableHdMenu\":false,\"disableHeaderClick\":false,\"hideHeaders\":false,\"afterrender\":\"MyGrid_afterrender\",\"beforerender\":\"MyGrid_beforerender\",\"checked\":\"MyGrid_checked\",\"cellclick\":\"MyGrid_cellclick\"},\"cn\":[{\"cid\":\"checkcolumn\",\"layoutConfig\":{},\"userConfig\":{\"align\":\"center\",\"header\":\"选择\",\"width\":80,\"dataIndex\":\"sel\",\"fixed\":false},\"name\":\"sel\"},{\"cid\":\"gridcolumn\",\"layoutConfig\":{},\"userConfig\":{\"header\":\"镜像版本\",\"dataIndex\":\"ver\",\"width\":200,\"align\":\"center\"},\"name\":\"ver\"},{\"cid\":\"gridcolumn\",\"layoutConfig\":{},\"userConfig\":{\"header\":\"说明\",\"dataIndex\":\"mark\",\"width\":120,\"align\":\"center\"},\"name\":\"mark\"}]},{\"cid\":\"label\",\"id\":\"hwLabel2\",\"layoutConfig\":{},\"userConfig\":{\"x\":20,\"y\":85,\"text\":\"项目镜像名称：\",\"style\":\"font-size: 14px;\"}},{\"cid\":\"textfield\",\"id\":\"hwText\",\"layoutConfig\":{},\"userConfig\":{\"x\":110,\"y\":80,\"width\":290,\"style\":\"font-size: 14px;\"}},{\"cid\":\"label\",\"id\":\"hwLabel3\",\"layoutConfig\":{},\"userConfig\":{\"x\":20,\"y\":330,\"text\":\"项目说明：\",\"style\":\"font-size: 14px;\"}},{\"cid\":\"textarea\",\"id\":\"hwTextArea\",\"layoutConfig\":{},\"userConfig\":{\"x\":20,\"y\":350,\"width\":440,\"height\":80}},{\"cid\":\"vmdButton\",\"id\":\"button\",\"layoutConfig\":{},\"userConfig\":{\"x\":340,\"y\":450,\"text\":\"确定\",\"type\":\"primary\",\"click\":\"button_click\"}},{\"cid\":\"vmdButton\",\"id\":\"button1\",\"layoutConfig\":{},\"userConfig\":{\"x\":410,\"y\":450,\"text\":\"关闭\"}},{\"cid\":\"label\",\"id\":\"hwLabel4\",\"layoutConfig\":{},\"userConfig\":{\"x\":20,\"y\":35,\"text\":\"提示：请确认项目或修改的模块已发布。如已发布请忽略该提示；如未发布，请通过项目配置中的发布项目进行操作。\",\"width\":440,\"style\":\"color:red\"}}]},{\"cid\":\"vmddataset\",\"id\":\"数据\",\"layoutConfig\":{},\"userConfig\":{}},{\"cid\":\"vmdvariable\",\"id\":\"变量\",\"layoutConfig\":{},\"userConfig\":{}},{\"cid\":\"vmdsubviewport\",\"id\":\"SubView_Window\",\"layoutConfig\":{},\"userConfig\":{},\"cn\":[{\"cid\":\"vmdSubView\",\"id\":\"subView\",\"layoutConfig\":{},\"userConfig\":{\"cid\":\"vmdSubView\",\"width\":350,\"height\":303,\"layout\":\"fit\"},\"cn\":[{\"cid\":\"container\",\"id\":\"hwDiv\",\"layoutConfig\":{},\"userConfig\":{\"x\":70,\"y\":70}}]}]}]}","vmdevents":"var comData = [{\n    sel: false,\n    ver: \"vmd2.0.6.200119\",\n    mark: \"版本说明\"\n}, {\n    sel: false,\n    ver: \"vmd2.0.5.200119\",\n    mark: \"版本说明\"\n}, {\n    sel: false,\n    ver: \"vmd2.0.4.200119\",\n    mark: \"版本说明\"\n}, {\n    sel: false,\n    ver: \"vmd2.0.3.200119\",\n    mark: \"版本说明\"\n}]\nvar verstore = new vmd.data.Store({\n    data: comData,\n    fields: ['sel', 'ver', 'mark']\n})\nvar imageServer = \"\"\nvar imageFileService = \"www.hanweikeji.com:10050\"\n\nfunction MyGrid_afterrender(sender) {\n    // //先获取镜像服务地址\n    // var hwFao1 = new HwFao(vmdSettings.vmdFileServiceIp || vmdSettings.dataServiceIp, \"vmd\");\n    // hwFao1.read(\"imageService.txt\", function(result) {\n    //     imageServer = result.data\n    //     if (!imageServer)\n    //         Ext.Msg.alert(\"提示\", \"请先配置镜像服务地址后再操作！\", function() {})\n    //     //通过镜像服务获取文件服务地址\n    //     hwDas.ajax({\n    //         url: \"http://\" + imageServer + \"/VMDCI/initService\",\n    //         type: 'get',\n    //         timeout: 20000,\n    //         success: function(data) {\n    //             imageFileService = data.data\n    //             if (!imageFileService)\n    //                 Ext.Msg.alert(\"提示\", \"获取镜像服务所需的文件服务地址失败！\", function() {});\n\n                //通过文件服务获取对应目录下的文件列表信息\n                var hwFao = new HwFao(imageFileService, \"dockerimages\");\n                hwFao.getDirs(\"data/vmd\", \"Dir\", function(result) {\n                    if (result.data && result.data.length > 0) {\n                        var storeData = []\n                        for (var i = 0; i < result.data.length; i++) {\n                            if (result.data[i].type = 'Dir' && result.data[i].name) {\n                                storeData.push({\n                                    sel: false,\n                                    ver: result.data[i].name,\n                                    mark: \"版本说明\"\n                                })\n                            }\n                        }\n                        //更新数据\n                        verstore.loadData(storeData);\n                    }\n                }, function() {})\n    //         },\n    //         error: function(msg) {\n    //             Ext.Msg.alert(\"提示\", \"获取镜像服务所需的文件服务地址失败！\", function() {});\n    //         }\n    //     })\n    // }, function(result) {\n    //     Ext.Msg.alert(\"提示\", \"请先配置镜像服务地址后再操作！\", function() {})\n    // })\n}\n\nfunction MyGrid_beforerender(sender) {\n    MyGrid.store = verstore;\n}\n\nfunction button_click(sender, e) {\n    var selVer = \"\"\n    for (var i = 0; i < verstore.getCount(); i++) {\n        var rreacord = verstore.getAt(i)\n        if (rreacord.get(\"sel\")) {\n            selVer = rreacord.get(\"ver\")\n        }\n    }\n    if (!selVer) {\n        Ext.Msg.alert(\"提示\", \"请选择项目镜像！\", function() {})\n        return;\n    }\n    if (!hwText.getValue()) {\n        Ext.Msg.alert(\"提示\", \"项目镜像名称不能为空！\", function() {})\n        return;\n    }\n    var publishparams = {\n        fileSerIp: imageFileService,\n        imageSerIp: imageServer,\n        vmd_ver: selVer,\n        projectId: vmd.getUrlParam(\"projectId\"),\n        projectName: vmd.getUrlParam(\"projectName\"),\n        imageType: 2,\n        vmdToken: Cookie.get(\"hwToken\"),\n        info: hwTextArea.getValue()\n    };\n    var myMask = new Ext.LoadMask(Ext.getBody(), {\n        msg: \"正在发布\" + vmd.getUrlParam(\"projectName\") + \"镜像,请稍后...\",\n        msgCls: 'z-index:10000;'\n    });\n    myMask.show();\n    //发布\n    vmd.ajax({\n        url: \"/expandimp/api/ImagePublish\",\n        type: 'post',\n        timeout: 120000,\n        //dataType:\"text\",\n        contentType: 'application/json;charset=UTF-8',\n        data: publishparams, //jsonp: \"callbackparam\", \n        success: function(result) {\n            myMask.hide();\n            if (result.type == \"success\") {\n                Ext.Msg.alert(\"提示\", \"发布成功！\")\n            } else\n                Ext.Msg.alert(\"提示\", result.msg)\n        },\n        error: function(msg) {\n            myMask.hide();\n            Ext.Msg.alert(\"提示\", \"发布失败！\")\n        }\n    })\n}\nvar selrowIndex;\n\nfunction MyGrid_checked(sender, field, val, record, rowIndex, columnIndex, e) {\n    if (!record)\n        return;\n    selrowIndex = rowIndex;\n    for (var i = 0; i < verstore.getCount(); i++) {\n        var rreacord = verstore.getAt(i)\n        if (i != selrowIndex && selrowIndex >= 0)\n            rreacord.set(\"sel\", false)\n    }\n\n\n\n    var myDate = new Date();\n    hwText.setValue(vmd.getUrlParam(\"projectName\") + \"-\" + myDate.format('ymd') + \"-\" + record.ver)\n\n\n\n}\n\nfunction MyGrid_cellclick(sender, rowIndex, columnIndex, e) {\n    if (rowIndex > 0) {\n        var record = verstore.getAt(rowIndex)\n        subView.show()\n        var hwFao = new HwFao(imageFileService, \"dockerimages\");\n        hwFao.read(\"data/vmd/update.txt\", function(result) {\n            hwDiv.update(result.data)\n        }, function() {})\n    }\n}","vmdcss":"","vmdprops":"\"\"","type":"module","vmdresource":"{\"components\":[{\"cid\":\"vmdrescsss\",\"layoutConfig\":{},\"userConfig\":{}},{\"cid\":\"vmdresjss\",\"layoutConfig\":{},\"userConfig\":{},\"cn\":[{\"cid\":\"resjs\",\"id\":\"project.config.js\",\"layoutConfig\":{},\"userConfig\":{}}]},{\"cid\":\"vmdresimgs\",\"layoutConfig\":{},\"userConfig\":{}}]}"}