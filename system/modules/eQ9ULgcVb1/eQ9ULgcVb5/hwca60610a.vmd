{"vmdversion":"vmd2.0.5.200306","vmdlayout":"{\"components\":[{\"cid\":\"viewport\",\"id\":\"MainViewport\",\"layoutConfig\":{},\"userConfig\":{\"layout\":\"border\",\"afterrender\":\"MainViewport_afterrender\"},\"cn\":[{\"cid\":\"container\",\"id\":\"div1\",\"layoutConfig\":{},\"userConfig\":{\"region\":\"north\",\"height\":31,\"layout\":\"absolute\"},\"cn\":[{\"cid\":\"checkbox\",\"id\":\"hwCheckbox\",\"layoutConfig\":{},\"userConfig\":{\"x\":20,\"y\":5,\"boxLabel\":\"全选\",\"style\":\"color: #5EA0FF;\",\"check\":\"hwCheckbox_check\"}},{\"cid\":\"vmdButton\",\"id\":\"button2\",\"layoutConfig\":{},\"userConfig\":{\"x\":80,\"y\":5,\"type\":\"text\",\"text\":\"只选分类\",\"click\":\"button2_click\"}}]},{\"cid\":\"container\",\"id\":\"div\",\"layoutConfig\":{},\"userConfig\":{\"region\":\"center\",\"layout\":\"fit\"},\"cn\":[{\"cid\":\"vmdTreeEx\",\"id\":\"tree\",\"layoutConfig\":{},\"userConfig\":{\"x\":20,\"y\":20,\"checkBox\":true,\"store\":\"treestore\",\"parentField\":\"parent_id\",\"valueField\":\"id\",\"textField\":\"name\",\"loadType\":\"全部加载\",\"rootValue\":\"0\",\"rootText\":\"协同开发\",\"cascading\":true,\"nodeMarkFiled\":\"type\",\"folderValue\":\"category\",\"leafValue\":\"module\",\"rootImg\":\"/system/modules/eQ9ULgcVb1/img/server5.png\",\"folderImg\":\"/system/modules/eQ9ULgcVb1/img/folderClosed.gif\",\"leafImg\":\"/system/modules/eQ9ULgcVb1/img/model.png\",\"afterBindData\":\"tree_afterBindData\"}}]},{\"cid\":\"container\",\"id\":\"div2\",\"layoutConfig\":{\"align\":\"middle\",\"pack\":\"center\"},\"userConfig\":{\"region\":\"south\",\"layout\":\"hbox\"},\"cn\":[{\"cid\":\"vmdButton\",\"id\":\"button\",\"layoutConfig\":{},\"userConfig\":{\"margins\":\"10\",\"text\":\"导出\",\"type\":\"info\",\"click\":\"button_click\"}},{\"cid\":\"vmdButton\",\"id\":\"button1\",\"layoutConfig\":{},\"userConfig\":{\"margins\":\"10\",\"text\":\"取消\",\"click\":\"button1_click\"}}]}]},{\"cid\":\"vmddataset\",\"id\":\"数据\",\"layoutConfig\":{},\"userConfig\":{},\"cn\":[{\"cid\":\"vmdJsonStore\",\"id\":\"treestore\",\"layoutConfig\":{},\"userConfig\":{\"cid\":\"vmdJsonStore\",\"id\":\"treestore\",\"storeConfig\":\"{\\\"id\\\":\\\"mfLDvMIDeH\\\",\\\"callcode\\\":\\\"vmdCode\\\",\\\"url\\\":\\\"CDEServcie/expProject/getexptreeinfo\\\",\\\"host\\\":\\\"\\\",\\\"isHwRest\\\":true,\\\"name\\\":\\\"获取导出的模块树\\\",\\\"getMethods\\\":[{\\\"id\\\":\\\"project_id\\\",\\\"value1\\\":\\\"return getUrlParam('project_id')||'eQ9ULgcVb1'\\\",\\\"value2\\\":\\\"\\\",\\\"defaultvalue\\\":\\\"\\\"}],\\\"postMethods\\\":[],\\\"putMethods\\\":[],\\\"deleteMethods\\\":[],\\\"saveMethods\\\":[],\\\"fields\\\":[{\\\"name\\\":\\\"id\\\",\\\"type\\\":\\\"string\\\"},{\\\"name\\\":\\\"name\\\",\\\"type\\\":\\\"string\\\"},{\\\"name\\\":\\\"parent_id\\\",\\\"type\\\":\\\"string\\\"},{\\\"name\\\":\\\"project_id\\\",\\\"type\\\":\\\"string\\\"},{\\\"name\\\":\\\"type\\\",\\\"type\\\":\\\"string\\\"},{\\\"name\\\":\\\"path\\\",\\\"type\\\":\\\"string\\\"}]}\"},\"cn\":[{\"cid\":\"datafield\",\"layoutConfig\":{},\"userConfig\":{\"cid\":\"datafield\",\"name\":\"id\"},\"name\":\"id\"},{\"cid\":\"datafield\",\"layoutConfig\":{},\"userConfig\":{\"cid\":\"datafield\",\"name\":\"name\"},\"name\":\"name\"},{\"cid\":\"datafield\",\"layoutConfig\":{},\"userConfig\":{\"cid\":\"datafield\",\"name\":\"parent_id\"},\"name\":\"parent_id\"},{\"cid\":\"datafield\",\"layoutConfig\":{},\"userConfig\":{\"cid\":\"datafield\",\"name\":\"project_id\"},\"name\":\"project_id\"},{\"cid\":\"datafield\",\"layoutConfig\":{},\"userConfig\":{\"cid\":\"datafield\",\"name\":\"type\"},\"name\":\"type\"},{\"cid\":\"datafield\",\"layoutConfig\":{},\"userConfig\":{\"cid\":\"datafield\",\"name\":\"path\"},\"name\":\"path\"}]}]},{\"cid\":\"vmdvariable\",\"id\":\"变量\",\"layoutConfig\":{},\"userConfig\":{}},{\"cid\":\"vmdsubviewport\",\"id\":\"SubView_Window\",\"layoutConfig\":{},\"userConfig\":{}}]}","vmdevents":"var hwproject_Name = vmd.getUrlParam('project_name')\nvar hwproject_Id = vmd.getUrlParam('project_id')\nvar treeNodePath = vmd.getUrlParam('nodepath')\n\nfunction hwCheckbox_check(sender, checked) {\n    var rootnode = tree.getRootNode();\n    if(checked == true) {\n        tree.setNodeCheckById(0, true); //设置根节点 被勾中\n        for(var i = 0; i < rootnode.childNodes.length; i++) {\n            tree.setNodeCheckById(rootnode.childNodes[i].id, true);\n            if(rootnode.childNodes[i].childNodes.length > 0) {\n                findchildnode(rootnode.childNodes[i]);\n            }\n        }\n    } else {\n        tree.setNodeCheckById(0, false); //设置根节点 不被勾中\n        for(var i = 0; i < rootnode.childNodes.length; i++) {\n            tree.setNodeCheckById(rootnode.childNodes[i].id, false);\n            if(rootnode.childNodes[i].childNodes.length > 0) {\n                findchildnode(rootnode.childNodes[i]);\n            }\n        }\n    }\n}\n//遍历树形子节点\nfunction findchildnode(roonodes) { //树形全勾中\n    var childnodes = roonodes.childNodes;\n    for(var i = 0; i < childnodes.length; i++) { // 从节点中取出子节点依次遍历\n        tree.setNodeCheckById(childnodes[i].id, hwCheckbox.checked);\n        if(childnodes[i].childNodes.length > 0) {\n            findchildnode(childnodes[i]); // 如果存在子节点 递归\n        }\n    }\n}\n\nfunction button2_click(sender, e) {\n    hwCheckbox.setValue(false); // 全选不勾中\n    tree.setNodeCheckById(0, false); //设置根节点 不被勾中\n    var rootnode = tree.getRootNode();\n    category_findchildnode(rootnode);\n}\n//只选择分类按钮(遍历树形子节点)\nfunction category_findchildnode(roonodes) { //树形全勾中\n    var childnodes = roonodes.childNodes;\n    for(var i = 0; i < childnodes.length; i++) { // 从节点中取出子节点依次遍历\n        if(childnodes[i].childNodes.length > 0) {\n            tree.setNodeCheckById(childnodes[i].id, true);\n            category_findchildnode(childnodes[i]); // 如果存在子节点 递归\n        } else {\n            if(childnodes[i].nodeDataJson.type == 'category') {\n                tree.setNodeCheckById(childnodes[i].id, true);\n            } else\n                tree.setNodeCheckById(childnodes[i].id, false);\n        }\n    }\n}\n\nfunction tree_afterBindData(sender) {\n    tree.getRootNode().setText(hwproject_Name);\n    //树形全选\n    var rootnode = tree.getRootNode();\n    if(hwCheckbox.checked == true) {\n        tree.setNodeCheckById(0, true); //设置根节点 被勾中\n        for(var i = 0; i < rootnode.childNodes.length; i++) {\n            tree.setNodeCheckById(rootnode.childNodes[i].id, true);\n            if(rootnode.childNodes[i].childNodes.length > 0) {\n                findchildnode(rootnode.childNodes[i]);\n            }\n        }\n    }\n    rootnode.expand();\n    if(treeNodePath) {\n        treeNodePath = treeNodePath.replace(hwproject_Id, 0);\n        delNodeIds = [];\n        delnode(rootnode)\n        for(var i = 0; i < delNodeIds.length; i++) {\n            tree.removeNodeById(delNodeIds[i])\n        }\n    }\n}\n//用户分类导出时，先加载所有的节点，treeNodePath\nfunction delnode(node) {\n    for(var i = 0; i < node.childNodes.length; i++) {\n        var cnode = node.childNodes[i]\n        if(cnode.getPath().indexOf(treeNodePath) >= 0 || treeNodePath.indexOf(cnode.getPath()) >= 0) {\n            if(cnode.childNodes.length > 0) {\n                delnode(cnode)\n            }\n        } else {\n            delNodeIds.push(cnode.id)\n        }\n    }\n}\nvar myMask;\n\nfunction button_click(sender, e) {\n    myMask = new Ext.LoadMask(document.body, {\n        msg: \"正在导出,请稍后...\",\n        msgCls: 'z-index:10000;'\n    });\n    myMask.show();\n    var ExpModulesInfo = getSelNodeIDs();\n    var url=\"/expandimp/api/moduleexp\"\n    vmd.ajax({\n        url: url,\n        type: 'post',\n        timeout: 120000,\n        dataType: 'json',\n        contentType: 'application/json',\n        data: JSON.stringify(ExpModulesInfo) ,\n        //dataType:\"text\",\n        //contentType: 'application/json;charset=UTF-8',\n        //data:ExpModulesInfo , //jsonp: \"callbackparam\", \n        success: function(result) {\n            myMask.hide();\n            if(result.type == \"success\") {\n                window.open(\"/\" + result.zipPath, '_self')\n                 var s = new vmd.proxy.Log();\n                        s.save(\"导出项目\", ExpModulesInfo.ProjectId, Ext.util.Cookies.get('userName') + \"在\" + Ext.Date.dateFormat(new Date(), 'Y-m-d H:i:s') + \"导出了项目\"+ExpModulesInfo.ProjectName+\"中的模块,模块Id：\" + ExpModulesInfo.ModulesId.join('、') + \"\", \"项目\", function() {\n                            // alert(\"保存成功了！\")\n                        }, function() {\n                            console.log(\"日志报存失败了！\");\n                        })\n            } else\n                Ext.Msg.alert(\"提示\", result.msg)\n        },\n        error: function(msg) {\n            myMask.hide();\n        }\n    })\n}\n\n\nvar cnodeIds = []\nvar mnodeIds = []\nvar mnodeInfo = []\n\nfunction getNodeId(node) {\n\n    for(var i = 0; i < node.childNodes.length; i++) {\n        var cnode = node.childNodes[i]\n        if(cnode.attributes.checked) {\n            if(cnode.childNodes.length > 0) {\n                getNodeId(cnode)\n                cnodeIds.push(cnode.id)\n            } else {\n                if(cnode.nodeDataJson.type == 'category') {\n                    cnodeIds.push(cnode.id)\n                } else {\n                    mnodeInfo.push({\n                        id: cnode.id,\n                        path: cnode.getPath().replace('/0/', '/' + hwproject_Id + '/')\n                    })\n                    mnodeIds.push(cnode.id)\n                }\n            }\n        }\n    }\n}\n\nfunction getSelNodeIDs() {\n    cnodeIds = []\n    mnodeIds = []\n    mnodeInfo = []\n    var rootnode = tree.getRootNode();\n    getNodeId(rootnode)\n    var ExpModulesInfo = {};\n    ExpModulesInfo.ModulesId = mnodeIds;\n    ExpModulesInfo.ModulesInfo = mnodeInfo;\n    ExpModulesInfo.CategorysId = cnodeIds;\n    ExpModulesInfo.ProjectId = hwproject_Id;\n    ExpModulesInfo.ProjectName = hwproject_Name;\n    return ExpModulesInfo\n}\n\nfunction button1_click(sender, e) {\n    if(parent && parent.expmodulesWin)\n        parent.expmodulesWin.close()\n}\n\nfunction MainViewport_afterrender(sender) {\n\n}","vmdcss":".x-form-cb-label{\n    color: #5EA0FF;\n}","vmdprops":"\"\"","type":"module","vmdcmpdeps":[],"vmdresource":"{\"components\":[{\"cid\":\"vmdrescsss\",\"layoutConfig\":{},\"userConfig\":{}},{\"cid\":\"vmdresjss\",\"layoutConfig\":{},\"userConfig\":{},\"cn\":[{\"cid\":\"resjs\",\"id\":\"project.config.js\",\"layoutConfig\":{},\"userConfig\":{}}]},{\"cid\":\"vmdresimgs\",\"layoutConfig\":{},\"userConfig\":{}}]}"}