{"vmdversion":"2.0.3.20190124","vmdlayout":"{\"components\":[{\"cid\":\"viewport\",\"id\":\"MyViewport\",\"layoutConfig\":{},\"userConfig\":{\"layout\":\"auto\",\"afterrender\":\"MyViewport_afterrender\"},\"cn\":[{\"cid\":\"panel\",\"id\":\"MyPanel\",\"layoutConfig\":{},\"userConfig\":{\"x\":0,\"y\":0,\"height\":650,\"layout\":\"absolute\",\"width\":600,\"border\":false,\"header\":false,\"region\":\"west\"},\"cn\":[{\"cid\":\"label\",\"id\":\"MyLabel8\",\"layoutConfig\":{},\"userConfig\":{\"x\":40,\"y\":320,\"text\":\"路径：\"}},{\"cid\":\"textfield\",\"id\":\"MyField6\",\"layoutConfig\":{},\"userConfig\":{\"x\":110,\"y\":320,\"width\":460,\"id\":\"MyField6\",\"disabled\":true}},{\"cid\":\"vmdButton\",\"id\":\"button3\",\"layoutConfig\":{},\"userConfig\":{\"x\":370,\"y\":450,\"text\":\"预览\",\"type\":\"info\",\"size\":\"large\",\"click\":\"button3_click\"}},{\"cid\":\"vmdButton\",\"id\":\"button1\",\"layoutConfig\":{},\"userConfig\":{\"x\":220,\"y\":450,\"type\":\"info\",\"text\":\"界面设计\",\"size\":\"large\",\"click\":\"button1_click\"}},{\"cid\":\"vmdButton\",\"id\":\"button\",\"layoutConfig\":{},\"userConfig\":{\"x\":110,\"y\":450,\"size\":\"large\",\"type\":\"info\",\"text\":\"保存\",\"click\":\"button_click\"}},{\"cid\":\"textarea\",\"id\":\"MyField7\",\"layoutConfig\":{},\"userConfig\":{\"x\":110,\"y\":360,\"width\":460,\"id\":\"MyField7\"}},{\"cid\":\"textfield\",\"id\":\"MyField5\",\"layoutConfig\":{},\"userConfig\":{\"x\":110,\"y\":280,\"width\":460,\"disabled\":true}},{\"cid\":\"textfield\",\"id\":\"MyField4\",\"layoutConfig\":{},\"userConfig\":{\"x\":110,\"y\":240,\"width\":460,\"disabled\":true}},{\"cid\":\"textfield\",\"id\":\"MyField3\",\"layoutConfig\":{},\"userConfig\":{\"x\":110,\"y\":200,\"width\":460,\"disabled\":true}},{\"cid\":\"textfield\",\"id\":\"MyField2\",\"layoutConfig\":{},\"userConfig\":{\"x\":110,\"y\":160,\"width\":460,\"disabled\":true}},{\"cid\":\"textfield\",\"id\":\"MyField1\",\"layoutConfig\":{},\"userConfig\":{\"x\":110,\"y\":120,\"width\":460}},{\"cid\":\"textfield\",\"id\":\"MyField\",\"layoutConfig\":{},\"userConfig\":{\"x\":110,\"y\":80,\"width\":460,\"disabled\":true}},{\"cid\":\"label\",\"id\":\"MyLabel7\",\"layoutConfig\":{},\"userConfig\":{\"x\":40,\"y\":360,\"text\":\"说明：\"}},{\"cid\":\"label\",\"id\":\"MyLabel6\",\"layoutConfig\":{},\"userConfig\":{\"x\":40,\"y\":280,\"text\":\"修改时间：\"}},{\"cid\":\"label\",\"id\":\"MyLabel5\",\"layoutConfig\":{},\"userConfig\":{\"x\":40,\"y\":240,\"text\":\"修改人：\"}},{\"cid\":\"label\",\"id\":\"MyLabel4\",\"layoutConfig\":{},\"userConfig\":{\"x\":40,\"y\":200,\"text\":\"创建时间：\"}},{\"cid\":\"label\",\"id\":\"MyLabel3\",\"layoutConfig\":{},\"userConfig\":{\"x\":40,\"y\":160,\"text\":\"创建人：\"}},{\"cid\":\"label\",\"id\":\"MyLabel2\",\"layoutConfig\":{},\"userConfig\":{\"x\":40,\"y\":120,\"text\":\"模块名称：\"}},{\"cid\":\"label\",\"id\":\"MyLabel1\",\"layoutConfig\":{},\"userConfig\":{\"x\":40,\"y\":80,\"text\":\"模块编码：\"}},{\"cid\":\"label\",\"id\":\"MyLabel\",\"layoutConfig\":{},\"userConfig\":{\"x\":40,\"y\":30,\"text\":\"模块基础信息\",\"style\":\"color: blue;    font-size: 20px;\"}},{\"cid\":\"vmdButton\",\"id\":\"button2\",\"layoutConfig\":{},\"userConfig\":{\"x\":490,\"y\":450,\"text\":\"注册\",\"type\":\"info\",\"size\":\"large\",\"click\":\"button2_click\"}}]}]},{\"cid\":\"vmddataset\",\"id\":\"数据集\",\"layoutConfig\":{},\"userConfig\":{}},{\"cid\":\"vmdvariable\",\"id\":\"变量\",\"layoutConfig\":{},\"userConfig\":{}},{\"cid\":\"vmdsubviewport\",\"id\":\"SubView_Window\",\"layoutConfig\":{},\"userConfig\":{}}]}","vmdevents":"function MyViewport_afterrender(sender) {\n    var tree = parent.hwTree;\n    var newnode = tree.newnode;\n    if(newnode) {\n        MyField.setValue(newGuid(32));\n        MyField1.setValue(\"\");\n        MyField2.setValue(Ext.util.Cookies.get('userName'));\n        MyField3.setValue(Ext.Date.dateFormat(new Date(), 'Y-m-d H:i:s'));\n        MyField4.setValue(\"\");\n        MyField5.setValue(\"\");\n        MyField6.setValue(\"\");\n        MyField7.setValue(\"\");\n    } else {\n        var selId = tree.getSelectedItemId();\n        var selnode = tree.itemObj[selId];\n        MyField.setValue(selnode.code);\n        MyField1.setValue(selnode.text);\n        MyField2.setValue(selnode.createuser);\n        MyField3.setValue(selnode.createtime);\n        MyField4.setValue(selnode.changeuser);\n        MyField5.setValue(selnode.changetime);\n        MyField6.setValue(\"/modules\" + selnode.path + \".vmd\");\n        MyField7.setValue(selnode.remark);\n    }\n}\n\nfunction button_click(sender) {\n    if(!saveCheck()) {\n        return;\n    }\n    saveModelInfo(function() {\n        Ext.Msg.alert(\"提示\", \"保存成功！\")\n    })\n}\n\n//模块保存按钮操作\nfunction saveModelInfo(callback) {\n    debugger\n    var mytree = parent.hwTree;\n    var newnode = mytree.newnode;\n    var btnProjectName = parent.btnProjectName;\n    var selId = btnProjectName.projectId;\n    // var selnode = mytree.itemObj[selId];\n    var selnodepath = \"/\" + selId;\n    var id = newGuid(10);\n    var category_id = selId;\n    var Project_id = selId;\n\n    category_id = \"0\";\n    Project_id = selId;\n\n    var codeid = MyField.getValue();\n    var name = MyField1.getValue();\n    var remark = MyField7.getValue();\n    var type = \"0\";\n    //保存模块基础信息\n    if(!newnode) {\n        MyField4.setValue(Ext.util.Cookies.get('userName'));\n        MyField5.setValue(Ext.Date.dateFormat(new Date(), 'Y-m-d H:i:s'))\n        hwDas.ajax({\n            das: {\n                idedas: true\n            },\n            url: \"CDEServcie/module/info\",\n            type: 'put',\n            timeout: 5000,\n            params: {},\n            data: [{\n                id: selId,\n                code: selnode.code,\n                type: type,\n                name: name,\n                remark: remark,\n                project_id: Project_id,\n                row_changed_by: MyField4.getValue(),\n                row_changed_date: MyField5.getValue()\n            }],\n            success: function(result) {\n                selnode.text = name;\n                selnode.changetime = MyField5.getValue();\n                selnode.changeuser = MyField4.getValue();\n                selnode.remark = MyField7.getValue();\n                mytree.setItemText(selId, name)\n                callback();\n            },\n            error: function(msg) {\n                Ext.Msg.alert(\"提示\", \"保存模块基础信息失败\")\n                return;\n            }\n        })\n    } else {\n        //保存模块基础信息\n        hwDas.ajax({\n            das: {\n                idedas: true\n            },\n            url: \"CDEServcie/module/info\",\n            type: 'post',\n            timeout: 5000,\n            params: {},\n            data: [{\n                id: id,\n                code: codeid,\n                type: type,\n                name: name,\n                remark: remark,\n                category_id: category_id,\n                project_id: Project_id,\n                row_created_by: MyField2.getValue(),\n                row_created_date: MyField3.getValue(),\n                row_changed_by: MyField4.getValue(),\n                row_changed_date: MyField5.getValue()\n            }],\n            success: function(result) {\n                mytree.insertNewChild(0, id, name);\n                mytree.setItemImage2(id, \"tree/model.png\", \"tree/model.png\", \"tree/model.png\")\n                var treenode = mytree.item(id);\n                treenode.path = selnodepath + \"/\" + id;\n                treenode.projectId = Project_id;\n                if(treenode) {\n                    treenode.isModel = true;\n                    treenode.text = name;\n                    treenode.createuser = MyField2.getValue();\n                    treenode.createtime = MyField3.getValue();\n                    treenode.changetime = MyField5.getValue();\n                    treenode.changeuser = MyField4.getValue();\n                    treenode.remark = remark;\n                    treenode.code = codeid\n                    treenode.newnode = true;\n                }\n                mytree.itemObj[id] = treenode;\n                mytree.selectItem(id, false, false);\n                mytree.newnode = false;\n                //保存模块路径版本信息\n                hwDas.ajax({\n                    das: {\n                        idedas: true\n                    },\n                    url: \"CDEServcie/module/file\",\n                    type: 'post',\n                    timeout: 5000,\n                    params: {},\n                    data: [{\n                        filepath: selnodepath + \"/\" + id,\n                        version: 1,\n                        module_id: id\n                    }],\n                    success: function(result) {\n                        // Ext.Msg.alert(\"提示\", \"保存成功！\")\n                    },\n                    error: function(msg) {\n                        Ext.Msg.alert(\"提示\", \"保存模块版本信息失败\")\n                        return;\n                    }\n                })\n                callback();\n            },\n            error: function(msg) {\n                console.log(msg)\n                Ext.Msg.alert(\"提示\", \"保存模块基础信息失败\")\n                return;\n            }\n        })\n\n    }\n\n}\n\nfunction button1_click(sender) {\n    var mytree = parent.hwTree;\n    var btnProjectName = parent.btnProjectName;\n    var selId = btnProjectName.projectId;\n    // var selId = mytree.getSelectedItemId();\n    // var selnode = mytree.itemObj[selId];\n    if(mytree.newnode) {\n        if(!saveCheck()) {\n            return;\n        }\n        saveModelInfo(function() {\n            selId = mytree.getSelectedItemId();\n            selnode = mytree.itemObj[selId];\n\n            openSelMode(selnode.id, selnode.text, 'modules' + selnode.path + '.vmd');\n        })\n\n        //parent.selectmode(selnode.id,escape(selnode.text),'modules' + selnode.path + '.vmd');\n\n    } else {\n        if(!saveCheck()) {\n            return;\n        }\n        saveModelInfo(function() {\n            selId = mytree.getSelectedItemId();\n            selnode = mytree.itemObj[selId];\n\n            vmd.isCheckFileExist(vmd.virtualPath + '/modules' + selnode.path + '.vmd', function(data) {\n                if(data) {\n                    var params = {\n                        id: selnode.id,\n                        name: selnode.text,\n                        path: 'modules' + selnode.path + '.vmd'\n                    }\n                    window.open(vmd.virtualPath + '/design/default.html?' + Ext.urlEncode(params), selnode.text + \" 模块设计\")\n\n                } else {\n                    openSelMode(selnode.id, selnode.text, 'modules' + selnode.path + '.vmd');\n                }\n            });\n\n        })\n    }\n}\n\nfunction button3_click(sender) {\n    var mytree = parent.hwTree;\n    var selId = mytree.getSelectedItemId();\n    var selnode = mytree.itemObj[selId];\n    var url = vmd.virtualPath + '/modules' + selnode.path + '.html';\n    window.open(url, selnode.text);\n\n}\n\n//自定义自定义方法\n\nfunction newGuid(len) {\n    var length = 32;\n    if(len)\n        length = len - 2\n    var guid = \"\";\n    for(var i = 1; i <= length; i++) {\n        var n = Math.floor(Math.random() * 16.0).toString(16);\n        guid += n;\n    }\n    return \"hw\" + guid;\n}\n\nfunction openSelMode(id, name, path) {\n    parent.openSelMode(id, name, path)\n}\n\nwindow[\"openSelMode\"] = openSelMode;\n\n/*\nfunction closeSelMode(create) {\n    if(create)\n        var mytree = parent.hwTree;\n    var selId = mytree.getSelectedItemId();\n    var selnode = mytree.itemObj[selId];\n    selnode.newnode = false;\n    mytree.newnode = false;\n    parent.closeSelMode1()\n}\nwindow[\"closeSelMode\"] = closeSelMode;\n*/\n\nfunction button2_click(sender) {\n    var html = \"<iframe src='\" + vmd.virtualPath + vmdSettings.systemPath+\"/eQ9ULgcVb5/hw28b7f229.html?r=\" + new Date().getTime() + \"' frameborder=0 scrolling=no style='height:100%;width:100%'></iframe>\";\n\n    var win = parent.openWin({\n        title: \"模块注册发布\",\n        modal: true,\n        maximized: false,\n        height: 500,\n        width: 400,\n        maximizable: true,\n        resizable: true,\n        bodyStyle: \"background-color:#fff\",\n        closeAction: 'close'\n    }, html)\n}\n\n/*保存前校验\nreturn:boolean  \n*/\nfunction saveCheck() {\n    if(MyField1.getValue() == \"\") {\n        Ext.Msg.alert(\"提示\", \"模块名称不能为空！\")\n        return false;\n    }\n    return true;\n}","vmdcss":"","vmdprops":"\"\"","type":"module","vmdresource":"{\"components\":[{\"cid\":\"vmdrescsss\",\"layoutConfig\":{},\"userConfig\":{}},{\"cid\":\"vmdresjss\",\"layoutConfig\":{},\"userConfig\":{}},{\"cid\":\"vmdresimgs\",\"layoutConfig\":{},\"userConfig\":{}}]}"}