<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml">
<head>
<meta http-equiv="X-UA-Compatible" content="IE=edge,chrome=1" />
<meta http-equiv="Content-Type" content="text/html; charset=utf-8"/>

    <title>主页面20190121</title>
	<!--基本样式-->
    <link href="/css/common.css?ver=2.0.3.20190124" rel="stylesheet" />
    <!--加载dhx组件-->
    <link href="/lib/ext-3.4/resources/css/ext-all.css?ver=2.0.3.20190124" rel="stylesheet" />
   
    <link href="/design/css/icons.css?ver=2.0.3.20190124" rel="stylesheet" />

	<link href="/lib/dhtmlx/dhtmlx.css?ver=2.0.3.20190124" rel="stylesheet" />
	  <!--样式快捷索引表-->
    <link href="/css/shortcut.css?ver=2.0.3.20190124" rel="stylesheet" />
    
    <script src="/lib/labjs/LAB.min.js?ver=2.0.3.20190124"></script>
    <script src="/config.js?ver=2.0.3.20190124"></script>
    <script src="/lib/ext-3.4/adapter/ext/ext-base-debug.js?ver=2.0.3.20190124"></script>
    <script src="/lib/ext-3.4/adapter/ext/ext-base-lang.js?ver=2.0.3.20190124"></script>
    <script src="/lib/ext-3.4/adapter/ext/ext-base-class.js?ver=2.0.3.20190124"></script>
    <script src="/lib/ext-3.4/ext-all-debug.js?ver=2.0.3.20190124"></script>
    <script src="/lib/ext-3.4/src/locale/ext-lang-zh_CN.js?ver=2.0.3.20190124"></script>
    <script src="/js/util.js?ver=2.0.3.20190124"></script>
    <script src="/lib/dhtmlx/dhtmlx.js?ver=2.0.3.20190124"></script>
	<script src="/report/dhtmlx/dhtmlxCommon/codebase/dhtmlxcommon.js?ver=2.0.3.20190124"></script>
	<script src="/report/dhtmlx/dhtmlxCommon/codebase/dhtmlxcore.js?ver=2.0.3.20190124"></script>
    <script src="/report/dhtmlx/dhtmlxCommon/codebase/dhtmlxcontainer.js?ver=2.0.3.20190124"></script>
	<script src="/report/FillReport2.0/js/dhtmlx/dhtmlXFileUploader.js?ver=2.0.3.20190124"></script>
    <script src="/js/hwdas.js?ver=2.0.3.20190124"></script>
	<script src="/js/hwMSC.js?ver=2.0.3.20190124"></script>
    <script src="/js/vmdcore.js?ver=2.0.3.20190124"></script>
    <script src="/js/vmdcomps.js?ver=2.0.3.20190124"></script>
    <script src="/js/publicMethods.js?ver=2.0.3.20190124"></script>
    <script src="/js/vmdreport.js?ver=2.0.3.20190124"></script>
    

    <script src="/lib/ace/ace.js"></script>
    <script src="/lib/ace/mode-base.js" type="text/javascript"></script>
    <script src="/lib/ace/theme-xcode.js" type="text/javascript" ></script>
    <script src="/lib/ace/ext-language_tools.js"></script>
    

    <style>

    </style>
    <style type="text/css" id="vmdcss">
        /*.list-list{*/
/*    margin-left: 25px;*/
/*    background-image: url("/modules/hw3ce0447e/img/list-list.png");*/
/*    background-repeat: no-repeat;*/
/*    background-position: center center;*/
/*    border-radius: 0px;*/
/*}*/
.div-hove:hover{
    background-color: rgba(255,255,255,0.3);
}
.div-hove{
    cursor: pointer
}
.x-combo-list-item{
    margin: 5px 0
}
    </style>
    <script>
	    vmd.preivewMode=true;
        vmd.virtualPath = '';
        vmd.workspace={"workspaceid":"290c7de6-2922-4ffe-81c4-18ee7b97d168","workflowIp":"","dataServiceIp":"","msgIp":"","projectid":"eQ9ULgcVb1"}
	vmd.resourceSettings={"测试&&资源中心服务器":"http://www.hanweikeji.com:10050/resource","测试&&服务器2":"http://www.hanweikeji.com:10050/resource"}
        Ext.define("vmd.module.MyViewport" ,{
	extend:"vmd.comp.viewport",
	requires:vmd.getCmpDeps(["vmd.ux.Uploader$1.0$Uploader","vmd.ux.ModuleInfo$1.0$ModuleInfo","vmd.ux.DataServiceModuleInfo$1.0$DataServiceModuleInfo","vmd.ux.WorkflowModuleInfo$1.0$WorkflowModuleInfo"]),
	xtype:"vmd.module.MyViewport",
	layout:"border",
	afterrender:"MyViewport_afterrender",
	beforerender:"MyViewport_beforerender",
	initComponent: function(){
		//上次点击的节点
var bselNodeId = "";
//获取传递的设计模式
var allowedDesigner = false;
var einfo = Ext.util.Cookies.get('hwEcyLogin');
var login = Ext.util.Cookies.get('hwLogin');
// 项目ID
var hwproject_id = '';
var lastWorkId = ''; //上一个活动工区 
var myMask, selectData = [],
    cateData = [];
var store = new Ext.data.JsonStore({
    proxy: new Ext.data.MemoryProxy(),
    fields: ['id', 'name', 'category_id', 'project_id']
});
// vmd.workspace = {
//     workflowIp: '',
//     dataServiceIp: '',
//     workspaceid: ''
// }

//初始化数据
function hwTree_afterrender(sender) {
    // 清空树原有的默认数据
    hwTree.deleteChildItems(0);
    hwTree.el.dom.setAttribute("data-step", "4");
    hwTree.el.dom.setAttribute("data-intro", "项目模块树，用于展示该项目的分类及模块，通过切换项目实现项目树信息的变化；");
    hwTree.el.dom.setAttribute("data-position", "right");
}

function hwTree_onOpenEnd(sender, id) {
    OpenNOde(id)
}
// 展开节点操作
function OpenNOde(id, callback) {
    var proId = id;
    var mytree = hwTree;
    mytree.newnode = false;
    var hasChild = mytree.hasChildren(proId);
    var selnode = mytree.itemObj[proId];
    var selnodepath = selnode.path;
    var projectId = hwproject_id.getValue();
    var childParentId = id;

    // return;
    if(!selnode.loadChild && !selnode.isModel) {

        var myMask = new Ext.LoadMask(Ext.getCmp("hwTree").el, {
            msg: "数据加载中,请稍后...",
            msgCls: 'z-index:10000;'
        });
        myMask.show();

        var bCategoryFlag = false;
        var bInfoFlag = false;

        hwDas.ajax({
            das: {
                idedas: true
            },
            url: "CDEServcie/module/category",
            type: 'get',
            timeout: 50000,
            params: {
                project_id: projectId,
                parent_id: childParentId
            },
            success: function(result) {
                var datajson = result.data[0].datas;
                var treeDataJson = [];
                for(var i = 0; i < datajson.length; i++) {
                    mytree.insertNewChild(proId, datajson[i].id, datajson[i].name);
                    mytree.setItemImage2(datajson[i].id, "tree/folderClosed.gif", "tree/folderOpen.gif", "tree/folderClosed.gif")
                    mytree.insertNewChild(datajson[i].id, datajson[i].id + "-0", "");
                    mytree.closeItem(datajson[i].id);
                    var treenode = mytree.item(datajson[i].id);
                    treenode.path = selnodepath + "/" + datajson[i].id;
                    treenode.projectId = projectId;
                    if(treenode) {
                        treenode.isFord = true;
                        treenode.loadChild = false;
                    }
                    mytree.itemObj[datajson[i].id] = treenode;
                }

                bCategoryFlag = true;
                if(bCategoryFlag && bInfoFlag) {
                    myMask.hide();
                }
                if(callback) {
                    callback();
                }
            },
            error: function(msg) {
                bCategoryFlag = true;
                if(bCategoryFlag && bInfoFlag) {
                    myMask.hide();
                }
                Ext.Msg.alert("提示", "获取模块信息失败", function() {})
            }
        })
        if(!selnode.loadChild) {
            mytree.deleteItem(id + "-0", false);
        }
        selnode.loadChild = true;
        hwDas.ajax({
            das: {
                idedas: true
            },
            url: "CDEServcie/module/info",
            type: 'get',
            timeout: 50000,
            params: {
                category_id: childParentId,
                project_id: projectId
            },
            success: function(result) {
                var datajson = result.data[0].datas;
                var treeDataJson = [];
                for(var i = 0; i < datajson.length; i++) {
                    mytree.insertNewChild(proId, datajson[i].id, datajson[i].name);
                    mytree.setItemImage2(datajson[i].id, "tree/model.png", "tree/model.png", "tree/model.png")
                    var treenode = mytree.item(datajson[i].id);
                    treenode.path = selnodepath + "/" + datajson[i].id;
                    treenode.projectId = projectId;
                    if(treenode) {
                        treenode.isModel = true;
                        treenode.createuser = datajson[i].row_created_by;
                        treenode.createtime = datajson[i].row_created_date;
                        treenode.changetime = datajson[i].row_changed_date;
                        treenode.changeuser = datajson[i].row_changed_by;
                        treenode.remark = datajson[i].remark;
                        treenode.code = datajson[i].code;
                    }
                    mytree.itemObj[datajson[i].id] = treenode;
                }
                bInfoFlag = true;
                if(bCategoryFlag && bInfoFlag) {
                    myMask.hide();
                }
                if(callback) {
                    callback();
                }
            },
            error: function(msg) {
                bInfoFlag = true;
                if(bCategoryFlag && bInfoFlag) {
                    myMask.hide();
                }
                Ext.Msg.alert("提示", "获取模块信息失败")
            }
        })
    }
}
var lastnodeType = "-1"; // 0:空白，1：分类，2：模板
//点击树节点操作
function hwTree_nodeClick(sender, id) {
    var proId = id;
    var mytree = hwTree;
    mytree.newnode = false;
    var hasChild = mytree.hasChildren(proId);
    var selnode = mytree.itemObj[proId];
    var selnodepath = selnode.path;
    var projectId = btnProjectName.projectId;
    var childParentId = "0";
    // if(bselNodeId != id) 
    {
        if(selnode.isModel) {
            divJcxx.hide();
            ModuleInfo.show();
            WorkflowModuleInfo.hide();
            DataServiceModuleInfo.hide();

            ModuleInfo.refresh(hwTree, projectId, btnWorkSpaceName.workspaceId);
            lastnodeType = "2"
            // document.getElementById("iframe_page").src = vmd.virtualPath + vmdSettings.systemPath+'/eQ9ULgcVb5/hwa99a3307.html';
        } else {
            if(lastnodeType != "1") {
                divJcxx.show();
                ModuleInfo.hide()
                WorkflowModuleInfo.hide();
                DataServiceModuleInfo.hide();

                document.getElementById("iframe_page").src = vmd.virtualPath + vmdSettings.systemPath+'/eQ9ULgcVb5/hw03cb4931.html';
                //MyP_jcxx.body.update("<" + "iframe " + " src=vmdSettings.systemPath+'/eQ9ULgcVb5/hw03cb4931.html' " + " width=100% height=100% frameborder=0  " + ">" + "sdsds" + "<" + "/" + "iframe" + ">");
                // projectId = selnode.projectId;
                childParentId = proId;
                lastnodeType = "1";
            }

            // document.getElementById("iframe_page").src = vmd.virtualPath + vmdSettings.systemPath+'/eQ9ULgcVb5/hw03cb4931.html';
        }
    }
    bselNodeId = id;
}
//创建分类按钮操作
function creatFord() {
    var addford = function(fordname, callback) {
        var mytree = hwTree;
        var selId = mytree.getSelectedItemId();
        var selnode = mytree.itemObj[selId];
        var selnodepath = selnode.path;
        var parentId;
        var projectId;
        var nodename = fordname;
        var newnodeid = newGuid(10);
        var newcode = newGuid(10);
        var xh = 10;
        if(selnode.isProject) {
            parentId = "0";
            projectId = selId;
        } else if(selnode.isModel) {
            return;
        } else if(selnode.isFord) {
            parentId = selId;
            projectId = selnode.projectId;
        }
        myMask = new Ext.LoadMask(Ext.getBody(), {
            msg: "加载中,请稍后..."
        });
        myMask.show();
        // 判断同一目录下是否存在相同名称分类
        checkfordReName(projectId, parentId, newnodeid, nodename, function() {
            if(callback) {
                callback()
            }
            hwDas.ajax({
                das: {
                    idedas: true
                },
                url: "CDEServcie/module/category",
                type: 'post',
                contentType: 'application/json;charset=UTF-8',
                timeout: 50000,
                params: {
                    parent_id: parentId,
                    name: nodename,
                    code: newcode,
                    project_id: projectId,
                    id: newnodeid,
                    xh: xh
                },
                datas: [{
                    parent_id: parentId,
                    name: nodename,
                    code: newcode,
                    project_id: projectId,
                    id: newnodeid,
                    xh: xh
                }],
                success: function(result) {
                    mytree.insertNewChild(selId, newnodeid, nodename);
                    mytree.setItemImage2(newnodeid, "tree/folderClosed.gif", "tree/folderOpen.gif", "tree/folderClosed.gif")
                    var treenode = mytree.item(newnodeid);
                    treenode.path = selnodepath + "/" + newnodeid;
                    treenode.projectId = projectId;
                    selnode.loadChild = true;
                    if(treenode) {
                        treenode.isFord = true;
                        treenode.loadChild = true;
                    }
                    mytree.itemObj[newnodeid] = treenode;
                    myMask.hide();
                },
                error: function(msg) {
                    myMask.hide();
                    Ext.Msg.alert("提示", "新建目录失败")
                }
            })
        })
    }
    var fordname = new Ext.MyFordWin(addford, '');
    fordname.show();
}

//删除目录 模块信息
function button1_click(sender) {
    var mytree = hwTree;
    var selId = mytree.getSelectedItemId();
    var selnode = mytree.itemObj[selId];
    var haschild = mytree.hasChildren(selId);

    if(selId == "hwZ8jCmRKR" || selId == "eQ9ULgcVc5" || selId == "eQ9ULgcVb5" || selId == "hwa99a3307" || selId == "hwc6d63bc6") {
        Ext.Msg.alert("提示", "该模块禁止删除！")
        return
    }

    if(mytree.itemObj[selId].projectId == "eQ9ULgcVb1") {
        Ext.Msg.confirm("提示", "删除的模块或项目为协同办公，请谨慎操作", function(type) {
            if(type == "yes") {
                deleteNode();
            } else
                return;
        })
        return;
    }
    deleteNode();
}

function deleteNode() {
    var mytree = hwTree;
    var selId = mytree.getSelectedItemId();
    var selnode = mytree.itemObj[selId];
    var haschild = mytree.hasChildren(selId);

    //删除文件夹
    if(selnode.isProject) {
        if(haschild > 0) {
            Ext.Msg.alert("提示", "存在子目录或模块，请删除子目录或子模块后再删除该项目！")
            return
        }
        Ext.Msg.confirm("提示", "删除项目后，项目下的所有文件都将删除。确认要删除该项目！", function(type) {
            if(type == "yes") {
                hwDas.ajax({
                    das: {
                        idedas: true
                    },
                    url: "CDEServcie/project/info",
                    type: 'delete',
                    timeout: 50000,
                    params: {
                        id: selId
                    },
                    success: function(result) {
                        mytree.deleteItem(selId, true);
                        getQueryData();
                    },
                    error: function(msg) {
                        Ext.Msg.alert("提示", "删除项目失败")
                    }
                })
            }
        })
        return;
    }
    //删除文件夹
    if(selnode.isFord) {
        if(haschild > 0) {
            Ext.Msg.alert("提示", "存在子目录或模块，请删除子目录或子模块后再删除该目录")
            return
        }
        Ext.Msg.confirm("提示", "确认要删除该目录！", function(type) {
            if(type == "yes") {
                hwDas.ajax({
                    das: {
                        idedas: true
                    },
                    url: "CDEServcie/module/category",
                    type: 'delete',
                    timeout: 50000,
                    params: {
                        id: selId
                    },
                    success: function(result) {
                        hwDas.remove("vmd", 'modules' + selnode.path, function() {
                            hwDas.remove("vmd", 'modules' + selnode.path, function() {
                                hwDas.remove("vmd", 'modules' + selnode.path, function() {
                                    Tips.tips("删除分类成功", "success");
                                    getQueryData();
                                }, function(msg) {
                                    Tips.tips("删除分类失败", "error");
                                })
                            }, function(msg) {
                                Tips.tips("删除分类失败", "error");
                            })
                        }, function(msg) {
                            Tips.tips("删除分类失败", "error");
                        })
                        mytree.deleteItem(selId, true);
                    },
                    error: function(msg) {
                        Ext.Msg.alert("提示", "删除分类失败")
                    }
                })
            }
        })
        return;
    }
    //删除模块
    if(selnode.isModel) {
        Ext.Msg.confirm("提示", "确认要删除该模块？", function(type) {
            if(type == "yes") {
                //先删除模块信息
                hwDas.ajax({
                    das: {
                        idedas: true
                    },
                    url: "CDEServcie/module/info",
                    type: 'delete',
                    timeout: 50000,
                    params: {
                        id: selId
                    },
                    success: function(result) {
                        //删除模块文件对应关系
                        // hwDas.ajax({
                        //     das: {
                        //         idedas: true
                        //     },
                        //     url: "CDEServcie/module/file",
                        //     type: 'delete',
                        //     timeout: 50000,
                        //     params: {
                        //         module_id: selId
                        //     },
                        //     success: function(result) {
                        Tips.tips("删除模块成功", "success");
                        getQueryData();
                        //     },
                        //     error: function(msg) {
                        //         Ext.Msg.alert("提示", "删除模块文件信息失败")
                        //     }
                        // })
                        mytree.deleteItem(selId); //, true);
                    },
                    error: function(msg) {
                        Ext.Msg.alert("提示", "删除模块信息失败")
                        return
                    }
                })

                //删除vmd文件
                hwDas.remove("vmd", 'modules' + selnode.path + '.vmd', function(result) {}, function(msg) {
                    Ext.Msg.alert("提示", "删除vmd模块文件失败")
                })
                //删除vmd文件
                hwDas.remove("vmd", 'modules' + selnode.path + '.html', function(result) {}, function(msg) {
                    Ext.Msg.alert("提示", "删除vmd模块文件失败")
                })
                hwDas.remove("vmd", 'modules' + selnode.path + '_r.html', function(result) {}, function(msg) {
                    Ext.Msg.alert("提示", "删除vmd模块文件失败")
                })
                hwDas.remove("vmd", 'modules' + selnode.path, function(result) {}, function(msg) {
                    Ext.Msg.alert("提示", "删除vmd子模块文件失败")
                })
            }
        })
        return;
    }
}

/////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////
//自定义自定义方法
function newGuid(len) {
    var length = 32;
    if(len)
        length = len - 2
    var guid = "";
    arr = ['0', '1', '2', '3', '4', '5', '6', '7', '8', '9', 'a', 'b', 'c', 'd', 'e', 'f', 'g', 'h', 'i', 'j', 'k', 'l', 'm', 'n', 'o', 'p', 'q', 'r', 's', 't', 'u', 'v', 'w', 'x', 'y', 'z', 'A', 'B', 'C', 'D', 'E', 'F', 'G', 'H', 'I', 'J', 'K', 'L', 'M', 'N', 'O', 'P', 'Q', 'R', 'S', 'T', 'U', 'V', 'W', 'X', 'Y', 'Z'];
    for(var i = 0; i < length; i++) {
        pos = Math.round(Math.random() * (arr.length - 1));
        guid += arr[pos];
    }
    return "hw" + guid;
}

//文件夹名称录入框
Ext.MyFordWin = Ext.extend(Ext.Window, {
    xtype: "window",
    title: "文件夹对话框",
    width: 300,
    height: 150,
    layout: "form",
    bodyStyle: 'padding:15px',
    labelAlign: "left",
    labelWidth: 40,
    modal: true,
    constructor: function(callback, name) {
        this.valueName = name;
        this.callback = callback;
        this.callParent();
    },
    initComponent: function() {
        var me = this;
        this.fbar = [{
            text: "确定",
            handler: function() {
                me.callback(Ext.getCmp('filename').getValue(), function() {
                    me.close();
                });
            }
        }, {
            text: "取消",
            handler: function() {
                me.close();
            }
        }];
        this.items = [{
            id: 'filename',
            xtype: "textfield",
            fieldLabel: "名称",
            anchor: "100%",
            value: this.valueName
        }]
        Ext.MyFordWin.superclass.initComponent.call(this);
    }
})
//右键菜单事件
function onMenuClick(menuitemId) {
    if(menuitemId == "newFord") { // 新建分类
        creatFord();
    } else if(menuitemId == "newMode") { // 新建模块
        // 在空白处点击鼠标时，就取消原有节点的选中
        // hwTree.clearSelection();
        hwTree.newnode = true;
        divJcxx.hide();
        ModuleInfo.show();
        WorkflowModuleInfo.hide();
        DataServiceModuleInfo.hide();
        ModuleInfo.refresh(hwTree, btnProjectName.projectId, btnWorkSpaceName.workspaceId);
        // lastnodeType = "1";
        // bselNodeId = hwTree.getSelectedItemId();
        // hwTree.itemObj[bselNodeId].loadChild = true;
        // hwTree.newnode = true;
        // document.getElementById("iframe_page").src = vmd.virtualPath + vmdSettings.systemPath+'/eQ9ULgcVb5/hwa99a3307.html';
    } else if(menuitemId == "delete") {
        button1_click();
    } else if(menuitemId == "newPro") {
        hwTree.newnode = true;
        document.getElementById("iframe_page").src = vmd.virtualPath + vmdSettings.systemPath+'/eQ9ULgcVb5/hwc6d63bc6.html';
    } else if(menuitemId == "copy") {
        nodeCopy();
    } else if(menuitemId == "cut") {
        // nodeCut();
    } else if(menuitemId == "paste") {
        nodePaste();
    } else if(menuitemId == "reName") {
        nodeReName()
    } else if(menuitemId == "expmodules") {
        ExpModules()
    }else if(menuitemId == "exppublishmodules") {
        expPublicshModules()
    }
}

///复制节点
function nodeCopy() {
    var mytree = hwTree;
    var selId = mytree.getSelectedItemId();
    // copyNodeId = selId;
    // cutNodeId = "";
    mytree.copyNodeId = selId;

}

//剪切节点(暂时不考虑)
function nodeCut() {
    var mytree = hwTree;
    var selId = mytree.getSelectedItemId();
    cutNodeId = selId;
    copyNodeId = "";
}

function nodePaste() {
    //创建一个form，填写name，备注
    var copyNode = hwTree.itemObj[hwTree.copyNodeId];
    var form = new Ext.form.FormPanel({
        labelAlign: "top",
        bodyStyle: "padding: 10px",
        border: false,
        items: [{
            xtype: "textfield",
            allowBlank: false,
            anchor: "100%",
            name: 'name',
            height: 30,
            fieldLabel: '将<span style="color:red;font-weight:bold">' + copyNode.text + '</span>复制为',
            emptyText: "请输入模块名称"
        }, {
            xtype: "textarea",
            allowBlank: true,
            name: 'remark',
            anchor: "100%",
            fieldLabel: "备注"
        }]


    })
    var win = new Ext.Window({

        width: 440,
        height: 260,
        title: '模块粘贴',
        hidden: false,
        layout: "fit",
        border: false,
        modal: true,
        items: form,
        fbar: [{
            text: '确定',
            handler: function() {
                if(form.getForm().isValid()) {
                    var values = form.form.getValues()
                    doNodePaste(values.name, values.remark, function() {
                        win.close()
                    })
                }
            }
        }, {
            text: '取消',
            handler: function() {
                win.close()
            }

        }]
    });
    win.show()
    form.form.setValues({
        name: copyNode.text + '1'
    })
}

//粘帖节点
function doNodePaste(name, remark, callback) {
    var mytree = hwTree;
    //先粘贴，等粘贴成功后，将copynodeid置空
    var copyNodeId = mytree.copyNodeId;
    if(!copyNodeId) {
        Ext.Msg.alert('错误', "粘贴出错，请重新复制！");
        return;
    }
    //首先创建模块，等成功后再拷贝文件。
    var selId = mytree.getSelectedItemId();
    var selnode = mytree.itemObj[selId];
    var selnodepath = selnode.path;
    var category_id;
    var projectId;
    var remark = remark || selnode.remark;
    if(selnode.isProject) {
        projectId = C;
        category_id = "0";
    } else if(selnode.isFord) {
        projectId = selnode.projectId;
        category_id = selId;
    } else {
        projectId = btnProjectName.projectId;
        category_id = "0";
        selId = '0';
    }
    myMask = new Ext.LoadMask(Ext.getBody(), {
        msg: "加载中,请稍后..."
    });
    myMask.show();
    // 判断同一节点下是否存在相同名称的模块
    checkModuleReName(projectId, category_id, name, function() {
        if(callback) {
            callback()
        }
        if(copyNodeId) {
            var copyNode = mytree.itemObj[copyNodeId];
            var copyFilePath = copyNode.path;
            var ModeName = name || copyNode.text;
            var id = newGuid(10);
            var newcode = newGuid(32);
            var row_created_by = Ext.util.Cookies.get('userName');
            var row_created_date = Ext.Date.dateFormat(new Date(), 'Y-m-d H:i:s');

            var saveCopyModelinfo = function() {

                //保存模块基础信息
                hwDas.ajax({
                    das: {
                        idedas: true
                    },
                    url: "CDEServcie/module/info",
                    type: 'post',
                    contentType: 'application/json;charset=UTF-8',
                    timeout: 50000,
                    params: {},
                    data: [{
                        id: id,
                        code: newcode,
                        type: "0",
                        name: ModeName,
                        remark: remark,
                        category_id: category_id,
                        project_id: projectId,
                        row_created_by: row_created_by,
                        row_created_date: row_created_date,
                        row_changed_by: row_created_by,
                        row_changed_date: row_created_date
                    }],
                    success: function(result) {
                        if(selId == '0') {
                            mytree.insertNewChild(selId, id, ModeName);
                            mytree.setItemImage2(id, "tree/model.png", "tree/model.png", "tree/model.png")
                        } else {
                            if(mytree.itemObj[selId].loadChild == true) {
                                mytree.insertNewChild(selId, id, ModeName);
                                mytree.setItemImage2(id, "tree/model.png", "tree/model.png", "tree/model.png")
                            }
                        }
                        var treenode = mytree.item(id);
                        treenode.path = selnodepath + "/" + id;
                        treenode.projectId = projectId;
                        if(treenode) {
                            treenode.isModel = true;
                            treenode.text = ModeName;
                            treenode.createuser = row_created_by;
                            treenode.createtime = row_created_date;
                            treenode.remark = remark;
                            treenode.code = newcode
                            treenode.newnode = false;
                        }
                        mytree.itemObj[id] = treenode;
                        mytree.selectItem(id, false, false);
                        mytree.newnode = false;
                        //拷贝vmd文件
                        hwDas.copy("vmd", "modules" + copyFilePath + ".vmd", "modules" + treenode.path + ".vmd", function() {
                            //重新刷新
                            mytree.selectItem(id, true);
                            mytree.copyNodeId = null;
                            myMask.hide();
                        }, function(msg) {
                            if(msg.indexOf('不存在') != -1) {
                                myMask.hide();
                                mytree.selectItem(id, true);
                                mytree.copyNodeId = null;
                                vmd.tip("该模块未设计", 'info', 2000);
                            } else {
                                Tips.tips(msg, "error");
                            }
                        });
                        //拷贝html 预览界面
                        hwDas.copy("vmd", "modules" + copyFilePath + ".html", "modules" + treenode.path + ".html",
                            function() {
                                myMask.hide();
                            },
                            function(msg) {
                                myMask.hide();
                                //   Ext.Msg.alert('错误',msg);
                            });
                        //复制后对file文件信息进行生成   成兵20180816增加
                        hwDas.ajax({
                            das: {
                                idedas: true
                            },
                            url: "CDEServcie/module/file",
                            type: 'post',
                            contentType: 'application/json;charset=UTF-8',
                            timeout: 50000,
                            params: {},
                            data: [{
                                filepath: selnodepath + "/" + id,
                                version: 1,
                                module_id: id
                            }],
                            success: function(result) {
                                // Ext.Msg.alert("提示", "保存成功！")
                            },
                            error: function(msg) {
                                Ext.Msg.alert("提示", "保存模块版本信息失败")
                                return;
                            }
                        })
                    },
                    error: function(msg) {
                        myMask.hide();
                        Ext.Msg.alert("提示", "复制失败")
                        return;
                    }
                })
            }
            var saveSubwinInfo = function() {
                //首先获取模块及所有子模块信息
                hwDas.get("CDEServcie/module/getmoduleandsubmodule", {}, {
                        module_id: copyNodeId
                    }, function(result) {
                        var datas = result.data[0].datas;
                        var newmoduleid = vmd.getGuid(10)
                        var newcode = vmd.getGuid(36)
                        //此处循环处理目标id  路径  层级关系
                        var getchildWinIds = function(srcid, trgid, mainid, trgpath) {
                            for(var i = 0; i < datas.length; i++) {
                                if(srcid == datas[i].upmoduleid) {
                                    newguid = vmd.getGuid(10)
                                    datas[i].trgid = newguid;
                                    datas[i].code = vmd.getGuid(36);
                                    datas[i].trgpath = trgpath + "/" + newguid;
                                    datas[i].trgupid = trgid;
                                    datas[i].trgmainid = mainid;
                                    datas[i].trgcateid = category_id;
                                    getchildWinIds(datas[i].id, newguid, mainid, trgpath + "/" + newguid)
                                }
                            }
                        }
                        for(var i = 0; i < datas.length; i++) {
                            if(copyNodeId == datas[i].id) {
                                datas[i].trgid = newmoduleid;
                                datas[i].trgpath = selnodepath + "/" + newmoduleid;
                                datas[i].trgupid = "";
                                datas[i].trgmainid = "";
                                datas[i].trgcateid = category_id;
                                datas[i].code = newcode;
                                datas[i].name = ModeName;
                                getchildWinIds(copyNodeId, newmoduleid, newmoduleid, selnodepath + "/" + newmoduleid)
                                break;
                            }
                        }
                        //此处保存复制的文件信息
                        var paths = [];
                        var saveData = [];
                        for(var i = 0; i < datas.length; i++) {
                            //用于替换path的信息
                            paths.push({
                                oldpath: datas[i].filepath + ".vmd",
                                newpath: datas[i].trgpath + ".vmd"
                            })
                            //用于替换moduleid的信息
                            paths.push({
                                oldpath: "moduleId:\"" + datas[i].id + "\"",
                                newpath: "moduleId:\"" + datas[i].trgid + "\""
                            }, {
                                oldpath: "moduleId\\\":\\\"" + datas[i].id,
                                newpath: "moduleId\\\":\\\"" + datas[i].trgid
                            })
                            //组织用于入库的模块信息
                            saveData.push({
                                project_id: datas[i].project_id,
                                code: datas[i].code,
                                upmoduleid: datas[i].trgupid,
                                mainmoduleid: datas[i].trgmainid,
                                module_id: datas[i].trgid,
                                name: datas[i].name,
                                remark: datas[i].remark,
                                category_id: datas[i].category_id,
                                type: datas[i].type,
                                filepath: datas[i].trgpath
                            })
                        }
                        //保存模块信息服务
                        hwDas.save("CDEServcie/module/getchildmodule", {}, {}, saveData, function() {
                            //添加节点到树
                            if(selId == '0') {
                                mytree.insertNewChild(selId, newmoduleid, ModeName);
                                mytree.setItemImage2(id, "tree/model.png", "tree/model.png", "tree/model.png")
                            } else {
                                if(mytree.itemObj[selId].loadChild == true) {
                                    mytree.insertNewChild(selId, newmoduleid, ModeName);
                                    mytree.setItemImage2(newmoduleid, "tree/model.png", "tree/model.png", "tree/model.png")
                                }
                            }
                            var treenode = mytree.item(newmoduleid);
                            treenode.path = selnodepath + "/" + newmoduleid;
                            treenode.projectId = projectId;
                            if(treenode) {
                                treenode.isModel = true;
                                treenode.text = ModeName;
                                treenode.createuser = row_created_by;
                                treenode.createtime = row_created_date;
                                treenode.remark = remark;
                                treenode.code = newcode
                                treenode.newnode = false;
                            }
                            mytree.itemObj[newmoduleid] = treenode;
                            mytree.selectItem(newmoduleid, false, false);
                            mytree.newnode = false;

                            //此处读取文件、替换、保存
                            var count = 0;
                            acount = datas.length * 2;
                            var checkcount = function() {
                                count++;
                                if(count == acount) {
                                    myMask.hide();
                                }
                            }
                            for(var i = 0; i < datas.length; i++) {
                                vmd.core.createCopyFile("modules" + datas[i].filepath + ".vmd", "modules" + datas[i].trgpath + ".vmd", paths, "text", function() {
                                    checkcount()
                                }, function() {
                                    checkcount()
                                })
                                vmd.core.createCopyFile("modules" + datas[i].filepath + ".html", "modules" + datas[i].trgpath + ".html", paths, "html", function() {
                                    checkcount()
                                }, function() {
                                    checkcount()
                                })
                            }
                        }, function(msg) {
                            console.log(msg)
                            myMask.hide();
                        })
                    },
                    function(msg) {
                        console.log(msg)
                        myMask.hide();
                    })
            }
            //20180920 成兵 增加对是否包含子页面模块的判断
            hwDas.get("CDEServcie/module/getchildmodule", {}, {
                mainmoduleid: copyNodeId
            }, function(result) {
                if(result.data.length > 0 && result.data[0].datas.length > 0) {
                    saveSubwinInfo()
                } else {
                    saveCopyModelinfo()
                }
            }, function(msg) {
                console.log(msg)
            })
        } else if(cutNodeId != "") {
            var cutNode = mytree.itemObj[copyNodeId];
            var cutFilePath = copyNode.path;
            var ModeName = copyNode.text;
            var remark = cutNode.remark;
            var code = cutNode.code;
            var id = cutNodeId;
            var row_created_by = Ext.util.Cookies.get('userName');
            var row_created_date = Ext.Date.dateFormat(new Date(), 'Y-m-d H:i:s');
            var row_changed_by = Ext.util.Cookies.get('userName');
            var row_changed_date = Ext.Date.dateFormat(new Date(), 'Y-m-d H:i:s');
            //保存模块基础信息
            hwDas.ajax({
                das: {
                    idedas: true
                },
                url: "CDEServcie/module/info",
                type: 'put',
                contentType: 'application/json;charset=UTF-8',
                timeout: 50000,
                params: {},
                data: [{
                    id: id,
                    category_id: category_id,
                    project_id: projectId,
                    row_created_by: row_created_by,
                    row_created_date: row_created_date,
                    row_changed_by: row_changed_by,
                    row_changed_date: row_changed_date
                }],
                success: function(result) {
                    //将节点移除，再添加
                    mytree.deleteItem(id);
                    mytree.insertNewChild(selId, id, ModeName);
                    mytree.setItemImage2(id, "tree/model.png", "tree/model.png", "tree/model.png")

                    cutNode.path = selnodepath + "/" + id;
                    cutNode.projectId = Project_id;
                    cutNode.createuser = row_created_by;
                    cutNode.createtime = row_created_date;
                    cutNode.changetime = row_changed_date;
                    cutNode.changeuser = row_changed_by;
                    treenode.newnode = false;

                    mytree.selectItem(id, false, false);
                    mytree.newnode = false;
                    //保存模块路径版本信息
                    hwDas.ajax({
                        das: {
                            idedas: true
                        },
                        url: "CDEServcie/module/file",
                        type: 'put',
                        contentType: 'application/json;charset=UTF-8',
                        timeout: 50000,
                        params: {},
                        data: [{
                            filepath: selnodepath + "/" + id,
                            version: 1,
                            module_id: id
                        }],
                        success: function(result) {
                            // Ext.Msg.alert("提示", "保存成功！")
                        },
                        error: function(msg) {
                            Ext.Msg.alert("提示", "保存模块版本信息失败")
                            return;
                        }
                    })
                },
                error: function(msg) {
                    Ext.Msg.alert("提示", "复制失败")
                    myMask.hide();
                    return;
                }
            })
        }
        copyCutNodeId = "";
    })
}
// 重命名
function nodeReName() {
    var mytree = hwTree;
    var selId = mytree.getSelectedItemId();
    var selnode = mytree.itemObj[selId];
    var nodeName = mytree.itemObj[selId].text;
    var parentId;
    if(mytree.getParentId(selId)) {
        parentId = mytree.getParentId(selId)
    } else {
        parentId = '0'
    }
    var addford = function(fordname, callback) {
        myMask = new Ext.LoadMask(Ext.getBody(), {
            msg: "加载中,请稍后..."
        });
        myMask.show();
        // 判断同一目录下是否存在相同名称分类
        checkfordReName(btnProjectName.projectId, parentId, selId, fordname, function() {
            if(callback) {
                callback()
            }
            hwDas.edit("CDEServcie/module/category", {}, {
                    name: fordname,
                    id: selId,
                }, [{
                    name: fordname,
                    id: selId,
                }],
                function(result) {
                    selnode.text = fordname;
                    mytree.setItemText(selId, fordname);
                    myMask.hide();
                },
                function(msg) {
                    myMask.hide();
                    Ext.Msg.alert("提示", "新建目录失败")
                }
            )
        })
    }
    var fordname = new Ext.MyFordWin(addford, nodeName);
    fordname.show();
}
//页面加载完后事件
function MyViewport_afterrender(sender) {
    var einfo = Ext.util.Cookies.get('hwEcyLogin');
    var login = Ext.util.Cookies.get('hwLogin');
    btnGrxx.setText(Cookie.get('userName') || '个人信息');
    MyP_Htool.doLayout()
    divJcxx.show()
    divJcxx.update("<iframe  id='iframe_page' src='" + vmd.virtualPath + vmdSettings.systemPath+"/eQ9ULgcVb5/hw03cb4931.html' width=100% height=100% frameborder=0  ></iframe>");

    // MyP_jcxx.body.update("<iframe  id='iframe_page' src='" + vmd.virtualPath + vmdSettings.systemPath+"/eQ9ULgcVb5/hw03cb4931.html' width=100% height=100% frameborder=0  ></iframe>");
    if(!allowedDesigner) {
        MyC_tc.hide();
        button.hide();
    }
    // 初始化工区切换菜单
    initMenuWorkSpaceList();

    $LAB.script('/lib/introjs/intro.js')
        .wait(function() {
            vmd.loadCss('/lib/introjs/introjs.css')
            var vmdinittips = LocalData.get('vmdinittips');
            if(!vmdinittips) {
                introJs().setOptions({
                    nextLabel: '下一步 &rarr;',
                    prevLabel: '&larr; 上一步',
                    skipLabel: '退出',
                    doneLabel: '结束'
                }).start();
                LocalData.set('vmdinittips', true)
            }
        })
}
//退出图标的点击事件
function MyC_tc_afterrender(sender) {
    sender.el.on('click', function() {
        outvmd();
    })
}
//退出按钮操作
function button_click(sender) {
    outvmd();
}
//登出vmd2.0
function outvmd() {

    Ext.Msg.confirm("提示", "确定要退出vmd2.0吗？", function(type) {

        if(type == "yes") {
            // Ext.util.Cookies.clear("hwLogin");
            Cookie.clear();
            self.location = vmd.virtualPath + vmdSettings.systemPath+"/eQ9ULgcVb5/eQ9ULgcVc5.html";
        }

    })
}

//页面初始化前方法 控制权限 记录编辑权限
function MyViewport_beforerender(sender) {
    if(Ext.isIE)
        vmd.tip('为达到更好的用户体验，建议采用谷歌浏览器、360极速浏览器等webkit内核的浏览器进行操作。', 'info', 3000);
    //模拟平台5的token传参登陆,默认设置cookie 为dbadmin 管理员
    var urlToken = getUrlParam("token");
    if(urlToken != null && urlToken != "") {
        Ext.util.Cookies.set('userName', "管理员");
        Ext.util.Cookies.set('hwLogin', "dbadmin");
        return
    }
    var userType = Ext.util.Cookies.get("userType");
    allowedDesigner = userType == "vmdDesigner" ? true : false;
    // var login = Ext.util.Cookies.get("login");
    if(!login) {
        self.location = vmd.virtualPath + vmdSettings.systemPath+"/eQ9ULgcVb5/eQ9ULgcVc5.html";
    }
}

var selModeWin;
window["selModeWin"] = selModeWin;
//新建模块时 打开模版选择页面 关闭时调用该方法，由子页面调用或该页面调用
function closeSelMode(create) {
    if(create) {
        var mytree = hwTree;
        var selId = mytree.getSelectedItemId();
        var selnode = mytree.itemObj[selId];
        selnode.newnode = false;
        mytree.newnode = false;
    }

    selModeWin.close();
}
window["closeSelMode"] = closeSelMode;
//新建模块时 打开模版选择页面，由子页面调用或该页面调用
function openSelMode(id, name, pdth, workspaceId) {
    selModeWin = new vmdDesigner({
        title: '<span style="color:blue">' + name + '</span> 模版选择',
        params: {
            id: id,
            name: name,
            path: pdth,
            workspaceid: workspaceId
        },
        auto: false,
        width: 920,
        height: 580,
        // width: document.body.clientWidth - 200,
        // height: document.body.clientHeight - 100,
        url: vmd.virtualPath + vmdSettings.systemPath+'/eQ9ULgcVb5/hw3b9ae460.html'
    });
    selModeWin.show(true);
}
//将选择模版方法放入window中
window["openSelMode"] = openSelMode;
var maskProgress = null;

// 工作流是否加载过
var ifWorkflowLoaded = false;

function hwTreeWorkFlow_afterrender(sender) {
    ifWorkflowLoaded = true;
    // 清空树原有的默认数据
    hwTreeWorkFlow.deleteChildItems(0);
    getWorkflowCategory();

    // 设置没配置工作流的提示信息
    panel1.add({
        id: 'infoWorkflow_div',
        tag: 'div',
        html: '请配置工作流',
        style: 'font-size:14px;font-family:Microsoft YaHei;color:#666666;margin:10px;'
    });
}

// 重新加载工作流分类，用于项目配置完成后保存
function reloadWorkflowCategory() {

    if(ifWorkflowLoaded) {
        hwTreeWorkFlow.deleteChildItems(0);
        getWorkflowCategory();
    }
}

function getWorkflowCategory() {
    if(!ifWorkflowLoaded) {
        return;
    }
    // 进度条
    var myMask = new Ext.LoadMask(Ext.getCmp("hwTreeWorkFlow").el, {
        msg: "数据加载中,请稍后...",
        msgCls: 'z-index:10000;'
    });
    myMask.show();
    maskProgress = new Ext.LoadMask(Ext.getBody(), {
        msg: "数据加载中,请稍后...",
        msgCls: 'z-index:10000;'
    });
    maskProgress.hide();

    // 获取项目中配置的工作流分类
    hwDas.get(
        "DataServiceWorkSpace/projectInfo/ProjcetServiceCategory", {}, {
            "projectid": btnProjectName.projectId,
            "type": 0
        },
        function(resultChecked) {
            // 根据获取的数据赋值基本信息Tab页
            if(null === resultChecked && undefined === resultChecked) {
                showWorkflowHintInfo();
                return;
            }

            if(null != resultChecked.data && undefined != resultChecked.data) {
                        // 获取所有工作流分类
                        var mytree = hwTreeWorkFlow;
                        mytree.itemObj = {};
                if(resultChecked.data.length > 0) {

                    // if(null != resultChecked.data[0].datas && undefined != resultChecked.data[0].datas) {}

                    if(resultChecked.data[0].datas.length > 0) {

                        var firstNode = "";
                        mytree.deleteChildItems(0);
                        mytree.loadJSONObject({
                            id: 0,
                            text: "工作流",
                            item: []
                        });
                        mytree.newnode = false;
                        var urlService = "http://" + (vmd.workspace.workflowIp || vmdSettings.workflowIp) + "/activiti-rest/service/repository/categorys/root?info=kermit";
                        // if(vmdSettings.workflowIp) {
                        //     var info = "kermit";
                        //     urlService = "http://" + vmdSettings.workflowIp + "/activiti-rest/service/repository/categorys/root?info=" + info;

                        //     // if(einfo && einfo != undefined && einfo != "undefined") {
                        //     //     urlService = "http://" + vmdSettings.workflowIp + "/activiti-rest/service/repository/categorys/root?einfo=" + einfo;
                        //     // } else {
                        //     //     var info = login;
                        //     //     if(!info) {
                        //     //         info = "kermit";
                        //     //     }
                        //     //     urlService = "http://" + vmdSettings.workflowIp + "/activiti-rest/service/repository/categorys/root?info=" + info;
                        //     // }
                        // }

                        // 获取根节点下的文件夹节点信息
                        hwDas.ajax({
                            // das: {
                            //     idedas: false
                            // },
                            url: urlService,
                            type: 'get',
                            timeout: 10000,
                            params: {},
                            success: function(result) {
                                var bFlag = false;

                                ////////////////////////////////////////////////////////////////////
                                for(var j = 0; j < resultChecked.data[0].datas.length; j++) {

                                    // 获取数据后解析形成树形节点；
                                    for(var i = 0; i < result.data.length; i++) {
                                        if(result.data[i].id ==
                                            resultChecked.data[0].datas[j].service_category_id) {

                                            bFlag = true;
                                            mytree.insertNewChild(0, result.data[i].id, result.data[i].name);
                                            mytree.setItemImage2(result.data[i].id, "tree/projectclose.png", "tree/projectopen.png", "tree/projectclose.png");
                                            mytree.setItemColor(result.data[i].id, '#000000', '#000000');
                                            mytree.insertNewChild(result.data[i].id, result.data[i].id + "-0000", "");
                                            mytree.closeItem(result.data[i].id);
                                            var treenode = mytree.item(result.data[i].id);
                                            if(treenode) {
                                                treenode.isTemplate = false; // 标识是否是模板文件
                                                // treenode.childLoaded = false; // 标识是否加载了子节点
                                                treenode.isDeployment = false; // 标识是否发布
                                                treenode.url = result.data[i].url;
                                                // 标识当前分类节点下的分类节点是否加载完成
                                                treenode.childCategoryLoaded = false;
                                                // 标识当前分类节点下的模板节点是否加载完成
                                                treenode.childModelLoaded = false;
                                            }
                                            var objKey = "hw" + result.data[i].id;
                                            mytree.itemObj[objKey] = treenode;
                                        }
                                    }
                                }

                                if(bFlag) {
                                    hwTreeWorkFlow.show();
                                } else {

                                    hwTreeWorkFlow.hide();
                                }
                                // ifWorkflowLoaded = true;
                                myMask.hide();
                            },
                            error: function(msg) {
                                showWorkflowHintInfo();
                                myMask.hide();
                                // Ext.Msg.alert("提示", "获取模块信息失败", function() {})
                            }
                        })

                        //绑定右键菜单
                        var menu = new dhtmlXMenuObject();
                        menu.renderAsContextMenu();
                        menu.attachEvent("onClick", onMenuWorkFlowClick);
                        menu.addNewChild(menu.topId, 0, "newWorkFlowCategory", "新建分类", false);
                        menu.addNewChild(menu.topId, 1, "newWorkFlowTemplate", "新建模板", false);
                        menu.addNewChild(menu.topId, 2, "editWorkFlow", "编辑", false);
                        menu.addNewChild(menu.topId, 3, "deleteWorkFlow", "删除", false);
                        menu.addNewChild(menu.topId, 4, "viewWorkFlow", "查看", false);
                        menu.addNewChild(menu.topId, 5, "publishWorkFlow", "发布", false);
                        mytree.enableDragAndDrop("temporary_disabled");
                        mytree.enableContextMenu(menu);

                        mytree.attachEvent("onBeforeContextMenu", function(itemId) {
                            var mytree = hwTreeWorkFlow;
                            var selId = mytree.getSelectedItemId();
                            var objKey = "hw" + selId;
                            var selnode = mytree.itemObj[objKey];
                            if(!selnode) {
                                return;
                            }
                            // 模板节点
                            if(selnode.isTemplate) {
                                menu.hideItem('newWorkFlowCategory');
                                menu.hideItem('newWorkFlowTemplate');
                                menu.showItem('editWorkFlow');
                                menu.showItem('viewWorkFlow');
                                if(selnode.isDeployment) {
                                    menu.hideItem('deleteWorkFlow');
                                    menu.hideItem('publishWorkFlow');
                                } else {
                                    menu.showItem('publishWorkFlow');
                                    menu.showItem('deleteWorkFlow');
                                }
                            } else // 分类节点
                            {
                                menu.showItem('newWorkFlowCategory');
                                menu.showItem('newWorkFlowTemplate');
                                menu.showItem('editWorkFlow');
                                menu.showItem('deleteWorkFlow');
                                menu.hideItem('viewWorkFlow');
                                menu.hideItem('publishWorkFlow');
                            }

                            return true;
                        })

                        //绑定右键事件 设置右键选中节点
                        mytree.attachEvent('onRightClick', function(id) {
                            mytree.selectItem(id);
                        })
                    } else {
                        showWorkflowHintInfo();
                        myMask.hide();
                    }
                } else {
                    showWorkflowHintInfo();
                    myMask.hide();
                }
            } else {
                showWorkflowHintInfo();
                myMask.hide();
            }
            // Tips.tips("查询成功！", "success");
        },
        function(msg) {
            showWorkflowHintInfo();
            myMask.hide();
        });
}

function showWorkflowHintInfo() {

    hwTreeWorkFlow.hide();
    // panel1.add({
    //     id: 'infoWorkflow_div',
    //     tag: 'div',
    //     html: '请配置工作流',
    //     style: 'font-size:14px;font-family:Microsoft YaHei;color:#666666;margin:10px;'
    // });
}
// function hwTreeWorkFlow_afterrender(sender) {
//     // 进度条
//     var myMask = new Ext.LoadMask(Ext.getCmp("hwTreeWorkFlow").el, {
//         msg: "数据加载中,请稍后...",
//         msgCls: 'z-index:10000;'
//     });
//     myMask.show();
//     maskProgress = new Ext.LoadMask(Ext.getBody(), {
//         msg: "数据加载中,请稍后...",
//         msgCls: 'z-index:10000;'
//     });
//     maskProgress.hide();

//     var mytree = hwTreeWorkFlow;
//     var firstNode = "";
//     mytree.deleteChildItems(0);
//     mytree.loadJSONObject({
//         id: 0,
//         text: "工作流",
//         item: []
//     });
//     mytree.itemObj = {};
//     mytree.newnode = false;
//     var urlService = "http://" + vmdSettings.workflowIp + "/activiti-rest/service/repository/categorys/root?info=kermit";
//     if(vmdSettings.workflowIp) {
//         var info = "kermit";
//         urlService = "http://" + vmdSettings.workflowIp + "/activiti-rest/service/repository/categorys/root?info=" + info;

//         // if(einfo && einfo != undefined && einfo != "undefined") {
//         //     urlService = "http://" + vmdSettings.workflowIp + "/activiti-rest/service/repository/categorys/root?einfo=" + einfo;
//         // } else {
//         //     var info = login;
//         //     if(!info) {
//         //         info = "kermit";
//         //     }
//         //     urlService = "http://" + vmdSettings.workflowIp + "/activiti-rest/service/repository/categorys/root?info=" + info;
//         // }
//     }

//     // 获取根节点下的文件夹节点信息
//     hwDas.ajax({
//         // das: {
//         //     idedas: false
//         // },
//         url: urlService,
//         type: 'get',
//         timeout: 50000,
//         params: {},
//         success: function(result) {
//             // 获取数据后解析形成树形节点；
//             for(var i = 0; i < result.data.length; i++) {

//                 mytree.insertNewChild(0, result.data[i].id, result.data[i].name);
//                 mytree.setItemImage2(result.data[i].id, "tree/projectclose.png", "tree/projectopen.png", "tree/projectclose.png");
//                 mytree.setItemColor(result.data[i].id, '#000000', '#000000');
//                 mytree.insertNewChild(result.data[i].id, result.data[i].id + "-0000", "");
//                 mytree.closeItem(result.data[i].id);
//                 var treenode = mytree.item(result.data[i].id);
//                 if(treenode) {
//                     treenode.isTemplate = false; // 标识是否是模板文件
//                     // treenode.childLoaded = false; // 标识是否加载了子节点
//                     treenode.isDeployment = false; // 标识是否发布
//                     treenode.url = result.data[i].url;
//                     // 标识当前分类节点下的分类节点是否加载完成
//                     treenode.childCategoryLoaded = false;
//                     // 标识当前分类节点下的模板节点是否加载完成
//                     treenode.childModelLoaded = false;
//                 }
//                 var objKey = "hw" + result.data[i].id;
//                 mytree.itemObj[objKey] = treenode;
//             }

//             myMask.hide();
//         },
//         error: function(msg) {
//             myMask.hide();
//             Ext.Msg.alert("提示", "获取模块信息失败", function() {})
//         }
//     })

//     //绑定右键菜单
//     var menu = new dhtmlXMenuObject();
//     menu.renderAsContextMenu();
//     menu.attachEvent("onClick", onMenuWorkFlowClick);
//     menu.addNewChild(menu.topId, 0, "newWorkFlowCategory", "新建分类", false);
//     menu.addNewChild(menu.topId, 1, "newWorkFlowTemplate", "新建模板", false);
//     menu.addNewChild(menu.topId, 2, "editWorkFlow", "编辑", false);
//     menu.addNewChild(menu.topId, 3, "deleteWorkFlow", "删除", false);
//     menu.addNewChild(menu.topId, 4, "viewWorkFlow", "查看", false);
//     menu.addNewChild(menu.topId, 5, "publishWorkFlow", "发布", false);
//     mytree.enableDragAndDrop("temporary_disabled");
//     mytree.enableContextMenu(menu);

//     mytree.attachEvent("onBeforeContextMenu", function(itemId) {
//         var mytree = hwTreeWorkFlow;
//         var selId = mytree.getSelectedItemId();
//         var objKey = "hw" + selId;
//         var selnode = mytree.itemObj[objKey];
//         if(!selnode) {
//             return;
//         }
//         // 模板节点
//         if(selnode.isTemplate) {
//             menu.hideItem('newWorkFlowCategory');
//             menu.hideItem('newWorkFlowTemplate');
//             menu.showItem('editWorkFlow');
//             menu.showItem('viewWorkFlow');
//             if(selnode.isDeployment) {
//                 menu.hideItem('deleteWorkFlow');
//                 menu.hideItem('publishWorkFlow');
//             } else {
//                 menu.showItem('publishWorkFlow');
//                 menu.showItem('deleteWorkFlow');
//             }
//         } else // 分类节点
//         {
//             menu.showItem('newWorkFlowCategory');
//             menu.showItem('newWorkFlowTemplate');
//             menu.showItem('editWorkFlow');
//             menu.showItem('deleteWorkFlow');
//             menu.hideItem('viewWorkFlow');
//             menu.hideItem('publishWorkFlow');
//         }

//         return true;
//     })

//     //绑定右键事件 设置右键选中节点
//     mytree.attachEvent('onRightClick', function(id) {
//         mytree.selectItem(id);
//     })
// }

/*1.使用MessageBox.wait()方法实现进度条*/
function Read1() {
    Ext.Msg.wait("内容", "Extjs进度条应用", {
        text: "正在加载。。。"
    });
}
//右键菜单事件
function onMenuWorkFlowClick(menuitemId) {
    if(menuitemId == "newWorkFlowCategory") { // 新建类别
        newWorkFlowCategoryFun();
    } else if(menuitemId == "newWorkFlowTemplate") { // 新建模板
        newWorkFlowTemplateFun();
    } else if(menuitemId == "editWorkFlow") { // 编辑
        editWorkFlowFun();
    } else if(menuitemId == "deleteWorkFlow") { //删除
        deleteWorkFlowFun();
    } else if(menuitemId == "viewWorkFlow") { //查看
        viewWorkFlowFun();
    } else if(menuitemId == "publishWorkFlow") { //发布
        publishWorkFlowFun();
    }
}

//工作流空白处右键菜单事件
function onMenuWorkFlowPanelClick(menuitemId) {
    // 在空白处点击鼠标时，就取消原有节点的选中
    hwTreeWorkFlow.clearSelection();
    newWorkFlowCategoryFun();
}

// 新建工作流分类
function newWorkFlowCategoryFun() {
    var addTreeNode = function(fordname, callback) {
        var mytree = hwTreeWorkFlow;
        var selId = mytree.getSelectedItemId();
        var parentId = selId;
        var iconPathOpen = "tree/folderOpen.gif";
        var iconPathClose = "tree/folderClosed.gif";
        if('' == selId) {
            selId = "00000000000000000000000000000000";
            parentId = "0";
            iconPathOpen = "tree/projectopen.png";
            iconPathClose = "tree/projectclose.png";
        }
        var nodename = fordname;
        myMask = new Ext.LoadMask(Ext.getBody(), {
            msg: "正在执行新建操作...",
            msgCls: 'z-index:10000;'
        });
        myMask.show();
        checkFlowfordReName(parentId, selId, nodename, function() {
            if(callback) {
                callback();
            }
            var urlService = "http://" + (vmd.workspace.workflowIp || vmdSettings.workflowIp) + "/activiti-rest/service/repository/categorys?info=kermit";
            // if(vmdSettings.workflowIp) {
            //     var info = "kermit";
            //     urlService = "http://" + vmdSettings.workflowIp + "/activiti-rest/service/repository/categorys?info=" + info;

            //     // if(einfo && einfo != undefined && einfo != "undefined") {
            //     //     urlService = "http://" + vmdSettings.workflowIp + "/activiti-rest/service/repository/categorys?einfo=" + einfo;
            //     // } else {
            //     //     var info = login;
            //     //     if(!info) {
            //     //         info = "kermit";
            //     //     }
            //     //     urlService = "http://" + vmdSettings.workflowIp + "/activiti-rest/service/repository/categorys?info=" + info;
            //     // }
            // }
            hwDas.ajax({
                url: urlService,
                type: 'post',
                timeout: 50000,
                contentType: 'application/json;charset=UTF-8',
                data: { // body传参
                    'superId': selId,
                    'name': nodename,
                    'xh': 1
                },
                success: function(result) {

                    if(result == "") {
                        return;
                    }
                    // 获取数据后解析形成树形节点；
                    mytree.insertNewChild(parentId, result.id, result.name);
                    mytree.setItemColor(result.id, '#000000', '#000000');
                    mytree.setItemImage2(result.id, iconPathClose, iconPathOpen, iconPathClose);
                    // mytree.insertNewChild(result.id, result.id + "-0000", "");
                    mytree.closeItem(result.id);
                    var treenode = mytree.item(result.id);
                    if(treenode) {
                        treenode.isTemplate = false; // 标识是否是目标文件
                        // treenode.childLoaded = true; // 标识是否加载了子节点
                        treenode.isDeployment = false; // 标识是否发布
                        treenode.url = result.url;
                        // 标识当前分类节点下的分类节点是否加载完成
                        treenode.childCategoryLoaded = true;
                        // 标识当前分类节点下的模板节点是否加载完成
                        treenode.childModelLoaded = true;
                    }
                    var objKey = "hw" + result.id;
                    mytree.itemObj[objKey] = treenode;

                    hwTreeWorkFlow.show();

                    connectWorkflowProject(result.id);

                    myMask.hide();
                },
                error: function(msg) {
                    myMask.hide();
                    Ext.Msg.alert("提示", "新建分类失败！")
                }
            })
        })

    }
    var winForm = new Ext.winWorkFlowCategory(addTreeNode, "");
    winForm.show();
}

// 新建工作流分类后，同步关联与项目的关系
function connectWorkflowProject(id) {
    var objWorkflow = {
        'projectid': btnProjectName.projectId,
        'servicecategoryid': id,
        'type': 0
    };
    hwDas.add(
        "DataServiceWorkSpace/projectInfo/ProjcetServiceCategory", {}, {}, objWorkflow,
        function(result) {
            // // 清空树原有的默认数据
            // hwTreeWorkFlow.deleteChildItems(0);
            // getWorkflowCategory();

            // Tips.tips("保存成功！", "success");
        },
        function(msg) {
            // Tips.tips("保存失败！", "error");
        }
    );
}

// 新建工作流模板
function newWorkFlowTemplateFun() {

    var addTreeNode = function(fordname, keyword, callback) {
        var mytree = hwTreeWorkFlow;
        var selId = mytree.getSelectedItemId();
        var nodeNameSel = mytree.getSelectedItemText();
        var nodename = fordname;
        var nodeKeyWord = keyword;
        var userName = Ext.util.Cookies.get('userName');
        myMask = new Ext.LoadMask(Ext.getBody(), {
            msg: "正在新建模板...",
            msgCls: 'z-index:10000;'
        });
        myMask.show();
        CheckFlowMoudlRename(selId, '', nodename, function() {
            if(callback) {
                callback();
            }
            var urlService = "http://" + (vmd.workspace.workflowIp || vmdSettings.workflowIp) + "/activiti-rest/service/repository/hwmodels?info=kermit";
            // if(vmdSettings.workflowIp) {
            //     var info = "kermit";
            //     urlService = "http://" + vmdSettings.workflowIp + "/activiti-rest/service/repository/hwmodels?info=" + info;

            //     // if(einfo && einfo != undefined && einfo != "undefined") {
            //     //     urlService = "http://" + vmdSettings.workflowIp + "/activiti-rest/service/repository/hwmodels?einfo=" + einfo;
            //     // } else {
            //     //     var info = login;
            //     //     if(!info) {
            //     //         info = "kermit";
            //     //     }
            //     //     urlService = "http://" + vmdSettings.workflowIp + "/activiti-rest/service/repository/hwmodels?info=" + info;
            //     // }
            // }

            hwDas.ajax({
                url: urlService,
                type: 'post',
                timeout: 50000,
                contentType: 'application/json;charset=UTF-8',
                data: { // body传参
                    'name': nodename,
                    'key': nodeKeyWord,
                    'category': nodeNameSel,
                    'categoryId': selId,
                    'creator': userName,
                    'reviser': userName
                },
                success: function(result) {

                    if(result == "") {
                        return;
                    }
                    // 获取数据后解析形成树形节点；
                    mytree.insertNewChild(selId, result, nodename);
                    mytree.setItemColor(result, '#808080', '#808080');
                    mytree.setItemImage2(result, "tree/model.png", "tree/model.png", "tree/model.png");
                    mytree.closeItem(result);

                    var treenode = mytree.item(result);
                    if(treenode) {
                        treenode.isTemplate = true; // 标识是否是模板文件
                        // treenode.childLoaded = true; // 标识是否加载了子节点
                        treenode.isDeployment = false; // 标识是否发布（新建的模板是未发布的）
                        // treenode.url = result.data.url; // 返回值只有一个ID，没有URL
                        // 标识当前分类节点下的分类节点是否加载完成
                        treenode.childCategoryLoaded = true;
                        // 标识当前分类节点下的模板节点是否加载完成
                        treenode.childModelLoaded = true;

                        // treenode.path = "/" + result.data[j].datas[i].ID;
                        // treenode.isModel = true;
                        // treenode.createuser = datajson[i].row_created_by;
                        treenode.createtime = Ext.Date.dateFormat(new Date(), 'Y-m-d H:i:s');
                        treenode.changetime = Ext.Date.dateFormat(new Date(), 'Y-m-d H:i:s');

                        // treenode.changeuser = datajson[i].row_changed_by;
                        // treenode.remark = datajson[i].remark;
                        treenode.code = result;
                    }
                    var objKey = "hw" + result;
                    mytree.itemObj[objKey] = treenode;

                    mytree.selectItem(result, true, false);

                    // 显示基本信息页面
                    var eleIFrame = document.getElementById("iframe_page");
                    if(eleIFrame) {
                        eleIFrame.src = vmd.virtualPath + vmdSettings.systemPath+'/hw4acf2f8b/hw28e7092c.html';
                    }
                    // // 调用设计器HTML页面
                    // document.getElementById("iframe_page").src = '/activiti/modeler.html?mode=design&modelId=' + result + '&info=kermit';

                    myMask.hide();
                },
                error: function(msg) {
                    myMask.hide();
                    Ext.Msg.alert("提示", "新建模板失败！")
                }
            })
        })
    }
    var winForm = new Ext.winWorkFlowTemplate(addTreeNode);
    winForm.show();
}

// 用于响应工作流加载完成后隐藏进度条
function workflowPageLoaded() {
    if(maskProgress) {
        maskProgress.hide();
    }
}

// 工作流分类编辑
function editWorkFlowFun() {
    var mytreeTmp = hwTreeWorkFlow;
    var nodeIdTmp = mytreeTmp.getSelectedItemId();
    var nodeNameSelTmp = mytreeTmp.getSelectedItemText();
    var objKeyTmp = "hw" + nodeIdTmp;
    var nodeItemObjTmp = mytreeTmp.itemObj[objKeyTmp];
    var userName = Ext.util.Cookies.get('userName');
    if(nodeItemObjTmp) {
        // 模板节点
        if(nodeItemObjTmp.isTemplate) {
            // 调用设计器HTML页面
            var infoLogin = '&info=kermit';
            // var info = login;
            // if(einfo && einfo != undefined && einfo != "undefined") {
            //     infoLogin = '&einfo=' + einfo;
            // } else if(info && info != undefined && info != "undefined") {
            //     infoLogin = '&info=' + info;
            // }
            divJcxx.show();
            ModuleInfo.hide();
            WorkflowModuleInfo.hide();
            DataServiceModuleInfo.hide();
            var pageSrc = '/activiti/modeler.html?mode=design&modelId=' + nodeIdTmp + infoLogin;

            // 显示工作流HTML页面
            if(maskProgress) {
                // maskProgress.show();
            }
            // if(progressBar) {
            //     // progressBar.show();
            // }
            document.getElementById("iframe_page").src = pageSrc;
        } else { // 分类节点
            var callbackFunc = function(fordname, callback) {
                var mytree = hwTreeWorkFlow;
                var nodeId = mytree.getSelectedItemId();
                var nodeNameSel = fordname;
                var objKey = "hw" + nodeId;
                var nodeItemObj = mytree.itemObj[objKey];
                var parentId;
                if(mytree.getParentId(nodeId)) {
                    parentId = mytree.getParentId(nodeId)
                } else {
                    parentId = '0'
                }
                myMask = new Ext.LoadMask(Ext.getBody(), {
                    msg: "加载中,请稍后..."
                });
                myMask.show();
                checkFlowfordReName(parentId, nodeId, fordname, function() {
                    if(callback) {
                        callback();
                    }
                    var urlService = "http://" + (vmd.workspace.workflowIp || vmdSettings.workflowIp) + "/activiti-rest/service/repository/categorys/" + nodeId + "?info=kermit";
                    // if(vmdSettings.workflowIp) {
                    //     var info = "kermit";
                    //     urlService = "http://" + vmdSettings.workflowIp + "/activiti-rest/service/repository/categorys/" + nodeId + "?info=" + info;

                    //     // if(einfo && einfo != undefined && einfo != "undefined") {
                    //     //     urlService = "http://" + vmdSettings.workflowIp + "/activiti-rest/service/repository/categorys/" + nodeId + "?einfo=" + einfo;
                    //     // } else {
                    //     //     var info = login;
                    //     //     if(!info) {
                    //     //         info = "kermit";
                    //     //     }
                    //     //     urlService = "http://" + vmdSettings.workflowIp + "/activiti-rest/service/repository/categorys/" + nodeId + "?info=" + info;
                    //     // }
                    // }
                    if(nodeItemObj) {
                        // 模板节点
                        hwDas.ajax({
                            // das: {
                            //     idedas: true
                            // },
                            url: urlService,
                            type: 'put',
                            timeout: 50000,
                            contentType: 'application/json;charset=UTF-8',
                            data: { // body传参
                                'name': nodeNameSel
                            },
                            success: function(result) {
                                // 获取数据后解析形成树形节点；
                                mytree.setItemText(result.id, result.name, result.name);
                                myMask.hide();
                            },
                            error: function(msg) {
                                myMask.hide();
                                Ext.Msg.alert("提示", "编辑分类失败！")
                            }
                        })
                    }
                })
            }
            var winForm = new Ext.winWorkFlowCategory(callbackFunc, nodeNameSelTmp);
            winForm.show();
        }
    }
}

// 删除
function deleteWorkFlowFun() {
    Ext.Msg.confirm("提示!", "确定要删除?", function(btn) {
        if(btn == "yes") {
            var mytree = hwTreeWorkFlow;
            var selId = mytree.getSelectedItemId();
            var objKey = "hw" + selId;
            var nodeItemObj = mytree.itemObj[objKey];

            if(!nodeItemObj) {
                return;
            }

            var urlService = "http://" + (vmd.workspace.workflowIp || vmdSettings.workflowIp) + "/activiti-rest/service/repository/categorys/" + selId + "?info=kermit";
            // if(vmdSettings.workflowIp) {
            //     var info = "kermit";
            //     urlService = "http://" + vmdSettings.workflowIp + "/activiti-rest/service/repository/categorys/" + selId + "?info=" + info;

            //     // if(einfo && einfo != undefined && einfo != "undefined") {
            //     //     urlService = "http://" + vmdSettings.workflowIp + "/activiti-rest/service/repository/categorys/" + selId + "?einfo=" + einfo;
            //     // } else {
            //     //     var info = login;
            //     //     if(!info) {
            //     //         info = "kermit";
            //     //     }
            //     //     urlService = "http://" + vmdSettings.workflowIp + "/activiti-rest/service/repository/categorys/" + selId + "?info=" + info;
            //     // }
            // }
            // 分类节点
            if(!nodeItemObj.isTemplate) {

                var myMask = new Ext.LoadMask(Ext.getBody(), {
                    msg: "正在执行删除操作...",
                    msgCls: 'z-index:10000;'
                });
                myMask.show();

                hwDas.ajax({
                    // das: {
                    //     idedas: true
                    // },
                    url: urlService,
                    type: 'delete',
                    timeout: 50000,
                    data: null,
                    dataType: 'text', // 返回的数据的格式
                    contentType: 'application/json',
                    success: function(result) {
                        delWorkflowProject(id);
                        mytree.deleteChildItems(selId);
                        mytree.deleteItem(selId);
                        if(mytree.hasChildren(0)) {
                            mytree.show();
                        } else {
                            mytree.hide();
                        }

                        myMask.hide();
                    },
                    error: function(msg) {
                        myMask.hide();
                        Ext.Msg.alert("提示", "删除分类失败！");
                    }
                })
            } else // 模板节点
            {
                var urlService = "http://" + (vmd.workspace.workflowIp || vmdSettings.workflowIp) + "/activiti-rest/service/repository/models/" + selId + "?info=kermit";
                // if(vmdSettings.workflowIp) {
                //     var info = "kermit";
                //     urlService = "http://" + vmdSettings.workflowIp + "/activiti-rest/service/repository/models/" + selId + "?info=" + info;

                //     // if(einfo && einfo != undefined && einfo != "undefined") {
                //     //     urlService = "http://" + vmdSettings.workflowIp + "/activiti-rest/service/repository/models/" + selId + "?einfo=" + einfo;
                //     // } else {
                //     //     var info = logini;
                //     //     if(!info) {
                //     //         info = "kermit";
                //     //     }
                //     //     urlService = "http://" + vmdSettings.workflowIp + "/activiti-rest/service/repository/models/" + selId + "?info=" + info;
                //     // }
                // }

                var myMask = new Ext.LoadMask(Ext.getBody(), {
                    msg: "正在执行删除操作...",
                    msgCls: 'z-index:10000;'
                });
                myMask.show();
                hwDas.ajax({
                    // das: {
                    //     idedas: true
                    // },
                    url: urlService,
                    type: 'delete',
                    timeout: 50000,
                    data: null,
                    dataType: 'text', // 返回的数据的格式
                    // contentType: "", // 传入数据的内容格式
                    success: function(result) {
                        mytree.deleteItem(selId);
                        // Ext.Msg.alert("提示", "删除模板成功！")
                        myMask.hide();
                    },
                    error: function(msg) {
                        myMask.hide();
                        Ext.Msg.alert("提示", "删除模板失败！")
                    }
                })
            }
        } else {

        }
    });
}

// 同步删除工作流与项目的关联关系
function delWorkflowProject(id) {

    hwDas.del(
        "DataServiceWorkSpace/projectInfo/ProjcetServiceCategory", {}, {
            'projectid': btnProjectName.projectId,
            'servicecategoryid': id,
            'type': 0
        },
        function(result) {
            // Tips.tips("删除成功！", "success");
        },
        function(msg) {
            // Tips.tips("删除失败！", "error");
        }
    );
}

// 查看
function viewWorkFlowFun() {

    var mytree = hwTreeWorkFlow;
    var nodeId = mytree.getSelectedItemId();
    var objKey = "hw" + nodeId;
    var nodeItemObj = mytree.itemObj[objKey];
    if(nodeItemObj) {
        // 模板节点
        if(nodeItemObj.isTemplate) {
            divJcxx.show();
            ModuleInfo.hide();
            WorkflowModuleInfo.hide();
            DataServiceModuleInfo.hide();
            if(maskProgress) {
                // maskProgress.show();
            }
            // if(progressBar) {
            //     // progressBar.show();
            // }
            // 调用设计器HTML页面
            document.getElementById("iframe_page").src = vmd.virtualPath + vmdSettings.systemPath+'/hw4acf2f8b/hw8ad68408.html?modelId=' + nodeId;
        } else // 分类节点
        {
            return;
        }
    }
}

// 发布
function publishWorkFlowFun() {

    var mytree = hwTreeWorkFlow;
    var selId = mytree.getSelectedItemId();
    var nodeNameSel = mytree.getSelectedItemText();

    var info = "kermit";
    var urlService = "http://" + (vmd.workspace.workflowIp || vmdSettings.workflowIp) + "/activiti-rest/service/repository/deployments/deployModel?info=" + info;
    // var urlService = "http://" + vmdSettings.workflowIp + "/activiti-rest/service/repository/deployments/deployModel?info=kermit";
    // if(vmdSettings.workflowIp) {
    //     var info = "kermit";
    //     urlService = "http://" + vmdSettings.workflowIp + "/activiti-rest/service/repository/deployments/deployModel?info=" + info;

    //     // if(einfo && einfo != undefined && einfo != "undefined") {
    //     //     urlService = "http://" + vmdSettings.workflowIp + "/activiti-rest/service/repository/deployments/deployModel?einfo=" + einfo;
    //     // } else {
    //     //     var info = login;
    //     //     if(!info) {
    //     //         info = "kermit";
    //     //     }
    //     //     urlService = "http://" + vmdSettings.workflowIp + "/activiti-rest/service/repository/deployments/deployModel?info=" + info;
    //     // }
    // }

    var myMask = new Ext.LoadMask(Ext.getBody(), {
        msg: "数据加载中,请稍后...",
        msgCls: 'z-index:10000;'
    });
    myMask.show();

    hwDas.ajax({
        // das: {
        //     idedas: true
        // },
        url: urlService,
        type: 'post',
        timeout: 50000,
        contentType: 'application/json;charset=UTF-8',
        data: { // body传参
            'id': selId,
            'name': nodeNameSel
        },
        success: function(result) {

            mytree.setItemColor(selId, "#000000", "#000000");
            myMask.hide();
        },
        error: function(msg) {
            myMask.hide();
            Ext.Msg.alert("提示", "模板发布失败！");
        }
    })
}

//分类名称录入框
Ext.winWorkFlowCategory = Ext.extend(Ext.Window, {
    xtype: "window",
    title: "分类",
    width: 300,
    height: 150,
    layout: "form",
    bodyStyle: 'padding:15px',
    labelAlign: "left",
    labelWidth: 40,
    modal: true,
    constructor: function(callback, valueText) {
        this.callback = callback;
        this.valueText = valueText;
        this.callParent();
    },
    initComponent: function() {
        var me = this;
        this.fbar = [{
            text: "确定",
            handler: function() {
                me.callback(Ext.getCmp('filename').getValue(), function() {
                    me.close();
                });
            }
        }, {
            text: "取消",
            handler: function() {
                me.close();
            }
        }];

        this.items = [{
            id: 'filename',
            xtype: "textfield",
            fieldLabel: "名称",
            anchor: "100%",
            value: this.valueText
        }]

        Ext.winWorkFlowCategory.superclass.initComponent.call(this);
    }
})

//模板名称录入框
Ext.winWorkFlowTemplate = Ext.extend(Ext.Window, {
    xtype: "window",
    title: "模板名称",
    width: 300,
    height: 150,
    layout: "form",
    bodyStyle: 'padding:15px',
    labelAlign: "left",
    labelWidth: 40,
    modal: true,
    constructor: function(callback) {
        this.callback = callback;
        this.callParent();
    },
    initComponent: function() {
        var me = this;
        this.fbar = [{
            text: "确定",
            handler: function() {
                var keyValue = randomWord(true, 3, 10);
                me.callback(Ext.getCmp('filename').getValue(), keyValue, function() {
                    me.close();
                });
            }
        }, {
            text: "取消",
            handler: function() {
                me.close();
            }
        }];

        this.items = [{
            id: 'filename',
            xtype: "textfield",
            fieldLabel: "名称",
            anchor: "100%"
        }]
        Ext.winWorkFlowTemplate.superclass.initComponent.call(this);
    }
})
/*
 ** randomWord 产生任意长度随机字母数字组合
 ** randomFlag-是否任意长度 min-任意长度最小位[固定位数] max-任意长度最大位
 ** xuanfeng 2014-08-28
 */
function randomWord(randomFlag, min, max) {
    var str = "",
        range = min,
        arr = ['a', 'b', 'c', 'd', 'e', 'f', 'g', 'h', 'i', 'j', 'k', 'l', 'm', 'n', 'o', 'p', 'q', 'r', 's', 't', 'u', 'v', 'w', 'x', 'y', 'z', 'A', 'B', 'C', 'D', 'E', 'F', 'G', 'H', 'I', 'J', 'K', 'L', 'M', 'N', 'O', 'P', 'Q', 'R', 'S', 'T', 'U', 'V', 'W', 'X', 'Y', 'Z'];
    // arr = ['0', '1', '2', '3', '4', '5', '6', '7', '8', '9', 'a', 'b', 'c', 'd', 'e', 'f', 'g', 'h', 'i', 'j', 'k', 'l', 'm', 'n', 'o', 'p', 'q', 'r', 's', 't', 'u', 'v', 'w', 'x', 'y', 'z', 'A', 'B', 'C', 'D', 'E', 'F', 'G', 'H', 'I', 'J', 'K', 'L', 'M', 'N', 'O', 'P', 'Q', 'R', 'S', 'T', 'U', 'V', 'W', 'X', 'Y', 'Z'];

    // 随机产生
    if(randomFlag) {
        range = Math.round(Math.random() * (max - min)) + min;
    }
    for(var i = 0; i < range; i++) {
        pos = Math.round(Math.random() * (arr.length - 1));
        str += arr[pos];
    }
    return str;
}
// 点击工作流树形节点
function hwTreeWorkFlow_nodeClick(sender, id) {
    divJcxx.show();
    ModuleInfo.hide();
    WorkflowModuleInfo.hide();
    DataServiceModuleInfo.hide();

    var nodeId = id;
    var mytree = hwTreeWorkFlow;
    var objKey = "hw" + nodeId;
    var selnode = mytree.itemObj[objKey];

    var eleIFrame = document.getElementById("iframe_page");
    if(eleIFrame) {
        if(selnode.isTemplate) {

            divJcxx.hide();
            WorkflowModuleInfo.show();
            WorkflowModuleInfo.refresh(mytree, btnProjectName.projectId, btnWorkSpaceName.workspaceId);

            // eleIFrame.src = vmd.virtualPath + vmdSettings.systemPath+'/hw4acf2f8b/hw28e7092c.html';
        } else {
            eleIFrame.src = vmd.virtualPath + vmdSettings.systemPath+'/eQ9ULgcVb5/hw03cb4931.html';
        }
    }
}

// 获取子节点中的分类节点
function getChildCategoryNodes(nodeParentId, maskLoading) {

    var nodeId = nodeParentId;
    var mytree = hwTreeWorkFlow;
    var objKeyTmp = "hw" + nodeId;
    var selnode = mytree.itemObj[objKeyTmp];
    if(!selnode) {
        return;
    }
    var info = "kermit";
    urlService = "http://" + (vmd.workspace.workflowIp || vmdSettings.workflowIp) + "/activiti-rest/service/repository/categorys/" + nodeParentId + "/members?info=" + info;

    // var urlService = "http://" + (vmd.workspace.workflowIp || vmdSettings.workflowIp) + "/activiti-rest/service/repository/categorys/" + nodeParentId + "/members?info=kermit";
    // if(vmdSettings.workflowIp) {
    //     var info = "kermit";
    //     urlService = "http://" + (vmd.workspace.workflowIp || vmdSettings.workflowIp) + "/activiti-rest/service/repository/categorys/" + nodeParentId + "/members?info=" + info;

    //     // if(einfo && einfo != undefined && einfo != "undefined") {
    //     //     urlService = "http://" + vmdSettings.workflowIp + "/activiti-rest/service/repository/categorys/" + nodeParentId + "/members?einfo=" + einfo;
    //     // } else {
    //     //     var info = login;
    //     //     if(!info) {
    //     //         info = "kermit";
    //     //     }
    //     //     urlService = "http://" + vmdSettings.workflowIp + "/activiti-rest/service/repository/categorys/" + nodeParentId + "/members?info=" + info;
    //     // }
    // }
    // 获取根节点下的文件夹节点信息
    hwDas.ajax({
        url: urlService,
        type: 'get',
        timeout: 10000,
        params: {},
        success: function(result) {

            // 获取分类节点数据后解析形成树形节点；
            for(var i = 0; i < result.data.length; i++) {

                mytree.insertNewChild(nodeId, result.data[i].id, result.data[i].name);
                mytree.setItemColor(result.data[i].id, '#000000', '#000000');
                mytree.setItemImage2(result.data[i].id, "tree/folderClosed.gif", "tree/folderOpen.gif", "tree/folderClosed.gif");
                mytree.insertNewChild(result.data[i].id, result.data[i].id + "-0000", "");
                mytree.closeItem(result.data[i].id);
                var treenode = mytree.item(result.data[i].id);
                if(treenode) {
                    treenode.isTemplate = false; // 标识是否是目标文件
                    // treenode.childLoaded = false; // 标识是否加载了子节点
                    treenode.isDeployment = false; // 标识是否发布
                    treenode.url = result.data[i].url;
                    // 标识当前分类节点下的分类节点是否加载完成
                    treenode.childCategoryLoaded = false;
                    // 标识当前分类节点下的模板节点是否加载完成
                    treenode.childModelLoaded = false;
                }
                var objKey = "hw" + result.data[i].id;
                mytree.itemObj[objKey] = treenode;
            }

            selnode.childCategoryLoaded = true;
            // selnode.childLoaded = true;
            if(selnode.childCategoryLoaded && selnode.childModelLoaded) {
                if(maskLoading) {
                    maskLoading.hide();
                }
            }
        },
        error: function(msg) {
            selnode.childCategoryLoaded = true;
            if(selnode.childCategoryLoaded && selnode.childModelLoaded) {
                if(maskLoading) {
                    maskLoading.hide();
                }
            }
            Ext.Msg.alert("提示", "获取分类节点信息失败", function() {})
        }
    })
}

// 获取子节点中的模板节点
function getChildTemplateNodes(nodeParentId, maskLoading) {

    var nodeId = nodeParentId;
    var mytree = hwTreeWorkFlow;
    var objKeyTmp = "hw" + nodeId;
    var selnode = mytree.itemObj[objKeyTmp];
    if(!selnode) {
        return;
    }
    var info = "kermit";
    urlService = "http://" + (vmd.workspace.workflowIp || vmdSettings.workflowIp) + "/activiti-rest/service/repository/hwmodels?categoryId=" + nodeParentId + "&info=" + info;

    // 获取根节点下的文件夹节点信息
    hwDas.ajax({
        // das: {
        //     idedas: true
        // },

        url: urlService,
        type: 'get',
        timeout: 10000,
        params: {},
        success: function(result) {

            // 获取分类节点数据后解析形成树形节点；
            for(var j = 0; j < result.data.length; j++) {

                for(var i = 0; i < result.data[j].datas.length; i++) {

                    mytree.insertNewChild(nodeId, result.data[j].datas[i].ID, result.data[j].datas[i].NAME);
                    if(result.data[j].datas[i].ISDEPLOYMENT) {
                        mytree.setItemColor(result.data[j].datas[i].ID, '#000000', '#000000');
                    } else {
                        mytree.setItemColor(result.data[j].datas[i].ID, '#808080', '#808080');
                    }
                    mytree.setItemImage2(result.data[j].datas[i].ID, "tree/model.png", "tree/model.png", "tree/model.png");
                    mytree.closeItem(result.data[j].datas[i].ID);
                    var treenode = mytree.item(result.data[j].datas[i].ID);
                    if(treenode) {
                        treenode.isTemplate = true; // 标识是否是目标文件
                        // treenode.childLoaded = true; // 标识是否加载了子节点
                        treenode.isDeployment = result.data[j].datas[i].ISDEPLOYMENT; // 标识是否发布
                        treenode.url = result.data[j].datas[i].URL;
                        // 标识当前分类节点下的分类节点是否加载完成
                        treenode.childCategoryLoaded = false;
                        // 标识当前分类节点下的模板节点是否加载完成
                        treenode.childModelLoaded = false;

                        // treenode.path = "/" + result.data[j].datas[i].ID;
                        // treenode.isModel = true;
                        // treenode.createuser = datajson[i].row_created_by;
                        var dateCreate = new Date(result.data[j].datas[i].CREATETIME);
                        var dateUpdate = new Date(result.data[j].datas[i].LASTUPDATETIME);

                        treenode.createtime = Ext.Date.dateFormat(dateCreate, 'Y-m-d H:i:s');
                        treenode.changetime = Ext.Date.dateFormat(dateUpdate, 'Y-m-d H:i:s');
                        // console.log(JSON.parse(result.data[j].datas[i].METAINFO).reviser)
                        treenode.changeuser = JSON.parse(result.data[j].datas[i].METAINFO).reviser;
                        // treenode.remark = datajson[i].remark;
                        treenode.code = result.data[j].datas[i].ID;
                    }
                    var objKey = "hw" + result.data[j].datas[i].ID;
                    mytree.itemObj[objKey] = treenode;
                }
            }
            selnode.childModelLoaded = true;
            // selnode.childLoaded = true;
            if(selnode.childCategoryLoaded && selnode.childModelLoaded) {
                if(maskLoading) {
                    maskLoading.hide();
                }
            }
        },
        error: function(msg) {
            selnode.childModelLoaded = true;
            if(selnode.childCategoryLoaded && selnode.childModelLoaded) {
                if(maskLoading) {
                    maskLoading.hide();
                }
            }
            Ext.Msg.alert("提示", "获取分类节点信息失败", function() {})
        }
    })
}

function hwTreeWorkFlow_onOpenEnd(sender, id, state) {
    var nodeId = id;
    var mytree = hwTreeWorkFlow;
    var objKey = "hw" + nodeId;
    var selnode = mytree.itemObj[objKey];
    if(!selnode) {
        return;
    }
    if(selnode.childCategoryLoaded || selnode.childModelLoaded) {
        return;
    }
    var maskLoading = new Ext.LoadMask(Ext.getCmp("hwTreeWorkFlow").el, {
        msg: "数据加载中,请稍后...",
        msgCls: 'z-index:10000;'
    });
    maskLoading.show();
    // 如果是文件夹节点
    if(!selnode.isTemplate) {
        var nodeNullId = nodeId + "-0000";
        var nIndex = mytree.getIndexById(nodeNullId);
        if(null != nIndex) {
            if(nIndex > -1) {
                mytree.deleteItem(nodeNullId);
            }
        }

        // 获取文件夹下的分类节点和模板节点
        // 分类节点
        getChildCategoryNodes(nodeId, maskLoading);
        // 模板节点
        getChildTemplateNodes(nodeId, maskLoading);
    }

    // myMask.hide();
}



//20171122 chengbing  主页面窗口
function openWin(obj, html, parname, par) {
    window[parname] = par;
    var openWinFrom = new Ext.Window(obj || {
        title: "节点绑定表单",
        modal: true,
        maximized: false,
        height: 600,
        width: 800,
        maximizable: true,
        resizable: true,
        bodyStyle: "background-color:#fff",
        closeAction: 'close'

    })
    Ext.defer(function() {
        openWinFrom.html = html; //"<iframe src='"+vmd.core.getVirtualPath()+vmdSettings.systemPath+"/hw4acf2f8b/hw3b434d49.html?r=" + new Date().getTime() + "' frameborder=0 scrolling=no style='height:100%;width:100%'></iframe>";
        openWinFrom.show()
    }, 50)

    window["openWinFrom"] = openWinFrom;
    return openWinFrom;
}
window["openWin"] = openWin;

//20171125 sgw  工作流页面保存后调用的方法，用于更新工作流节点的是否发布的状态
function designTemplate(id) {

    var mytree = hwTreeWorkFlow;
    var nodeId = id;
    if(nodeId == "" || !nodeId) {
        return;
    }
    // 显示默认页面
    divJcxx.show();
    ModuleInfo.hide();
    WorkflowModuleInfo.hide();
    DataServiceModuleInfo.hide();
    // 调用设计器HTML页面
    var eleIFrame = document.getElementById("iframe_page");
    if(eleIFrame) {
        // eleIFrame.src = '/activiti/modeler.html?mode=design&modelId=' + nodeId + '&info=kermit';

        var infoLogin = '&info=kermit';
        //var info = Ext.util.Cookies.get('login');
        // if(einfo && einfo != undefined && einfo != "undefined") {
        //     infoLogin = '&einfo=' + einfo;
        // } else if(info && info != undefined && info != "undefined") {
        //     infoLogin = '&info=' + info;
        // }
        var pageSrc = '/activiti/modeler.html?mode=design&modelId=' + nodeId + infoLogin;
        eleIFrame.src = pageSrc;
    }

}

// 2017.11.25 sgw: 声明全局函数
window["designTemplate"] = designTemplate;

//20171128 sgw  工作流页面基本信息的保存
function saveModelInfo(name, description) {
    var mytree = hwTreeWorkFlow;
    var selId = mytree.getSelectedItemId();
    if(selId == "" || !selId) {
        return;
    }
    var objKey = "hw" + selId;
    var selnode = mytree.itemObj[objKey];
    if(!selnode) {
        return;
    }
    if(!selnode.isTemplate) {
        return;
    }
    selnode.text = name;
    var userName = Ext.util.Cookies.get('userName');
    var pid = mytree.getParentId(selId)
    CheckFlowMoudlRename(pid, selId, name, function() {
        // var urlService = "http://" + (vmd.workspace.workflowIp || vmdSettings.workflowIp) + "/activiti-rest/service/repository/models/" + selId + "?info=kermit";
        // if(vmdSettings.workflowIp) {
        //     var info = "kermit";
        //     urlService = "http://" + vmdSettings.workflowIp + "/activiti-rest/service/repository/models/" + selId + "?info=" + info;

        //     // if(einfo && einfo != undefined && einfo != "undefined") {
        //     //     urlService = "http://" + vmdSettings.workflowIp + "/activiti-rest/service/repository/models/" + selId + "?einfo=" + einfo;
        //     // } else {
        //     //     var info = login;
        //     //     if(!info || info == undefined || info == "undefined") {
        //     //         info = "kermit";
        //     //     }
        //     //     urlService = "http://" + vmdSettings.workflowIp + "/activiti-rest/service/repository/models/" + selId + "?info=" + info;
        //     // }
        // }

        // var urlService = "activiti-rest/service/repository/models/" + selId + "?info=kermit";

        // var urlparam = {
        //     host: (vmd.workspace.workflowIp || vmdSettings.workflowIp),
        //     url: urlService
        // }

        // // 更改活动工区状态
        // hwDas.edit(
        //     urlparam, {}, {}, [{ // body传参
        //         'name': name,
        //         'metaInfo': "{\"name\":\"" + name + "\",\"description\":\"" + description + "\",\"reviser\":\"" + userName + "\"}"
        //     }],
        //     function(result) {
        //         // 获取数据后解析形成树形节点；
        //         mytree.setItemText(selId, name, name);
        //         Ext.Msg.alert("提示", "保存成功！");
        //     },
        //     function(msg) {
        //         Ext.Msg.alert("提示", "保存模板基本信息失败！")
        //     }
        // );

        var urlService = "http://" + (vmd.workspace.workflowIp || vmdSettings.workflowIp) + "/activiti-rest/service/repository/models/" + selId + "?info=kermit";

        // var tmp = "{\"name\":\"" + name + "\",\"description\":\"" + description + "\",\"reviser\":\"" + userName + "\"}";
        hwDas.ajax({
            // das: {
            //     idedas: true
            // },
            url: urlService,
            type: 'put',
            timeout: 50000,
            contentType: 'application/json;charset=UTF-8',
            data: { // body传参
                'name': name,
                'metaInfo': "{\"name\":\"" + name + "\",\"description\":\"" + description + "\",\"reviser\":\"" + userName + "\"}"
                // 'metaInfo': {'name':name,'description':description,'reviser':userName}
            },
            success: function(result) {
                // 获取数据后解析形成树形节点；
                mytree.setItemText(selId, name, name);
                WorkflowModuleInfo.hwText4.setValue(Ext.util.Cookies.get('userName'));
                WorkflowModuleInfo.hwText5.setValue(Ext.Date.dateFormat(new Date(), 'Y-m-d H:i:s'))
                Ext.Msg.alert("提示", "保存成功！")
            },
            error: function(msg) {
                Ext.Msg.alert("提示", "保存模板基本信息失败！")
            }
        })
    })
}

// 2017.11.25 sgw: 声明全局函数
window["saveModelInfo"] = saveModelInfo;

//20171125 sgw  工作流页面保存后调用的方法，用于更新工作流节点的是否发布的状态
function modelDeployment(id) {

    var mytree = hwTreeWorkFlow;
    var selId = id;
    if(selId == "" || !selId) {
        return;
    }

    var nodeNameSel = mytree.getItemText(selId);

    var urlService = "http://" + (vmd.workspace.workflowIp || vmdSettings.workflowIp) + "/activiti-rest/service/repository/deployments/deployModel?info=kermit";
    // if(vmdSettings.workflowIp) {
    //     var info = "kermit";
    //     urlService = "http://" + vmdSettings.workflowIp + "/activiti-rest/service/repository/deployments/deployModel?info=" + info;

    //     // if(einfo && einfo != undefined && einfo != "undefined") {
    //     //     urlService = "http://" + vmdSettings.workflowIp + "/activiti-rest/service/repository/deployments/deployModel?einfo=" + einfo;
    //     // } else {
    //     //     var info = login;
    //     //     if(!info || info == undefined || info == "undefined") {
    //     //         info = "kermit";
    //     //     }
    //     //     urlService = "http://" + vmdSettings.workflowIp + "/activiti-rest/service/repository/deployments/deployModel?info=" + info;
    //     // }
    // }
    hwDas.ajax({
        // das: {
        //     idedas: true
        // },
        url: urlService,
        type: 'post',
        timeout: 50000,
        contentType: 'application/json;charset=UTF-8',
        data: { // body传参
            'id': selId,
            'name': nodeNameSel
        },
        success: function(result) {
            selnode.isDeployment = false;

            var nodeId = mytree.getSelectedItemId();
            var objKey = "hw" + nodeId;
            var selnode = mytree.itemObj[objKey];
            if(selnode) {
                // 如果是文件夹节点
                if(selnode.isTemplate) {
                    selnode.isDeployment = true;
                    mytree.setItemColor(selId, "#000000", "#000000");
                }
            }



        },
        error: function(msg) {
            Ext.Msg.alert("提示", "模板发布失败！");
        }
    })

}

// 2017.11.25 sgw: 声明全局函数
window["modelDeployment"] = modelDeployment;

//20171125 sgw  工作流页面保存后调用的方法，用于更新工作流节点的是否发布的状态
function updateDeploymentState() {

    var mytree = hwTreeWorkFlow;
    var nodeId = mytree.getSelectedItemId();
    var objKey = "hw" + nodeId;
    var selnode = mytree.itemObj[objKey];
    if(!selnode) {
        return;
    }
    // 如果是文件夹节点
    if(selnode.isTemplate) {
        selnode.isDeployment = false;
        mytree.setItemColor(nodeId, '#808080', '#808080');
    }
}

// 2017.11.25 sgw: 声明全局函数
window["updateDeploymentState"] = updateDeploymentState;

// 数据服务是否加载过
var ifDataServiceLoaded = false;

function hwTreeDataService_afterrender(sender) {

    ifDataServiceLoaded = true;
    // 清空树原有的默认数据
    hwTreeDataService.deleteChildItems(0);
    getDataServiceCategory();

    // 没配置数据服务时的提示信息
    panel2.add({
        id: 'infoDataService_div',
        tag: 'div',
        html: '请配置数据服务',
        style: 'font-size:14px;font-family:Microsoft YaHei;color:#666666;margin:10px;'
    });
}

// 重新加载数据服务分类，用于项目配置完成后保存
function reloadDataServiceCategory() {
    if(ifDataServiceLoaded) {
        // 清空树原有的默认数据
        hwTreeDataService.deleteChildItems(0);
        getDataServiceCategory();
    }
}

function getDataServiceCategory() {
    if(!ifDataServiceLoaded) {
        return;
    }
    // 进度条
    var myMask = new Ext.LoadMask(Ext.getCmp("hwTreeDataService").el, {
        msg: "数据加载中,请稍后...",
        modal: true,
        msgCls: 'z-index:10000;'
    });
    myMask.show();

    var mytree = hwTreeDataService;
    var firstNode = "";
    mytree.deleteChildItems(0);
    mytree.loadJSONObject({
        id: 0,
        text: "数据服务",
        item: []
    });
    mytree.itemObj = {};
    mytree.newnode = false;

    // 获取项目中配置的数据服务
    hwDas.get(
        "DataServiceWorkSpace/projectInfo/ProjcetServiceCategory", {}, {
            "projectid": btnProjectName.projectId,
            "type": 1
        },
        function(resultChecked) {
            // 根据获取的数据赋值基本信息Tab页
            if(null === resultChecked && undefined === resultChecked) {
                showDataServiceHintInfo();
                return;
            }

            if(null != resultChecked.data && undefined != resultChecked.data) {
                if(resultChecked.data.length > 0) {
                    if(null != resultChecked.data[0].datas && undefined != resultChecked.data[0].datas) {
                        if(resultChecked.data[0].datas.length > 0) {

                            var urlparam = {
                                host: vmd.workspace.dataServiceIp || vmdSettings.dataServiceIp,
                                url: "DataService/Service/Project"
                            }
                            hwDas.get(urlparam, {}, {
                                    develop: "true"
                                }, function(result) {

                                    var bFlag = false;
                                    ////////////////////////////////////////////////
                                    for(var k = 0; k < resultChecked.data[0].datas.length; k++) {

                                        // 获取分类节点数据后解析形成树形节点；
                                        for(var j = 0; j < result.data.length; j++) {

                                            for(var i = 0; i < result.data[j].datas.length; i++) {
                                                if(result.data[j].datas[i].id ==
                                                    resultChecked.data[0].datas[k].service_category_id) {

                                                    bFlag = true;
                                                    mytree.insertNewChild(0, result.data[j].datas[i].id, result.data[j].datas[i].name);
                                                    mytree.setItemImage2(result.data[j].datas[i].id, "tree/model.png", "tree/model.png", "tree/model.png");
                                                    mytree.closeItem(result.data[j].datas[i].id);
                                                    var treenode = mytree.item(result.data[j].datas[i].id);
                                                    if(treenode) {
                                                        treenode.builtin = result.data[j].datas[i].builtin;
                                                        treenode.code = result.data[j].datas[i].code;
                                                        treenode.remark = result.data[j].datas[i].remark;
                                                    }
                                                    var objKey = "hw" + result.data[j].datas[i].id;
                                                    mytree.itemObj[objKey] = treenode;
                                                }

                                            }
                                        }
                                    }
                                    if(bFlag) {
                                        hwTreeDataService.show();
                                    } else {

                                        hwTreeDataService.hide();
                                    }
                                    // 隐藏进度条
                                    myMask.hide();
                                },
                                function(msg) {
                                    showDataServiceHintInfo();
                                    // 隐藏进度条
                                    myMask.hide();
                                })


                            //绑定右键菜单
                            var menu = new dhtmlXMenuObject();
                            menu.renderAsContextMenu();
                            menu.attachEvent("onClick", onMenuDataServiceClick);
                            // menu.attachEvent("onClick", onMenuWorkFlowClick);
                            // menu.addNewChild(menu.topId, 0, "newDataService", "添加", false);
                            // menu.addNewChild(menu.topId, 1, "editDataService", "编辑", false);
                            // menu.addNewChild(menu.topId, 2, "deleteDataService", "删除", false);
                            menu.addNewChild(menu.topId, 3, "viewDataService", "查看", false);
                            mytree.enableDragAndDrop("temporary_disabled");
                            mytree.enableContextMenu(menu);


                            // 右键菜单的显示隐藏
                            mytree.attachEvent("onBeforeContextMenu", function(itemId) {

                                // menu.showItem('newDataService');
                                // menu.showItem('editDataService');
                                // menu.showItem('deleteDataService');
                                menu.showItem('viewDataService');
                                return true;
                            })

                            //绑定右键事件 设置右键选中节点
                            mytree.attachEvent('onRightClick', function(id) {
                                mytree.selectItem(id);
                            })
                        } else {
                            showDataServiceHintInfo();
                            // 隐藏进度条
                            myMask.hide();
                        }

                    } else {
                        showDataServiceHintInfo();
                        // 隐藏进度条
                        myMask.hide();
                    }
                } else {
                    showDataServiceHintInfo();
                    // 隐藏进度条
                    myMask.hide();
                }
            } else {
                showDataServiceHintInfo();
                // 隐藏进度条
                myMask.hide();
            }
        },
        function(msg) {
            showDataServiceHintInfo();
            // 隐藏进度条
            myMask.hide();
        });
}

function showDataServiceHintInfo() {
    hwTreeDataService.hide();
    // panel2.add({
    //     id: 'infoDataService_div',
    //     tag: 'div',
    //     html: '请配置数据服务',
    //     style: 'font-size:14px;font-family:Microsoft YaHei;color:#666666;margin:10px;'
    // });
}
// function hwTreeDataService_afterrender(sender) {

//     // 进度条
//     var myMask = new Ext.LoadMask(Ext.getCmp("hwTreeDataService").el, {
//         msg: "数据加载中,请稍后...",
//         modal: true,
//         msgCls: 'z-index:10000;'
//     });
//     myMask.show();

//     var mytree = hwTreeDataService;
//     var firstNode = "";
//     mytree.deleteChildItems(0);
//     mytree.loadJSONObject({
//         id: 0,
//         text: "数据服务",
//         item: []
//     });
//     mytree.itemObj = {};
//     mytree.newnode = false;

//     // 获取根节点下的文件夹节点信息

//     hwDas.ajax({
//         das: {
//             idedas: true
//         },
//         url: "DataService/Service/Project",
//         type: 'get',
//         timeout: 50000,
//         params: {
//             develop: "true"
//         },
//         success: function(result) {

//             // 获取分类节点数据后解析形成树形节点；
//             for(var j = 0; j < result.data.length; j++) {

//                 for(var i = 0; i < result.data[j].datas.length; i++) {

//                     mytree.insertNewChild(0, result.data[j].datas[i].id, result.data[j].datas[i].name);
//                     mytree.setItemImage2(result.data[j].datas[i].id, "tree/model.png", "tree/model.png", "tree/model.png");
//                     mytree.closeItem(result.data[j].datas[i].id);
//                     var treenode = mytree.item(result.data[j].datas[i].id);
//                     if(treenode) {
//                         treenode.builtin = result.data[j].datas[i].builtin;
//                         treenode.code = result.data[j].datas[i].code;
//                         treenode.remark = result.data[j].datas[i].remark;
//                     }
//                     var objKey = "hw" + result.data[j].datas[i].id;
//                     mytree.itemObj[objKey] = treenode;
//                 }
//             }
//             // 隐藏进度条
//             myMask.hide();
//         },
//         error: function(msg) {
//             Ext.Msg.alert("提示", "数据服务信息获取失败！", function() {})
//         }
//     })


//     //绑定右键菜单
//     var menu = new dhtmlXMenuObject();
//     menu.renderAsContextMenu();
//     menu.attachEvent("onClick", onMenuDataServiceClick);
//     // menu.attachEvent("onClick", onMenuWorkFlowClick);
//     menu.addNewChild(menu.topId, 0, "newDataService", "添加", false);
//     menu.addNewChild(menu.topId, 1, "editDataService", "编辑", false);
//     menu.addNewChild(menu.topId, 2, "deleteDataService", "删除", false);
//     menu.addNewChild(menu.topId, 3, "viewDataService", "查看", false);
//     mytree.enableDragAndDrop("temporary_disabled");
//     mytree.enableContextMenu(menu);


//     // 右键菜单的显示隐藏
//     mytree.attachEvent("onBeforeContextMenu", function(itemId) {

//         menu.showItem('newDataService');
//         menu.showItem('editDataService');
//         menu.showItem('deleteDataService');
//         menu.showItem('viewDataService');
//         return true;
//     })

//     //绑定右键事件 设置右键选中节点
//     mytree.attachEvent('onRightClick', function(id) {
//         mytree.selectItem(id);
//     })
// }
//右键菜单事件
function onMenuDataServiceClick(menuitemId) {
    if(menuitemId == "newDataService") { // 添加
        newDataService();
    } else if(menuitemId == "editDataService") { // 编辑
        editDataService();
    } else if(menuitemId == "deleteDataService") { // 删除
        deleteDataService();
    } else if(menuitemId == "viewDataService") { //查看
        viewDataService();
    }
}
//数据服务的空白处右键菜单事件
function onMenuDataServicePanelClick(menuitemId) {
    // 在空白处点击鼠标时，就取消原有节点的选中
    hwTreeDataService.clearSelection();
    newDataService();
}

// 添加数据服务
// function newDataService() {

//     var addTreeNode = function(code, name, remark) {
//         var mytree = hwTreeDataService;
//         var selId = mytree.getSelectedItemId();
//         var nodeNameSel = mytree.getSelectedItemText();
//         var serviceCode = code;
//         var serviceName = name;
//         var serviceRemark = remark;

//         var urlparam = {
//             host: vmd.workspace.dataServiceIp || vmdSettings.dataServiceIp,
//             url: "DataService/Service/Project"
//         }
//         hwDas.add(
//             urlparam, {}, {}, {
//                 code: serviceCode,
//                 name: serviceName,
//                 remark: serviceRemark
//             },
//             function(result) { // 保存成功
//                 // Tips.tips("保存成功！", "success");

//                 if(result == "") {
//                     return;
//                 }
//                 if(!result.data) {
//                     return;
//                 }

//                 if(result.data.length > 0) {
//                     if(result.data[0].datas) {
//                         var serviceName = result.data[0].datas.name;
//                         var serviceId = result.data[0].datas.id;

//                         // 获取数据后解析形成树形节点；
//                         mytree.insertNewChild(0, serviceId, serviceName);
//                         mytree.setItemImage2(serviceId, "tree/model.png", "tree/model.png", "tree/model.png");
//                         mytree.closeItem(serviceId);
//                         var treenode = mytree.item(serviceId);
//                         if(treenode) {
//                             treenode.code = result.data[0].datas.code;
//                             treenode.remark = result.data[0].datas.remark;
//                             treenode.builtin = result.data[0].datas.builtin;
//                         }
//                         var objKey = "hw" + serviceId;
//                         mytree.itemObj[objKey] = treenode;
//                         mytree.selectItem(serviceId, true, false);

//                         hwTreeDataService.show();

//                         connectDataServicProject(serviceId);

//                         // 显示基本信息页面
//                         var eleIFrame = document.getElementById("iframe_page");
//                         if(eleIFrame) {
//                             eleIFrame.src = vmd.virtualPath + vmdSettings.systemPath+'/hw4acf2f8b/hwcb376d18.html';
//                         }
//                     }
//                 }
//             },
//             function(msg) {
//                 Ext.Msg.alert("提示", "添加服务失败！");
//             }
//         );


//         // hwDas.ajax({
//         //     das: {
//         //         idedas: true
//         //     },
//         //     url: "DataService/Service/Project",
//         //     type: 'post',
//         //     timeout: 50000,
//         //     data: [{ // body传参
//         //         code: serviceCode,
//         //         name: serviceName,
//         //         remark: serviceRemark
//         //     }],
//         //     success: function(result) {

//         //         if(result == "") {
//         //             return;
//         //         }
//         //         if(!result.data) {
//         //             return;
//         //         }

//         //         if(result.data.length > 0) {
//         //             if(result.data[0].datas) {
//         //                 var serviceName = result.data[0].datas.name;
//         //                 var serviceId = result.data[0].datas.id;

//         //                 // 获取数据后解析形成树形节点；
//         //                 mytree.insertNewChild(0, serviceId, serviceName);
//         //                 mytree.setItemImage2(serviceId, "tree/model.png", "tree/model.png", "tree/model.png");
//         //                 mytree.closeItem(serviceId);
//         //                 var treenode = mytree.item(serviceId);
//         //                 if(treenode) {
//         //                     treenode.code = result.data[0].datas.code;
//         //                     treenode.remark = result.data[0].datas.remark;
//         //                     treenode.builtin = result.data[0].datas.builtin;
//         //                 }
//         //                 var objKey = "hw" + serviceId;
//         //                 mytree.itemObj[objKey] = treenode;
//         //                 mytree.selectItem(serviceId, true, false);

//         //                 connectDataServicProject(serviceId);

//         //                 // 显示基本信息页面
//         //                 var eleIFrame = document.getElementById("iframe_page");
//         //                 if(eleIFrame) {
//         //                     eleIFrame.src = vmd.virtualPath + vmdSettings.systemPath+'/hw4acf2f8b/hwcb376d18.html';
//         //                 }
//         //             }
//         //         }
//         //     },
//         //     error: function(msg) {
//         //         Ext.Msg.alert("提示", "添加服务失败！")
//         //     }
//         // })
//     }
//     var winForm = new Ext.winDataService(addTreeNode, "", "", "");
//     winForm.show();
// }

// 新建数据服务分类后，同步关联与项目的关系
// function connectDataServicProject(id) {
//     var objData = {
//         'projectid': btnProjectName.projectId,
//         'servicecategoryid': id,
//         'type': 1
//     };
//     hwDas.add(
//         "DataServiceWorkSpace/projectInfo/ProjcetServiceCategory", {}, {}, objData,
//         function(result) {
//             // Tips.tips("保存成功！", "success");
//         },
//         function(msg) {
//             // Tips.tips("保存失败！", "error");
//         }
//     );
// }

// 同步删除数据服务与项目的关联关系
// function delDataServiceProject(id) {

//     hwDas.del(
//         "DataServiceWorkSpace/projectInfo/ProjcetServiceCategory", {}, {
//             'projectid': btnWorkSpaceName.workspaceId,
//             'servicecategoryid': id,
//             'type': 1
//         },
//         function(result) {
//             // Tips.tips("删除成功！", "success");
//         },
//         function(msg) {
//             // Tips.tips("删除失败！", "error");
//         }
//     );
// }

// 编辑数据服务
function editDataService() {

    var addTreeNode = function(code, name, remark) {

        var mytree = hwTreeDataService;
        var serviceIdTmp = mytree.getSelectedItemId();
        var serviceCode = code;
        var serviceName = name;
        var serviceRemark = remark;

        var urlparam = {
            host: vmd.workspace.dataServiceIp || vmdSettings.dataServiceIp,
            url: "DataService/Service/Project"
        }

        // 更改活动工区状态
        hwDas.edit(
            urlparam, {}, {}, [{
                'code': serviceCode,
                'id': serviceIdTmp,
                'name': serviceName,
                'remark': serviceRemark
            }],
            function(result) {
                if(result == "") {
                    return;
                }
                if(!result.data) {
                    return;
                }

                if(result.data.length > 0) {
                    if(result.data[0].datas) {
                        var serviceName = result.data[0].datas.name;
                        var serviceId = result.data[0].datas.id;

                        mytree.setItemText(serviceId, serviceName, serviceName);
                        var treenode = mytree.item(serviceId);
                        if(treenode) {
                            treenode.code = result.data[0].datas.code;
                            treenode.remark = result.data[0].datas.remark;
                            treenode.builtin = result.data[0].datas.builtin;
                        }
                        var objKey = "hw" + serviceId;
                        mytree.itemObj[objKey] = treenode;
                    }
                }
            },
            function(msg) {
                Ext.Msg.alert("提示", "编辑节点失败！")
            }
        );

        // // 模板节点
        // hwDas.ajax({
        //     das: {
        //         idedas: true
        //     },
        //     url: "DataService/Service/Project",
        //     // url: "http://"+vmdSettings.dataServiceIp+"/DasService/DataService/DataService/Service/Project",
        //     type: 'put',
        //     timeout: 50000,
        //     data: [{ // body传参
        //         'code': serviceCode,
        //         'id': serviceIdTmp,
        //         'name': serviceName,
        //         'remark': serviceRemark
        //     }],
        //     success: function(result) {

        //         if(result == "") {
        //             return;
        //         }
        //         if(!result.data) {
        //             return;
        //         }

        //         if(result.data.length > 0) {
        //             if(result.data[0].datas) {
        //                 var serviceName = result.data[0].datas.name;
        //                 var serviceId = result.data[0].datas.id;

        //                 mytree.setItemText(serviceId, serviceName, serviceName);
        //                 var treenode = mytree.item(serviceId);
        //                 if(treenode) {
        //                     treenode.code = result.data[0].datas.code;
        //                     treenode.remark = result.data[0].datas.remark;
        //                     treenode.builtin = result.data[0].datas.builtin;
        //                 }
        //                 var objKey = "hw" + serviceId;
        //                 mytree.itemObj[objKey] = treenode;
        //             }
        //         }
        //     },
        //     error: function(msg) {
        //         Ext.Msg.alert("提示", "编辑节点失败！")
        //     }
        // })
    }

    var mytreeTmp = hwTreeDataService;
    var nodeId = mytreeTmp.getSelectedItemId();
    var nodeNameTmp = mytreeTmp.getSelectedItemText();
    var objKey = "hw" + nodeId;
    var nodeItemObj = mytreeTmp.itemObj[objKey];

    var winForm = new Ext.winDataService(addTreeNode, nodeItemObj.code, nodeNameTmp, nodeItemObj.remark);
    winForm.show();
}
// 删除数据服务
// function deleteDataService() {
//     var disabledIds=['104FPWq2wr','eQX5RdNjsW','TuKge8jDwF','Tv3hLjddZS'];
//     Ext.Msg.confirm("提示!", "确定要删除?", function(btn) {
//         if(btn == "yes") {

//             var mytree = hwTreeDataService;
//             var selId = mytree.getSelectedItemId();
//             var objKey = "hw" + selId;
//             var nodeItemObj = mytree.itemObj[objKey];

//             if(!nodeItemObj) {
//                 return;
//             }
//             //关键服务禁用删除
//             if(disabledIds.indexOf(selId)!=-1) return;

//             mytree.deleteItem(selId);
//             if(mytree.hasChildren(0)) {
//                 mytree.show();
//             } else {
//                 mytree.hide();
//             }
//             delDataServiceProject(selId);

//             // 显示默认页面
//             divJcxx.show();
//             ModuleInfo.hide();
//             WorkflowModuleInfo.hide();
//             DataServiceModuleInfo.hide();
//             var eleIFrame = document.getElementById("iframe_page");
//             if(eleIFrame) {
//                 eleIFrame.src = vmd.virtualPath + vmdSettings.systemPath+'/eQ9ULgcVb5/hw03cb4931.html';
//             }

//             var urlparam = {
//                 host: vmd.workspace.dataServiceIp || vmdSettings.dataServiceIp,
//                 url: "DataService/Service/Project"
//             }
//             hwDas.del(
//                 urlparam, {}, {
//                     'id': selId
//                 },
//                 function(result) {
//                     // Tips.tips("删除成功！", "success");
//                 },
//                 function(msg) {
//                     Tips.tips("删除服务失败！", "error");
//                 }
//             );

//             // hwDas.ajax({
//             //     das: {
//             //         idedas: true
//             //     },
//             //     url: "DataService/Service/Project",
//             //     // url: "http://"+vmdSettings.dataServiceIp+"/DasService/DataService/DataService/Service/Project",
//             //     type: 'delete',
//             //     timeout: 50000,
//             //     params: {
//             //         'id': selId
//             //     },
//             //     success: function(result) {
//             //         // Ext.Msg.alert("提示", "删除模板成功！")
//             //     },
//             //     error: function(msg) {
//             //         Ext.Msg.alert("提示", "删除服务失败！")
//             //     }
//             // })
//         } else {

//         }
//     });
// }

//查看数据服务
function viewDataService() {

    var mytree = hwTreeDataService;
    var nodeId = mytree.getSelectedItemId();
    var objKey = "hw" + nodeId;
    var selnode = mytree.itemObj[objKey];
    if(!selnode) {
        return;
    }

    divJcxx.show();
    ModuleInfo.hide();
    WorkflowModuleInfo.hide();
    DataServiceModuleInfo.hide();

    var eleIFrame = document.getElementById("iframe_page");
    var urlService = "http://" + (vmd.workspace.dataServiceIp || vmdSettings.dataServiceIp) + "/DasManage/main/project/manage.html?id=" + nodeId + "&builtin=" + selnode.builtin;
    // if(vmdSettings.dataServiceIp) {
    //     urlService = "http://" + vmdSettings.dataServiceIp + "/DasManage/main/project/manage.html?id=" + nodeId + "&builtin=" + selnode.builtin;
    // }
    if(eleIFrame) {
        var url = urlService;
        eleIFrame.src = url;
        // eleIFrame.src = "http://"+vmdSettings.dataServiceIp+"/DasManage/main/project/manage.html?id=104FPWq2wr&builtin=1";
    }
}

// 2017.11.27: 声明全局函数
window["viewDataService"] = viewDataService;

//数据服务录入框
Ext.winDataService = Ext.extend(Ext.Window, {
    xtype: "window",
    title: "数据服务",
    width: 300,
    height: 214,
    layout: "form",
    bodyStyle: 'padding:15px',
    labelAlign: "left",
    labelWidth: 40,
    modal: true,
    constructor: function(callback, code, name, remark) {
        this.callback = callback;
        this.valueCode = code;
        this.valueName = name;
        this.valueRemark = remark;
        this.callParent();
    },
    initComponent: function() {
        var me = this;
        this.fbar = [{
            text: "确定",
            handler: function() {
                me.callback(Ext.getCmp('code').getValue(), Ext.getCmp('name').getValue(), Ext.getCmp('remark').getValue());
                me.close();
            }
        }, {
            text: "取消",
            handler: function() {
                me.close();
            }
        }];

        this.items = [{
            id: 'code',
            xtype: "textfield",
            fieldLabel: "编码",
            anchor: "100%",
            value: this.valueCode
        }, {
            id: 'name',
            xtype: "textfield",
            fieldLabel: "名称",
            anchor: "100%",
            value: this.valueName
        }, {
            id: 'remark',
            xtype: "textfield",
            fieldLabel: "说明",
            anchor: "100%",
            value: this.valueRemark
        }]
        Ext.winDataService.superclass.initComponent.call(this);
    }
})

function hwTreeDataService_nodeClick(sender, id) {
    viewDataService();
    return;
    //win.close()
    divJcxx.show();
    ModuleInfo.hide();
    WorkflowModuleInfo.hide();
    DataServiceModuleInfo.hide();

    divJcxx.hide();
    DataServiceModuleInfo.show();
    DataServiceModuleInfo.refresh(hwTreeDataService, btnProjectName.projectId, btnWorkSpaceName.workspaceId);

    // var eleIFrame = document.getElementById("iframe_page");
    // if(eleIFrame) {
    //     eleIFrame.src = vmd.virtualPath + vmdSettings.systemPath+'/hw4acf2f8b/hwcb376d18.html';
    // }
}

function btnXtpz_click(sender) {

    var updateConfig = function(workflowIp, dataServiceIp) {

        // 存储信息到系统配置变量中
        vmdSettings.workflowIp = workflowIp;
        vmdSettings.dataServiceIp = dataServiceIp;
        var bodyStr = 'window.vmdSettings={\n';
        bodyStr += "workflowIp: \"" + workflowIp + "\",\n";
        bodyStr += "dataServiceIp: \"" + dataServiceIp + "\"\n";
        bodyStr += '}';
        saveVmdConfig("config.js", bodyStr, "vmdstate");
    }

    var winForm = new Ext.winVmdConfig(updateConfig, vmdSettings.workflowIp, vmdSettings.dataServiceIp);
    winForm.show();
}

// 保存配置信息
var saveVmdConfig = function(filename, bodyStr, taskName) {

    Ext.Ajax.request({
        url: vmd.vmdUploadPath + 'FileService?FileName=' + filename,
        timeout: 50000,
        success: function(result) {
            var res;
            try {
                res = Ext.util.JSON.decode(result.responseText);

                var info = Ext.decode(bodyStr);
                var replacestr = res.data;
                var workflowIpStr = 'vmdSettings.workflowIp="{ip}"';
                var dataServiceIpStr = 'vmdSettings.dataServiceIp="{ip}"';
                workflowIpStr = workflowIpStr.format({
                    ip: info.workflowIp
                })
                dataServiceIpStr = dataServiceIpStr.format({
                    ip: info.dataServiceIp
                })
                replacestr = replacestr.replace(/vmdSettings.workflowIp="[\w.:\d]+"/g, workflowIpStr);
                replacestr = replacestr.replace(/vmdSettings.dataServiceIp="[\w.:\d]+"/g, dataServiceIpStr);


                if(res.errMsg) {
                    Ext.Msg.alert('错误', res.errMsg);
                    return
                } else {
                    Ext.Ajax.request({
                        url: vmd.vmdUploadPath + 'FileService',
                        // defaultPostHeader: 'text/plain',
                        timeout: 50000,
                        success: function(result) {
                            Ext.Msg.alert('提示', '保存成功！');
                        },
                        failure: function(result) {
                            //vmdstate = true;
                            tastList[taskName] = true;
                            Ext.Msg.alert('错误', '网络超时，保存失败！')
                            myMask.hide()
                        },
                        headers: {
                            token: '',
                            FileName: filename
                        },
                        params: {
                            body: replacestr
                        }
                    });
                }
            } catch (ex) {
                res = {};
            }
        }
    })
}

//模板名称录入框
Ext.winVmdConfig = Ext.extend(Ext.Window, {
    xtype: "window",
    title: "系统信息配置",
    width: 300,
    height: 160,
    layout: "form",
    bodyStyle: 'padding:10px',
    labelAlign: "right",
    labelWidth: 80,
    modal: true,
    constructor: function(callback, workflowIp, dataServiceIp) {

        this.callback = callback;
        this.workflowIp = workflowIp;
        this.dataServiceIp = dataServiceIp;
        // this.reportIp = reportIp;
        this.callParent();
    },
    initComponent: function() {
        var me = this;
        this.fbar = [{
            text: "确定",
            handler: function() {
                me.callback(Ext.getCmp('workflowIp').getValue(), Ext.getCmp('dataServiceIp').getValue());
                me.close();
            }
        }, {
            text: "取消",
            handler: function() {
                me.close();
            }
        }];

        this.items = [{
            id: 'workflowIp',
            xtype: "textfield",
            fieldLabel: "工作流地址",
            anchor: "100%",
            value: this.workflowIp
        }, {
            id: 'dataServiceIp',
            xtype: "textfield",
            fieldLabel: "数据服务地址",
            anchor: "100%",
            value: this.dataServiceIp
        }]
        Ext.winVmdConfig.superclass.initComponent.call(this);
    }
})

// 退出

function btnZy_click(sender) {
    window.open(vmd.virtualPath + '/modules/hw3ce0447e/hwef4bf837/hw8EUFAFsa.html', "资源管理")
}

function btnGrxx_click(sender) {
    // Ext.MessageBox.alert("提示", "正在开发中...");
}

function rightMenuClick(id, el, title, fn) {
    var menu = new Ext.menu.Menu({
        id: id,
        items: [{
            text: title,
            handler: function() {
                fn && fn()
            }
        }]
    })
    el.on('contextmenu', function(e) {
        e.stopEvent();
        menu.showAt(e.getXY());
    })
}
// 左侧空白右键菜单
function panel_afterrender(sender) {
    var isAdd = false; // 判断是否添加粘贴item
    var menu = new Ext.menu.Menu({
        id: 'p_menu',
        items: [{
            id: 1,
            text: '新建分类',
            handler: function() {
                creatProjectFord()
            }
        }, {
            id: 2,
            text: '新建模块',
            handler: function() {
                // 在空白处点击鼠标时，就取消原有节点的选中
                hwTree.clearSelection();

                hwTree.newnode = true;
                divJcxx.hide();
                ModuleInfo.show();
                WorkflowModuleInfo.hide();
                DataServiceModuleInfo.hide();
                ModuleInfo.refresh(hwTree, btnProjectName.projectId, btnWorkSpaceName.workspaceId);
                lastnodeType = "0";
                // hwTree.newnode = true;
                // document.getElementById("iframe_page").src = vmd.virtualPath + vmdSettings.systemPath+'/hwipUwNjJb/hw4db49729.html';
                bselNodeId = id;
            }
        }, {
            id: 3,
            text: '项目注册',
            handler: function() {
                // 根据项目id获取注册配置信息
                hwDas.get("DataServiceWorkSpace/projectInfo/projectreginfo", {}, {
                    projectid: btnProjectName.projectId
                }, function(result) {
                    // console.log(result)
                    if(result.data && result.data.length > 0 && result.data[0].datas && result.data[0].datas.length > 0) {
                        var porjectRegister = new vmd.window({
                            title: "项目注册发布",
                            url: vmd.core.getVirtualPath() + "modules/eQ9ULgcVb1/eQ9ULgcVb5/hwid1VqqtB.html",
                            auto: false,
                            height: 600,
                            width: 520,
                            maximizable: false,
                            enableLoading: true,
                            resizable: true,
                            params: {
                                project_id: btnProjectName.projectId,
                                r: new Date().getTime()
                            }
                        })
                        porjectRegister.show();
                        parent.porjectRegister = porjectRegister;
                        parent.projectName = btnProjectName.getText();
                        parent.subsysid = result.data[0].datas[0].subsysid;
                        parent.pttype = result.data[0].datas[0].pttype;
                        parent.ptdb = result.data[0].datas[0].ptdb;
                        parent.virtualPath = result.data[0].datas[0].virtualdir;
                        parent.resourceserver = result.data[0].datas[0].resourceserver;
                    } else {
                        vmd.alert('提示', '请先对该项目进行注册信息配置');
                    }

                })
            }
        }, {
            id: 4,
            text: '导出模块',
            handler: function() {
                ExpModules(true)
            }
        }, {
            id: 5,
            text: '导出发布模块',
            handler: function() {
               expPublicshModules(true)
            }
        }]
    })
    this.el.on('contextmenu', function(e) {
        e.stopEvent();
        if(hwproject_id.getValue() == '') {
            return;
        }
        if(hwTree.copyNodeId) {
            if(!isAdd) {
                menu.addItem({
                    id: 4,
                    text: '粘贴',
                    handler: function() {
                        nodePaste();
                    }
                });
                isAdd = true;
            }
        } else {
            if(isAdd) {
                menu.remove(4);
                isAdd = false
            }
        }

        menu.showAt(e.getXY());
    })
}
var expMask
//导出模块功能 成兵
function ExpModules(project_name, project_id,expAll) {
   
    var nodepath;
    if(hwTree.getSelectedItemId() && hwTree.itemObj[hwTree.getSelectedItemId()])
        nodepath = hwTree.itemObj[hwTree.getSelectedItemId()].path; 
    if(expAll)nodepath=""
    var expmodulesWin = new vmd.window({
        title: "模块导出",
        url: vmd.core.getVirtualPath() + "modules/eQ9ULgcVb1/eQ9ULgcVb5/hwca60610a.html",
        auto: false,
        height: 520,
        width: 500,
        maximizable: false,
        enableLoading: true,
        resizable: false,
        params: {
            project_name: project_name || btnProjectName.getText(),
            project_id: project_id || btnProjectName.projectId,
            nodepath: nodepath,
            r: new Date().getTime()
        }
    })
    expmodulesWin.show();
    window.expmodulesWin = expmodulesWin;
}
window.ExpModules = ExpModules;

function expPublicshModules(expAll)
{
     var nodepath;
    if(hwTree.getSelectedItemId() && hwTree.itemObj[hwTree.getSelectedItemId()])
        nodepath = hwTree.itemObj[hwTree.getSelectedItemId()].path;
    if(expAll)nodepath=""
    var expPublishmodulesWin = new vmd.window({
        title: "导出发布模块",
        url: vmd.core.getVirtualPath() + "modules/eQ9ULgcVb1/eQ9ULgcVb5/hwPHVNaLbQ.html",
        auto: false,
        height: 520,
        width: 600,
        maximizable: false,
        enableLoading: true,
        resizable: false,
        params: {
            project_name: btnProjectName.getText(),
            project_id: btnProjectName.projectId,
            nodepath: nodepath,
            r: new Date().getTime()
        }
    })
    
    expPublishmodulesWin.show();
    window.expPublishmodulesWin = expPublishmodulesWin;
}
window.expPublicshModules=expPublicshModules;

//导出模块功能  选择项目 成兵
function selectExpProject() {
    var expProSelWin = new vmd.window({
        title: "导出项目选择",
        url: vmd.core.getVirtualPath() + "modules/eQ9ULgcVb1/eQ9ULgcVb5/hwMYLlr4P6.html",
        auto: false,
        height: 520,
        width: 870,
        maximizable: false,
        enableLoading: true,
        resizable: false,
        params: {
            r: new Date().getTime()
        }
    })
    expProSelWin.show();
    window.expProSelWin = expProSelWin;
}


function getNodePath(node) {
    var nodepath = "/" + node.id
    if(node.parent) {
        return getNodePath(node.parent) + nodepath
    }

    return nodepath
}

// 工作流的新建分类
function panel7_afterrender(sender) {
    rightMenuClick('p_workflowMenu', this.el, '新建分类', function() {
        onMenuWorkFlowPanelClick('newWorkFlowCategory');
    });
}

function panel8_afterrender(sender) {
    this.el.on('contextmenu', function(e) {
        e.stopEvent();
    })
}

// 获取模块／分类信息
function changeData() {
    var mytree = hwTree;
    var firstNode = "";
    mytree.deleteChildItems(0);
    mytree.loadJSONObject({
        id: 0,
        text: "我的项目",
        item: []
    });
    mytree.itemObj = {};
    mytree.newnode = false;
    if(hwproject_id.getValue() != '') {
        //进度条
        var myMask = new Ext.LoadMask(Ext.getCmp("hwTree").el, {
            msg: "数据加载中,请稍后...",
            msgCls: 'z-index:10000;'
        });
        myMask.show();
        hwDas.ajax({
            das: {
                idedas: true
            },
            url: "CDEServcie/module/category",
            type: 'get',
            timeout: 10000,
            params: {
                project_id: hwproject_id.getValue(),
                parent_id: 0
            },
            success: function(result) {
                var datajson = result.data[0].datas;
                var treeDataJson = [];
                for(var i = 0; i < datajson.length; i++) {
                    mytree.insertNewChild(0, datajson[i].id, datajson[i].name);
                    mytree.setItemImage2(datajson[i].id, "tree/folderClosed.gif", "tree/folderOpen.gif", "tree/folderClosed.gif")
                    mytree.insertNewChild(datajson[i].id, datajson[i].id + "-0", "");
                    mytree.closeItem(datajson[i].id);
                    var treenode = mytree.item(datajson[i].id);
                    treenode.path = "/" + hwproject_id.getValue() + "/" + datajson[i].id;
                    treenode.projectId = hwproject_id.getValue();
                    if(treenode) {
                        treenode.isFord = true;
                        treenode.loadChild = false;
                        treenode.isProject = false;
                    }
                    mytree.itemObj[datajson[i].id] = treenode;
                }

                bCategoryFlag = true;
                bInfoFlag = true;
                if(bCategoryFlag && bInfoFlag) {
                    myMask.hide();
                }
                // 项目中的模块添加到搜索列表
                getQueryData()
            },
            error: function(msg) {
                bCategoryFlag = true;
                bInfoFlag = true;
                if(bCategoryFlag && bInfoFlag) {
                    myMask.hide();
                }
                Ext.Msg.alert("提示", "获取模块信息失败", function() {})
            }
        })
        hwDas.ajax({
            das: {
                idedas: true
            },
            url: "CDEServcie/module/info",
            type: 'get',
            timeout: 10000,
            params: {
                project_id: hwproject_id.getValue(),
                category_id: '0'
            },
            success: function(result) {
                var datajson = result.data[0].datas;
                var treeDataJson = [];
                for(var i = 0; i < datajson.length; i++) {
                    mytree.insertNewChild(0, datajson[i].id, datajson[i].name);
                    mytree.setItemImage2(datajson[i].id, "tree/model.png", "tree/model.png", "tree/model.png")
                    var treenode = mytree.item(datajson[i].id);
                    treenode.path = "/" + hwproject_id.getValue() + "/" + datajson[i].id;
                    treenode.projectId = hwproject_id.getValue();
                    if(treenode) {
                        treenode.isModel = true;
                        treenode.createuser = datajson[i].row_created_by;
                        treenode.createtime = datajson[i].row_created_date;
                        treenode.changetime = datajson[i].row_changed_date;
                        treenode.changeuser = datajson[i].row_changed_by;
                        treenode.remark = datajson[i].remark;
                        treenode.code = datajson[i].code;
                    }
                    mytree.itemObj[datajson[i].id] = treenode;
                }
                bInfoFlag = true;
                bCategoryFlag = true;
                if(bCategoryFlag && bInfoFlag) {
                    myMask.hide();
                }
            },
            error: function(msg) {
                bInfoFlag = true;
                bCategoryFlag = true;
                if(bCategoryFlag && bInfoFlag) {
                    myMask.hide();
                }
                Ext.Msg.alert("提示", "获取模块信息失败")
            }
        })
    }

    //绑定右键菜单
    var menu = new dhtmlXMenuObject();
    menu.renderAsContextMenu();
    menu.attachEvent("onClick", onMenuClick);
    // menu.addNewChild(menu.topId, 0, "newPro", "新建项目", false);
    menu.addNewChild(menu.topId, 1, "newFord", "新建分类", false);
    menu.addNewChild(menu.topId, 2, "newMode", "新建模块", false);
    menu.addNewChild(menu.topId, 3, "copy", "复制", false);
    //menu.addNewChild(menu.topId, 4, "cut", "剪切", false);
    menu.addNewChild(menu.topId, 5, "paste", "粘帖", false);
    menu.addNewChild(menu.topId, 7, "reName", "重命名", false);
    menu.addNewChild(menu.topId, 6, "delete", "删除", false);
    menu.addNewChild(menu.topId, 8, "expmodules", "导出模块", false);
    menu.addNewChild(menu.topId, 9, "exppublishmodules", "导出发布模块", false);
    mytree.enableDragAndDrop("temporary_disabled");

    mytree.enableContextMenu(menu);

    mytree.attachEvent("onBeforeContextMenu", function(itemId) {
        var mytree = hwTree;
        var selId = mytree.getSelectedItemId();
        var selnode = mytree.itemObj[selId];

        //需要在项目及分类下显示粘贴
        var showPasteMenu = function(tree, menu) {
            menu.hideItem('copy');
            menu.hideItem('cut');
            if(tree.copyNodeId) {
                menu.showItem('paste');
            } else {
                menu.hideItem('paste');
            }
        }

        if(selnode.isProject) {
            //项目
            menu.showItem('newPro');
            menu.showItem('newFord');
            menu.showItem('newMode');
            menu.showItem('delete');
            menu.showItem('expmodules');
            menu.showItem('exppublishmodules');

            showPasteMenu(mytree, menu);
        } else if(selnode.isFord) {
            //分类
            menu.hideItem('newPro');
            menu.showItem('newFord');
            menu.showItem('newMode');
            menu.showItem('reName');
            menu.showItem('delete');
            menu.showItem('expmodules');
            menu.showItem('exppublishmodules');

            showPasteMenu(mytree, menu);
        } else if(selnode.isModel) {
            //模块
            menu.hideItem('newPro');
            menu.hideItem('newFord');
            menu.hideItem('newMode');
            menu.hideItem('reName');
            menu.showItem('copy');
            menu.showItem('expmodules');
            menu.showItem('exppublishmodules');

            //menu.showItem('cut');
            menu.hideItem('paste');
            menu.showItem('delete');
        }
        return true
    })

    //绑定右键事件 设置右键选中节点
    mytree.attachEvent('onRightClick', function(id) {
        //panel下的右键取消
        Ext.getCmp('p_menu') && Ext.getCmp('p_menu').hide();
        mytree.selectItem(id);
        hwTree_nodeClick(mytree, id)
    })


}

// 初始化工区列表菜单
function initMenuWorkSpaceList() {
    hwMenuWorkSpaceList.removeAll();
    hwDas.get(
        "DataServiceWorkSpace/WorkSpaceInfo/WorkSpaceUserQuery", {}, {
            'loginname': Ext.util.Cookies.get('hwLogin')
        },
        function(result) {
            // 根据获取的数据赋值基本信息Tab页
            if(null == result || undefined == result) {
                return;
            }
            if(null != result.data && undefined != result.data) {
                if(result.data.length > 0) {
                    if(null != result.data[0].datas && undefined != result.data[0].datas) {
                        if(result.data[0].datas.length > 0) {
                            var isActive = false;
                            for(var i = 0; i < result.data[0].datas.length; i++) {
                                if(result.data[0].datas[i].active_ind == 1) {
                                    isActive = true;
                                    hwvarWorkSpaceId.setValue(result.data[0].datas[i].workspace_id);
                                    btnWorkSpaceManagement.workspaceId = result.data[0].datas[i].workspace_id;
                                    btnWorkSpaceName.setText(result.data[0].datas[i].name);
                                    btnWorkSpaceName.workspaceId = result.data[0].datas[i].workspace_id;
                                    getProject(hwvarWorkSpaceId.getValue());
                                    lastWorkId = result.data[0].datas[i].workspace_id;
                                    var itemMenu = new Ext.menu.CheckItem({
                                        id: result.data[0].datas[i].workspace_id,
                                        text: result.data[0].datas[i].name,
                                        iconCls: "server-list",
                                        group: 'name',
                                        checked: true
                                    })
                                } else {
                                    var itemMenu = new Ext.menu.CheckItem({
                                        id: result.data[0].datas[i].workspace_id,
                                        text: result.data[0].datas[i].name,
                                        iconCls: "server-list",
                                        group: 'name',
                                        checked: false
                                    })
                                }
                                hwMenuWorkSpaceList.addMenuItem(itemMenu);
                            }
                            // 如果没有活动工区，就设置第一个为活动工区
                            if(!isActive) {
                                hwvarWorkSpaceId.setValue(result.data[0].datas[0].workspace_id);
                                btnWorkSpaceManagement.workspaceId = result.data[0].datas[0].workspace_id;
                                btnWorkSpaceName.setText(result.data[0].datas[0].name);
                                btnWorkSpaceName.workspaceId = result.data[0].datas[0].workspace_id;
                                getProject(hwvarWorkSpaceId.getValue());
                            }
                            vmd.core.getWorkSpaceServer(btnWorkSpaceName.workspaceId);
                        } else {
                            newDefaultWorkSpace();
                        }
                    } else {
                        newDefaultWorkSpace();
                    }
                } else {
                    newDefaultWorkSpace();
                }
            } else {
                newDefaultWorkSpace();
            }
        },
        function(msg) {
            Tips.tips("查询工区信息失败！", "error");
        });
}

// 初始化工区列表菜单
function newDefaultWorkSpace() {

    // 当前用户无工区则新建工区
    var newID = vmd.util.guid();
    var workspace_name = '我的工区';

    vmd.workspace.workflowIp = "";
    vmd.workspace.dataServiceIp = "";

    var is_active = 0;
    var dateTime = new Date();
    // var dateTime = new Date().getTime();
    var dateTimeTmp = Ext.Date.dateFormat(new Date(), 'Y-m-d H:i:s')
    // var dateTimeTmp = dateTime.getFullYear() + '-' + (parseFloat(dateTime.getMonth()) + 1) + '-' + dateTime.getDate() +
    //     ' ' + dateTime.getHours() + ':' + dateTime.getMinutes() + ':' + dateTime.getSeconds();
    hwDas.add(
        "DataServiceWorkSpace/WorkSpaceInfo/WorkSpaceInfo", {}, {}, [{
            'workspaceid': newID,
            'lastid': "",
            'workspacename': workspace_name,
            'isactive': 1,
            'modifydate': dateTimeTmp,
            'createddate': dateTimeTmp,
            'aliasid': vmd.util.guid(),
            'aliaslongname': workspace_name,
            'aliasshortname': workspace_name,
            'remark': workspace_name
        }],
        function(result) {
            vmd.workspace.workspaceid = newID;
            setDefaultWorkSpace(newID);
        },
        function(msg) {
            Tips.tips("添加工区信息失败！", "error");
        }
    );
}

function updateMenuWorkSpaceList() {
    hwMenuWorkSpaceList.removeAll();
    hwDas.get(
        "DataServiceWorkSpace/WorkSpaceInfo/WorkSpaceUserQuery", {}, {
            'loginname': Ext.util.Cookies.get('hwLogin')
        },
        function(result) {
            // 根据获取的数据赋值基本信息Tab页
            if(null == result || undefined == result) {
                return;
            }
            if(null != result.data && undefined != result.data) {
                if(result.data.length > 0) {
                    if(null != result.data[0].datas && undefined != result.data[0].datas) {
                        if(result.data[0].datas.length > 0) {
                            console.log(result.data[0].datas)
                            var isActive = false;
                            for(var i = 0; i < result.data[0].datas.length; i++) {
                                if(result.data[0].datas[i].active_ind == 1) {
                                    isActive = true;
                                    hwvarWorkSpaceId.setValue(result.data[0].datas[i].workspace_id);
                                    btnWorkSpaceManagement.workspaceId = result.data[0].datas[i].workspace_id;
                                    btnWorkSpaceName.setText(result.data[0].datas[i].name);
                                    btnWorkSpaceName.workspaceId = result.data[0].datas[i].workspace_id;
                                    // getProject(hwvarWorkSpaceId.getValue());
                                    lastWorkId = result.data[0].datas[i].workspace_id;
                                    var itemMenu = new Ext.menu.CheckItem({
                                        id: result.data[0].datas[i].workspace_id,
                                        text: result.data[0].datas[i].name,
                                        iconCls: "server-list",
                                        group: 'name',
                                        checked: true
                                    })
                                } else {
                                    var itemMenu = new Ext.menu.CheckItem({
                                        id: result.data[0].datas[i].workspace_id,
                                        text: result.data[0].datas[i].name,
                                        iconCls: "server-list",
                                        group: 'name',
                                        checked: false
                                    })
                                }
                                hwMenuWorkSpaceList.addMenuItem(itemMenu);
                            }
                            // 如果没有活动工区，就设置第一个为活动工区
                            if(!isActive) {
                                hwvarWorkSpaceId.setValue(result.data[0].datas[0].workspace_id);
                                btnWorkSpaceManagement.workspaceId = result.data[0].datas[0].workspace_id;
                                btnWorkSpaceName.setText(result.data[0].datas[0].name);
                                btnWorkSpaceName.workspaceId = result.data[0].datas[0].workspace_id;
                                // getProject(hwvarWorkSpaceId.getValue());
                            }
                        }
                    }
                } else {
                    // 当前用户无工区则新建工区
                    var newID = vmd.util.guid();
                    var workspace_name = '我的工区';

                    vmd.workspace.workflowIp = "";
                    vmd.workspace.dataServiceIp = "";

                    var is_active = 0;
                    var dateTime = new Date();
                    // var dateTime = new Date().getTime();
                    var dateTimeTmp = Ext.Date.dateFormat(new Date(), 'Y-m-d H:i:s')
                    // var dateTimeTmp = dateTime.getFullYear() + '-' + (parseFloat(dateTime.getMonth()) + 1) + '-' + dateTime.getDate() +
                    //     ' ' + dateTime.getHours() + ':' + dateTime.getMinutes() + ':' + dateTime.getSeconds();
                    hwDas.add(
                        "DataServiceWorkSpace/WorkSpaceInfo/WorkSpaceInfo", {}, {}, [{
                            'workspaceid': newID,
                            'lastid': "",
                            'workspacename': workspace_name,
                            'isactive': 1,
                            'modifydate': dateTimeTmp,
                            'createddate': dateTimeTmp,
                            'aliasid': vmd.util.guid(),
                            'aliaslongname': workspace_name,
                            'aliasshortname': workspace_name,
                            'remark': workspace_name
                        }],
                        function(result) {
                            vmd.workspace.workspaceid = newID;
                            setDefaultWorkSpace(newID);
                        },
                        function(msg) {
                            Tips.tips("添加工区信息失败！", "error");
                        }
                    );
                }
            }
        },
        function(msg) {
            Tips.tips("查询工区信息失败！", "error");
        });
}

function setDefaultWorkSpace(newID) {
    btnWorkSpaceManagement.workspaceId = newID;
    btnWorkSpaceName.setText('我的工区');
    btnWorkSpaceName.workspaceId = newID;
    hwvarWorkSpaceId.setValue(newID);


    hwproject_id.setValue('');
    btnProjectName.setText('请添加项目');
    btnProjectName.projectId = '';
    ListBtn.onDisable();
    btnProjectName.onDisable();
    changeData();
    // Ext.Msg.alert("提示", "获取工区数据失败！");
}
// 显示当前登陆人工区列表
function btnWorkSpaceManagement_click(sender, e) {
    var formWorkSpaceManage = new vmd.window({
        title: "工区管理",
        url: vmd.core.getVirtualPath() + "modules/eQ9ULgcVb1/hwipUwNjJb/hw4361c4dd.html",
        auto: false,
        height: 520,
        width: 860,
        maximizable: false,
        enableLoading: true,
        resizable: false,
        params: {
            workspaceid: btnWorkSpaceName.workspaceId,
            workflowaddr: vmd.workspace.workflowIp,
            dataserviceaddr: vmd.workspace.dataServiceIp,
            r: new Date().getTime()
        }
    })

    formWorkSpaceManage.show();
    window.formWorkSpaceManage = formWorkSpaceManage;
    window.initMenuWorkSpaceList = initMenuWorkSpaceList;
    window.updateMenuWorkSpaceList = updateMenuWorkSpaceList;
    window.reloadWorkflowCategory = reloadWorkflowCategory;
    window.reloadDataServiceCategory = reloadDataServiceCategory;
    if(parent) {
        parent.formWorkSpaceManage = formWorkSpaceManage;
        parent.initMenuWorkSpaceList = initMenuWorkSpaceList;
        parent.updateMenuWorkSpaceList = updateMenuWorkSpaceList;
        parent.reloadWorkflowCategory = reloadWorkflowCategory;
        parent.reloadDataServiceCategory = reloadDataServiceCategory;
    }

}

// 工区切换
function hwMenuWorkSpaceList_click(sender, menuItem, e) {
    var itemId = menuItem.id;
    var itemText = menuItem.text;
    // 更改活动工区状态
    hwDas.edit(
        "DataServiceWorkSpace/WorkSpaceInfo/changeActive", {}, {}, [{
            'lastworkid': lastWorkId,
            'workid': itemId
        }],
        function(result) {},
        function(msg) {
            Tips.tips("工区状态更改失败！", "error");
        }
    );
    vmd.core.getWorkSpaceServer(itemId);
    hwvarWorkSpaceId.setValue(itemId);
    btnWorkSpaceManagement.workspaceId = itemId;
    btnWorkSpaceName.setText(itemText);
    btnWorkSpaceName.workspaceId = itemId;
    getProject(hwvarWorkSpaceId.getValue());
    lastWorkId = itemId;
}

// // 获取工区中配置的工作流服务地址
// function getWorkflowAddress(wsId) {

//     vmd.workspace.workspaceid = wsId;
//     vmd.workspace.workflowIp = "";
//     hwDas.get(
//         "DataServiceWorkSpace/WorkSpaceInfo/ServiceAddress", {}, {
//             "workspaceid": workspaceId,
//             "servicetype": 3
//         },
//         function(result) {
//             // 根据获取的数据赋值基本信息Tab页
//             if(null === result && undefined === result) {
//                 return;
//             }

//             if(null != result.data && undefined != result.data) {
//                 if(result.data.length > 0) {
//                     if(null != result.data[0].datas && undefined != result.data[0].datas) {
//                         if(result.data[0].datas.length > 0) {
//                             vmd.workspace.workflowIp = result.data[0].datas[0].address;
//                         }
//                     }
//                 }
//             }
//         },
//         function(msg) {
//             // Ext.Msg.alert("提示", "查询工区信息失败！");
//         });
// }

// // 获取工区中配置的数据服务地址
// function getDataServiceAddress(wsId) {

//     vmd.workspace.workspaceid = wsId;
//     vmd.workspace.dataServiceIp = "";
//     hwDas.get(
//         "DataServiceWorkSpace/WorkSpaceInfo/ServiceAddress", {}, {
//             "workspaceid": workspaceId,
//             "servicetype": 4
//         },
//         function(result) {
//             // 根据获取的数据赋值基本信息Tab页
//             if(null === result && undefined === result) {
//                 return;
//             }

//             if(null != result.data && undefined != result.data) {
//                 if(result.data.length > 0) {
//                     if(null != result.data[0].datas && undefined != result.data[0].datas) {
//                         if(result.data[0].datas.length > 0) {
//                             vmd.workspace.dataServiceIp = result.data[0].datas[0].address;
//                         }
//                     }
//                 }
//             }
//             panelTabDataService.ifDataLoaded = true;
//         },
//         function(msg) {
//             // Ext.Msg.alert("提示", "查询工区信息失败！");
//         });
// }

// 工区管理
function hwMenuWorkSpace_click(sender, menuItem, e) {
    var itemId = menuItem.id;
    var itemAddProject = itemId.indexOf("hwMenuItemAddProject"); // 基于0开始,找不到返回-1
    var itemConfig = itemId.indexOf("hwMenuItemWorkSpaceConfig"); // 基于0开始,找不到返回-1
    var itemNewProject = itemId.indexOf("hwMenuItemNewProject"); // 基于0开始,找不到返回-1

    // 基本信息
    if(itemAddProject > -1) {
        onMenuItemAddProject();
    } else if(itemConfig > -1) {
        onMenuItemWorkSpaceConfig();
    } else if(itemNewProject > -1) {
        onMenuItemNewProject();
    }
}
// 添加项目
function onMenuItemAddProject() {
    window.getProject = getProject;
    var formAddProject = new parent.vmd.window({
        title: btnWorkSpaceName.text + " - 项目添加",
        //url: vmd.core.getVirtualPath() + vmdSettings.systemPath+"/hwipUwNjJb/hwzIqDcsGS.html",
        url: vmd.core.getVirtualPath() + "modules/eQ9ULgcVb1/hwipUwNjJb/hwRSvMOuk9.html?r=" + Math.random(),
        auto: false,
        height: 505,
        width: 890,
        // height: 506,
        // width: 880,
        maximizable: false,
        enableLoading: true,
        resizable: true,
        params: {
            workspaceid: btnWorkSpaceName.workspaceId,
            r: new Date().getTime()
        }
    })

    formAddProject.show();
    window.formAddProject = formAddProject;
    window.getProject = getProject;
    if(parent) {
        parent.formAddProject = formAddProject;
        parent.getProject = getProject;
    }
}

// function addProjectTree() {
//     treeProjects.store.toRefresh(); // 刷新项目树
// }
// 工区配置
function onMenuItemWorkSpaceConfig() {
    window.btnWorkSpaceName = btnWorkSpaceName;
    var formWorkSpaceConfig = new vmd.window({
        title: btnWorkSpaceName.getText() + "参数配置",
        url: vmd.core.getVirtualPath() + "modules/eQ9ULgcVb1/hwipUwNjJb/hw56e34140.html",
        auto: false,
        height: 510,
        width: 626,
        maximizable: false,
        enableLoading: true,
        resizable: false,
        params: {
            workspaceid: btnWorkSpaceName.workspaceId,
            r: new Date().getTime()
        }
    })
    window.formWorkSpaceConfig = formWorkSpaceConfig;
    window.initMenuWorkSpaceList = initMenuWorkSpaceList;
    window.updateMenuWorkSpaceList = updateMenuWorkSpaceList;
    window.reloadWorkflowCategory = reloadWorkflowCategory;
    window.reloadDataServiceCategory = reloadDataServiceCategory;
    if(parent) {
        parent.formWorkSpaceConfig = formWorkSpaceConfig;
        parent.btnWorkSpaceName = btnWorkSpaceName;
        parent.initMenuWorkSpaceList = initMenuWorkSpaceList;
        parent.updateMenuWorkSpaceList = updateMenuWorkSpaceList;
        parent.reloadWorkflowCategory = reloadWorkflowCategory;
        parent.reloadDataServiceCategory = reloadDataServiceCategory;
    }

    formWorkSpaceConfig.show();

}

// 新建项目
function onMenuItemNewProject() {
    var formNewProject = new vmd.window({
        title: "新建项目",
        url: vmd.core.getVirtualPath() + "modules/eQ9ULgcVb1/hwipUwNjJb/hwf9cbd384.html",
        auto: false,
        height: 590,
        width: 878,
        maximizable: false,
        enableLoading: true,
        resizable: false,
        params: {
            workspaceid: btnWorkSpaceName.workspaceId,
            r: new Date().getTime()
        }
    })

    formNewProject.show();
    window.formNewProject = formNewProject;
    window.getProject = getProject;
    if(parent) {
        parent.formNewProject = formNewProject;
        parent.getProject = getProject;
    }
}
// 项目配置
function ListBtn_click(sender, e) {
    hwMenuProjectConfig.showAt(e.xy);
}

function opencProjectConfig() {
    if(btnProjectName.projectId == '') {
        return;
    }
    // var nodeSel = btnProjectName.projectId;
    window.getProject = getProject;
    var formProConfig = new vmd.window({
        title: btnProjectName.getText() + "配置",
        url: vmd.core.getVirtualPath() + "modules/eQ9ULgcVb1/hwipUwNjJb/hw9299ec24.html",
        auto: false,
        height: 510,
        width: 626,
        maximizable: false,
        enableLoading: true,
        resizable: false,
        params: {
            workId: btnWorkSpaceName.workspaceId,
            id: btnProjectName.projectId,
            r: new Date().getTime()
        }
    })

    formProConfig.show();
    window.formProConfig = formProConfig;
    window.reloadWorkflowCategory = reloadWorkflowCategory;
    window.reloadDataServiceCategory = reloadDataServiceCategory;
    if(parent) {
        parent.formProConfig = formProConfig;
        parent.btnProjectName = btnProjectName;
        parent.getProject = getProject;
        parent.reloadWorkflowCategory = reloadWorkflowCategory;
        parent.reloadDataServiceCategory = reloadDataServiceCategory;
        // parent.getWorkflowCategory = getWorkflowCategory;
        // parent.getDataServiceCategory = getDataServiceCategory;
    }
    // if(btnProjectName.projectId == '') {
    //     Ext.Msg.alert("提示", "暂无项目可编辑！");
    //     return
    // }
    // var btnLeft = sender.el.getRegion().left;
    // var btnTop = sender.el.getRegion().top;
    // var btnHeight = sender.getHeight() / 1.2;
    // hwMenuProject.showAt([btnLeft, btnTop + btnHeight]);
    // // hwMenuProject.showAt(e.xy);
}
// 操作项目
function hwMenuProject_click(sender, menuItem, e) {
    var itemId = menuItem.id;
    var itemConfig = itemId.indexOf("hwMenuItemProjectConfig"); // 基于0开始,找不到返回-1
    // var itemCopy = itemId.indexOf("hwMenuItemProjectCopy"); // 基于0开始,找不到返回-1
    var itemDel = itemId.indexOf("hwMenuItemProjectDel"); // 基于0开始,找不到返回-1
    var itemFord = itemId.indexOf("ProjectNewFord");
    var itemMode = itemId.indexOf("ProjectNewMode");

    // 基本信息
    if(itemConfig > -1) {
        onMenuItemProjectConfig();
    } else if(itemDel > -1) {
        onMenuItemProjectDel();
    } else if(itemFord > -1) {
        creatProjectFord()
    } else if(itemMode > -1) {
        hwTree.newnode = true;
        divJcxx.hide();
        ModuleInfo.show();
        WorkflowModuleInfo.hide();
        DataServiceModuleInfo.hide();
        ModuleInfo.refresh(hwTree, btnProjectName.projectId, btnWorkSpaceName.workspaceId);

        // hwTree.newnode = true;
        // // document.getElementById("iframe_page").src = vmd.virtualPath + vmdSettings.systemPath+'/eQ9ULgcVb5/hwa99a3307.html';
        // document.getElementById("iframe_page").src = vmd.virtualPath + vmdSettings.systemPath+'/hwipUwNjJb/hwSthqiIpx.html';
    }
}

// 删除项目
function onMenuItemProjectDel() {

    Ext.Msg.confirm("提示", "确认要从工区中删除该项目？", function(type) {
        if(type == "yes") {

            var nodeSel = btnProjectName.projectId;
            if(null == nodeSel || undefined == nodeSel) {
                Ext.Msg.alert("提示", "请选择要删除的节点！");
                return;
            }

            hwDas.del(
                "DataServiceWorkSpace/WorkSpaceInfo/WorkSpaceProject", {}, {
                    'workspaceid': btnWorkSpaceName.workspaceId,
                    'projectid': nodeSel
                },
                function(result) {
                    Tips.tips("删除成功！", "success");
                    // Ext.Msg.alert("提示", "删除资源目录成功！");
                },
                function(msg) {
                    Tips.tips("删除失败！", "error");
                    // Ext.Msg.alert("提示", "删除项目失败！");
                }
            );

        }
    });
}


// 新建项目分类
function creatProjectFord() {
    var addford = function(fordname, callback) {
        var mytree = hwTree;
        var selId = btnProjectName.projectId;
        // var selnode = mytree.itemObj[selId];
        var selnodepath = "/" + selId;
        var parentId;
        var projectId;
        var nodename = fordname;
        var newnodeid = newGuid(10);
        var newcode = newGuid(10);
        var xh = 10;
        parentId = "0";
        projectId = selId;
        myMask = new Ext.LoadMask(Ext.getBody(), {
            msg: "加载中,请稍后..."
        });
        myMask.show();

        // 判断同一目录下是否存在相同名称分类
        checkfordReName(projectId, parentId, newnodeid, nodename, function() {
            if(callback) {
                callback()
            }
            hwDas.ajax({
                das: {
                    idedas: true
                },
                url: "CDEServcie/module/category",
                type: 'post',
                contentType: 'application/json;charset=UTF-8',
                timeout: 50000,
                params: {
                    parent_id: parentId,
                    name: nodename,
                    code: newcode,
                    project_id: projectId,
                    id: newnodeid,
                    xh: xh
                },
                datas: [{
                    parent_id: parentId,
                    name: nodename,
                    code: newcode,
                    project_id: projectId,
                    id: newnodeid,
                    xh: xh
                }],
                success: function(result) {
                    mytree.insertNewChild(0, newnodeid, nodename);
                    mytree.setItemImage2(newnodeid, "tree/folderClosed.gif", "tree/folderOpen.gif", "tree/folderClosed.gif")
                    var treenode = mytree.item(newnodeid);
                    treenode.path = selnodepath + "/" + newnodeid;
                    treenode.projectId = projectId;
                    treenode.loadChild = true;
                    if(treenode) {
                        treenode.isFord = true;
                    }
                    mytree.itemObj[newnodeid] = treenode;
                    myMask.hide();
                    getQueryData();
                },
                error: function(msg) {
                    myMask.hide();
                    Ext.Msg.alert("提示", "新建目录失败")
                }
            })
        })
    }

    var fordname = new Ext.MyFordWin(addford, '');
    fordname.show();
}
// 弹出工区列表
function btnMenu1_click(sender, e) {
    var btnLeft = sender.el.getRegion().left;
    var btnTop = sender.el.getRegion().top;
    var btnHeight = sender.getHeight() / 1.2;
    hwMenuWorkSpace.showAt([btnLeft, btnTop + btnHeight]);
}
// 获取项目列表
function btnWorkSpaceName_click(sender, e) {
    var btnLeft = sender.el.getRegion().left;
    var btnTop = sender.el.getRegion().top;
    var btnHeight = sender.getHeight() / 1.5;
    if(hwMenuWorkSpaceList.items.length > 0) {
        hwMenuWorkSpaceList.showAt([btnLeft, btnTop + btnHeight]);
    }
}
//项目切换
function hwMenuProjectList_click(sender, menuItem, e) {
    var itemId = menuItem.id;
    var itemText = menuItem.text;
    hwDas.edit(
        'DataServiceWorkSpace/projectInfo/changeprojectind', {}, {
            'workspece_id': btnWorkSpaceName.workspaceId,
            'project_id': menuItem.id
        }, [{
            'workspece_id': btnWorkSpaceName.workspaceId,
            'project_id': menuItem.id
        }],
        function(result) {},
        function(msg) {}
    );
    hwproject_id.setValue(itemId);

    btnProjectName.setText(itemText);
    btnProjectName.projectId = itemId;
    //成兵 20180911 设置并获取该项目的环境变量
    vmd.core.getEnvVariables(btnProjectName.projectId)

    changeData();

    if(ifWorkflowLoaded) {
        // 清空树原有的默认数据
        hwTreeWorkFlow.deleteChildItems(0);
        getWorkflowCategory();
    }

    if(ifDataServiceLoaded) {
        // 清空树原有的默认数据
        hwTreeDataService.deleteChildItems(0);
        getDataServiceCategory();
    }

    divJcxx.show();
    ModuleInfo.hide()
    WorkflowModuleInfo.hide();
    DataServiceModuleInfo.hide();
    // 右侧显示初始页面
    document.getElementById("iframe_page").src = vmd.virtualPath + vmdSettings.systemPath+'/eQ9ULgcVb5/hw03cb4931.html';
    //MyP_jcxx.body.update("<" + "iframe " + " src=vmdSettings.systemPath+'/eQ9ULgcVb5/hw03cb4931.html' " + " width=100% height=100% frameborder=0  " + ">" + "sdsds" + "<" + "/" + "iframe" + ">");
    // projectId = selnode.projectId;
    lastnodeType = "1";
}
// 获取项目列表
function getProject(id) {
    hwMenuProjectList.removeAll();

    hwproject_id.setValue('');
    btnProjectName.setText('');
    btnProjectName.projectId = '';

    hwDas.get('DataServiceWorkSpace/WorkSpaceInfo/WorkSpaceProject', {}, {
            workspaceid: id
        },
        function(result) {
            if(result.data.length > 0) {
                if(null != result.data[0].datas && undefined != result.data[0].datas) {
                    if(result.data[0].datas.length > 0) {
                        var isActive = false;
                        for(var i = 0; i < result.data[0].datas.length; i++) {
                            if(result.data[0].datas[i].active_ind == 1) {
                                isActive = true;
                                var itemMenu = new Ext.menu.CheckItem({
                                    id: result.data[0].datas[i].project_id,
                                    text: result.data[0].datas[i].project_name,
                                    iconCls: "server-list",
                                    group: 'name of group',
                                    checked: true
                                })
                                hwproject_id.setValue(result.data[0].datas[i].project_id);
                                btnProjectName.setText(result.data[0].datas[i].project_name);
                                btnProjectName.projectId = result.data[0].datas[i].project_id;
                                ListBtn.onEnable();
                                btnProjectName.onEnable();
                            } else {
                                var itemMenu = new Ext.menu.CheckItem({
                                    id: result.data[0].datas[i].project_id,
                                    text: result.data[0].datas[i].project_name,
                                    iconCls: "server-list",
                                    group: 'name of group',
                                    checked: false
                                })
                            }
                            hwMenuProjectList.addMenuItem(itemMenu);
                        }
                        if(!isActive) {
                            hwproject_id.setValue(result.data[0].datas[0].project_id);
                            btnProjectName.setText(result.data[0].datas[0].project_name);
                            btnProjectName.projectId = result.data[0].datas[0].project_id;
                            ListBtn.onEnable();
                            btnProjectName.onEnable();
                        }
                        changeData();
                        //成兵 20180911 设置并获取该项目的环境变量
                        vmd.core.getEnvVariables(btnProjectName.projectId)
                        // 重新加载工作流和数据服务
                        reloadWorkflowCategory();
                        reloadDataServiceCategory();
                    } else {
                        hwproject_id.setValue('');
                        btnProjectName.setText('请添加项目');
                        btnProjectName.projectId = '';
                        ListBtn.onDisable();
                        btnProjectName.onDisable();
                        changeData();

                        // 重新加载工作流和数据服务
                        reloadWorkflowCategory();
                        reloadDataServiceCategory();
                    }
                }
            }
        },
        function(msg) {
            Ext.Msg.alert("提示", "获取项目信息失败");
        }
    );
    divJcxx.show()
    //divJcxx.update("<iframe  id='iframe_page' src='" + vmd.virtualPath + vmdSettings.systemPath+"/eQ9ULgcVb5/hw03cb4931.html' width=100% height=100% frameborder=0  ></iframe>");

}
// 弹出项目列表
function btnProjectName_click(sender, e) {
    if(btnProjectName.projectId == '') {
        return;
    }
    var btnLeft = sender.el.getRegion().left + 5;
    var btnTop = sender.el.getRegion().top;
    var btnHeight = sender.getHeight() / 1.2;
    hwMenuProjectList.showAt([btnLeft, btnTop + btnHeight]);
}

function MyTabs_tabchange(sender, tab) {
    // var tabId = tab.id;

    // // 基本信息
    // if(tabId == "panel") { // 模块
    // } else if(tabId == "panel1") { // 工作流
    //     if(!ifWorkflowLoaded) {
    //         getWorkflowCategory();
    //     }
    // } else if(tabId == "panel2") { // 数据服务
    //     if(!ifDataServiceLoaded) {
    //         // getDataServiceCategory();
    //         ifDataServiceLoaded = true;
    //     }
    // }
}

// 判断同一节点下是否存在相同名称的模块
function checkModuleReName(projectId, pId, name, callback) {
    var isRep = false;
    hwDas.ajax({
        das: {
            idedas: true
        },
        url: "CDEServcie/module/info",
        type: 'get',
        timeout: 50000,
        params: {
            category_id: pId,
            project_id: projectId
        },
        success: function(result) {
            var datajson = result.data[0].datas;
            for(var i = 0; i < datajson.length; i++) {
                if(datajson[i].name == name) {
                    isRep = true;
                    break
                }
            }
            if(isRep) {
                myMask.hide();
                Ext.Msg.alert('提示', '此模版名称已存在');
            } else {
                callback()
            }
        },
        error: function(msg) {
            myMask.hide();
            Ext.Msg.alert("提示", "获取模块信息失败")
        }
    })
}
// 判断同一节点下是否存在相同名称的分类
function checkfordReName(projectId, pId, id, name, callback) {
    var isRep = false;
    hwDas.ajax({
        das: {
            idedas: true
        },
        url: "CDEServcie/module/category",
        type: 'get',
        timeout: 50000,
        params: {
            project_id: projectId,
            parent_id: pId
        },
        success: function(result) {
            var datajson = result.data[0].datas;
            for(var i = 0; i < datajson.length; i++) {
                if(name == datajson[i].name && datajson[i].id != id) {
                    isRep = true;
                    break;
                }
            }
            if(isRep) {
                myMask.hide();
                Ext.Msg.alert('提示', '此分类名称已存在');
            } else {
                callback()
            }
        },
        error: function(msg) {
            myMask.hide();
            Ext.Msg.alert("提示", "获取分类信息失败")
        }
    })
}
// 判断同一节点下是否存在相同名称的工作流分类
function checkFlowfordReName(nodeParentId, id, name, callback) {
    var isRep = false;
    var info = "kermit";
    var urlService = ''
    if(nodeParentId == '0') {
        urlService = "http://" + (vmd.workspace.workflowIp || vmdSettings.workflowIp) + "/activiti-rest/service/repository/categorys/root?info=kermit"
    } else {
        urlService = "http://" + (vmd.workspace.workflowIp || vmdSettings.workflowIp) + "/activiti-rest/service/repository/categorys/" + nodeParentId + "/members?info=" + info;
    }
    // 获取根节点下的文件夹节点信息
    hwDas.ajax({
        url: urlService,
        type: 'get',
        timeout: 10000,
        params: {},
        success: function(result) {
            for(var i = 0; i < result.data.length; i++) {
                if(result.data[i].name == name && result.data[i].id != id) {
                    isRep = true;
                    break;
                };
            }
            if(isRep) {
                myMask.hide();
                Ext.Msg.alert('提示', '此分类名称已存在');
            } else {
                callback()
            }
        },
        error: function(msg) {
            myMask.hide();
            Ext.Msg.alert("提示", "获取分类节点信息失败", function() {})
        }
    })
}
// 判断同一节点下是否存在相同名称的工作流模块
function CheckFlowMoudlRename(ParentId, id, name, callback) {
    var isRep = false;
    var info = "kermit";
    urlService = "http://" + (vmd.workspace.workflowIp || vmdSettings.workflowIp) + "/activiti-rest/service/repository/hwmodels?categoryId=" + ParentId + "&info=" + info;
    // 获取根节点下的文件夹节点信息
    hwDas.ajax({
        url: urlService,
        type: 'get',
        timeout: 10000,
        params: {},
        success: function(result) {
            for(var j = 0; j < result.data.length; j++) {
                for(var i = 0; i < result.data[j].datas.length; i++) {
                    if(result.data[j].datas[i].NAME == name && result.data[j].datas[i].ID != id) {
                        isRep = true;
                        break
                    }
                }
            }
            if(isRep) {
                myMask.hide();
                Ext.Msg.alert('提示', '此分类名称已存在');
            } else {
                callback()
            }
        },
        error: function(msg) {
            myMask.hide();
            Ext.Msg.alert("提示", "获取分类节点信息失败", function() {})
        }
    })
}


function hwTreeWorkFlow_beforerender(sender) {
    // ifWorkflowLoaded = false;
}

function hwTreeDataService_beforerender(sender) {
    // ifDataServiceLoaded = false;
}

function hwTree_beforerender(sender) {}

function btn_uxcom_click(sender, e) {
    window.open(vmd.virtualPath + vmdSettings.systemPath+'/hw61499a5d/hwvl41einK.html', "复合组件管理");
    // window.open(vmd.virtualPath + vmdSettings.systemPath+'/hw61499a5d/hw86c61c8b.html', "复合组件管理");
}

function projectInfo_click(sender, e) {
    opencProjectConfig()
}

function btnPro_click(sender, e) {
    hwMenuProMange.showAt(e.xy)
}

function newProject_click(sender, e) {
    onMenuItemNewProject();
}

function RegInfo_click(sender, e) {
    var formRegInfo = new vmd.window({
        title: "注册信息配置",
        url: vmd.core.getVirtualPath() + "modules/eQ9ULgcVb1/eQ9ULgcVb5/hwd3771cbe.html",
        auto: false,
        height: 650,
        width: 600,
        maximizable: false,
        enableLoading: true,
        resizable: false,
        params: {
            id: btnProjectName.projectId,
            r: new Date().getTime()
        }
    })
    formRegInfo.show();
    window.formRegInfo=formRegInfo;
}

function varsInfo_click(sender, e) {
    var formVarInfo = new vmd.window({
        title: "环境变量",
        url: vmd.core.getVirtualPath() + "modules/eQ9ULgcVb1/eQ9ULgcVb5/hw0141d302.html",
        auto: false,
        height: 650,
        width: 600,
        maximizable: false,
        enableLoading: true,
        resizable: false,
        params: {
            id: btnProjectName.projectId,
            r: new Date().getTime()
        }
    })

    formVarInfo.show();
    window.formVarInfo = formVarInfo;
}

//成兵 20180911 设置并获取该项目的环境变量
function reLoadEnvar() {
    vmd.core.getEnvVariables(btnProjectName.projectId)
}
window.reLoadEnvar = reLoadEnvar;

// 模块检索
function mCombo_afterrender(sender) {
    store.loadData(selectData);
    mCombo.displayField = 'name';
    mCombo.valueField = 'id';
}

// 获取项目下所有分类及模块信息
function getQueryData() {
    hwDas.get("CDEServcie/module/xmmk", {}, {
            'project_id': hwproject_id.getValue()
        },
        function(result) {
            selectData = result.data[0].datas;
            cateData = result.data[1].datas
            store.loadData(selectData);
            mCombo.bindStore(store)
            mCombo.setValue('');
        },
        function(msg) {}
    );
}

// 查找被检索界面的所有父级分类，并按顺序放到数组中
function queryParen(arr, cId) {
    var pid;
    for(var i = 0; i < cateData.length; i++) {
        if(cateData[i].id == cId) {
            pid = cateData[i].parent_id;
        }
    }
    if(pid != '0') {
        arr.unshift(pid);
        queryParen(arr, pid)
    }
}
// 递归函数从祖父级开始逐层展开节点
function diGuiopen(arr, m, seleId) {
    if(m >= arr.length) {
        return
    }
    if(m == arr.length - 1) {
        // var isLoad = hwTree.itemObj[arr[m]].loadChild;
        if(hwTree.itemObj[arr[m]] && hwTree.itemObj[arr[m]].loadChild == true) {
            hwTree.openItem(arr[m])
            hwTree.selectItem(seleId, true, false);
        } else {
            OpenNOde(arr[m], function() {
                hwTree.selectItem(seleId, true, false);
            })
        }
    } else {
        // var isLoad = hwTree.itemObj[arr[m]].loadChild;
        if(hwTree.itemObj[arr[m]] && hwTree.itemObj[arr[m]].loadChild == true) {
            hwTree.openItem(arr[m])
            m++;
            diGuiopen(arr, m, seleId)
        } else {
            OpenNOde(arr[m], function() {
                m++;
                diGuiopen(arr, m, seleId)
            })
        }
    }
}

function mCombo_selectChanged(sender, combo, record, index) {
    var id = record.data.id;
    if(id == '' || id == null) {
        return
    }
    hwTree.closeAllItems()
    var cataId, pidArr = [],
        k = 0;
    for(var i = 0; i < selectData.length; i++) {
        if(selectData[i].id == id) {
            cataId = selectData[i].category_id;
            break
        }
    }
    if(cataId == '0') {
        hwTree.selectItem(combo, true, false);
        return
    }
    pidArr.push(cataId);
    queryParen(pidArr, cataId)
    diGuiopen(pidArr, k, id)
}

function MyP_Htool_afterrender(sender) {

    MyP_Htool.el.dom.setAttribute("data-step", "1");
    MyP_Htool.el.dom.setAttribute("data-intro", "vmd2.0 功能，支持项目管理、资源管理、复合组件管理等；");
    MyP_Htool.el.dom.setAttribute("data-position", "left");
}

function MyPanel2_afterrender(sender) {
    MyPanel2.el.dom.setAttribute("data-step", "3");
    MyPanel2.el.dom.setAttribute("data-intro", "对应工区下的所有项目列表，并可以对项目进行发布信息、环境变量、数据服务等信息的配置");
    MyPanel2.el.dom.setAttribute("data-position", "right");
}

function panel6_afterrender(sender) {
    panel6.el.dom.setAttribute("data-step", "2");
    panel6.el.dom.setAttribute("data-intro", "支持按工区进行项目管理，可将数据服务、工作流等资源相同的项目进行统一管理；");
    panel6.el.dom.setAttribute("data-position", "right");
}

function panel5_afterrender(sender) {
    panel5.el.dom.setAttribute("data-step", "5");
    panel5.el.dom.setAttribute("data-intro", "模块检索，支持输入关键字对模块进行检索，并进行定位；");
    panel5.el.dom.setAttribute("data-position", "right");
}

function MyP_jcxx_afterrender(sender) {
    MyP_jcxx.el.dom.setAttribute("data-step", "6");
    MyP_jcxx.el.dom.setAttribute("data-intro", "资料及模块基本信息展示区，提供vmd学习使用资料和模块的基本信息；");
    MyP_jcxx.el.dom.setAttribute("data-position", "left");
}
//选择导出项目 成兵
function projectExp_click(sender, e) {
    selectExpProject()
}
//导入模块
function projectImp_click(sender, e) {
    var uploader = Uploader.getUploader();
    var uploaderwin = new vmd.window({
        items: Uploader,
        auto: false,
        height: 500,
        width: 655,
        maximizable: false,
        resizable: false,
        closeAction: 'hide',
        title: "文件上传"
    })
    Uploader.show()
    uploaderwin.show();
    uploaderwin.hide(); //上传接口
    uploader.upload(vmdSettings.dataServiceIp, "expandimp\\expandimp\\impmodules", uploaderwin, function(fileList) {
        //上传成功回调
        var state = true;
        var proName = "";
        var proId = "";
        var impPath = "";
        var impUser = "";
        var impDate = "";
        //组织导入项目信息
        if(fileList.length > 0) {
            if(fileList[0].state == 'SUCCESS') {
                state = true
                if(fileList[0].title.split(".").length == 2 && fileList[0].title.split(".")[1] == 'zip') {
                    var zipInfos = fileList[0].title.split("-");
                    impPath = "expandimp\\impmodules\\" + fileList[0].title;
                    if(zipInfos.length == 3) {
                        proName = zipInfos[0];
                        proId = zipInfos[1];
                    } else {
                        Ext.Msg.alert("提示", "导入的文件名不规范，请严格按照 项目名-项目id-导出用户-日期.zip 的格式")
                        return;
                    }
                } else {
                    Ext.Msg.alert("提示", '导入标准的zip模块导出文件')
                    return;
                }
            } else
                return;
        }
        var impMask = new Ext.LoadMask(document.body, {
            msg: "正在检测比对,请稍后...",
            msgCls: 'z-index:10000;'
        });
        impMask.show();
        //判断项目是否存在
        hwDas.get("DataServiceWorkSpace/projectInfo/ProjectBaseInfo", {}, {
            projectid: proId
        }, function(result) {
            if(result)
                var datas = result.data[0].datas;
            var creatPro = false;
            var importSer = function() {
                //调用服务，解压文件，并在服务器端比对数据并返回。
                vmd.ajax({
                    url: "/expandimp/api/ModuleCheck",
                    type: 'post',
                    timeout: 50000,
                    //dataType:"text",
                    //contentType: 'application/json;charset=UTF-8',
                    data: {
                        proName: proName,
                        proId: proId,
                        impUser: impUser,
                        impDate: impDate,
                        impPath: impPath,
                        creatPro: creatPro
                    },
                    success: function(result) {

                        impMask.hide();
                        if(result.type == "success") {
                            //返回模块信息比对信息
                            window.modulesCheckInfos = {
                                checkInfo: result.checkInfo || [],
                                project_id: proId,
                                proName: proName,
                                path: impPath,
                                impUser: impUser,
                                impDate: impUser,
                                creatPro: creatPro
                            }
                            var modulesCheckWin = new vmd.window({
                                title: "导入模块对比",
                                url: vmd.core.getVirtualPath() + "modules/eQ9ULgcVb1/eQ9ULgcVb5/hwHHPbTeiO.html",
                                auto: false,
                                height: 600,
                                width: 520,
                                maximizable: false,
                                enableLoading: true,
                                resizable: true,
                                params: {
                                    r: new Date().getTime()
                                }
                            })
                            uploaderwin.hide();
                            modulesCheckWin.show()
                            window.modulesCheckWin = modulesCheckWin
                        } else
                            Ext.Msg.alert("提示", result.msg)
                    },
                    error: function(msg) {
                        impMask.hide();
                    }
                })
            }
            if(datas.length <= 0) {
                Ext.Msg.confirm("提示", "该环境下无" + proName + "项目，是否新建项目并导入。", function(type) {
                    if(type == "yes") {
                        creatPro = true
                        importSer();
                    }
                })
            } else {
                importSer()
            }
        }, function(msg) {})
    }, "vmd");
}

//设置导航提示
function div3_click(sender, e) {
    hwMenuHelp.showAt(e.xy);
}

function about_click(sender, e) {
    var aboutWin = new vmd.window({
        title: "关于",
        url: vmd.core.getVirtualPath() + "modules/eQ9ULgcVb1/eQ9ULgcVb5/hwf799effb.html",
        auto: false,
        height: 240,
        width: 380,
        maximizable: false,
        enableLoading: true,
        resizable: true
    })
    aboutWin.show();
}

function guide_click(sender,e){
    introJs().setOptions({
        nextLabel: '下一步 &rarr;',
        prevLabel: '&larr; 上一步',
        skipLabel: '退出',
        doneLabel: '结束'
    }).start();
    LocalData.set('vmdinittips', true)
}
			this.MyViewport_afterrender=MyViewport_afterrender;
		this.MyViewport_beforerender=MyViewport_beforerender;
		hwvarWorkSpaceId=new vmd.var.variable({});
		hwproject_id=new vmd.var.variable({});



		this.items=[
			{
				xtype:"panel",
				id:"MyPanel_head",
				title:"Panel",
				header:false,
				border:true,
				height:60,
				x:0,
				y:0,
				layout:"border",
				bodyStyle:"background-color: #409EFF;",
				region:"north",
				items:[
					{
						xtype:"panel",
						id:"MyPanel_logo",
						title:"Panel",
						header:false,
						border:false,
						height:100,
						region:"west",
						layout:"border",
						width:200,
						maskDisabled:true,
						bodyStyle:"background-color: #0676fe;",
						items:[
							{
								xtype:"vmd.div",
								id:"MyC_Logoimg",
								autoEl:"div",
								border:false,
								backgroundRepeat:"no-repeat",
								backgroundPosition:"top left",
								width:58,
								height:42,
								style:"background: url('/system/img/main/vmdlogo.png') no-repeat center;    margin-left: 20px;    margin-top: 5px;",
								x:0,
								y:0,
								region:"west"
							},
							{
								xtype:"label",
								id:"MyLb_name",
								text:"VMD2.0",
								x:70,
								y:10,
								style:"font-family: \"Microsoft Yahei\";    font-size: 26px;    color: #ffffff;    margin-left: 20px;    margin-top: 4px;",
								region:"center",
								split:false,
								cls:"lineHeight200",
								width:180
							}
						]
					},
					{
						xtype:"panel",
						id:"MyP_Htool",
						layoutConfig:{
							align:"middle",
							pack:"end",
							scrollOffset:20
						},
						title:"Panel",
						header:false,
						border:false,
						height:100,
						region:"east",
						width:520,
						layout:"hbox",
						style:"background-color: skyblue;",
						bodyStyle:"background-color: #0676FE;",
						margins:"",
						cmargins:"",
						split:false,
						afterrender:"MyP_Htool_afterrender",
						listeners:{
							vmdafterrender:MyP_Htool_afterrender
						},
						items:[
							{
								xtype:"vmd.div",
								id:"div3",
								autoEl:"div",
								border:false,
								backgroundRepeat:"no-repeat",
								backgroundPosition:"center center",
								width:40,
								height:50,
								backgroundImage:"/system/modules/eQ9ULgcVb1/img/tips.png",
								flex:"",
								disableImage:false,
								click:"div3_click",
								listeners:{
									click:div3_click
								}
							},
							{
								xtype:"vmd.div",
								id:"MyC_pro",
								autoEl:"div",
								border:false,
								backgroundRepeat:"no-repeat",
								backgroundPosition:"top left",
								width:80,
								height:40,
								style:"background-image: url(/system/img/main/sysmange.png);    background-repeat: no-repeat;    background-position: 5px center;    background-size: 16px;    padding-left: 25px;",
								overCls:"div-hove",
								items:[
									{
										xtype:"vmd.button",
										id:"btnPro",
										text:"项目管理",
										type:"text",
										size:"small",
										style:"font-size: 12px;    color: #ffffff;    margin-right: 10px;    line-height: 30px;",
										click:"btnPro_click",
										listeners:{
											click:btnPro_click
										}
									}
								]
							},
							{
								xtype:"vmd.div",
								id:"div",
								autoEl:"div",
								border:false,
								backgroundRepeat:"no-repeat",
								backgroundPosition:"top left",
								width:80,
								height:40,
								x:83,
								y:25,
								style:"background-image: url(/system/img/main/hjbl.png);    background-repeat: no-repeat;    margin-right: 10px;    background-position: 8px center;    padding-left: 30px;",
								region:"center",
								margins:"",
								cls:"hove",
								overCls:"div-hove",
								items:[
									{
										xtype:"vmd.button",
										id:"btnWorkSpaceManagement",
										text:"工区管理",
										type:"text",
										size:"small",
										style:"font-size: 12px;    color: #ffffff;    margin-right: 10px;    line-height: 30px;",
										x:110,
										y:22,
										click:"btnWorkSpaceManagement_click",
										region:"west",
										margins:"0 5 0 0",
										listeners:{
											click:btnWorkSpaceManagement_click
										}
									}
								]
							},
							{
								xtype:"vmd.div",
								id:"div2",
								autoEl:"div",
								border:false,
								backgroundRepeat:"no-repeat",
								backgroundPosition:"top left",
								width:80,
								height:40,
								backgroundImage:"/system/modules/eQ9ULgcVb1/img/复合组件1.png",
								style:"margin-right: 10px;    background-image: url('/system/modules/eQ9ULgcVb1/img/复合组件1.png');    background-repeat: no-repeat;    background-position: 5px center;    padding-left: 30px;    background-size: 22px;",
								overCls:"div-hove",
								items:[
									{
										xtype:"vmd.button",
										id:"btn_uxcom",
										text:"复合组件",
										type:"text",
										size:"small",
										click:"btn_uxcom_click",
										style:"font-size: 12px;    color: #ffffff;    line-height: 30px;",
										margins:"0 10 0 5",
										listeners:{
											click:btn_uxcom_click
										}
									}
								]
							},
							{
								xtype:"vmd.div",
								id:"MyC_zy",
								autoEl:"div",
								border:false,
								backgroundRepeat:"no-repeat",
								backgroundPosition:"top left",
								width:80,
								height:40,
								x:270,
								y:25,
								style:"background-image: url(/system/img/main/zy.png);    background-repeat: no-repeat;    background-position: 8px center;    padding-left: 28px;    background-size: 18px;",
								pageX:"",
								pageY:"",
								overCls:"div-hove",
								items:[
									{
										xtype:"vmd.button",
										id:"btnZy",
										text:"资源管理",
										type:"text",
										size:"small",
										x:200,
										y:22,
										style:"font-size: 12px;    color: #ffffff;    line-height: 30px;",
										click:"btnZy_click",
										margins:"0 5 0 0",
										listeners:{
											click:btnZy_click
										}
									}
								]
							},
							{
								xtype:"vmd.div",
								id:"MyC_hjbl",
								autoEl:"div",
								border:false,
								backgroundRepeat:"no-repeat",
								backgroundPosition:"top left",
								width:1,
								height:40,
								x:270,
								y:25,
								style:"background-image: url(/system/img/main/xtpz.png);    background-repeat: no-repeat;    background-position: 8px center;    background-size: 18px;    padding-left: 28px;    display: none",
								overCls:"div-hove",
								items:[
									{
										xtype:"vmd.button",
										id:"btnXtpz",
										text:"系统配置",
										type:"text",
										size:"small",
										style:"font-size: 12px;    color: #ffffff;    line-height: 28px;",
										y:22,
										x:290,
										click:"btnXtpz_click",
										margins:"0 5 0 0",
										listeners:{
											click:btnXtpz_click
										}
									}
								]
							},
							{
								xtype:"vmd.div",
								id:"MyC_grxx",
								autoEl:"div",
								border:false,
								backgroundRepeat:"no-repeat",
								backgroundPosition:"top left",
								width:80,
								height:40,
								x:360,
								y:25,
								style:"background-image: url(/system/img/main/grxx.png);    background-repeat: no-repeat;    background-position: 5px center;    background-size: 18px;    padding-left: 25px;",
								margins:"",
								items:[
									{
										xtype:"vmd.button",
										id:"btnGrxx",
										text:"个人信息",
										type:"text",
										size:"small",
										style:"font-size: 12px;    color: #ffffff;    cursor: default;    line-height: 28px;",
										x:380,
										y:22,
										click:"btnGrxx_click",
										margins:"0 10 0 0",
										listeners:{
											click:btnGrxx_click
										}
									}
								]
							},
							{
								xtype:"vmd.div",
								id:"MyC_tc",
								autoEl:"div",
								border:false,
								backgroundRepeat:"no-repeat",
								backgroundPosition:"top left",
								width:60,
								height:40,
								x:430,
								y:25,
								style:"background-image: url(/system/img/main/tc.png);    background-repeat: no-repeat;    background-position: 5px center;    background-size: 16px;    padding-left: 25px;",
								afterrender:"MyC_tc_afterrender",
								overCls:"div-hove",
								listeners:{
									vmdafterrender:MyC_tc_afterrender
								},
								items:[
									{
										xtype:"vmd.button",
										id:"button",
										text:"退&nbsp;&nbsp;出",
										type:"text",
										size:"small",
										x:440,
										y:22,
										style:"font-size: 12px;    color: #ffffff;    line-height: 28px;",
										click:"button_click",
										listeners:{
											click:button_click
										}
									}
								]
							}
						]
					},
					{
						xtype:"panel",
						id:"panel3",
						title:"Panel",
						header:false,
						border:false,
						height:100,
						region:"center",
						layout:"auto",
						bodyStyle:"background-color: #0676FE;",
						items:[
							{
								xtype:"panel",
								id:"panel4",
								title:"Panel",
								header:false,
								border:false,
								height:45,
								bodyStyle:"background-color: #0676FE;",
								items:[
									{
										xtype:"panel",
										id:"panel6",
										title:"Panel",
										header:false,
										border:false,
										height:50,
										bodyStyle:"background-color: #0676FE;",
										width:211,
										afterrender:"panel6_afterrender",
										listeners:{
											vmdafterrender:panel6_afterrender
										},
										items:[
											{
												xtype:"vmd.button",
												id:"btnWorkSpaceName",
												text:"我的工区",
												type:"text",
												size:"small",
												style:"font-family: \"Microsoft Yahei\";    font-size: 18px;    color: #fff;    line-height: 55px;    background-image: icon-double-angle-down;    background-position: center left;",
												y:18,
												region:"center",
												click:"btnWorkSpaceName_click",
												icon:"icon-angle-down",
												listeners:{
													click:btnWorkSpaceName_click
												}
											},
											{
												xtype:"vmd.button",
												id:"btnMenu1",
												type:"text",
												size:"small",
												click:"btnMenu1_click",
												style:"font-size: 18px;    color: #fff;    margin-left: 10px;",
												x:100,
												y:12,
												region:"east",
												icon:"icon-cog",
												listeners:{
													click:btnMenu1_click
												}
											}
										]
									}
								]
							},
							{
								xtype:"vmd.div",
								id:"div1",
								autoEl:"div",
								border:false,
								backgroundRepeat:"no-repeat",
								backgroundPosition:"top left",
								width:400,
								height:20,
								style:"background-image: url('/system/modules/eQ9ULgcVb1/img/down.png');    background-repeat: no-repeat;    background-size: 17px 11px;    margin-right: 10px;    background-position: 30px 0;",
								backgroundImage:"/system/modules/eQ9ULgcVb1/img/down.png",
								hidden:true
							}
						]
					}
				]
			},
			{
				xtype:"panel",
				id:"MyP_info",
				title:"Panel",
				header:false,
				border:false,
				height:640,
				x:0,
				y:60,
				layout:"border",
				region:"center",
				items:[
					{
						xtype:"panel",
						id:"MyP_ModelTree",
						title:"Panel",
						header:false,
						border:false,
						height:639,
						width:220,
						layout:"border",
						x:0,
						y:0,
						region:"west",
						style:"background-color: white;",
						bodyStyle:"background-color: white;",
						split:true,
						floatable:false,
						collapseMode:"mini",
						collapsible:true,
						items:[
							{
								xtype:"panel",
								id:"MyPanel2",
								title:"Panel",
								header:false,
								border:true,
								height:40,
								region:"north",
								layout:"border",
								afterrender:"MyPanel2_afterrender",
								listeners:{
									vmdafterrender:MyPanel2_afterrender
								},
								items:[
									{
										xtype:"panel",
										id:"MyPanel",
										title:"Panel",
										header:false,
										border:false,
										height:40,
										x:0,
										y:0,
										layout:"border",
										width:220,
										region:"center",
										autoHeight:false,
										autoWidth:false,
										items:[
											{
												xtype:"vmd.button",
												id:"btnProjectName",
												text:"源头数据采集项目",
												type:"text",
												size:"small",
												style:"font-family: Microsoft YaHei;    font-size: 16px;    text-align: left;    padding-left: 10px;    overflow: hidden;",
												width:167,
												height:24,
												region:"center",
												disabled:false,
												hidden:false,
												autoHide:false,
												x:3,
												y:14,
												click:"btnProjectName_click",
												icon:"icon-angle-down",
												listeners:{
													click:btnProjectName_click
												}
											},
											{
												xtype:"vmd.button",
												id:"ListBtn",
												type:"text",
												size:"small",
												x:180,
												y:5,
												width:30,
												height:20,
												style:"font-size: 16px;    border: 0;",
												region:"east",
												icon:"icon-wrench",
												click:"ListBtn_click",
												disabled:false,
												listeners:{
													click:ListBtn_click
												}
											}
										]
									}
								]
							},
							{
								xtype:"panel",
								id:"MyPanel1",
								title:"Panel",
								header:false,
								border:false,
								height:300,
								x:70,
								y:130,
								region:"center",
								layout:"fit",
								width:357,
								items:[
									{
										xtype:"tabpanel",
										id:"MyTabs",
										activeTab:0,
										height:150,
										width:500,
										unstyled:false,
										activeItem:"panel",
										tabchange:"MyTabs_tabchange",
										listeners:{
											tabchange:MyTabs_tabchange
										},
										items:[
											{
												xtype:"panel",
												id:"panel",
												title:"模块",
												header:true,
												border:false,
												height:100,
												layout:"border",
												afterrender:"panel_afterrender",
												listeners:{
													vmdafterrender:panel_afterrender
												},
												items:[
													{
														xtype:"panel",
														id:"panel5",
														title:"Panel",
														header:false,
														border:false,
														height:28,
														region:"north",
														layout:"fit",
														afterrender:"panel5_afterrender",
														listeners:{
															vmdafterrender:panel5_afterrender
														},
														items:[
															{
																xtype:"vmd.comlist",
																id:"mCombo",
																width:350,
																height:270,
																afterrender:"mCombo_afterrender",
																selectChanged:"mCombo_selectChanged",
																style:"border: 1px solid #dfdfdf;    border-right: 0;    border-top: 0;    font-size: 13px;",
																listeners:{
																	vmdafterrender:mCombo_afterrender,
																	selectChanged:mCombo_selectChanged
																}
															}
														]
													},
													{
														xtype:"vmd.tree",
														id:"hwTree",
														skin:"material",
														width:220,
														isdesign:false,
														x:0,
														y:0,
														afterrender:"hwTree_afterrender",
														onOpenEnd:"hwTree_onOpenEnd",
														nodeClick:"hwTree_nodeClick",
														region:"center",
														onOpenStart:"hwTree_onOpenStart",
														onDblClick:"hwTree_onDblClick",
														beforerender:"hwTree_beforerender",
														CheckBox:false,
														listeners:{
															vmdafterrender:hwTree_afterrender,
															onOpenEnd:hwTree_onOpenEnd,
															nodeClick:hwTree_nodeClick,
															beforerender:hwTree_beforerender
														}
													}
												]
											},
											{
												xtype:"panel",
												id:"panel1",
												title:"工作流",
												header:true,
												border:false,
												height:100,
												layout:"fit",
												items:[
													{
														xtype:"panel",
														id:"panel7",
														title:"Panel",
														header:false,
														border:false,
														height:100,
														layout:"fit",
														afterrender:"panel7_afterrender",
														listeners:{
															vmdafterrender:panel7_afterrender
														},
														items:[
															{
																xtype:"vmd.tree",
																id:"hwTreeWorkFlow",
																skin:"material",
																width:220,
																height:580,
																isdesign:false,
																afterrender:"hwTreeWorkFlow_afterrender",
																nodeClick:"hwTreeWorkFlow_nodeClick",
																onOpenEnd:"hwTreeWorkFlow_onOpenEnd",
																beforerender:"hwTreeWorkFlow_beforerender",
																listeners:{
																	vmdafterrender:hwTreeWorkFlow_afterrender,
																	nodeClick:hwTreeWorkFlow_nodeClick,
																	onOpenEnd:hwTreeWorkFlow_onOpenEnd,
																	beforerender:hwTreeWorkFlow_beforerender
																}
															}
														]
													}
												]
											},
											{
												xtype:"panel",
												id:"panel2",
												title:"数据服务",
												header:true,
												border:false,
												height:100,
												layout:"fit",
												items:[
													{
														xtype:"panel",
														id:"panel8",
														title:"Panel",
														header:false,
														border:false,
														height:100,
														layout:"fit",
														afterrender:"panel8_afterrender",
														listeners:{
															vmdafterrender:panel8_afterrender
														},
														items:[
															{
																xtype:"vmd.tree",
																id:"hwTreeDataService",
																skin:"material",
																width:220,
																height:580,
																isdesign:false,
																afterrender:"hwTreeDataService_afterrender",
																nodeClick:"hwTreeDataService_nodeClick",
																beforerender:"hwTreeDataService_beforerender",
																listeners:{
																	vmdafterrender:hwTreeDataService_afterrender,
																	nodeClick:hwTreeDataService_nodeClick,
																	beforerender:hwTreeDataService_beforerender
																}
															}
														]
													}
												]
											}
										]
									}
								]
							}
						]
					},
					{
						xtype:"panel",
						id:"MyP_jcxx",
						title:"Panel",
						header:false,
						border:false,
						height:640,
						width:900,
						x:220,
						y:0,
						layout:"anchor",
						region:"center",
						afterrender:"MyP_jcxx_afterrender",
						listeners:{
							vmdafterrender:MyP_jcxx_afterrender
						},
						items:[
							{
								xtype:"vmd.div",
								id:"divJcxx",
								autoEl:"div",
								border:true,
								backgroundRepeat:"no-repeat",
								backgroundPosition:"top left",
								width:869,
								height:629,
								layout:"anchor",
								hidden:true,
								anchor:"100% 100%"
							},
							{
								xtype:"vmd.ux.WorkflowModuleInfo",
								id:"WorkflowModuleInfo",
								layout:"absolute",
								hidden:true
							},
							{
								xtype:"vmd.ux.DataServiceModuleInfo",
								id:"DataServiceModuleInfo",
								hidden:true
							},
							{
								xtype:"vmd.ux.ModuleInfo",
								id:"ModuleInfo",
								layout:"absolute",
								anchor:"100% 100%",
								hidden:true
							}
						]
					}
				]
			},
			{
				xtype:"vmd.menu",
				id:"hwMenuWorkSpaceList",
				width:120,
				hidden:true,
				floating:true,
				region:"west",
				click:"hwMenuWorkSpaceList_click",
				listeners:{
					click:hwMenuWorkSpaceList_click
				}
			},
			{
				xtype:"vmd.menu",
				id:"hwMenuWorkSpace",
				width:50,
				hidden:true,
				floating:true,
				region:"west",
				click:"hwMenuWorkSpace_click",
				listeners:{
					click:hwMenuWorkSpace_click
				},
				items:[
					{
						xtype:"menuitem",
						id:"hwMenuItemAddProject",
						width:120,
						text:"添加项目",
						hidden:false
					},
					{
						xtype:"menuitem",
						id:"hwMenuItemNewProject",
						width:120,
						text:"新建项目",
						hidden:true
					},
					{
						xtype:"menuitem",
						id:"hwMenuItemWorkSpaceConfig",
						width:120,
						text:"参数配置",
						hidden:false
					}
				]
			},
			{
				xtype:"vmd.menu",
				id:"hwMenuProject",
				width:50,
				hidden:true,
				floating:true,
				region:"east",
				click:"hwMenuProject_click",
				listeners:{
					click:hwMenuProject_click
				},
				items:[
					{
						xtype:"menuitem",
						id:"hwMenuItemProjectConfig",
						width:120,
						text:"项目配置"
					},
					{
						xtype:"menuitem",
						id:"ProjectNewFord",
						width:120,
						text:"新建分类",
						hidden:true
					},
					{
						xtype:"menuitem",
						id:"ProjectNewMode",
						width:120,
						text:"新建模块",
						hidden:true
					},
					{
						xtype:"menuitem",
						id:"hwMenuItemProjectDel",
						width:120,
						text:"删除"
					}
				]
			},
			{
				xtype:"vmd.menu",
				id:"hwMenuProjectList",
				width:120,
				hidden:true,
				floating:true,
				region:"south",
				click:"hwMenuProjectList_click",
				listeners:{
					click:hwMenuProjectList_click
				}
			},
			{
				xtype:"vmd.menu",
				id:"hwMenuProjectConfig",
				width:120,
				hidden:true,
				floating:true,
				items:[
					{
						xtype:"menuitem",
						id:"projectInfo",
						width:120,
						text:"项目配置",
						hidden:false,
						click:"projectInfo_click",
						listeners:{
							click:projectInfo_click
						}
					},
					{
						xtype:"menuitem",
						id:"RegInfo",
						width:120,
						text:"发布注册配置",
						hidden:false,
						click:"RegInfo_click",
						listeners:{
							click:RegInfo_click
						}
					},
					{
						xtype:"menuitem",
						id:"varsInfo",
						width:120,
						text:"环境变量",
						hidden:false,
						click:"varsInfo_click",
						listeners:{
							click:varsInfo_click
						}
					}
				]
			},
			{
				xtype:"vmd.menu",
				id:"hwMenuProMange",
				width:120,
				hidden:true,
				floating:true,
				items:[
					{
						xtype:"menuitem",
						id:"newProject",
						width:120,
						text:"新建项目",
						hidden:false,
						click:"newProject_click",
						listeners:{
							click:newProject_click
						}
					},
					{
						xtype:"menuitem",
						id:"projectExp",
						width:120,
						text:"导出项目",
						hidden:false,
						click:"projectExp_click",
						listeners:{
							click:projectExp_click
						}
					},
					{
						xtype:"menuitem",
						id:"projectImp",
						width:120,
						text:"项目导入",
						hidden:false,
						click:"projectImp_click",
						listeners:{
							click:projectImp_click
						}
					}
				]
			},
			{
				xtype:"vmd.menu",
				id:"hwMenuHelp",
				width:120,
				hidden:true,
				floating:true,
				items:[
					{
						xtype:"menuitem",
						id:"guide",
						width:120,
						text:"向导",
						hidden:false,
						click:"guide_click",
						listeners:{
							click:guide_click
						}
					},
					{
						xtype:"menuitem",
						id:"about",
						width:120,
						text:"关于",
						hidden:false,
						click:"about_click",
						listeners:{
							click:about_click
						}
					}
				]
			},
			{
				xtype:"vmd.ux.Uploader",
				id:"Uploader",
				layout:"fit",
				region:"east",
				hidden:true
			}
		]
		this.callParent();
		var me = this;vmd.core.moduleInit(this.items, this);
			me.on('beforerender',function(){ MyViewport_beforerender.call(me,me)})
		me.on('afterrender',function(){ MyViewport_afterrender.call(me,me)})
}
})
        Ext.onReady(function () {
            Ext.create('vmd.module.MyViewport', {
                renderTo: document.body
            })


        })

      </script>
</head>
<body>
</body>
</html>
