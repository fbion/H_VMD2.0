{"vmdlayout":"{\"components\":[{\"cid\":\"viewport\",\"id\":\"MyViewport\",\"layoutConfig\":{},\"userConfig\":{\"layout\":\"absolute\",\"afterrender\":\"MyViewport_afterrender\"},\"cn\":[{\"cid\":\"panel\",\"id\":\"panel\",\"layoutConfig\":{},\"userConfig\":{\"x\":0,\"y\":0,\"height\":470,\"width\":860,\"header\":false,\"layout\":\"absolute\"},\"cn\":[{\"cid\":\"label\",\"id\":\"label\",\"layoutConfig\":{},\"userConfig\":{\"text\":\"名称：\",\"x\":10,\"y\":20}},{\"cid\":\"textfield\",\"id\":\"hwText\",\"layoutConfig\":{},\"userConfig\":{\"x\":50,\"y\":10,\"width\":360}},{\"cid\":\"label\",\"id\":\"label1\",\"layoutConfig\":{},\"userConfig\":{\"x\":430,\"y\":20,\"text\":\"区域\"}},{\"cid\":\"vmdComlist\",\"id\":\"comlist\",\"layoutConfig\":{},\"userConfig\":{\"x\":460,\"y\":10,\"width\":310}},{\"cid\":\"label\",\"id\":\"label2\",\"layoutConfig\":{},\"userConfig\":{\"x\":10,\"y\":50,\"text\":\"项目时间范围：\"}},{\"cid\":\"label\",\"id\":\"label3\",\"layoutConfig\":{},\"userConfig\":{\"x\":10,\"y\":80,\"text\":\"合同时间范围：\"}},{\"cid\":\"label\",\"id\":\"label6\",\"layoutConfig\":{},\"userConfig\":{\"x\":430,\"y\":50,\"text\":\"到\"}},{\"cid\":\"label\",\"id\":\"label7\",\"layoutConfig\":{},\"userConfig\":{\"x\":430,\"y\":80,\"text\":\"到\"}},{\"cid\":\"datefield\",\"id\":\"hwDate\",\"layoutConfig\":{},\"userConfig\":{\"x\":100,\"y\":40,\"width\":310}},{\"cid\":\"datefield\",\"id\":\"hwDate1\",\"layoutConfig\":{},\"userConfig\":{\"x\":460,\"y\":40,\"width\":310}},{\"cid\":\"datefield\",\"id\":\"hwDate2\",\"layoutConfig\":{},\"userConfig\":{\"x\":100,\"y\":70,\"width\":310}},{\"cid\":\"datefield\",\"id\":\"hwDate3\",\"layoutConfig\":{},\"userConfig\":{\"x\":460,\"y\":70,\"width\":310}},{\"cid\":\"vmdButton\",\"id\":\"button\",\"layoutConfig\":{},\"userConfig\":{\"x\":690,\"y\":430,\"width\":70,\"text\":\"确定\",\"style\":\"background-color: rgb(64, 158, 255);    color: rgb(255, 255, 255);    font-size: 14px;\",\"id\":\"btnOk\",\"click\":\"button_click\"}},{\"cid\":\"vmdButton\",\"id\":\"button1\",\"layoutConfig\":{},\"userConfig\":{\"x\":780,\"y\":430,\"width\":70,\"text\":\"取消\",\"style\":\"background-color: rgb(201, 201, 201);    color: rgb(0, 0, 0);    font-size: 14px;\",\"id\":\"btnCancle\",\"click\":\"button1_click\"}},{\"cid\":\"vmdButton\",\"id\":\"btnSearch\",\"layoutConfig\":{},\"userConfig\":{\"x\":780,\"y\":70,\"id\":\"btnSearch\",\"text\":\"查询\",\"style\":\"font-size: 14px;\",\"width\":70}},{\"cid\":\"vmdButton\",\"id\":\"btnNewProject\",\"layoutConfig\":{},\"userConfig\":{\"x\":20,\"y\":430,\"id\":\"btnNewProject\",\"text\":\"创建新项目...\",\"type\":\"text\",\"style\":\"font-size: 14px;\",\"click\":\"btnNewProject_click\"}},{\"cid\":\"panel\",\"id\":\"panel1\",\"layoutConfig\":{},\"userConfig\":{\"x\":10,\"y\":110,\"width\":840,\"height\":310,\"header\":false,\"border\":true,\"bodyStyle\":\"border: 1px solid RGB(192, 192,192);\"},\"cn\":[{\"cid\":\"grid\",\"id\":\"MyGridProject\",\"layoutConfig\":{},\"userConfig\":{\"x\":20,\"y\":250,\"height\":310,\"header\":false,\"store\":\"storeProjectList\",\"border\":true,\"width\":843,\"id\":\"MyGridProject\",\"beforerender\":\"MyGridProject_beforerender\"},\"cn\":[{\"cid\":\"booleancolumn\",\"layoutConfig\":{},\"userConfig\":{\"header\":\"选择\",\"align\":\"center\",\"width\":40,\"dataIndex\":\"checked\",\"resizable\":false,\"fixed\":false},\"name\":\"checked\"},{\"cid\":\"gridcolumn\",\"layoutConfig\":{},\"userConfig\":{\"header\":\"项目名称\",\"dataIndex\":\"project_name\",\"align\":\"left\",\"width\":320},\"name\":\"project_name\"},{\"cid\":\"gridcolumn\",\"layoutConfig\":{},\"userConfig\":{\"header\":\"项目别名\",\"dataIndex\":\"alias_short_name\",\"align\":\"left\",\"width\":260},\"name\":\"alias_short_name\"},{\"cid\":\"gridcolumn\",\"layoutConfig\":{},\"userConfig\":{\"header\":\"立项时间\",\"align\":\"center\",\"dataIndex\":\"row_created_date\"},\"name\":\"row_created_date\"},{\"cid\":\"gridcolumn\",\"layoutConfig\":{},\"userConfig\":{\"header\":\"合同时间\",\"align\":\"center\",\"dataIndex\":\"contract_date\"},\"name\":\"contract_date\"}]}]},{\"cid\":\"vmdDataView\",\"id\":\"hwDataView\",\"layoutConfig\":{},\"userConfig\":{\"x\":10,\"y\":470,\"width\":460,\"height\":160,\"tpl\":\"<ul>\\n    <tpl for=\\\".\\\">\\n        <div class=\\\"file undefined file-box menu-file\\\" original-name=\\\"{name}\\\" title=\\\"名称:{name}大小:221B 修改时间 : {modifyTime}\\\" data-size=\\\"221\\\">\\n            <div class=\\\"item-select\\\">\\n                <div class=\\\"item-check\\\"></div>\\n            </div>\\n            <div class=\\\"item-menu\\\">\\n                <div class=\\\"cert\\\"></div>\\n            </div>\\n            <div class=\\\"ico\\\" filetype=\\\"{type}\\\"><i class=\\\"x-item-file x-{ext}\\\"></i></div>\\n            <div class=\\\"filename\\\"> <span class=\\\"title db-click-rename\\\" title=\\\"双击名称重命名\\\">{name}\\t</span> </div>\\n        </div>\\n    </tpl>\\n</ul>\"}}]}]},{\"cid\":\"vmddataset\",\"id\":\"数据集\",\"layoutConfig\":{},\"userConfig\":{},\"cn\":[{\"cid\":\"vmdJsonStore\",\"id\":\"storeProjectList\",\"layoutConfig\":{},\"userConfig\":{\"id\":\"storeProjectList\",\"storeConfig\":\"{\\\"id\\\":\\\"TA6EtU7wTx\\\",\\\"callcode\\\":\\\"vmdCode\\\",\\\"url\\\":\\\"DataServiceWorkSpace/projectInfo/ProjectAll\\\",\\\"host\\\":\\\"\\\",\\\"isHwRest\\\":true,\\\"name\\\":\\\"所有项目\\\",\\\"getMethods\\\":[],\\\"postMethods\\\":[],\\\"putMethods\\\":[],\\\"deleteMethods\\\":[],\\\"saveMethods\\\":[],\\\"fields\\\":[{\\\"name\\\":\\\"checked\\\",\\\"type\\\":\\\"string\\\"},{\\\"name\\\":\\\"project_name\\\",\\\"type\\\":\\\"string\\\"},{\\\"name\\\":\\\"row_created_date\\\",\\\"type\\\":\\\"string\\\"},{\\\"name\\\":\\\"contract_date\\\",\\\"type\\\":\\\"string\\\"}]}\",\"load\":\"storeProjectList_load\"},\"cn\":[{\"cid\":\"datafield\",\"layoutConfig\":{},\"userConfig\":{\"cid\":\"datafield\",\"name\":\"checked\"},\"name\":\"checked\"},{\"cid\":\"datafield\",\"layoutConfig\":{},\"userConfig\":{\"cid\":\"datafield\",\"name\":\"project_name\"},\"name\":\"project_name\"},{\"cid\":\"datafield\",\"layoutConfig\":{},\"userConfig\":{\"cid\":\"datafield\",\"name\":\"row_created_date\"},\"name\":\"row_created_date\"},{\"cid\":\"datafield\",\"layoutConfig\":{},\"userConfig\":{\"cid\":\"datafield\",\"name\":\"contract_date\"},\"name\":\"contract_date\"}]}]},{\"cid\":\"vmdvariable\",\"id\":\"变量\",\"layoutConfig\":{},\"userConfig\":{}}]}","vmdevents":"var workspaceId = \"\";\n\nfunction btnNewProject_click(sender, e) {\n    // 创建新项目\n    var addProject = function(name, alias, remark) {\n\n        debugger;\n        var projectId = vmd.util.guid();\n        var aliasId = vmd.util.guid();\n        var changedBy = \"\";\n        var changedDate = \"\";\n        var createdBy = \"\";\n        var createdDate = \"\";\n\n        // 保存到数据库\n        hwDas.add(\n            \"DataServiceWorkSpace/projectInfo/ProjectBaseInfo\", {}, {}, [{\n                'workspaceid': workspaceId,\n                'projectid': projectId,\n                'name': name,\n                'alias': alias,\n                'aliasid': aliasId,\n                'changeddate': changedDate,\n                'changedby': changedBy,\n                'createddate': createdDate,\n                'createdby': createdBy,\n                'description': remark\n            }],\n            function(result) {\n\n                Tips.tips(\"查询成功！\", \"success\");\n                // 刷新项目列表数据集（或调用数据集对象添加一条记录）\n                storeProjectList.toRefresh();\n                // Ext.Msg.alert(\"提示\", \"添加服务地址成功！\")\n            },\n            function(msg) {\n\n                Tips.tips(\"保存失败！\", \"error\");\n                // Ext.Msg.alert(\"提示\", \"添加服务地址失败！\");\n            }\n        );\n    }\n\n    var winForm = new Ext.winAddProject(addProject, \"\", \"\", \"\");\n    winForm.show();\n}\n\n\n//添加资源中心服务地址\nExt.winAddProject = Ext.extend(Ext.Window, {\n    xtype: \"window\",\n    title: \"新建项目\",\n    width: 300,\n    height: 200,\n    layout: \"form\",\n    bodyStyle: 'padding:15px',\n    labelAlign: \"left\",\n    labelWidth: 40,\n    modal: true,\n    constructor: function(callback, name, alias, remark) {\n        this.callback = callback;\n        this.valueAlias = alias;\n        this.valueName = name;\n        this.valueRemark = remark;\n        this.callParent();\n    },\n    initComponent: function() {\n        var me = this;\n        this.fbar = [{\n            text: \"确定\",\n            handler: function() {\n                me.callback(Ext.getCmp('name').getValue(), Ext.getCmp('alias').getValue(), Ext.getCmp('remark').getValue());\n                me.close();\n            }\n        }, {\n            text: \"取消\",\n            handler: function() {\n                me.close();\n            }\n        }];\n\n        this.items = [{\n            id: 'name',\n            xtype: \"textfield\",\n            fieldLabel: \"名称\",\n            anchor: \"100%\",\n            value: this.valueName\n        }, {\n            id: 'alias',\n            xtype: \"textfield\",\n            fieldLabel: \"别名\",\n            anchor: \"100%\",\n            value: this.valueAlias\n        }, {\n            id: 'remark',\n            xtype: \"textfield\",\n            fieldLabel: \"说明\",\n            anchor: \"100%\",\n            value: this.valueRemark\n        }]\n        Ext.winAddProject.superclass.initComponent.call(this);\n    }\n})\n\n// 确定按钮事件\nfunction button_click(sender, e) {\n    debugger;\n\n    // 删除与当前工区相关的所有项目\n    hwDas.del(\n        \"DataServiceWorkSpace/WorkSpaceInfo/DelProjectByWorkspace\", {}, {\n            'workspaceid': workspaceId\n        },\n        function(result) {\n            // Tips.tips(\"删除成功！\", \"success\");\n            // Ext.Msg.alert(\"提示\", \"保存服务地址信息成功！\");\n        },\n        function(msg) {\n            // Tips.tips(\"删除失败！\", \"error\");\n            // Ext.Msg.alert(\"提示\", \"保存服务地址信息失败！\");\n        }\n    );\n\n    // 根据选择的项目保存与工区关联的项目\n    var selModel = MyGridProject.getSelectionModel();\n    // if(null != selModel && undefined != selModel) {\n    //     if(null != selModel.selections && undefined != selModel.selections) {\n    //         if(selModel.selections.items) {\n    //             for(var i = 0; i < selModel.selections.items.length; i++) {\n    //                 hwDas.add(\n    //                     \"DataServiceWorkSpace/WorkSpaceInfo/WorkSpaceProject\", {}, {}, [{\n    //                         'workspaceid': workspaceId,\n    //                         'projectid': selModel.selections.items[i].projectid\n    //                     }],\n    //                     function(result) {\n    //                         // Tips.tips(\"保存成功！\", \"success\");\n    //                     },\n    //                     function(msg) {\n    //                         // Tips.tips(\"保存失败！\", \"error\");\n    //                     }\n    //                 );\n    //             }\n    //         }\n    //     }\n    // }\n\n    var arrData = [];\n\n    if(null != selModel && undefined != selModel) {\n        if(null != selModel.selections && undefined != selModel.selections) {\n            if(selModel.selections.items) {\n                for(var i = 0; i < selModel.selections.items.length; i++) {\n                    var objRow = {\n                        'workspaceid': workspaceId,\n                        'projectid': selModel.selections.items[i].project_id\n                    };\n                    arrData.push(objRow);\n                }\n            }\n        }\n    }\n\n    hwDas.add(\n        \"DataServiceWorkSpace/projectInfo/ProjectBaseInfo\", {}, {}, arrData,\n        function(result) {\n            Tips.tips(\"保存成功！\", \"success\");\n            // 刷新项目列表数据集（或调用数据集对象添加一条记录）\n            storeProjectList.toRefresh();\n        },\n        function(msg) {\n            Tips.tips(\"保存失败！\", \"error\");\n        }\n    );\n\ndebugger\n    parent.treeProjects.addProjectTree();\n    parent.formAddProject.close();\n}\n\n// 取消按钮事件\nfunction MyViewport_afterrender(sender) {\n    debugger;\n    workspaceId = getUrlParam(\"workspaceid\");\n    // workspaceId = \"657e35d9-494a-456d-8f80-98b4924133d7\";\n}\n\nfunction button1_click(sender, e) {\n\n    parent.formAddProject.close();\n}\n\nfunction MyGridProject_beforerender(sender) {\n    // MyGridProject.selModel = {\n    //     injectCheckbox: 0,\n    //     mode: \"SIMPLE\",     //\"SINGLE\"/\"SIMPLE\"/\"MULTI\"\n    //     checkOnly: true     //只能通过checkbox选择\n    // };\n}\n\nfunction storeProjectList_load(sender, records, options) {\n    // 绑定的数据加载完成后\n    // 查询当前工区包含的项目，设置选中\n    hwDas.get(\n        \"DataServiceWorkSpace/WorkSpaceInfo/WorkSpaceProject\", {}, {\n            \"workspaceid\": workspaceId\n        },\n        function(result) {\n            // 根据获取的数据赋值基本信息Tab页\n            if(null === result && undefined === result) {\n                return;\n            }\n\n            if(null != result.data && undefined != result.data) {\n                if(result.data.length > 0) {\n                    if(null != result.data[0].datas && undefined != result.data[0].datas) {\n                        for(var i = 0; i < result.data[0].datas.length; i++) {\n                            // result.data[0].datas[i].project_id;\n                            // 根据项目ID，设置列表项的选中\n                        }\n                    }\n                }\n            }\n        },\n        function(msg) {\n            // Tips.tips(\"查询失败！\", \"error\");\n        });\n}","vmdcss":"","vmdprops":"\"\"","type":"module"}