{"vmdversion":"vmd2.0.6.200119","vmdlayout":"{\"components\":[{\"cid\":\"viewport\",\"id\":\"MainViewport\",\"layoutConfig\":{},\"userConfig\":{\"layout\":\"border\"},\"cn\":[{\"cid\":\"container\",\"id\":\"div1\",\"layoutConfig\":{},\"userConfig\":{\"region\":\"north\",\"height\":31,\"layout\":\"absolute\"},\"cn\":[{\"cid\":\"checkbox\",\"id\":\"hwCheckbox\",\"layoutConfig\":{},\"userConfig\":{\"x\":20,\"y\":5,\"boxLabel\":\"全选\",\"style\":\"color: #5EA0FF;\",\"check\":\"hwCheckbox_check\",\"checked\":true}},{\"cid\":\"checkbox\",\"id\":\"hwCheckbox1\",\"layoutConfig\":{},\"userConfig\":{\"x\":80,\"y\":5,\"boxLabel\":\"只导入组件\",\"style\":\"color: #5EA0FF;\",\"check\":\"hwCheckbox1_check\",\"checked\":false,\"afterrender\":\"hwCheckbox1_afterrender\"}}]},{\"cid\":\"container\",\"id\":\"div\",\"layoutConfig\":{},\"userConfig\":{\"region\":\"center\",\"layout\":\"fit\"},\"cn\":[{\"cid\":\"vmdTreeEx\",\"id\":\"tree\",\"layoutConfig\":{},\"userConfig\":{\"x\":20,\"y\":20,\"checkBox\":true,\"store\":\"treestore\",\"parentField\":\"parent_id\",\"valueField\":\"id\",\"textField\":\"name\",\"loadType\":\"全部加载\",\"rootValue\":\"0\",\"rootText\":\"协同开发\",\"cascading\":true,\"nodeMarkFiled\":\"type\",\"folderValue\":\"category\",\"leafValue\":\"module\",\"rootImg\":\"/system/modules/eQ9ULgcVb1/img/server5.png\",\"folderImg\":\"/system/modules/eQ9ULgcVb1/img/folderClosed.gif\",\"leafImg\":\"/system/modules/eQ9ULgcVb1/img/model.png\",\"afterBindData\":\"tree_afterBindData\",\"beforerender\":\"tree_beforerender\",\"beforeNodeExpand\":\"tree_beforeNodeExpand\",\"afterNodeExpand\":\"tree_afterNodeExpand\"}}]},{\"cid\":\"container\",\"id\":\"div2\",\"layoutConfig\":{\"align\":\"middle\",\"pack\":\"center\"},\"userConfig\":{\"region\":\"south\",\"layout\":\"hbox\"},\"cn\":[{\"cid\":\"vmdButton\",\"id\":\"button\",\"layoutConfig\":{},\"userConfig\":{\"margins\":\"10\",\"text\":\"导入\",\"type\":\"info\",\"click\":\"button_click\"}},{\"cid\":\"vmdButton\",\"id\":\"button1\",\"layoutConfig\":{},\"userConfig\":{\"margins\":\"10\",\"text\":\"取消\",\"click\":\"button1_click\"}}]}]},{\"cid\":\"vmddataset\",\"id\":\"数据\",\"layoutConfig\":{},\"userConfig\":{}},{\"cid\":\"vmdvariable\",\"id\":\"变量\",\"layoutConfig\":{},\"userConfig\":{}},{\"cid\":\"vmdsubviewport\",\"id\":\"SubView_Window\",\"layoutConfig\":{},\"userConfig\":{}}]}","vmdevents":"var UxsCheckInfos = {};\nif (parent.UxsCheckInfos)\n    UxsCheckInfos = parent.UxsCheckInfos\nvar treestore;\nvar impCategory = getUrlParam(\"categoryId\");\n\nfunction hwCheckbox_check(sender, checked) {\n    var rootnode = tree.getRootNode();\n    if (checked == true) {\n        tree.setNodeCheckById(0, true); //设置根节点 被勾中\n        for (var i = 0; i < rootnode.childNodes.length; i++) {\n            var c_type = rootnode.childNodes[i].nodeDataJson.c_type\n            tree.setNodeCheckById(rootnode.childNodes[i].id, true);\n            if (rootnode.childNodes[i].childNodes.length > 0) {\n                findchildnode(rootnode.childNodes[i]);\n            }\n        }\n    } else {\n        tree.setNodeCheckById(0, false); //设置根节点 不被勾中\n        for (var i = 0; i < rootnode.childNodes.length; i++) {\n            tree.setNodeCheckById(rootnode.childNodes[i].id, false);\n            if (rootnode.childNodes[i].childNodes.length > 0) {\n                findchildnode(rootnode.childNodes[i]);\n            }\n        }\n    }\n}\n//遍历树形子节点\nfunction findchildnode(roonodes) { //树形全勾中\n    var childnodes = roonodes.childNodes;\n    for (var i = 0; i < childnodes.length; i++) { // 从节点中取出子节点依次遍历\n        var c_type = childnodes[i].nodeDataJson.c_type\n        tree.setNodeCheckById(childnodes[i].id, hwCheckbox.checked);\n        if (childnodes[i].childNodes.length > 0) {\n            findchildnode(childnodes[i]); // 如果存在子节点 递归\n        }\n    }\n}\n\nfunction button2_click(sender, e) {\n    hwCheckbox.setValue(false); // 全选不勾中\n    tree.setNodeCheckById(0, false); //设置根节点 不被勾中\n    var rootnode = tree.getRootNode();\n    category_findchildnode(rootnode);\n}\n//只选择分类按钮(遍历树形子节点)\nfunction category_findchildnode(roonodes) { //树形全勾中\n    var childnodes = roonodes.childNodes;\n    for (var i = 0; i < childnodes.length; i++) { // 从节点中取出子节点依次遍历\n        if (childnodes[i].childNodes.length > 0) {\n            tree.setNodeCheckById(childnodes[i].id, true);\n            category_findchildnode(childnodes[i]); // 如果存在子节点 递归\n        } else {\n            if (childnodes[i].nodeDataJson.type == 'category') {\n                tree.setNodeCheckById(childnodes[i].id, true);\n            } else\n                tree.setNodeCheckById(childnodes[i].id, false);\n        }\n    }\n}\n\nfunction tree_afterBindData(sender) {\n    //树形全选\n    var rootnode = tree.getRootNode();\n    if (hwCheckbox.checked == true) {\n        tree.setNodeCheckById(0, true); //设置根节点 被勾中\n        for (var i = 0; i < rootnode.childNodes.length; i++) {\n            var c_type = rootnode.childNodes[i].nodeDataJson.c_type\n            tree.setNodeCheckById(rootnode.childNodes[i].id, true);\n            if (rootnode.childNodes[i].childNodes.length > 0) {\n                findchildnode(rootnode.childNodes[i]);\n            }\n        }\n    }\n    rootnode.expand();\n}\nvar myMask;\n\nfunction button_click(sender, e) {\n    myMask = new Ext.LoadMask(document.body, {\n        msg: \"正在导入,请稍后...\",\n        msgCls: 'z-index:10000;'\n    });\n    myMask.show();\n    //处理导入\n    var impInfos = getSelNodeIDs();\n    vmd.ajax({\n        url: \"/expandimp/api/UxImp\",\n        type: 'post',\n        timeout: 120000,\n        //dataType:\"text\",\n        //contentType: 'application/json;charset=UTF-8',\n        data: {\n            UxsId: impInfos.UxsId,\n            categorysId: impInfos.categorysId,\n            UxsInfo: impInfos.UxsInfo,\n            impUser: Ext.util.Cookies.get('userName'),\n            impDate: Ext.Date.dateFormat(new Date(), 'Y-m-d H:i:s'),\n            impPath: UxsCheckInfos.path,\n            creatFord: !hwCheckbox1.checked,\n            impCategory: getUrlParam(\"categoryId\")\n        }, //jsonp: \"callbackparam\", \n        success: function(result) {\n            myMask.hide();\n            if (result.type == \"success\") {\n                Ext.Msg.alert(\"提示\", \"导入成功！\", function() {\n                    if (parent && parent.UxsCheckWin)\n                        parent.UxsCheckWin.close()\n                })\n                if (parent && parent.treeInit)\n                    parent.treeInit()\n            } else\n                Ext.Msg.alert(\"提示\", result.msg)\n        },\n        error: function(msg) {\n            myMask.hide();\n            console.log(msg.msg)\n        }\n    })\n}\nvar cnodeIds = []\nvar mnodeIds = []\nvar mnodeInfo = []\n\nfunction getNodeId(node) {\n    for (var i = 0; i < node.childNodes.length; i++) {\n        var cnode = node.childNodes[i]\n        if (cnode.attributes.checked) {\n            if (cnode.childNodes.length > 0) {\n                getNodeId(cnode)\n                cnodeIds.push(cnode.id)\n            } else {\n                if (cnode.nodeDataJson.type == 'category') {\n                    cnodeIds.push(cnode.id)\n                } else {\n                    mnodeInfo.push({\n                        id: cnode.id,\n                        name: cnode.text,\n                        t_name: cnode.nodeDataJson.t_name\n                    })\n                    mnodeIds.push(cnode.id)\n                }\n            }\n        }\n    }\n}\n\nfunction getSelNodeIDs() {\n    cnodeIds = []\n    mnodeIds = []\n    mnodeInfo = []\n    var rootnode = tree.getRootNode();\n    getNodeId(rootnode)\n    var impModulesInfo = {};\n    impModulesInfo.UxsId = mnodeIds;\n    impModulesInfo.categorysId = cnodeIds;\n    impModulesInfo.UxsInfo = mnodeInfo;\n    return impModulesInfo\n}\n\nfunction button1_click(sender, e) {\n    if (parent && parent.UxsCheckWin)\n        parent.UxsCheckWin.close()\n}\n\nfunction tree_beforerender(sender) {\n    // 创建数据集。 \n    tree.rootText = \"复合组件\";\n    var treeData = UxsCheckInfos.checkInfo;\n    treestore = new vmd.data.Store({\n        data: treeData,\n        fields: ['id', 'name', 'parent_id', 'type', 'c_type', 'nver', 'over', 't_name']\n    })\n    tree.store = treestore;\n}\n\nfunction tree_beforeNodeExpand(sender, node, deep, anim) {}\n\nfunction tree_afterNodeExpand(sender, node) {\n    if (node.childNodes.length > 0) {\n        for (var i = 0; i < node.childNodes.length; i++) {\n            if (node.childNodes[i].nodeDataJson.c_type == '1')\n                node.childNodes[i].ui.addClass(\"nodecolor1\")\n            if (node.childNodes[i].nodeDataJson.c_type == '2')\n                node.childNodes[i].ui.addClass(\"nodecolor2\")\n            if (node.childNodes[i].nodeDataJson.c_type == '3')\n                node.childNodes[i].ui.addClass(\"nodecolor3\")\n            if (node.childNodes[i].nodeDataJson.c_type == '4')\n                node.childNodes[i].ui.addClass(\"nodecolor4\")\n            if (node.childNodes[i].nodeDataJson.c_type == '5')\n                node.childNodes[i].ui.addClass(\"nodecolor5\")\n        }\n    }\n}\n\nfunction hwCheckbox1_check(sender, checked) {\n    if (checked) {\n        var treeData = UxsCheckInfos.checkInfo;\n        var newTreeData = [];\n        for (var i = 0; i < treeData.length; i++) {\n            var ntn = {};\n            if (treeData[i].type != \"category\") {\n                for (var key in treeData[i]) {\n                    ntn[key] = treeData[i][key]\n                }\n                ntn.parent_id = '0';\n                newTreeData.push(ntn)\n            }\n        }\n        treestore = new vmd.data.Store({\n            data: newTreeData,\n            fields: ['id', 'name', 'parent_id', 'type', 'c_type', 'nver', 'over', 't_name']\n        })\n        tree.store = treestore;\n        tree.refresh()\n    } else {\n        var treeData = UxsCheckInfos.checkInfo;\n        treestore = new vmd.data.Store({\n            data: treeData,\n            fields: ['id', 'name', 'parent_id', 'type', 'c_type', 'nver', 'over', 't_name']\n        })\n        tree.store = treestore;\n        tree.refresh()\n    }\n}\n\nfunction hwCheckbox1_afterrender(sender) {\n    if (!impCategory)\n        hwCheckbox1.hide()\n}","vmdcss":".x-form-cb-label {\n    color: #5EA0FF;\n}\n\n.nodecolor1 a span {\n    color: red;\n    font-weight:bold\n}\n\n.nodecolor2 a span  {\n    color: blue;\n    font-weight:bold\n}\n\n.nodecolor3  a span  {\n    color: green;\n    font-weight:bold\n}\n\n.nodecolor4 a span {\n    color: black;\n    font-weight:bold\n}\n\n.nodecolor5 a span {\n    color: orangered;\n    font-weight:bold\n}\n","vmdprops":"\"\"","type":"module","vmdresource":"{\"components\":[{\"cid\":\"vmdrescsss\",\"layoutConfig\":{},\"userConfig\":{}},{\"cid\":\"vmdresjss\",\"layoutConfig\":{},\"userConfig\":{},\"cn\":[{\"cid\":\"resjs\",\"id\":\"project.config.js\",\"layoutConfig\":{},\"userConfig\":{}}]},{\"cid\":\"vmdresimgs\",\"layoutConfig\":{},\"userConfig\":{}}]}"}