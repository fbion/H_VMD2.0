{"vmdversion":"2.0.3.0908","vmdlayout":"{\"components\":[{\"cid\":\"viewport\",\"id\":\"MyViewport\",\"layoutConfig\":{},\"userConfig\":{\"layout\":\"fit\",\"afterrender\":\"MyViewport_afterrender\",\"beforerender\":\"MyViewport_beforerender\"},\"cn\":[{\"cid\":\"panel\",\"id\":\"panel\",\"layoutConfig\":{},\"userConfig\":{\"x\":0,\"y\":0,\"width\":760,\"height\":410,\"title\":\"属性设置\",\"layout\":\"border\",\"border\":false,\"header\":false,\"unstyled\":false},\"cn\":[{\"cid\":\"panel\",\"id\":\"panel1\",\"layoutConfig\":{},\"userConfig\":{\"region\":\"center\",\"height\":283,\"layout\":\"fit\",\"border\":true,\"header\":false,\"cmargins\":\"\",\"padding\":\"10\",\"unstyled\":false,\"labelAlign\":\"left\",\"labelWidth\":60},\"cn\":[{\"cid\":\"form\",\"id\":\"MyForm\",\"layoutConfig\":{},\"userConfig\":{\"header\":false,\"border\":false,\"labelWidth\":60},\"cn\":[{\"cid\":\"textfield\",\"id\":\"id\",\"layoutConfig\":{},\"userConfig\":{\"fieldLabel\":\"属性名称\",\"allowBlank\":false,\"name\":\"id\",\"id\":\"id\",\"emptyText\":\"请输入属性名称，须英文\",\"cls\":\"code\"}},{\"cid\":\"textarea\",\"id\":\"desc\",\"layoutConfig\":{},\"userConfig\":{\"fieldLabel\":\"属性描述\",\"allowBlank\":true,\"id\":\"desc\",\"emptyText\":\"请输入属性描述，便于代码编辑自动提示用\",\"cls\":\"code\"}},{\"cid\":\"textfield\",\"id\":\"zhname\",\"layoutConfig\":{},\"userConfig\":{\"fieldLabel\":\"中文名称\",\"allowBlank\":true,\"id\":\"zhname\",\"emptyText\":\"请输入属性中文名称（汉化用）\",\"hidden\":false}},{\"cid\":\"vmdCombo\",\"id\":\"bindCmp\",\"layoutConfig\":{},\"userConfig\":{\"fieldLabel\":\"绑定组件\",\"width\":500,\"anchor\":\"100%\",\"id\":\"bindCmp\",\"store\":\"cmpStore\",\"displayField\":\"cmpId\",\"valueField\":\"cmpId\",\"change\":\"bindCmp_change\",\"cls\":\"code\"}},{\"cid\":\"vmdCombo\",\"id\":\"bindValue\",\"layoutConfig\":{},\"userConfig\":{\"fieldLabel\":\"绑定属性\",\"width\":500,\"anchor\":\"100%\",\"id\":\"bindValue\",\"displayField\":\"name\",\"store\":\"cmpPropStore\",\"valueField\":\"name\",\"cls\":\"code\",\"change\":\"bindValue_change\"}},{\"cid\":\"checkbox\",\"id\":\"isPublic\",\"layoutConfig\":{},\"userConfig\":{\"fieldLabel\":\"公共属性\",\"boxLabel\":\"\",\"checked\":true,\"id\":\"isPublic\"}},{\"cid\":\"radiogroup\",\"id\":\"cmptype\",\"layoutConfig\":{},\"userConfig\":{\"fieldLabel\":\"组件类型\",\"width\":\"\",\"height\":29,\"id\":\"cmptype\",\"change\":\"cmptype_change\",\"afterrender\":\"cmptype_afterrender\"},\"cn\":[{\"cid\":\"radio\",\"id\":\"hwRadio\",\"layoutConfig\":{},\"userConfig\":{\"boxLabel\":\"文本框\",\"fieldLabel\":\"\",\"checked\":false,\"inputValue\":\"string\"}},{\"cid\":\"radio\",\"id\":\"hwRadio1\",\"layoutConfig\":{},\"userConfig\":{\"fieldLabel\":\"\",\"boxLabel\":\"数字框\",\"inputValue\":\"number\"}},{\"cid\":\"radio\",\"id\":\"hwRadio3\",\"layoutConfig\":{},\"userConfig\":{\"fieldLabel\":\"\",\"boxLabel\":\"布尔组件\",\"inputValue\":\"boolean\"}},{\"cid\":\"radio\",\"id\":\"hwRadio2\",\"layoutConfig\":{},\"userConfig\":{\"fieldLabel\":\"\",\"boxLabel\":\"下拉框\",\"inputValue\":\"combo\"}}]},{\"cid\":\"panel\",\"id\":\"combo_settings\",\"layoutConfig\":{},\"userConfig\":{\"height\":290,\"layout\":\"absolute\",\"id\":\"combo_settings\",\"header\":true,\"autoHeight\":false,\"hidden\":false,\"title\":\"下拉框属性设置\"},\"cn\":[{\"cid\":\"checkbox\",\"id\":\"combo_multi\",\"layoutConfig\":{},\"userConfig\":{\"x\":10,\"y\":10,\"boxLabel\":\"下拉多选\",\"id\":\"combo_multi\"}},{\"cid\":\"label\",\"id\":\"label\",\"layoutConfig\":{},\"userConfig\":{\"text\":\"下拉框内容(静态json结构)\",\"height\":20,\"autoHeight\":false,\"x\":10,\"y\":40,\"cls\":\"font-14\"}},{\"cid\":\"vmdAceEditor\",\"id\":\"como_dataset\",\"layoutConfig\":{},\"userConfig\":{\"width\":\"\",\"height\":190,\"style\":\"border: 1px solid #eee;\",\"anchor\":\"100%\",\"x\":10,\"y\":60,\"id\":\"como_dataset\"}},{\"cid\":\"label\",\"id\":\"label1\",\"layoutConfig\":{},\"userConfig\":{\"x\":190,\"y\":40,\"text\":\"[{text:'dispalytext'},value:'dispalyvalue']\",\"style\":\"color: red;    font-weight: bold\",\"cls\":\"font-14\"}}]}]}]},{\"cid\":\"panel\",\"id\":\"panel2\",\"layoutConfig\":{},\"userConfig\":{\"region\":\"west\",\"width\":179,\"style\":\"\",\"split\":true,\"animFloat\":false,\"collapsible\":false,\"frame\":false,\"hideCollapseTool\":false,\"floatable\":true,\"collapseMode\":\"mini\",\"hidden\":false,\"cmargins\":\"\",\"border\":true,\"header\":false,\"layout\":\"border\"},\"cn\":[{\"cid\":\"panel\",\"id\":\"panel4\",\"layoutConfig\":{},\"userConfig\":{\"region\":\"center\",\"header\":false,\"border\":false,\"layout\":\"fit\"},\"cn\":[{\"cid\":\"vmdDataView\",\"id\":\"hwDataView\",\"layoutConfig\":{},\"userConfig\":{\"tpl\":\"<ul>    <tpl for=\\\".\\\">        <li class=\\\"info\\\" style=\\\"line-height:30px;padding-left:5px\\\">            <h4>{id}{[values.desc?('('+values.desc+')'):'']}</h4> </li>    </tpl></ul>\",\"data\":\"var data = [{    \\\"id\\\": 'ksrq',    \\\"desc\\\": \\\"开始日期\\\",}, {    \\\"id\\\": 'jsrq',    \\\"desc\\\": \\\"结束日期\\\"}];return data;\",\"width\":\"\",\"afterrender\":\"hwDataView_afterrender\",\"store\":\"\",\"click\":\"hwDataView_click\",\"cls\":\"code\"}}]},{\"cid\":\"panel\",\"id\":\"panel5\",\"layoutConfig\":{\"align\":\"middle\",\"pack\":\"center\"},\"userConfig\":{\"region\":\"north\",\"unstyled\":false,\"frame\":false,\"border\":false,\"header\":false,\"height\":43,\"layout\":\"hbox\",\"bodyStyle\":\"border-bottom: 1px solid #99bbe8\"},\"cn\":[{\"cid\":\"vmdButton\",\"id\":\"button2\",\"layoutConfig\":{},\"userConfig\":{\"margins\":\"0 10\",\"text\":\"新建\",\"icon\":\"edit-outline\",\"click\":\"button2_click\"}},{\"cid\":\"vmdButton\",\"id\":\"button3\",\"layoutConfig\":{},\"userConfig\":{\"text\":\"删除\",\"type\":\"(none)\",\"icon\":\"delete\",\"click\":\"button3_click\"}}]}]},{\"cid\":\"panel\",\"id\":\"panel3\",\"layoutConfig\":{\"align\":\"middle\",\"pack\":\"center\"},\"userConfig\":{\"region\":\"south\",\"border\":false,\"header\":false,\"height\":40,\"layout\":\"hbox\",\"collapseMode\":\"standard\",\"frame\":false},\"cn\":[{\"cid\":\"vmdButton\",\"id\":\"button\",\"layoutConfig\":{},\"userConfig\":{\"margins\":\"0 20\",\"text\":\"保存\",\"type\":\"primary\",\"width\":80,\"click\":\"button_click\"}},{\"cid\":\"vmdButton\",\"id\":\"button1\",\"layoutConfig\":{},\"userConfig\":{\"text\":\"关闭\",\"width\":80,\"click\":\"button1_click\"}}]}]}]},{\"cid\":\"vmddataset\",\"id\":\"数据集\",\"layoutConfig\":{},\"userConfig\":{}},{\"cid\":\"vmdvariable\",\"id\":\"变量\",\"layoutConfig\":{},\"userConfig\":{}},{\"cid\":\"vmdsubviewport\",\"id\":\"SubView_Window\",\"layoutConfig\":{},\"userConfig\":{}}]}","vmdevents":"//默认追加状态\nvar editorStatus = 'new';\n\nvar propStore = new Ext.data.JsonStore({\n    proxy: new Ext.data.MemoryProxy(),\n    fields: ['id', 'zhname', 'bindCmp', 'bindValue', 'isPublic', 'desc', 'uxcid', 'group', 'cmptype', 'cmpsettings']\n});\nvar cmpStore = new Ext.data.JsonStore({\n    proxy: new Ext.data.MemoryProxy(),\n    fields: ['cmpId']\n});\nvar cmpPropStore = new Ext.data.JsonStore({\n    proxy: new Ext.data.MemoryProxy(),\n    fields: ['name']\n});\nvar reqPropId = getUrlParam('id');\n\n//获取属性节点的数据\nvar data = parent.xds.vmd.getPropsData();\npropStore.loadData(data);\n\n//获取组件树\nvar nodeList = [];\nvar getAllCmpsByNode = function(node, nodeList) {\n\n    Ext.each(node.childNodes, function(item) {\n        var obj = {\n            cmpId: item.id\n        };\n        nodeList.push(obj);\n        getAllCmpsByNode(item, nodeList);\n    })\n\n}\n\nvar viewRoot = parent.xds.inspector.root.childNodes[0];\ngetAllCmpsByNode(viewRoot, nodeList)\n\ncmpStore.loadData(nodeList);\nvar refreshPropNode = function() {\n\n    var data = Ext.pluck(propStore.data.items, 'data');\n    parent.xds.vmd.addPropNodes(data);\n\n}\n\nfunction button1_click(sender) {\n\n    parent.propWin.close()\n}\n\nfunction hwDataView_afterrender(sender) {\n    //属性列表加载\n    sender.setStore(propStore)\n    //选中传来的属性\n\n    if(reqPropId) {\n        var num = propStore.find('id', reqPropId)\n        if(num != -1) {\n            // sender.select(num)\n            var node = this.getNode(num);\n            Ext.defer(function() {\n                node.click()\n            }, 50)\n\n        }\n\n    }\n}\n\nfunction button2_click(sender) {\n    //新建\n\n    editorStatus = 'new';\n    hwDataView.clearSelections()\n    var rec = new propStore.recordType({\n        id: '',\n        zhname: '',\n        bindCmp: '',\n        bindValue: '',\n        desc: '',\n        isPublic: true,\n        cmptype: 'string',\n        cmpsettings: ''\n    });\n\n    cmptype.hide();\n    combo_settings.hide();\n    MyForm.form.loadRecord(rec);\n\n}\n\nfunction button3_click(sender) {\n    //删除\n\n    var selectData = hwDataView.getSelectedRecords();\n    if(selectData.length == 0) {\n        Ext.Msg.alert('提示', '请选择要删除的属性！')\n        return\n    }\n    Ext.Msg.confirm('提示', '你确定要删除属性吗?', function(type) {\n\n        if(type == 'yes') {\n            propStore.remove(selectData)\n            refreshPropNode()\n            vmd.alert('提示', '删除成功！');\n\n        }\n    })\n}\n\nfunction setDefinePropSettings(reqPropId) {\n    if(!reqPropId) {\n        cmptype.hide();\n        combo_settings.hide()\n        return\n    }\n    var num = propStore.find('id', reqPropId)\n    var rec = propStore.getAt(num);\n    var _cmptype, _cmpsettings, cmpsettings;\n    if(rec) {\n        _cmptype = rec.get('cmptype');\n        _cmpsettings = rec.get('cmpsettings');\n        cmpsettings = Ext.decode(_cmpsettings);\n        if(_cmptype) {\n\n            cmptype.setValue(_cmptype);\n            var index = cmpPropStore.find('name', rec.get('bindValue'));\n            if(_cmptype == 'combo') {\n\n\n                if(index != -1) {\n                    cmptype.hide();\n                    cmptype.setValue('string');\n                    combo_settings.hide();\n                    combo_multi.setValue(false);\n                    como_dataset.setValue('');\n                } else {\n                    cmptype.show();\n                    combo_settings.show()\n                    combo_multi.setValue(cmpsettings.isMulti);\n                    como_dataset.setValue(cmpsettings.data)\n\n                }\n\n            } else {\n\n                if(index != -1) {\n                    cmptype.hide();\n                } else {\n                    cmptype.show();\n                }\n\n            }\n        } else {\n\n\n            cmptype.setValue(\"string\")\n        }\n\n    }\n\n}\n\n\nfunction MyViewport_afterrender(sender) {\n    //数据加载完成？\n    parent.propWin && parent.propWin.loading.hide();\n\n    //自定义属性赋值\n    setDefinePropSettings(reqPropId)\n\n\n}\n\n\nfunction button_click(sender) {\n    //保存\n    var form = MyForm.getForm();\n    var values = form.getValues();\n    var id = values.id;\n    var num;\n\n    var getCmpCid = function(cmpId) {\n        var cid = \"\";\n        var cmp = parent.xds.inspector.nodeHash[cmpId];\n        if(cmp) {\n            cid = cmp.component.cid;\n        }\n        return cid;\n    }\n    if(form.isValid()) {\n        values.bindCmp = Ext.getCmp('bindCmp').getValue();\n        values.bindValue = Ext.getCmp('bindValue').getValue() || Ext.getCmp('bindValue').getText();\n        values.uxcid = getCmpCid(values.bindCmp);\n\n        values.cmptype = cmptype.getValue();\n        var cmpsettings = {\n            isMulti: combo_multi.getValue(),\n            data: como_dataset.getValue()\n        }\n        values.cmpsettings = Ext.encode(cmpsettings);\n        delete values.dhxcombo\n        delete values.dhxcombo_new_value\n\n        if(editorStatus == 'new') {\n            num = propStore.find('id', id)\n            var rec = new propStore.recordType(values);\n            if(num != -1) {\n                Ext.Msg.alert('提示', 'ID为' + id + '的属性已存在，请修改属性ID！');\n                return;\n            }\n            propStore.add(rec);\n            // vmd.alert('提示', '添加成功！');\n\n        } else {\n            //编辑状态\n\n\n            num = propStore.find('id', hwDataView.activeId)\n            // rec.store=propStore;\n            var rec = propStore.getAt(num);\n\n            propStore.reader.update(rec, values)\n\n            //propStore.commitChanges()\n            // vmd.alert('提示', '修改成功！');\n            //propStore.commitChanges()\n        }\n        refreshPropNode()\n        var myMask = new Ext.LoadMask(Ext.getBody(), {\n            msg: \"正在保存中,请稍后...\",\n            msgCls: 'z-index:70000;'\n        });\n        myMask.show();\n\n        parent.xds && parent.xds.project.save(function() {\n\n            myMask.hide();\n        });\n\n\n    } else {\n        Ext.Msg.alert('提示', '请检查必填项！')\n\n    }\n}\n\nfunction hwDataView_click(sender, index, node, e) {\n\n    editorStatus = 'edit';\n    var data = sender.getRecord(node).data;\n    var rec = new propStore.recordType(data);\n    sender.activeId = data.id;\n    MyForm.form.loadRecord(rec);\n    setDefinePropSettings(sender.activeId)\n\n}\n\nfunction bindCmp_change(sender) {\n    //绑定组件的属性\n\n    var val = sender.getValue();\n    var cmp = parent.xds.inspector.nodeHash[val];\n    if(!cmp) return;\n    var configs = cmp.component.configs.items;\n    //过滤事件\n    var propArr = [];\n    Ext.each(configs, function(item) {\n        if(item.group != '事件') {\n            var obj = {\n                name: item.name\n            }\n            propArr.push(obj);\n        }\n\n\n    })\n    cmpPropStore.loadData(propArr);\n\n}\n\nfunction bindValue_change(sender) {\n\n    //判断输入的属性是不是在下拉列表中存在\n\n    var text = sender.getText();\n    var index;\n    if(text) {\n\n        index = cmpPropStore.find('name', text);\n        if(index < 0) {\n\n            cmptype.show();\n            if(cmptype.getValue() == 'combo') combo_settings.show();\n\n        } else {\n            cmptype.hide();\n            combo_settings.hide();\n            combo_multi.setValue(false);\n            como_dataset.setValue('')\n\n\n        }\n    }\n\n}\n\nfunction MyViewport_beforerender(sender) {\n    cmptype.hidden = true;\n    combo_settings.hidden = true;\n\n}\n\nfunction cmptype_change(sender, checked) {\n\n    var val = sender.getValue()\n    if(val == 'combo') {\n        combo_settings.show();\n    } else {\n        combo_settings.hide();\n    }\n}\n\n\n\nfunction cmptype_afterrender(sender) {\n\n}","vmdcss":"li.info h4 {\n    cursor: pointer\n}\n.code{\n    \n    font:14px/normal 'Consolas';\n}\n\n.vmd-dataview ul li.info-hover {\n    background-color: #CEEBFE;\n\n}\n\n.vmd-dataview ul li.x-view-selected {\n    background-color:#20a0ff ;\n    color: #fff;\n}","vmdprops":"\"\"","type":"module","vmdresource":"{\"components\":[{\"cid\":\"vmdrescsss\",\"layoutConfig\":{},\"userConfig\":{}},{\"cid\":\"vmdresjss\",\"layoutConfig\":{},\"userConfig\":{}},{\"cid\":\"vmdresimgs\",\"layoutConfig\":{},\"userConfig\":{}}]}"}