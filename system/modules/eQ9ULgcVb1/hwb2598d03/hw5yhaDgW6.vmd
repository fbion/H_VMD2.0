{"vmdversion":"2.0.3","vmdlayout":"{\"components\":[{\"cid\":\"viewport\",\"id\":\"MyViewport\",\"layoutConfig\":{},\"userConfig\":{\"layout\":\"border\",\"afterrender\":\"MyViewport_afterrender\"},\"cn\":[{\"cid\":\"panel\",\"id\":\"panel2\",\"layoutConfig\":{},\"userConfig\":{\"region\":\"north\",\"height\":29,\"border\":false,\"header\":false,\"layout\":\"absolute\",\"style\":\"background-color: lightblue;\",\"bodyStyle\":\"background-color: lightblue;\"},\"cn\":[{\"cid\":\"label\",\"id\":\"label\",\"layoutConfig\":{},\"userConfig\":{\"text\":\"请选择要注册的子系统：\",\"x\":5,\"y\":5}}]},{\"cid\":\"panel\",\"id\":\"panel\",\"layoutConfig\":{},\"userConfig\":{\"region\":\"center\",\"layout\":\"border\",\"header\":false,\"border\":false},\"cn\":[{\"cid\":\"panel\",\"id\":\"panel3\",\"layoutConfig\":{},\"userConfig\":{\"border\":true,\"header\":false,\"region\":\"center\",\"height\":619,\"layout\":\"anchor\"},\"cn\":[{\"cid\":\"container\",\"id\":\"div1\",\"layoutConfig\":{},\"userConfig\":{\"anchor\":\"100% 50%\",\"layout\":\"fit\",\"style\":\"padding-bottom: 8px;\"},\"cn\":[{\"cid\":\"vmdTree\",\"id\":\"hwTree\",\"layoutConfig\":{},\"userConfig\":{\"style\":\"margin-left: 5px;    margin-top: 5px;    margin-bottom: 10px;    margin-right: 10px;    padding-bottom: 10px;\",\"afterrender\":\"hwTree_afterrender\",\"region\":\"center\",\"columnWidth\":1,\"anchor\":\"100% 60%\"}}]},{\"cid\":\"container\",\"id\":\"div3\",\"layoutConfig\":{},\"userConfig\":{\"anchor\":\"100% 50%\",\"layout\":\"border\"},\"cn\":[{\"cid\":\"container\",\"id\":\"div4\",\"layoutConfig\":{},\"userConfig\":{\"region\":\"north\",\"border\":false,\"layout\":\"column\",\"height\":38},\"cn\":[{\"cid\":\"label\",\"id\":\"label2\",\"layoutConfig\":{},\"userConfig\":{\"x\":8,\"y\":20,\"text\":\"数据服务地址:\"}},{\"cid\":\"textfield\",\"id\":\"txt_dataserverip\",\"layoutConfig\":{},\"userConfig\":{\"x\":90,\"y\":10,\"width\":180,\"columnWidth\":0.5,\"id\":\"txt_dataserverip\"}},{\"cid\":\"label\",\"id\":\"label3\",\"layoutConfig\":{},\"userConfig\":{\"x\":310,\"y\":20,\"text\":\"工作流地址：\"}},{\"cid\":\"textfield\",\"id\":\"txt_workflowip\",\"layoutConfig\":{},\"userConfig\":{\"x\":390,\"y\":10,\"width\":180,\"columnWidth\":0.5,\"id\":\"txt_workflowip\"}}]},{\"cid\":\"container\",\"id\":\"div5\",\"layoutConfig\":{},\"userConfig\":{\"region\":\"center\",\"layout\":\"border\"},\"cn\":[{\"cid\":\"container\",\"id\":\"div2\",\"layoutConfig\":{},\"userConfig\":{\"anchor\":\"100% 10%\",\"border\":false,\"layout\":\"absolute\",\"region\":\"north\",\"height\":29,\"style\":\"background-color: lightblue;\"},\"cn\":[{\"cid\":\"label\",\"id\":\"title\",\"layoutConfig\":{},\"userConfig\":{\"anchor\":\"\",\"height\":20,\"id\":\"title\",\"text\":\"   设置资源服务器：\",\"autoHeight\":false,\"width\":100,\"y\":5,\"x\":5,\"autoWidth\":true}}]},{\"cid\":\"container\",\"id\":\"DivResource\",\"layoutConfig\":{},\"userConfig\":{\"anchor\":\"100% 30%\",\"id\":\"DivResource\",\"layout\":\"fit\",\"region\":\"center\"},\"cn\":[{\"cid\":\"panel\",\"id\":\"palResource\",\"layoutConfig\":{},\"userConfig\":{\"border\":false,\"header\":false,\"id\":\"palResource\",\"layout\":\"anchor\",\"autoScroll\":true},\"cn\":[{\"cid\":\"vmd.ux.PublishResource\",\"id\":\"PublishResource\",\"layoutConfig\":{},\"userConfig\":{\"anchor\":\"100% \"}}]}]}]}]}]},{\"cid\":\"panel\",\"id\":\"panel4\",\"layoutConfig\":{},\"userConfig\":{\"region\":\"south\",\"header\":false,\"border\":false,\"height\":50,\"layout\":\"absolute\"},\"cn\":[{\"cid\":\"label\",\"id\":\"label1\",\"layoutConfig\":{},\"userConfig\":{\"text\":\"虚拟目录：\",\"x\":10,\"y\":10}},{\"cid\":\"textfield\",\"id\":\"MyField\",\"layoutConfig\":{},\"userConfig\":{\"x\":80,\"y\":10,\"width\":240}}]}]},{\"cid\":\"panel\",\"id\":\"panel1\",\"layoutConfig\":{\"align\":\"top\",\"pack\":\"center\"},\"userConfig\":{\"region\":\"south\",\"header\":false,\"border\":false,\"height\":40,\"layout\":\"hbox\"},\"cn\":[{\"cid\":\"vmdButton\",\"id\":\"button\",\"layoutConfig\":{},\"userConfig\":{\"region\":\"west\",\"text\":\"注册\",\"type\":\"info\",\"size\":\"small\",\"click\":\"button_click\"}},{\"cid\":\"container\",\"id\":\"div\",\"layoutConfig\":{},\"userConfig\":{\"width\":100,\"border\":false}},{\"cid\":\"vmdButton\",\"id\":\"button1\",\"layoutConfig\":{},\"userConfig\":{\"text\":\"取消\",\"click\":\"button1_click\"}}]}]},{\"cid\":\"vmddataset\",\"id\":\"数据集\",\"layoutConfig\":{},\"userConfig\":{}},{\"cid\":\"vmdvariable\",\"id\":\"变量\",\"layoutConfig\":{},\"userConfig\":{}}]}","vmdevents":"var workspaceid = getUrlParam(workspaceid)\nif(workspaceid) {\n    vmd.core.getWorkSpaceServer(workspaceid);\n}\n\nfunction hwTree_afterrender(sender) {\n    //初始化数据\n    myMask = new Ext.LoadMask(Ext.getCmp(\"hwTree\").el, {\n        msg: \"数据加载中,请稍后...\",\n        msgCls: 'z-index:10000;'\n    });\n    myMask.show();\n    var mytree = hwTree;\n    mytree.deleteChildItems(0);\n    mytree.loadJSONObject({\n        id: 0,\n        text: \"我的项目\",\n        item: []\n    });\n    //mytree.enableRadioButtons(true)\n    //mytree.enableSingleRadioMode(true)\n    hwDas.ajax({\n        das: {\n            idedas: true\n        },\n        url: \"zjsjyjcywgl系统/pt/hqzxt\",\n        type: 'get',\n        timeout: 5000,\n        params: {},\n        success: function(result) {\n            var datajson = result.data[0].datas;\n            for(var i = 0; i < datajson.length; i++) {\n                mytree.insertNewChild(0, datajson[i].subsysid, datajson[i].subsysname);\n                mytree.setItemImage2(datajson[i].subsysid, \"tree/model.png\", \"tree/model.png\", \"tree/model.png\");\n            }\n            myMask.hide();\n        },\n        error: function(msg) {\n            myMask.hide();\n            Ext.Msg.alert(\"提示\", \"获取平台子系统信息失败\", function() {})\n        }\n    })\n}\n\nfunction button_click(sender) {\n    var listPublishResourceServers = [];\n    var objlistResourceNameIP = {};\n    for(var i = 0; i < listPublishResourceComps.length; i++) {\n        var Serversinfo = listPublishResourceComps[i].getText();\n        listPublishResourceServers.push(Serversinfo);\n    }\n\n    for(var i = 0; i < listResourceNameIP.length; i++) {\n        for(var j = 0; j < listPublishResourceServers.length; j++) {\n            if(listResourceNameIP[i].oldip == listPublishResourceServers[j].oldIP) {\n                listResourceNameIP[i].newip = listPublishResourceServers[j].newIP || listPublishResourceServers[j].oldIP\n                objlistResourceNameIP[listResourceNameIP[i].name] = \"http://\" + listResourceNameIP[i].newip + \"/resource\";\n                break;\n            }\n        }\n    }\n\n    var mytree = hwTree;\n    //将节点信息传递到设计页面\n    var selId = mytree.getSelectedItemId();\n    var myPtree = parent.hwTree;\n    var selPId = parent.hwTree.getSelectedItemId();\n    var selNode = myPtree.itemObj[selPId];\n    var proId = selNode.projectId;\n    var data = [{\n        subsysid: selId,\n        moduleguid: selNode.id,\n        modulename: selNode.text,\n        moudelinfo: selNode.remark,\n        moduletype: 1,\n        startname: \"/release\" + selNode.path + \".html\",\n        enable: 1,\n        args: \"\"\n    }];\n    hwDas.ajax({\n        das: {\n            idedas: true\n        },\n        url: \"zjsjyjcywgl系统/pt/zcmk\",\n        type: \"save\",\n        timeout: 5000,\n        data: data,\n        success: function(result) {\n            myMask.msg = \"正在发布页面！\";\n            var path = vmd.core.getVirtualPath() + \"modules\" + selNode.path + \"_r.html\";\n            var releasePath = \"release\" + selNode.path + \".html\";\n            var virtualPath = \"\";\n            if(MyField.getValue() != \"\")\n                virtualPath = \"/\" + MyField.getValue();\n            vmd.core.createReleaseHtml(path, releasePath, virtualPath, function() {\n                myMask.hide();\n                Ext.Msg.alert(\"提示\", \"注册模块信息成功\", function() {\n                    parent.openWinFrom.hide();\n                })\n            }, objlistResourceNameIP,selNode.projectId);\n            hwDas.copy(\"vmd\", \"modules/\" + proId + \"/img\", \"release/\" + proId + \"/img\", function() {}, function() {});\n            hwDas.copy(\"vmd\", \"modules/\" + proId + \"/css\", \"release/\" + proId + \"/css\", function() {}, function() {});\n            hwDas.copy(\"vmd\", \"modules/\" + proId + \"/js\", \"release/\" + proId + \"/js\", function() {}, function() {});\n        },\n        error: function(msg) {\n            myMask.hide();\n            Ext.Msg.alert(\"提示\", \"注册模块信息失败\", function() {})\n            parent.openWinFrom.hide();\n        }\n    })\n\n    // 保存配置信息\n    var saveVmdConfig = function(filename, bodyStr) {\n        Ext.Ajax.request({\n            url: vmd.vmdUploadPath + 'FileService',\n            timeout: 5000,\n            success: function(result) {},\n            failure: function(result) {\n                Ext.Msg.alert('错误', '网络超时，保存项目配置信息失败！')\n                myMask.hide()\n            },\n            headers: {\n                FileName: 'release/' + selNode.projectId + \"/\" + filename,\n            },\n            params: {\n                body: bodyStr\n            }\n        })\n    }\n\n    var bodyStr = 'vmd.workspace={\\n';\n    bodyStr += \"dataServiceIp: \\\"\" +( txt_dataserverip.getValue() || vmd.workspace.dataServiceIp) + \"\\\",\\n\";\n    bodyStr += \"workflowIp: \\\"\" + (txt_workflowip.getValue() || vmd.workspace.workflowIp) + \"\\\"\\n\";\n    bodyStr += '}';\n    //处理项目的配置文件\n    saveVmdConfig(\"config.js\", bodyStr);\n\n}\n\nfunction button1_click(sender) {\n\n    parent.openWinFrom.hide();\n\n}\n\nvar listPublishResourceComps = []; //记录动态添加的组件列表。\nvar listResourceIP = []; //记录当前模块所有的资源服务器地址\nvar listResourceNameIP = []; //记录资源的名称和ip信息\n\nfunction MyViewport_afterrender(sender) {\n    var vp = vmd.core.getVirtualPath().replace(window.location.origin + \"/\", \"\");\n    if(vp.lastIndexOf(\"/\") > 0)\n        MyField.setValue(vp.substr(0, vp.lastIndexOf(\"/\")));\n    else\n        MyField.setValue(\"\");\n    //递归添加地址对应组件，并设置内容\n    hwDas.get(\"DataServiceWorkSpace/projectInfo/getResSerByModuleId\", {}, {\n        module_id: parent.hwTree.getSelectedItemId() //\"hwfc1422a6\" //\n    }, function(result) {\n        if(result.data && result.data.length > 0 && result.data[0].datas && result.data[0].datas.length > 0) {\n            for(var i = 0; i < result.data[0].datas.length; i++) {\n                if(listResourceIP.indexOf(result.data[0].datas[i].resource_server_ip) < 0) {\n                    listResourceIP.push(result.data[0].datas[i].resource_server_ip);\n                    var ipresource = new vmd.ux.PublishResource({\n                        id: \"PublishResource\" + i,\n                        anchor: \"100% \"\n                    });\n                    palResource.add(ipresource)\n                    ipresource.setText(result.data[0].datas[i].resource_server_ip, \"\", result.data[0].datas[i].fullname.replace('&&', '/'));\n                    listPublishResourceComps.push(ipresource)\n                }\n                listResourceNameIP.push({\n                    name: result.data[0].datas[i].fullname,\n                    oldip: result.data[0].datas[i].resource_server_ip,\n                    newip: \"\"\n                })\n            }\n            PublishResource.hide();\n            palResource.onBodyResize()\n        }\n    }, function() {});\n}","vmdcss":"","vmdprops":"\"\"","type":"module","vmdresource":"{\"components\":[{\"cid\":\"vmdrescsss\",\"layoutConfig\":{},\"userConfig\":{}},{\"cid\":\"vmdresjss\",\"layoutConfig\":{},\"userConfig\":{}},{\"cid\":\"vmdresimgs\",\"layoutConfig\":{},\"userConfig\":{}}]}"}