{"vmdlayout":"{\"components\":[{\"cid\":\"viewport\",\"id\":\"MyViewport\",\"layoutConfig\":{},\"userConfig\":{\"layout\":\"auto\",\"afterrender\":\"MyViewport_afterrender\"},\"cn\":[{\"cid\":\"panel\",\"id\":\"MyPanel\",\"layoutConfig\":{},\"userConfig\":{\"x\":0,\"y\":0,\"height\":650,\"layout\":\"absolute\",\"width\":600,\"border\":false,\"header\":false,\"region\":\"west\"},\"cn\":[{\"cid\":\"label\",\"id\":\"MyLabel8\",\"layoutConfig\":{},\"userConfig\":{\"x\":40,\"y\":360,\"text\":\"路径：\"}},{\"cid\":\"vmdButton\",\"id\":\"button1\",\"layoutConfig\":{},\"userConfig\":{\"x\":230,\"y\":480,\"type\":\"info\",\"text\":\"编辑\",\"size\":\"large\",\"click\":\"button1_click\"}},{\"cid\":\"vmdButton\",\"id\":\"button\",\"layoutConfig\":{},\"userConfig\":{\"x\":110,\"y\":480,\"size\":\"large\",\"type\":\"info\",\"text\":\"保存\",\"click\":\"button_click\"}},{\"cid\":\"textarea\",\"id\":\"MyField7\",\"layoutConfig\":{},\"userConfig\":{\"x\":110,\"y\":400,\"width\":460,\"id\":\"MyField7\",\"allowBlank\":true,\"beforerender\":\"MyField7_beforerender\"}},{\"cid\":\"textfield\",\"id\":\"MyField5\",\"layoutConfig\":{},\"userConfig\":{\"x\":110,\"y\":320,\"width\":460,\"disabled\":true}},{\"cid\":\"textfield\",\"id\":\"MyField4\",\"layoutConfig\":{},\"userConfig\":{\"x\":110,\"y\":280,\"width\":460,\"disabled\":true}},{\"cid\":\"textfield\",\"id\":\"MyField3\",\"layoutConfig\":{},\"userConfig\":{\"x\":110,\"y\":240,\"width\":460,\"disabled\":true}},{\"cid\":\"textfield\",\"id\":\"MyField2\",\"layoutConfig\":{},\"userConfig\":{\"x\":110,\"y\":200,\"width\":460,\"disabled\":true}},{\"cid\":\"textfield\",\"id\":\"MyField1\",\"layoutConfig\":{},\"userConfig\":{\"x\":110,\"y\":120,\"width\":460,\"invalidText\":\"\",\"allowBlank\":false,\"beforerender\":\"MyField1_beforerender\"}},{\"cid\":\"textfield\",\"id\":\"MyField\",\"layoutConfig\":{},\"userConfig\":{\"x\":110,\"y\":80,\"width\":460,\"disabled\":true}},{\"cid\":\"label\",\"id\":\"MyLabel7\",\"layoutConfig\":{},\"userConfig\":{\"x\":40,\"y\":400,\"text\":\"说明：\",\"height\":20}},{\"cid\":\"label\",\"id\":\"MyLabel6\",\"layoutConfig\":{},\"userConfig\":{\"x\":40,\"y\":320,\"text\":\"修改时间：\",\"height\":20}},{\"cid\":\"label\",\"id\":\"MyLabel5\",\"layoutConfig\":{},\"userConfig\":{\"x\":40,\"y\":280,\"text\":\"修改人：\"}},{\"cid\":\"label\",\"id\":\"MyLabel4\",\"layoutConfig\":{},\"userConfig\":{\"x\":40,\"y\":240,\"text\":\"创建时间：\"}},{\"cid\":\"label\",\"id\":\"MyLabel3\",\"layoutConfig\":{},\"userConfig\":{\"x\":40,\"y\":200,\"text\":\"创建人：\",\"height\":20}},{\"cid\":\"label\",\"id\":\"MyLabel2\",\"layoutConfig\":{},\"userConfig\":{\"x\":40,\"y\":120,\"text\":\"名称：\"}},{\"cid\":\"label\",\"id\":\"MyLabel1\",\"layoutConfig\":{},\"userConfig\":{\"x\":40,\"y\":80,\"text\":\"编码：\"}},{\"cid\":\"label\",\"id\":\"MyLabel\",\"layoutConfig\":{},\"userConfig\":{\"x\":40,\"y\":30,\"text\":\"基础信息\",\"style\":\"color: blue;    font-size: 20px;\"}},{\"cid\":\"checkbox\",\"id\":\"hwCheckbox\",\"layoutConfig\":{},\"userConfig\":{\"x\":110,\"y\":155,\"boxLabel\":\"\"}},{\"cid\":\"label\",\"id\":\"label1\",\"layoutConfig\":{},\"userConfig\":{\"x\":40,\"y\":160,\"text\":\"共享：\",\"height\":20}},{\"cid\":\"textfield\",\"id\":\"hwText_path\",\"layoutConfig\":{},\"userConfig\":{\"x\":110,\"y\":360,\"width\":460,\"id\":\"hwText_path\"}}]}]},{\"cid\":\"vmddataset\",\"id\":\"数据集\",\"layoutConfig\":{},\"userConfig\":{}},{\"cid\":\"vmdvariable\",\"id\":\"变量\",\"layoutConfig\":{},\"userConfig\":{}}]}","vmdevents":"function MyViewport_afterrender(sender) {\n    debugger\n    var tree = parent.hwTree;\n    var newnode = tree.newnode;\n    if(newnode) {\n        MyField.setValue(newGuid(32));\n        MyField1.setValue(\"\");\n        MyField2.setValue(Ext.util.Cookies.get('userName'));\n        MyField3.setValue(Ext.Date.dateFormat(new Date(), 'Y-m-d H:i:s'));\n        MyField4.setValue(\"\");\n        MyField5.setValue(\"\");\n        MyField7.setValue(\"\");\n        hwText_path.setValue(\"\");\n    } else {\n        var selId = tree.getSelectedItemId();\n        var selnode = tree.itemObj[selId];\n        hwCheckbox.setValue(selnode.shared == \"1\" ? true : false);\n        MyField.setValue(selnode.code);\n        MyField1.setValue(selnode.text);\n        MyField1.setDisabled(true);\n        MyField2.setValue(selnode.createuser);\n        MyField3.setValue(selnode.createtime);\n        MyField4.setValue(selnode.changeuser);\n        MyField5.setValue(selnode.changetime);\n        MyField7.setValue(selnode.remark);\n        hwText_path.setValue(selnode.path);\n    }\n}\n\nfunction button_click(sender) {\n    editId = \"\";\n    saveModelInfo(function() {\n        Ext.Msg.alert(\"提示\", \"保存成功！\")\n    });\n}\neditId = newGuid(8);\n//模块保存按钮操作\nfunction saveModelInfo(callback) {\n    var mytree = parent.hwTree;\n    var newnode = mytree.newnode;\n    var selId = mytree.getSelectedItemId();\n    var selnode = mytree.itemObj[selId];\n    var selnodepath = selnode.path;\n    var id = newGuid(10);\n    var category_id = selId;\n    var Project_id = selnode.projectId;\n    if(selnode.isRoot) {\n        category_id = \"0\";\n    }\n    var codeid = MyField.getValue();\n    var name = MyField1.getValue();\n    var remark = MyField7.getValue();\n\n    var type = \"0\";\n    if(selnode.isCss)\n        type = \"5\"\n    if(selnode.isJs)\n        type = \"1\"\n\n    //var vmdpath = mytree.getp\n    //编辑\n    if(!newnode) {\n        MyField4.setValue(Ext.util.Cookies.get('userName'));\n        MyField5.setValue(Ext.Date.dateFormat(new Date(), 'Y-m-d H:i:s'))\n            //更新模块基础信息\n        hwDas.ajax({\n            das: {\n                idedas: true\n            },\n            url: \"CDEServcie/resource/zygl\",\n            type: 'put',\n            timeout: 5000,\n            params: {},\n            headers: {\n                Ecylogin: Ext.util.Cookies.get('EcyLogin') || Ext.util.Cookies.get('ecyLogin')\n            },\n            data: [{\n                editid: editId,\n                id: selId,\n                // code: selnode.code,\n                // type: '4',\n                // name: name,\n                remark: remark,\n                version: \"1\",\n                // project_id: Project_id,\n                shared: hwCheckbox.getValue() ? \"1\" : \"0\",\n                readdate: Ext.Date.dateFormat(new Date(), 'Y-m-d H:i:s'),\n                //filepath: '/components/vmd/' + name + '.vmd',\n                row_changed_by: MyField4.getValue(),\n                row_changed_date: MyField5.getValue(),\n                edit_reason: \"修改基础信息\"\n            }],\n            success: function(result) {\n                selnode.text = name;\n                selnode.changetime = MyField5.getValue();\n                selnode.changeuser = MyField4.getValue();\n                selnode.remark = MyField7.getValue();\n                selnode.isModel = true;\n                selnode.shared = hwCheckbox.getValue() ? \"1\" : \"0\";\n                mytree.setItemText(selId, name)\n                callback();\n            },\n            error: function(msg) {\n                Ext.Msg.alert(\"提示\", \"保存模块基础信息失败\")\n                return;\n            }\n        })\n    } else {\n        checkEmpty(function() {\n            //checkName(name, function() {\n            //保存模块基础信息\n            hwDas.ajax({\n                    das: {\n                        idedas: true\n                    },\n                    url: \"CDEServcie/resource/zygl\",\n                    type: 'post',\n                    timeout: 5000,\n                    params: {},\n                    headers: {\n                        Ecylogin: Ext.util.Cookies.get('EcyLogin') || Ext.util.Cookies.get('ecyLogin')\n                    },\n                    data: [{\n                        editid: editId,\n                        id: id,\n                        code: codeid,\n                        type: type,\n                        name: name,\n                        //edit_reason: remark,\n                        category_id: category_id,\n                        project_id: Project_id,\n                        version: \"1\",\n                        shared: hwCheckbox.getValue() ? \"1\" : \"0\",\n                        readdate: Ext.Date.dateFormat(new Date(), 'Y-m-d H:i:s'),\n                        filepath: '/components/vmd/' + name + '.vmd',\n                        row_created_by: MyField2.getValue(),\n                        row_created_date: MyField3.getValue()\n                    }],\n                    success: function(result) {\n                        mytree.insertNewChild(selId, id, name);\n                        mytree.setItemImage2(id, \"tree/model.png\", \"tree/model.png\", \"tree/model.png\")\n                        var treenode = mytree.item(id);\n                        treenode.path = selnodepath + \"/\" + id;\n                        treenode.projectId = Project_id;\n                        if(treenode) {\n                            treenode.isModel = true;\n                            treenode.text = name;\n                            treenode.createuser = MyField2.getValue();\n                            treenode.createtime = MyField3.getValue();\n                            treenode.changetime = MyField5.getValue();\n                            treenode.changeuser = MyField4.getValue();\n                            treenode.remark = remark;\n                            treenode.code = codeid;\n                            treenode.type = '4';\n                            treenode.shared = hwCheckbox.getValue() ? \"1\" : \"0\";\n                            treenode.newnode = true;\n                        }\n                        mytree.itemObj[id] = treenode;\n                        mytree.selectItem(id, false, false);\n                        mytree.newnode = false;\n                        callback();\n                    },\n                    error: function(msg) {\n                        Ext.Msg.alert(\"提示\", \"保存模块基础信息失败\")\n                        return;\n                    }\n                })\n                //})\n        })\n\n    }\n}\n\nfunction checkName(name, callback) {\n\n    hwDas.ajax({\n        das: {\n            idedas: true\n        },\n        url: \"CDEServcie/resource/info\",\n        type: 'get',\n        timeout: 5000,\n        params: {\n            name: name\n        },\n        success: function(result) {\n            if(result.data[0].datas.length <= 0) {\n                if(callback)\n                    callback()\n            } else {\n                Ext.Msg.alert(\"提示\", \"该组件已存在，请重新命名组件！\")\n                return;\n            }\n        },\n        error: function(msg) {\n            Ext.Msg.alert(\"提示\", \"保存模块版本信息失败\")\n            return;\n        }\n    })\n}\n\n//编辑脚本  打开ace编辑器编辑\nfunction button1_click(sender) {\n    editId = newGuid(8);\n    var mytree = parent.hwTree;\n    var selId = mytree.getSelectedItemId();\n    var selnode = mytree.itemObj[selId];\n\n    saveModelInfo(function() {\n        selId = mytree.getSelectedItemId();\n        selnode = mytree.itemObj[selId];\n        var params = {\n            type: \"ux\",\n            path: selnode.text + '.vmd',\n            uxid: editId,\n            name: selnode.text\n        }\n        window.open(vmd.virtualPath + '/design/default.html?' + Ext.urlEncode(params), selnode.text + \" 组件设计\")\n    })\n}\n\n\n//自定义自定义方法\n\nfunction newGuid(len) {\n    var length = 32;\n    if(len)\n        length = len - 2\n    var guid = \"\";\n    arr = ['0', '1', '2', '3', '4', '5', '6', '7', '8', '9', 'a', 'b', 'c', 'd', 'e', 'f', 'g', 'h', 'i', 'j', 'k', 'l', 'm', 'n', 'o', 'p', 'q', 'r', 's', 't', 'u', 'v', 'w', 'x', 'y', 'z', 'A', 'B', 'C', 'D', 'E', 'F', 'G', 'H', 'I', 'J', 'K', 'L', 'M', 'N', 'O', 'P', 'Q', 'R', 'S', 'T', 'U', 'V', 'W', 'X', 'Y', 'Z'];\n    for(var i = 0; i < length; i++) {\n        pos = Math.round(Math.random() * (arr.length - 1));\n        guid += arr[pos];\n    }\n    // for(var i = 1; i <= length; i++) {\n    //     var n = Math.floor(Math.random() * 16.0).toString(16);\n    //     guid += n;\n    // }\n    return \"hw\" + guid;\n}\ndebugger\n\nfunction openSelMode(id, name, path) {\n    parent.openSelMode(id, name, path)\n}\n\nfunction checkEmpty(callback) {\n    MyField.setValue(newGuid(32));\n    if(MyField2.getValue() == \"\") {\n        Ext.Msg.alert(\"提示\", \"名称不能为空\")\n        return;\n    }\n\n    if(callback)\n        callback()\n}\n\n\n\nfunction MyField1_beforerender(sender) {\n    MyField1.regex = /^[a-zA-Z][a-zA-Z0-9]*$/;\n    MyField1.regexText = \"名称以字母打头，且只能包含数字、字母、下划线\";\n}\n\nfunction MyField7_beforerender(sender) {\n\n}","vmdcss":"","vmdprops":"\"\"","type":"module"}