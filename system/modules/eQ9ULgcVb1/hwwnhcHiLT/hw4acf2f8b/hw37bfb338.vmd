{"vmdversion":"2.0.3.0701","vmdlayout":"{\"components\":[{\"cid\":\"viewport\",\"id\":\"MyViewport\",\"layoutConfig\":{},\"userConfig\":{\"layout\":\"border\",\"afterrender\":\"MyViewport_afterrender\",\"beforerender\":\"MyViewport_beforerender\"},\"cn\":[{\"cid\":\"panel\",\"id\":\"panel\",\"layoutConfig\":{},\"userConfig\":{\"x\":140,\"y\":80,\"region\":\"center\",\"height\":681,\"width\":681,\"border\":false,\"header\":false,\"layout\":\"anchor\"},\"cn\":[{\"cid\":\"container\",\"id\":\"div1\",\"layoutConfig\":{},\"userConfig\":{\"anchor\":\"100% 100%\"}}]},{\"cid\":\"panel\",\"id\":\"panel1\",\"layoutConfig\":{},\"userConfig\":{\"x\":250,\"y\":380,\"region\":\"east\",\"width\":200,\"border\":false,\"header\":false,\"split\":true,\"collapseMode\":\"mini\",\"layout\":\"anchor\"},\"cn\":[{\"cid\":\"container\",\"id\":\"div2\",\"layoutConfig\":{},\"userConfig\":{\"height\":30,\"anchor\":\"100%\",\"layout\":\"absolute\"},\"cn\":[{\"cid\":\"label\",\"id\":\"label1\",\"layoutConfig\":{},\"userConfig\":{\"x\":20,\"y\":10,\"text\":\"绑定节点\"}}]},{\"cid\":\"container\",\"id\":\"div3\",\"layoutConfig\":{},\"userConfig\":{\"anchor\":\"100% -30\",\"layout\":\"fit\"},\"cn\":[{\"cid\":\"vmdGrid\",\"id\":\"hwGrid\",\"layoutConfig\":{},\"userConfig\":{\"height\":481,\"beforerender\":\"hwGrid_beforerender\",\"afterrender\":\"hwGrid_afterrender\"}}]}]},{\"cid\":\"panel\",\"id\":\"panel2\",\"layoutConfig\":{\"align\":\"middle\",\"pack\":\"center\"},\"userConfig\":{\"x\":300,\"y\":270,\"region\":\"south\",\"border\":false,\"header\":false,\"height\":40,\"layout\":\"hbox\",\"bodyStyle\":\"border-top: 1px solid lightblue\"},\"cn\":[{\"cid\":\"vmdButton\",\"id\":\"button1\",\"layoutConfig\":{},\"userConfig\":{\"text\":\"确定\",\"type\":\"info\",\"click\":\"button1_click\"}},{\"cid\":\"container\",\"id\":\"div4\",\"layoutConfig\":{},\"userConfig\":{\"width\":100,\"border\":false}},{\"cid\":\"vmdButton\",\"id\":\"button\",\"layoutConfig\":{},\"userConfig\":{\"text\":\"取消\",\"click\":\"button_click\"}}]}]},{\"cid\":\"vmddataset\",\"id\":\"数据集\",\"layoutConfig\":{},\"userConfig\":{}},{\"cid\":\"vmdvariable\",\"id\":\"变量\",\"layoutConfig\":{},\"userConfig\":{}}]}","vmdevents":"var myFlowInfo;\nvar myConfigInfo = {\n    modelId: \"\",\n    modelName: \"\",\n    variantNode: [{\n        formProperties: [],\n        processKey: \"5\",\n        taskNodeName: \"资料上传\",\n        taskNodeid: \"HWLDJKOSOJDFJAI4987A6\"\n    }]\n\n};\nif(parent.vmd.workspace&&!vmd.workspace)\n    vmd.workspace=parent.vmd.workspace;\n\nvar elogin=Ext.util.Cookies.get('ecyLogin');\nmyConfigInfo = {};\n\n//显示流程图\nfunction MyViewport_afterrender(sender) {\n    var modelId = myFlowInfo.modelId;\n    div1.update(\"<iframe  id='iframe_page' src='\"+vmd.core.getVirtualPath()+\"activiti/modeler-visual.html?mode=visual&modelId=\" + modelId + \"&info=kermit' width=100% height=100% frameborder=0  ></iframe>\");\n}\n\nfunction MyViewport_beforerender(sender) {\n    if(!parent.edValue || !parent.edValue.flowInfo) {\n        Ext.Msg.alert(\"提示\", \"未设置模版绑定的工作流！\", function() {\n            parent.xds.vmd.deleteChildNodeById(parent.edValue.id) //parent.edValue.id\n        })\n        return\n    }\n\n    myFlowInfo = Ext.decode(parent.edValue.flowInfo)\n    myConfigInfo = Ext.decode(parent.edValue.configInfo)\n\n    if(myConfigInfo.modelId && myConfigInfo.modelId != myFlowInfo.modelId) {\n        Ext.Msg.alert(\"提示\", \"工作流模版与节点不对应,请重新选择绑定的节点。\", function() {})\n        myConfigInfo = {\n            modelId: \"\",\n            modelName: \"\",\n            variantNode: []\n        };\n        myConfigInfo.modelId = myFlowInfo.modelId;\n        myConfigInfo.modelName = myFlowInfo.nodeName;\n\n        parent.xds.vmd.deleteChildNodeById(parent.edValue.id) //parent.edValue.id\n\n    } else if(myConfigInfo == \"\") {\n        myConfigInfo = {\n            modelId: \"\",\n            modelName: \"\",\n            variantNode: []\n        };\n    }\n    myConfigInfo.modelId = myFlowInfo.modelId;\n    myConfigInfo.modelName = myFlowInfo.nodeName;\n}\n\nvar addnode = [];\n\nfunction openConfig(a) {\n    //判断当前选中节点是否已经添加\n    var nodeinfo = Ext.decode(a)\n    var taskNodeName = nodeinfo.variantNode.taskNodeName;\n    var taskNodeId = nodeinfo.variantNode.taskNodeid;\n    var hasnode = false;\n\n    for(var i = 0; i < hwGrid.getRowsNum(); i++) {\n        if(hwGrid.cells2(i, 0).getValue() == taskNodeId) {\n            hasnode = true\n            break;\n        }\n    }\n    myConfigInfo.startNodeId=nodeinfo.variantProcess.taskNodeid;\n    if(!hasnode) {\n        addnode.push(taskNodeId)\n        var newId = (new Date()).valueOf();\n        hwGrid.addRow(newId, [taskNodeId, taskNodeName]);\n        myConfigInfo.variantNode.push(nodeinfo.variantNode);\n\n    }\n    if(!myConfigInfo.variantProcess) {\n        addnode.push(\"hwglobalvariable\")\n        myConfigInfo.variantProcess = nodeinfo.variantProcess.formProperties || [];\n    }\n}\nwindow[\"workflowNodeDblClick\"] = openConfig;\n\n\nfunction hwGrid_beforerender(sender) {\n    hwGrid.headstr = \"节点编码,节点名称\";\n    hwGrid.colType = \"ro,ro\";\n    //sender.colSorting = \"str,str\";\n    var headerWidth = \"80,100\"\n    var colId = \"id,name\";\n    hwGrid.headerWidth = headerWidth;\n    hwGrid.colId = colId;\n}\n\n\nfunction hwGrid_afterrender(sender) {\n    hwGrid.clearAll();\n    var dsdata = myConfigInfo.variantNode || [];\n    var dsdata1 = [];\n    for(var i = 0; i < dsdata.length; i++) {\n        var datarow = {};\n        datarow.id = dsdata[i].taskNodeid;\n        datarow.name = dsdata[i].taskNodeName;\n        dsdata1.push(datarow);\n    }\n    //绑定节点变量\n    var ds1 = new dhtmlXDataStore({\n        data: dsdata1,\n        datatype: \"json\"\n    });\n    hwGrid.sync(ds1);\n}\n\nfunction button1_click(sender) {\n    var retutnValue = Ext.encode(myConfigInfo);\n    window.vmdReturnValue = retutnValue;\n    var data = [];\n    if(addnode.indexOf(\"hwglobalvariable\") >= 0) { //添加全局变量节点\n        data.push({\n            cid: 'vmdWorkFlowVarFord',\n            name: \"全局变量\",\n            nodeId: \"hwglobalvariable\",\n            id: \"hwglobalvariable\"\n        })\n    }\n    //添加工作流节点到工作留下\n    var bindcount= 0;\n    for(var i = 0; i < myConfigInfo.variantNode.length; i++) {\n        if(addnode.indexOf(myConfigInfo.variantNode[i].taskNodeid) >= 0) {\n            data.push({\n                cid: 'vmdWorkFlowNode',\n                name: myConfigInfo.variantNode[i].taskNodeName,\n                nodeId: myConfigInfo.variantNode[i].taskNodeid,\n                id: myConfigInfo.variantNode[i].taskNodeid\n            })\n        }\n        if(bindNodeForm)\n            bindNodeForm(myConfigInfo.variantNode[i].taskNodeid,parent.getUrlParam(\"id\"),function(aa){bindcount++})\n    }\n    //parent.xds.vmd.deleteChildNodeById(parent.edValue.id)\n    parent.xds.vmd.addNode(data, parent.edValue.id)\n        //添加变量节点到工作流节点下\n    for(var i = 0; i < myConfigInfo.variantNode.length; i++) {\n        if(addnode.indexOf(myConfigInfo.variantNode[i].taskNodeid) >=0) {\n            var varObj = myConfigInfo.variantNode[i].formProperties || [];\n            var varData = [];\n            for(var j = 0; j < varObj.length; j++) {\n                varData.push({\n                    cid: 'vmdWorkFlowNodeVar',\n                    name: varObj[j].name,\n                    type: varObj[j].type\n                })\n            }\n            parent.xds.vmd.addNode(varData, myConfigInfo.variantNode[i].taskNodeid)\n        }\n    }\n    //添加全局变量到节点下\n    if(addnode.indexOf(\"hwglobalvariable\") >= 0) {\n        var gVarObj = myConfigInfo.variantProcess || [];\n        var gVarData = [];\n        for(var j = 0; j < gVarObj.length; j++) {\n            gVarData.push({\n                cid: 'vmdWorkFlowNodeVar',\n                name: gVarObj[j].name,\n                type: gVarObj[j].type\n            })\n        }\n        //parent.xds.vmd.deleteChildNodeById(\"hwglobalvariable\")\n        parent.xds.vmd.addNode(gVarData, \"hwglobalvariable\")\n    }\n\n    parent.edClose(true);\n}\n\nfunction button_click(sender) {\n    parent.edClose();\n}","vmdcss":"","vmdprops":"\"\"","type":"module","vmdresource":"{\"components\":[{\"cid\":\"vmdrescsss\",\"layoutConfig\":{},\"userConfig\":{}},{\"cid\":\"vmdresjss\",\"layoutConfig\":{},\"userConfig\":{}},{\"cid\":\"vmdresimgs\",\"layoutConfig\":{},\"userConfig\":{}}]}"}