{"vmdlayout":"{\"components\":[{\"cid\":\"viewport\",\"id\":\"MyViewport\",\"layoutConfig\":{},\"userConfig\":{\"layout\":\"fit\",\"afterrender\":\"MyViewport_afterrender\"},\"cn\":[{\"cid\":\"panel\",\"id\":\"panel\",\"layoutConfig\":{},\"userConfig\":{\"x\":0,\"y\":0,\"width\":760,\"height\":410,\"title\":\"属性设置\",\"layout\":\"border\",\"border\":false,\"header\":false,\"unstyled\":false},\"cn\":[{\"cid\":\"panel\",\"id\":\"panel1\",\"layoutConfig\":{},\"userConfig\":{\"region\":\"center\",\"height\":283,\"layout\":\"fit\",\"border\":true,\"header\":false,\"cmargins\":\"\",\"padding\":\"10\",\"unstyled\":false,\"labelAlign\":\"left\",\"labelWidth\":60},\"cn\":[{\"cid\":\"form\",\"id\":\"MyForm\",\"layoutConfig\":{},\"userConfig\":{\"header\":false,\"border\":false,\"labelWidth\":70},\"cn\":[{\"cid\":\"textfield\",\"id\":\"id\",\"layoutConfig\":{},\"userConfig\":{\"fieldLabel\":\"方法名称\",\"allowBlank\":false,\"name\":\"id\",\"id\":\"id\",\"emptyText\":\"请输入方法名称，须英文\",\"cls\":\"code\"}},{\"cid\":\"textfield\",\"id\":\"params\",\"layoutConfig\":{},\"userConfig\":{\"id\":\"params\",\"fieldLabel\":\"方法参数\",\"emptyText\":\"填写多个参数用逗号分开，如果param1,param2\",\"cls\":\"code\"}},{\"cid\":\"textarea\",\"id\":\"desc\",\"layoutConfig\":{},\"userConfig\":{\"fieldLabel\":\"方法描述\",\"allowBlank\":true,\"id\":\"desc\",\"emptyText\":\"请输入方法描述，便于代码编辑自动提示用\",\"cls\":\"code\"}},{\"cid\":\"checkboxgroup\",\"id\":\"returnType\",\"layoutConfig\":{},\"userConfig\":{\"fieldLabel\":\"返回值类型\",\"anchor\":\"\",\"width\":400,\"cls\":\"\",\"id\":\"returnType\"},\"cn\":[{\"cid\":\"checkbox\",\"id\":\"hwCheckbox\",\"layoutConfig\":{},\"userConfig\":{\"boxLabel\":\"Void\",\"fieldLabel\":\"\",\"checked\":false,\"cls\":\"code\",\"inputValue\":\"无\"}},{\"cid\":\"checkbox\",\"id\":\"hwCheckbox1\",\"layoutConfig\":{},\"userConfig\":{\"fieldLabel\":\"\",\"boxLabel\":\"String\",\"inputValue\":\"字符串\"}},{\"cid\":\"checkbox\",\"id\":\"hwCheckbox2\",\"layoutConfig\":{},\"userConfig\":{\"fieldLabel\":\"\",\"boxLabel\":\"Number\",\"inputValue\":\"数字\"}},{\"cid\":\"checkbox\",\"id\":\"hwCheckbox3\",\"layoutConfig\":{},\"userConfig\":{\"fieldLabel\":\"\",\"boxLabel\":\"Object\",\"inputValue\":\"对象\"}}]},{\"cid\":\"vmdAceEditor\",\"id\":\"code\",\"layoutConfig\":{},\"userConfig\":{\"anchor\":\"100%\",\"fieldLabel\":\"方法定义\",\"value\":\"//直接填写方法内容\",\"id\":\"code\",\"cls\":\"code ace_code\"}},{\"cid\":\"checkbox\",\"id\":\"isPublic\",\"layoutConfig\":{},\"userConfig\":{\"fieldLabel\":\"公共方法\",\"boxLabel\":\"\",\"checked\":true,\"id\":\"isPublic\"}}]}]},{\"cid\":\"panel\",\"id\":\"panel2\",\"layoutConfig\":{},\"userConfig\":{\"region\":\"west\",\"width\":179,\"style\":\"\",\"split\":true,\"animFloat\":false,\"collapsible\":false,\"frame\":false,\"hideCollapseTool\":false,\"floatable\":true,\"collapseMode\":\"mini\",\"hidden\":false,\"cmargins\":\"\",\"border\":true,\"header\":false,\"layout\":\"border\"},\"cn\":[{\"cid\":\"panel\",\"id\":\"panel4\",\"layoutConfig\":{},\"userConfig\":{\"region\":\"center\",\"header\":false,\"border\":false,\"layout\":\"fit\"},\"cn\":[{\"cid\":\"vmdDataView\",\"id\":\"hwDataView\",\"layoutConfig\":{},\"userConfig\":{\"tpl\":\"<ul>    <tpl for=\\\".\\\">        <li class=\\\"info\\\" style=\\\"line-height:30px;padding-left:5px\\\">            <h4>{id}{[values.params?('('+values.params+')'):'']}</h4> </li>    </tpl></ul>\",\"data\":\"var data = [{    \\\"id\\\": 'getKsrq',    \\\"desc\\\": \\\"开始日期\\\",}, {    \\\"id\\\": 'getJsrq',    \\\"desc\\\": \\\"结束日期\\\"}];return data;\",\"width\":\"\",\"afterrender\":\"hwDataView_afterrender\",\"store\":\"\",\"click\":\"hwDataView_click\",\"cls\":\"code\"}}]},{\"cid\":\"panel\",\"id\":\"panel5\",\"layoutConfig\":{\"align\":\"middle\",\"pack\":\"center\"},\"userConfig\":{\"region\":\"north\",\"unstyled\":false,\"frame\":false,\"border\":false,\"header\":false,\"height\":43,\"layout\":\"hbox\",\"bodyStyle\":\"border-bottom: 1px solid #99bbe8\"},\"cn\":[{\"cid\":\"vmdButton\",\"id\":\"button2\",\"layoutConfig\":{},\"userConfig\":{\"margins\":\"0 10\",\"text\":\"新建\",\"icon\":\"edit-outline\",\"click\":\"button2_click\"}},{\"cid\":\"vmdButton\",\"id\":\"button3\",\"layoutConfig\":{},\"userConfig\":{\"text\":\"删除\",\"type\":\"(none)\",\"icon\":\"delete\",\"click\":\"button3_click\"}}]}]},{\"cid\":\"panel\",\"id\":\"panel3\",\"layoutConfig\":{\"align\":\"middle\",\"pack\":\"center\"},\"userConfig\":{\"region\":\"south\",\"border\":false,\"header\":false,\"height\":40,\"layout\":\"hbox\",\"collapseMode\":\"standard\",\"frame\":false},\"cn\":[{\"cid\":\"vmdButton\",\"id\":\"button\",\"layoutConfig\":{},\"userConfig\":{\"margins\":\"0 20\",\"text\":\"保存\",\"type\":\"primary\",\"width\":80,\"click\":\"button_click\"}},{\"cid\":\"vmdButton\",\"id\":\"button1\",\"layoutConfig\":{},\"userConfig\":{\"text\":\"关闭\",\"width\":80,\"click\":\"button1_click\"}}]}]}]},{\"cid\":\"vmddataset\",\"id\":\"数据集\",\"layoutConfig\":{},\"userConfig\":{}},{\"cid\":\"vmdvariable\",\"id\":\"变量\",\"layoutConfig\":{},\"userConfig\":{}}]}","vmdevents":"//默认追加状态\nvar editorStatus = 'new';\n//ace 代码自动识别\n if (parent.init_def_platformControlData) {\n            parent.init_def_platformControlData();\n            def_platformControl = parent.def_platformControl\n        }\nvar propStore = new Ext.data.JsonStore({\n    proxy: new Ext.data.MemoryProxy(),\n    fields: ['id', 'zhname', 'bindCmp', 'bindValue', 'isPublic', 'desc', 'uxcid'\n    ,'params','code','returnType']\n});\nvar cmpStore = new Ext.data.JsonStore({\n    proxy: new Ext.data.MemoryProxy(),\n    fields: ['cmpId']\n});\nvar cmpPropStore = new Ext.data.JsonStore({\n    proxy: new Ext.data.MemoryProxy(),\n    fields: ['name']\n});\n\nvar reqPropId = getUrlParam('id');\n\n//获取属性节点的数据\nif(parent.xds) {\n    var data = parent.xds.vmd.getMethodsData();\n    propStore.loadData(data);\n\n}\n\n\n//获取组件树\nvar nodeList = [];\nvar getAllCmpsByNode = function(node, nodeList) {\n\n    Ext.each(node.childNodes, function(item) {\n        var obj = {\n            cmpId: item.id\n        };\n        nodeList.push(obj);\n        getAllCmpsByNode(item, nodeList);\n    })\n\n}\nif(parent.xds) {\n    var viewRoot = parent.xds.inspector.root.childNodes[0];\n    getAllCmpsByNode(viewRoot, nodeList)\n\n}\n\n\n//cmpStore.loadData(nodeList);\nvar refreshPropNode = function() {\n\n    var data = Ext.pluck(propStore.data.items, 'data');\n    parent.xds.vmd.addMethodNodes(data);\n\n}\n\nfunction button1_click(sender) {\n\n    parent.propWin.close()\n}\n\nfunction hwDataView_afterrender(sender) {\n    //属性列表加载\n    sender.setStore(propStore)\n        //选中传来的属性\n\n    if(reqPropId) {\n        var num = propStore.find('id', reqPropId)\n        if(num != -1) {\n            // sender.select(num)\n            var node = this.getNode(num);\n            Ext.defer(function() {\n                node.click()\n            }, 50)\n\n        }\n\n    }\n}\n\nfunction button2_click(sender) {\n    //新建\n\n    editorStatus = 'new';\n    hwDataView.clearSelections()\n    var rec = new propStore.recordType({\n        id: '',\n        zhname: '',\n        bindCmp: '',\n        bindValue: '',\n        desc: '',\n        code:'//直接填写方法内容',\n        params:'',\n        isPublic: true,\n        returnType:''\n    });\n    MyForm.form.loadRecord(rec);\n}\n\nfunction button3_click(sender) {\n    //删除\n\n    var selectData = hwDataView.getSelectedRecords();\n    if(selectData.length == 0) {\n        Ext.Msg.alert('提示', '请选择要删除的方法！')\n        return\n    }\n    Ext.Msg.confirm('提示', '你确定要删除该方法吗?', function(type) {\n\n        if(type == 'yes') {\n            propStore.remove(selectData)\n            refreshPropNode()\n            vmd.alert('提示', '删除成功！');\n\n        }\n    })\n}\n\n\n\nfunction MyViewport_afterrender(sender) {\n    //数据加载完成？\n    parent.propWin && parent.propWin.loading.hide();\n\n\n}\n\n\nfunction button_click(sender) {\n    //保存\n\n    var form = MyForm.getForm();\n    var values = form.getValues();\n    var id = values.id;\n    var num;\n\n    var getCmpCid = function(cmpId) {\n        var cid = \"\";\n        var cmp = parent.xds.inspector.nodeHash[cmpId];\n        if(cmp) {\n            cid = cmp.component.cid;\n        }\n        return cid;\n    }\n    if(form.isValid()) {\n        \n         values.code = Ext.getCmp('code').getValue();\n         values.returnType=Ext.getCmp('returnType').getValue();\n        // values.bindValue = Ext.getCmp('bindValue').getValue();\n        // values.uxcid = getCmpCid(values.bindCmp);\n        // delete values.dhxcombo\n        // delete values.dhxcombo_new_value\n\n        if(editorStatus == 'new') {\n            num = propStore.find('id', id)\n            var rec = new propStore.recordType(values);\n            if(num != -1) {\n                Ext.Msg.alert('提示', '名称为' + id + '的方法已存在，请修改方法名称！');\n                return;\n            }\n            propStore.add(rec);\n            //vmd.alert('提示', '添加成功！');\n\n        } else {\n            //编辑状态\n\n\n            num = propStore.find('id', hwDataView.activeId)\n                // rec.store=propStore;\n            var rec = propStore.getAt(num);\n\n            propStore.reader.update(rec, values)\n\n            //propStore.commitChanges()\n           // vmd.alert('提示', '修改成功！');\n            //propStore.commitChanges()\n        }\n        refreshPropNode();\n        var myMask = new Ext.LoadMask(Ext.getBody(), {\n            msg: \"正在保存中,请稍后...\",\n            msgCls: 'z-index:70000;'\n        });\n        myMask.show();\n        \n        parent.xds&& parent.xds.project.save(function(){\n            \n            myMask.hide();\n        });\n        \n\n\n\n    } else {\n        Ext.Msg.alert('提示', '请检查必填项！')\n\n    }\n}\n\nfunction hwDataView_click(sender, index, node, e) {\n\n    editorStatus = 'edit';\n    var data = sender.getRecord(node).data;\n    var rec = new propStore.recordType(data);\n    sender.activeId = data.id;\n    \n    MyForm.form.loadRecord(rec);\n\n}\n\nfunction bindCmp_change(sender) {\n    //绑定组件的属性\n\n    var val = sender.getValue();\n    var cmp = parent.xds.inspector.nodeHash[val];\n    if(!cmp) return;\n    var configs = cmp.component.configs.items;\n    //过滤事件\n    var propArr = [];\n    Ext.each(configs, function(item) {\n        if(item.group != '事件') {\n            var obj = {\n                name: item.name\n            }\n            propArr.push(obj);\n        }\n\n\n    })\n    cmpPropStore.loadData(propArr);\n\n}","vmdcss":"li.info h4 {\n    cursor: pointer\n}\n.code{\n    font:14px/normal 'Consolas'\n}\n.ace_code{\n    \n    border:1px solid #dfdfdf;\n}\n\n.vmd-dataview ul li.info-hover {\n    background-color: #CEEBFE;\n\n}\n\n.vmd-dataview ul li.x-view-selected {\n    background-color:#20a0ff ;\n    color: #fff;\n}","vmdprops":"\"\"","type":"module"}