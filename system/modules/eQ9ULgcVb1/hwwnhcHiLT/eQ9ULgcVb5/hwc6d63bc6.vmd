{"vmdversion":"2.0.3.0701","vmdlayout":"{\"components\":[{\"cid\":\"viewport\",\"id\":\"MyViewport\",\"layoutConfig\":{},\"userConfig\":{\"layout\":\"absolute\",\"afterrender\":\"MyViewport_afterrender\"},\"cn\":[{\"cid\":\"label\",\"id\":\"MyLabel\",\"layoutConfig\":{},\"userConfig\":{\"x\":40,\"y\":30,\"text\":\"项目基础信息\",\"style\":\"color: blue;    font-size: 20px;\"}},{\"cid\":\"label\",\"id\":\"MyLabel1\",\"layoutConfig\":{},\"userConfig\":{\"x\":40,\"y\":80,\"text\":\"项目编码：\"}},{\"cid\":\"label\",\"id\":\"MyLabel2\",\"layoutConfig\":{},\"userConfig\":{\"x\":40,\"y\":120,\"text\":\"项目名称：\"}},{\"cid\":\"label\",\"id\":\"MyLabel3\",\"layoutConfig\":{},\"userConfig\":{\"x\":40,\"y\":160,\"text\":\"创建人：\"}},{\"cid\":\"label\",\"id\":\"MyLabel4\",\"layoutConfig\":{},\"userConfig\":{\"x\":40,\"y\":200,\"text\":\"创建时间：\"}},{\"cid\":\"label\",\"id\":\"MyLabel5\",\"layoutConfig\":{},\"userConfig\":{\"x\":40,\"y\":240,\"text\":\"修改人：\"}},{\"cid\":\"label\",\"id\":\"MyLabel6\",\"layoutConfig\":{},\"userConfig\":{\"x\":40,\"y\":280,\"text\":\"修改时间：\"}},{\"cid\":\"label\",\"id\":\"MyLabel7\",\"layoutConfig\":{},\"userConfig\":{\"x\":40,\"y\":320,\"text\":\"说明：\"}},{\"cid\":\"textfield\",\"id\":\"MyField\",\"layoutConfig\":{},\"userConfig\":{\"x\":110,\"y\":80,\"width\":460,\"disabled\":true}},{\"cid\":\"textfield\",\"id\":\"MyField1\",\"layoutConfig\":{},\"userConfig\":{\"x\":110,\"y\":120,\"width\":460}},{\"cid\":\"textfield\",\"id\":\"MyField2\",\"layoutConfig\":{},\"userConfig\":{\"x\":110,\"y\":160,\"width\":460,\"disabled\":true}},{\"cid\":\"textfield\",\"id\":\"MyField3\",\"layoutConfig\":{},\"userConfig\":{\"x\":110,\"y\":200,\"width\":460,\"disabled\":true}},{\"cid\":\"textfield\",\"id\":\"MyField4\",\"layoutConfig\":{},\"userConfig\":{\"x\":110,\"y\":240,\"width\":460,\"disabled\":true}},{\"cid\":\"textfield\",\"id\":\"MyField5\",\"layoutConfig\":{},\"userConfig\":{\"x\":110,\"y\":280,\"width\":460,\"disabled\":true}},{\"cid\":\"textarea\",\"id\":\"MyField6\",\"layoutConfig\":{},\"userConfig\":{\"x\":110,\"y\":320,\"width\":460}},{\"cid\":\"vmdButton\",\"id\":\"button\",\"layoutConfig\":{},\"userConfig\":{\"x\":110,\"y\":410,\"size\":\"large\",\"text\":\"保存\",\"type\":\"info\",\"click\":\"button_click\"}}]},{\"cid\":\"vmddataset\",\"id\":\"数据集\",\"layoutConfig\":{},\"userConfig\":{}},{\"cid\":\"vmdvariable\",\"id\":\"变量\",\"layoutConfig\":{},\"userConfig\":{}}]}","vmdevents":"p_readOnly=getUrlParam(\"readOnly\")||false;\n\n\nfunction MyViewport_afterrender(sender) {\n    var tree = parent.hwTree;\n    var newnode = tree.newnode;\n    if(newnode) {\n        MyField.setValue(newGuid(32));\n        MyField1.setValue(\"\");\n        MyField2.setValue(Ext.util.Cookies.get('userName'));\n        MyField3.setValue(Ext.Date.dateFormat(new Date(), 'Y-m-d H:i:s'));\n        MyField4.setValue(\"\");\n        MyField5.setValue(\"\");\n        MyField6.setValue(\"\");\n    } else {\n        var selId = tree.getSelectedItemId();\n        var selnode = tree.itemObj[selId];\n        MyField.setValue(selnode.code);\n        MyField1.setValue(selnode.text);\n        MyField2.setValue(selnode.createuser);\n        MyField3.setValue(selnode.createtime);\n        MyField4.setValue(selnode.changeuser);\n        MyField5.setValue(selnode.changetime);\n        MyField6.setValue(selnode.remark);\n    }\n    \n    if(p_readOnly)\n    {\n        MyField1.setDisabled(true)\n        MyField6.setDisabled(true)\n        button.setVisible()\n        \n    }\n    \n}\n\n\n\nfunction button_click(sender) {\n    \n    var tree = parent.hwTree;\n    var newnode = tree.newnode;\n    var selId = tree.getSelectedItemId();\n    var selnode = tree.itemObj[selId];\n    var Project_id = newGuid(10);\n    var codeid = MyField.getValue();\n    var name = MyField1.getValue();\n    var remark = MyField6.getValue();\n    var xh = 10;\n    //编辑\n    if(newnode) {\n\n        hwDas.ajax({\n            das: {\n                idedas: true\n            },\n            url: \"CDEServcie/project/info\",\n            type: 'post',\n            timeout: 5000,\n            params: {},\n            data: [{\n                id: Project_id,\n                code: codeid,\n                xh: xh,\n                name: name,\n                row_created_by: MyField2.getValue(),\n                row_created_date: MyField3.getValue()\n            }],\n            success: function(result) {\n\n                tree.insertNewChild(\"0\", Project_id, name);\n                tree.setItemImage2(Project_id, \"tree/projectclose.png\", \"tree/projectopen.png\", \"tree/projectclose.png\");\n                var treenode = tree.item(Project_id);\n                treenode.path = \"/\" +Project_id;\n                treenode.projectId = Project_id;\n                if(treenode) {\n                    treenode.isProject = true;\n                    treenode.createuser = MyField2.getValue();\n                    treenode.createtime = MyField3.getValue();\n                    treenode.changeuser = MyField4.getValue();\n                    treenode.changetime = MyField5.getValue();\n                    treenode.remark = remark;\n                    treenode.code = codeid\n                }\n                tree.itemObj[Project_id] = treenode;\n                tree.selectItem(Project_id, false, false);\n                Ext.Msg.alert(\"提示\", \"保存成功！\")\n            },\n            error: function(msg) {\n                Ext.Msg.alert(\"提示\", \"保存项目信息出错！\")\n                return;\n            }\n        })\n    } else {\n        Project_id = selId;\n        MyField4.setValue(Ext.util.Cookies.get('userName'));\n        MyField5.setValue(Ext.Date.dateFormat(new Date(), 'Y-m-d H:i:s'));\n        hwDas.ajax({\n            das: {\n                idedas: true\n            },\n            url: \"CDEServcie/project/info\",\n            type: 'put',\n            timeout: 5000,\n            params: {},\n            data: [{\n                id: Project_id,\n                code: codeid,\n                xh: xh,\n                name: name,\n                row_changed_by: MyField4.getValue(),\n                row_changed_date: MyField5.getValue()\n            }],\n            success: function(result) {\n                selnode.text = name;\n                selnode.changeuser = MyField4.getValue();\n                selnode.changetime = MyField5.getValue();\n                selnode.remark = MyField6.getValue();\n                tree.setItemText(selId, name)\n                Ext.Msg.alert(\"提示\", \"保存成功！\")\n            },\n            error: function(msg) {\n                Ext.Msg.alert(\"提示\", \"修改项目信息出错！\")\n                return;\n            }\n        })\n    }\n}\n\n//自定义自定义方法\n\nfunction newGuid(len) {\n    var length = 32;\n    if(len)\n        length = len - 2\n    var guid = \"\";\n    for(var i = 1; i <= length; i++) {\n        var n = Math.floor(Math.random() * 16.0).toString(16);\n        guid += n;\n    }\n    return \"hw\" + guid;\n}","vmdcss":"","vmdprops":"\"\"","type":"module","vmdresource":"{\"components\":[{\"cid\":\"vmdrescsss\",\"layoutConfig\":{},\"userConfig\":{}},{\"cid\":\"vmdresjss\",\"layoutConfig\":{},\"userConfig\":{}},{\"cid\":\"vmdresimgs\",\"layoutConfig\":{},\"userConfig\":{}}]}"}