{"vmdversion":"2.0.3.20190124","vmdlayout":"{\"components\":[{\"cid\":\"viewport\",\"id\":\"MainViewport\",\"layoutConfig\":{},\"userConfig\":{\"layout\":\"border\",\"afterrender\":\"MainViewport_afterrender\"},\"cn\":[{\"cid\":\"container\",\"id\":\"div\",\"layoutConfig\":{},\"userConfig\":{\"x\":180,\"y\":70,\"region\":\"center\",\"layout\":\"fit\",\"border\":false,\"margins\":\"0 10 0 10\"},\"cn\":[{\"cid\":\"vmdTreeEx\",\"id\":\"tree\",\"layoutConfig\":{},\"userConfig\":{\"afterrender\":\"tree_afterrender\",\"beforerender\":\"tree_beforerender\",\"parentField\":\"pid\",\"valueField\":\"id\",\"textField\":\"name\",\"loadType\":\"全部加载\",\"rootValue\":\"0\",\"hideRoot\":true,\"rootText\":\"模块树\",\"checkBox\":true,\"afterNodeExpand\":\"tree_afterNodeExpand\",\"leafImg\":\"/system/modules/eQ9ULgcVb1/img/page.png\"}}]},{\"cid\":\"container\",\"id\":\"div1\",\"layoutConfig\":{\"align\":\"middle\"},\"userConfig\":{\"x\":220,\"y\":230,\"region\":\"north\",\"layout\":\"hbox\",\"height\":43},\"cn\":[{\"cid\":\"textfield\",\"id\":\"hwText\",\"layoutConfig\":{},\"userConfig\":{\"style\":\"border: 1px solid rgb(223, 223, 223);       height: 24px;\",\"width\":322,\"height\":30,\"margins\":\"0 0 0 20\"}},{\"cid\":\"vmdButton\",\"id\":\"button\",\"layoutConfig\":{},\"userConfig\":{\"style\":\"border-radius: 0px;    width: 18px;    height: 18px;\",\"width\":30,\"height\":30,\"icon\":\"search\",\"text\":\"\",\"click\":\"button_click\"}}]},{\"cid\":\"container\",\"id\":\"div2\",\"layoutConfig\":{\"align\":\"middle\",\"pack\":\"center\"},\"userConfig\":{\"x\":360,\"y\":420,\"region\":\"south\",\"layout\":\"hbox\",\"style\":\"background-color: #f2f2f2\"},\"cn\":[{\"cid\":\"vmdButton\",\"id\":\"button1\",\"layoutConfig\":{},\"userConfig\":{\"text\":\"确定\",\"margins\":\"0 20 0 0\",\"type\":\"primary\",\"click\":\"button1_click\"}},{\"cid\":\"vmdButton\",\"id\":\"button2\",\"layoutConfig\":{},\"userConfig\":{\"text\":\"取消\",\"margins\":\"0 0 0 20\",\"type\":\"(none)\"}}]}]},{\"cid\":\"vmddataset\",\"id\":\"数据集\",\"layoutConfig\":{},\"userConfig\":{}},{\"cid\":\"vmdvariable\",\"id\":\"变量\",\"layoutConfig\":{},\"userConfig\":{}},{\"cid\":\"vmdsubviewport\",\"id\":\"SubView_Window\",\"layoutConfig\":{},\"userConfig\":{}}]}","vmdevents":"function MainViewport_afterrender(sender) {\r\n}\r\nvar comData = [{\r\n    id: '张三',\r\n    pid: 12,\r\n    name: 12,\r\n    type: '0'\r\n}]\r\nvar treeStore = new vmd.data.Store({\r\n    data: comData,\r\n    fields: ['id', 'pid', 'name', 'type']\r\n})\r\n\r\nfunction tree_afterrender(sender) {\r\n\r\n    //先获取项目的发布配置信息，\r\n    bindvmdtree()\r\n}\r\n\r\nfunction bindvmdtree() {\r\n    var projectId = vmd.getUrlParam(\"projectid\") || vmd.workspace.projectid;\r\n    hwDas.get(\"CDEServcie/module/getmoduletree\", {}, {\r\n        project_id: projectId\r\n    }, function(result) {\r\n        if(result.data && result.data.length > 0 && result.data[0].datas && result.data[0].datas.length > 0) {\r\n            var treeData = result.data[0].datas\r\n            treeStore = new vmd.data.Store({\r\n                data: treeData,\r\n                fields: ['id', 'pid', 'name', 'type']\r\n            })\r\n            //tree.rootValue=projectId\r\n            tree.bindStore(treeStore, true);\r\n        }\r\n    }, function(msg) {})\r\n}\r\n\r\nfunction bindisiptree() {\r\n    var projectId = vmd.getUrlParam(\"projectid\") || vmd.workspace.projectid;\r\n    var recs = store.query(\"config_id\", combo.getValue())\r\n    if(recs.items.length <= 0) {\r\n        treeStore = new vmd.data.Store({\r\n            data: [],\r\n            fields: ['id', 'pid', 'name', 'type']\r\n        })\r\n        tree.bindStore(treeStore, true);\r\n        return\r\n    }\r\n    var rec = recs.items[0]\r\n    if(rec.data.ptservice == \"\") {\r\n        alert(\"提示\", \"该发布配置未设置平台服务，获取模块失败。\")\r\n    }\r\n    hwDas.get(rec.data.ptservice + \"/getmoduletree\", {}, {}, function(result) {\r\n        if(result.data && result.data.length > 0 && result.data[0].datas && result.data[0].datas.length > 0) {\r\n            var treeData = result.data[0].datas\r\n            treeStore = new vmd.data.Store({\r\n                data: treeData,\r\n                fields: ['id', 'pid', 'name', 'type']\r\n            })\r\n            //tree.rootValue=\"0\"\r\n            tree.bindStore(treeStore, true);\r\n        }\r\n    }, function(msg) {\r\n        alert(\"提示\", \"获取平台模块失败。\")\r\n    })\r\n}\r\n\r\nfunction tree_beforerender(sender) {\r\n    tree.store = treeStore;\r\n}\r\n\r\nfunction tree_afterNodeExpand(sender, node) {\r\n    for(var i = 0; i < node.childNodes.length; i++) {\r\n        if(node.childNodes[i].nodeDataJson.type == \"0\") {\r\n            node.childNodes[i].setIcon(\"/system/modules/eQ9ULgcVb1/img/model.png\")\r\n            node.childNodes[i].ui.checkbox.hidden = true\r\n        }\r\n        if(node.childNodes[i].nodeDataJson.type == \"1\") {\r\n            node.childNodes[i].setIcon(\"/system/modules/eQ9ULgcVb1/img/folderClosed.gif\")\r\n            node.childNodes[i].ui.checkbox.hidden = true\r\n        }\r\n        if(node.childNodes[i].nodeDataJson.type == \"2\") {\r\n            node.childNodes[i].setIcon(\"/system/modules/eQ9ULgcVb1/img/page.png\")\r\n        }\r\n    }\r\n}\r\n\r\nfunction button1_click(sender, e) {\r\n    //记录日志信息   \r\n    var selnode = tree.getChecked()\r\n    var selmodule = []\r\n    for(var i = 0; i < selnode.length; i++) {\r\n        selmodule.push({\r\n            moduleId: selnode[i].id,\r\n            moduleName: selnode[i].text,\r\n            modulePath: selnode[i].getPath(\"text\")\r\n        })\r\n    }\r\n    if(parent && parent.addSelModule) {\r\n        parent.addSelModule(selmodule)\r\n    }\r\n    if(parent && parent.moduleSelWin) {\r\n        parent.moduleSelWin.close()\r\n    }\r\n}\r\n\r\nfunction button_click(sender, e) {\r\n    tree.filterBy(hwText.getValue())\r\n}\r\n\r\n\r\n","vmdcss":"","vmdprops":"\"\"","type":"module","vmdresource":"{\"components\":[{\"cid\":\"vmdrescsss\",\"layoutConfig\":{},\"userConfig\":{}},{\"cid\":\"vmdresjss\",\"layoutConfig\":{},\"userConfig\":{}},{\"cid\":\"vmdresimgs\",\"layoutConfig\":{},\"userConfig\":{}}]}"}