<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml">
<head>
<meta http-equiv="X-UA-Compatible" content="IE=edge,chrome=1" />
<meta http-equiv="Content-Type" content="text/html; charset=utf-8"/>

    <title>下拉树加模糊功能</title>
	<!--基本样式-->
    <link href="{virtualPath}/css/common.css?ver=2.0.3.0804" rel="stylesheet" />
    <!--加载dhx组件-->
    <link href="{virtualPath}/lib/ext-3.4/resources/css/ext-all.css?ver=2.0.3.0804" rel="stylesheet" />
   
    <link href="{virtualPath}/design/css/icons.css?ver=2.0.3.0804" rel="stylesheet" />

	<link href="{virtualPath}/lib/dhtmlx/dhtmlx.css?ver=2.0.3.0804" rel="stylesheet" />
	  <!--样式快捷索引表-->
    <link href="{virtualPath}/css/shortcut.css?ver=2.0.3.0804" rel="stylesheet" />
    
    <script src="{virtualPath}/lib/labjs/LAB.min.js?ver=2.0.3.0804"></script>
    <script src="{virtualPath}/config.js?ver=2.0.3.0804"></script>
    <script src="{virtualPath}/lib/ext-3.4/adapter/ext/ext-base-debug.js?ver=2.0.3.0804"></script>
    <script src="{virtualPath}/lib/ext-3.4/adapter/ext/ext-base-lang.js?ver=2.0.3.0804"></script>
    <script src="{virtualPath}/lib/ext-3.4/adapter/ext/ext-base-class.js?ver=2.0.3.0804"></script>
    <script src="{virtualPath}/lib/ext-3.4/ext-all-debug.js?ver=2.0.3.0804"></script>
    <script src="{virtualPath}/lib/ext-3.4/src/locale/ext-lang-zh_CN.js?ver=2.0.3.0804"></script>
    <script src="{virtualPath}/js/util.js?ver=2.0.3.0804"></script>
    <script src="{virtualPath}/lib/dhtmlx/dhtmlx.js?ver=2.0.3.0804"></script>
	<script src="{virtualPath}/report/dhtmlx/dhtmlxCommon/codebase/dhtmlxcommon.js?ver=2.0.3.0804"></script>
	<script src="{virtualPath}/report/dhtmlx/dhtmlxCommon/codebase/dhtmlxcore.js?ver=2.0.3.0804"></script>
    <script src="{virtualPath}/report/dhtmlx/dhtmlxCommon/codebase/dhtmlxcontainer.js?ver=2.0.3.0804"></script>
	<script src="{virtualPath}/report/FillReport2.0/js/dhtmlx/dhtmlXFileUploader.js?ver=2.0.3.0804"></script>
    <script src="{virtualPath}/js/hwdas.js?ver=2.0.3.0804"></script>
    <script src="{virtualPath}/js/vmdcore.js?ver=2.0.3.0804"></script>
    <script src="{virtualPath}/js/vmdcomps.js?ver=2.0.3.0804"></script>
    <script src="{virtualPath}/js/publicMethods.js?ver=2.0.3.0804"></script>
    <script src="{virtualPath}/js/vmdreport.js?ver=2.0.3.0804"></script>
    {workspacePath}

    <script src="{virtualPath}/lib/ace/ace.js"></script>
    <script src="{virtualPath}/lib/ace/mode-base.js" type="text/javascript"></script>
    <script src="{virtualPath}/lib/ace/theme-xcode.js" type="text/javascript" ></script>
    <script src="{virtualPath}/lib/ace/ext-language_tools.js"></script>
    

    <style>

    </style>
    <style type="text/css" id="vmdcss">
        
    </style>
    <script>
        vmd.virtualPath = '{virtualPath}';
        
        Ext.define("vmd.module.MyViewport" ,{
	extend:"vmd.comp.viewport",
	requires:vmd.getCmpDeps([]),
	xtype:"vmd.module.MyViewport",
	layout:"absolute",
	autoScroll:true,
	afterrender:"MyViewport_afterrender",
	listeners:{
		vmdafterrender:function(){
	this.MyViewport_afterrender(this)
}
	},
	initComponent: function(){
		function combo_afterrender(sender) {
    //hwjVcIXpPa

    combo.setValue = function(val) {

        this._value = val;
        tree.setValue()

    }
    combo.getValue = function() {

        return this._value || ""
    }


    var imgel = combo.el.query(".dhxcombo_select_img");
    vmd(imgel).unbind('click')
    combo.addClass('combotree')
    vmd(sender.DOMelem_input).on('focus', function(e) {

        e.stopPropagation();
        var pos = combo.el.getRegion();
        var top = pos.top + 30;
        var left = pos.left
        tree.show();
        tree.el.setLeft(left);
        tree.el.setTop(top);


    }).on('blur', function() {



    }).on('keyup', function() {
        tree.filterBy(combo.getText())
    })

    Ext.getDoc().on('click', function(e) {


        if(vmd(e.target).parents('.combotree').length == 0 && vmd(e.target).parents('.vmd-tree').length == 0) tree.hide()

    })

}

function tree_nodeclick(sender, node, e) {
    e.stopPropagation();

    if(!node.hasChildNodes()) {
        combo.setText(node.text)
        combo._value = node.id;
        tree.hide();
    }


}

function MyViewport_afterrender(sender) {
    tree.hide();
    combo.setValue("hwHC35FGFV");

}




function button_click(sender, e) {

    // alert(combo.getText())

    // alert(combo.getValue())
    
}

function tree_beforerender(sender) {

    tree.setValue = function() {

        var id = combo._value;
        //if(!id) return
        var node = tree.getNodeById(id);
        var text = "";
        if(node) {
            text = node.text;

            //节点展开

            tree.expandPath(node.getPath());
            node.select()
        }

        combo.setText(text)
    }
    this.store.on('load', function() {

        tree.setValue()

    })
}

function button1_click(sender, e) {

    //  var win= new Ext.Window({
    //      html:'<iframe src="http://www.hanweikeji.com:10055/modules/eQ9ULgcVb1/hwB72m1spu/hwd2vSkDTh.html?r=1533355035759" style="height:100%;width:100%"></iframe>',
    //       height:200,
    //       width:400

    //  })
  var  win = new vmd.window({

        url: 'http://www.hanweikeji.com:10055/modules/eQ9ULgcVb1/hwB72m1spu/hwd2vSkDTh.html?r=1533355035759',
        height: 200,
        width: 400,
        auto: false
    })
    win.show()

}
			this.MyViewport_afterrender=MyViewport_afterrender;
		hwvar=new vmd.var.variable({});

		store=new vmd.store.jsonStore({"xtype":"vmd.jsonStore","id":"store","autoLoad":true,"cid":"vmdJsonStore","storeConfig":"{\"id\":\"eQ9TXjYMJR\",\"callcode\":\"vmdCode\",\"url\":\"CDEServcie/project/info\",\"host\":\"\",\"isHwRest\":true,\"name\":\"项目信息\",\"getMethods\":[],\"postMethods\":[],\"putMethods\":[],\"deleteMethods\":[],\"saveMethods\":[],\"fields\":[{\"name\":\"id\",\"type\":\"string\"},{\"name\":\"xh\",\"type\":\"string\"},{\"name\":\"code\",\"type\":\"string\"},{\"name\":\"name\",\"type\":\"string\"},{\"name\":\"category_id\",\"type\":\"string\"},{\"name\":\"ppdm_guid\",\"type\":\"string\"},{\"name\":\"row_changed_by\",\"type\":\"string\"},{\"name\":\"row_changed_date\",\"type\":\"datetime\"},{\"name\":\"row_created_by\",\"type\":\"string\"},{\"name\":\"row_created_date\",\"type\":\"datetime\"},{\"name\":\"row_effective_date\",\"type\":\"datetime\"},{\"name\":\"row_expiry_date\",\"type\":\"datetime\"},{\"name\":\"row_quality\",\"type\":\"string\"},{\"name\":\"effective_date\",\"type\":\"datetime\"},{\"name\":\"expiry_date\",\"type\":\"datetime\"}]}"});
		store1=new vmd.store.jsonStore({"xtype":"vmd.jsonStore","id":"store1","autoLoad":true,"cid":"vmdJsonStore","storeConfig":"{\"id\":\"l0JzcNr6GW\",\"callcode\":\"vmdCode\",\"url\":\"DataServiceWorkSpace/BUSINESSASSOCIATE/employee\",\"host\":\"\",\"isHwRest\":true,\"name\":\"查询员工\",\"getMethods\":[],\"postMethods\":[],\"putMethods\":[],\"deleteMethods\":[],\"saveMethods\":[],\"fields\":[{\"name\":\"business_associate_id\",\"type\":\"string\"},{\"name\":\"first_name\",\"type\":\"string\"}]}"});
		store2=new vmd.store.jsonStore({"xtype":"vmd.jsonStore","id":"store2","autoLoad":true,"cid":"vmdJsonStore","storeConfig":"{\"id\":\"TxfVyP1knW\",\"callcode\":\"vmdCode\",\"url\":\"DataServiceWorkSpace/WorkSpaceInfo/WorkSpaceUserQuery\",\"host\":\"\",\"isHwRest\":true,\"name\":\"用户关联工区查询\",\"getMethods\":[{\"id\":\"loginname\",\"value1\":\"return combo1.getValue()||'';\",\"value2\":\"\"}],\"postMethods\":[],\"putMethods\":[],\"deleteMethods\":[],\"saveMethods\":[],\"fields\":[{\"name\":\"workspace_id\",\"type\":\"string\"},{\"name\":\"name\",\"type\":\"string\"},{\"name\":\"active_ind\",\"type\":\"string\"}]}"});
		store3=new vmd.store.jsonStore({"xtype":"vmd.jsonStore","id":"store3","autoLoad":true,"cid":"vmdJsonStore","storeConfig":"{\"id\":\"eQ9T1htRZs\",\"callcode\":\"vmdCode\",\"url\":\"CDEServcie/module/category\",\"host\":\"\",\"isHwRest\":true,\"name\":\"模块目录\",\"getMethods\":[{\"id\":\"project_id\",\"value1\":\"return 'eQ9ULgcVb1';\",\"value2\":\"\"},{\"id\":\"parent_id\",\"value1\":\"return 0;\",\"value2\":\"\"}],\"postMethods\":[],\"putMethods\":[],\"deleteMethods\":[],\"saveMethods\":[],\"fields\":[{\"name\":\"id\",\"type\":\"string\"},{\"name\":\"xh\",\"type\":\"string\"},{\"name\":\"code\",\"type\":\"string\"},{\"name\":\"name\",\"type\":\"string\"},{\"name\":\"parent_id\",\"type\":\"string\"},{\"name\":\"project_id\",\"type\":\"string\"},{\"name\":\"ppdm_guid\",\"type\":\"string\"},{\"name\":\"row_changed_by\",\"type\":\"string\"},{\"name\":\"row_changed_date\",\"type\":\"datetime\"},{\"name\":\"row_created_by\",\"type\":\"string\"},{\"name\":\"row_created_date\",\"type\":\"datetime\"},{\"name\":\"row_effective_date\",\"type\":\"datetime\"},{\"name\":\"row_expiry_date\",\"type\":\"datetime\"},{\"name\":\"row_quality\",\"type\":\"string\"},{\"name\":\"effective_date\",\"type\":\"datetime\"},{\"name\":\"expiry_date\",\"type\":\"datetime\"}]}"});
		store4=new vmd.store.jsonStore({"xtype":"vmd.jsonStore","id":"store4","autoLoad":true,"cid":"vmdJsonStore","storeConfig":"{\"id\":\"eQ9T1htRZs\",\"callcode\":\"vmdCode\",\"url\":\"CDEServcie/module/category\",\"host\":\"\",\"isHwRest\":true,\"name\":\"模块目录\",\"getMethods\":[{\"id\":\"project_id\",\"value1\":\"return 'eQ9ULgcVb1';\",\"value2\":\"\"},{\"id\":\"parent_id\",\"value1\":\"\",\"value2\":\"\"}],\"postMethods\":[],\"putMethods\":[],\"deleteMethods\":[],\"saveMethods\":[],\"fields\":[{\"name\":\"id\",\"type\":\"string\"},{\"name\":\"xh\",\"type\":\"string\"},{\"name\":\"code\",\"type\":\"string\"},{\"name\":\"name\",\"type\":\"string\"},{\"name\":\"parent_id\",\"type\":\"string\"},{\"name\":\"project_id\",\"type\":\"string\"},{\"name\":\"ppdm_guid\",\"type\":\"string\"},{\"name\":\"row_changed_by\",\"type\":\"string\"},{\"name\":\"row_changed_date\",\"type\":\"datetime\"},{\"name\":\"row_created_by\",\"type\":\"string\"},{\"name\":\"row_created_date\",\"type\":\"datetime\"},{\"name\":\"row_effective_date\",\"type\":\"datetime\"},{\"name\":\"row_expiry_date\",\"type\":\"datetime\"},{\"name\":\"row_quality\",\"type\":\"string\"},{\"name\":\"effective_date\",\"type\":\"datetime\"},{\"name\":\"expiry_date\",\"type\":\"datetime\"}]}"});


		this.items=[
			{
				xtype:"vmd.treeex",
				id:"tree",
				width:190,
				height:270,
				hideRoot:false,
				x:350,
				y:80,
				store:store3,
				parentField:"parent_id",
				valueField:"id",
				textField:"name",
				loadType:"全部加载",
				rootValue:"0",
				rootText:"aa",
				checkBox:false,
				nodeclick:"tree_nodeclick",
				beforerender:"tree_beforerender",
				listeners:{
					nodeclick:tree_nodeclick,
					beforerender:tree_beforerender
				}
			},
			{
				xtype:"vmd.combo",
				id:"combo",
				width:150,
				x:150,
				y:160,
				afterrender:"combo_afterrender",
				listeners:{
					vmdafterrender:combo_afterrender
				}
			},
			{
				xtype:"vmd.button",
				id:"button1",
				text:"button",
				type:"(none)",
				size:"small",
				x:80,
				y:70,
				click:"button1_click",
				listeners:{
					click:button1_click
				}
			}
		]
		this.callParent();
		var me = this;vmd.core.moduleInit(this.items, this);
	}
})
        Ext.onReady(function () {
            Ext.create('vmd.module.MyViewport', {
                renderTo: document.body
            })


        })

      </script>
</head>
<body>
</body>
</html>
