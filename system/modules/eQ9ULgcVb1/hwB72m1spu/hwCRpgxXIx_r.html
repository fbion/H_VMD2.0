<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml">
<head>
<meta http-equiv="X-UA-Compatible" content="IE=edge,chrome=1" />
<meta http-equiv="Content-Type" content="text/html; charset=utf-8"/>

    <title>ocx调用测试2</title>
	<!--基本样式-->
    <link href="{virtualPath}/css/common.css?ver=2.0.3.0815" rel="stylesheet" />
    <!--加载dhx组件-->
    <link href="{virtualPath}/lib/ext-3.4/resources/css/ext-all.css?ver=2.0.3.0815" rel="stylesheet" />
   
    <link href="{virtualPath}/design/css/icons.css?ver=2.0.3.0815" rel="stylesheet" />

	<link href="{virtualPath}/lib/dhtmlx/dhtmlx.css?ver=2.0.3.0815" rel="stylesheet" />
	  <!--样式快捷索引表-->
    <link href="{virtualPath}/css/shortcut.css?ver=2.0.3.0815" rel="stylesheet" />
    
    <script src="{virtualPath}/lib/labjs/LAB.min.js?ver=2.0.3.0815"></script>
    <script src="{virtualPath}/config.js?ver=2.0.3.0815"></script>
    <script src="{virtualPath}/lib/ext-3.4/adapter/ext/ext-base-debug.js?ver=2.0.3.0815"></script>
    <script src="{virtualPath}/lib/ext-3.4/adapter/ext/ext-base-lang.js?ver=2.0.3.0815"></script>
    <script src="{virtualPath}/lib/ext-3.4/adapter/ext/ext-base-class.js?ver=2.0.3.0815"></script>
    <script src="{virtualPath}/lib/ext-3.4/ext-all-debug.js?ver=2.0.3.0815"></script>
    <script src="{virtualPath}/lib/ext-3.4/src/locale/ext-lang-zh_CN.js?ver=2.0.3.0815"></script>
    <script src="{virtualPath}/js/util.js?ver=2.0.3.0815"></script>
    <script src="{virtualPath}/lib/dhtmlx/dhtmlx.js?ver=2.0.3.0815"></script>
	<script src="{virtualPath}/report/dhtmlx/dhtmlxCommon/codebase/dhtmlxcommon.js?ver=2.0.3.0815"></script>
	<script src="{virtualPath}/report/dhtmlx/dhtmlxCommon/codebase/dhtmlxcore.js?ver=2.0.3.0815"></script>
    <script src="{virtualPath}/report/dhtmlx/dhtmlxCommon/codebase/dhtmlxcontainer.js?ver=2.0.3.0815"></script>
	<script src="{virtualPath}/report/FillReport2.0/js/dhtmlx/dhtmlXFileUploader.js?ver=2.0.3.0815"></script>
    <script src="{virtualPath}/js/hwdas.js?ver=2.0.3.0815"></script>
    <script src="{virtualPath}/js/vmdcore.js?ver=2.0.3.0815"></script>
    <script src="{virtualPath}/js/vmdcomps.js?ver=2.0.3.0815"></script>
    <script src="{virtualPath}/js/publicMethods.js?ver=2.0.3.0815"></script>
    <script src="{virtualPath}/js/vmdreport.js?ver=2.0.3.0815"></script>
    {workspacePath}

    <script src="{virtualPath}/lib/ace/ace.js"></script>
    <script src="{virtualPath}/lib/ace/mode-base.js" type="text/javascript"></script>
    <script src="{virtualPath}/lib/ace/theme-xcode.js" type="text/javascript" ></script>
    <script src="{virtualPath}/lib/ace/ext-language_tools.js"></script>
    

    <style>

    </style>
    <style type="text/css" id="vmdcss">
        
    </style>
    <script>
        vmd.virtualPath = '{virtualPath}';
        
        Ext.define("vmd.module.MyViewport" ,{
	extend:"vmd.comp.viewport",
	requires:vmd.getCmpDeps([]),
	xtype:"vmd.module.MyViewport",
	layout:"border",
	afterrender:"MyViewport_afterrender",
	beforerender:"MyViewport_beforerender",
	autoScroll:true,
	listeners:{
		vmdafterrender:function(){
	this.MyViewport_afterrender(this)
},
		beforerender:function(){
	this.MyViewport_beforerender(this)
}
	},
	initComponent: function(){
		function MyViewport_afterrender(sender) {

    var script = document.createElement("script");
    //创建language标签
    script.setAttribute('language', 'javascript')
    //创建for标签
    script.setAttribute('for', 'RealTimePlayOcx')
    //创建event标签
    script.event = "FireSelectWindow(lWndIndex)";
    //创建script 内容
    script.innerHTML = "\n alert()";

    document.getElementsByTagName("head")[0].appendChild(script);


    document.getElementById('div').innerHTML = '<object classid="clsid:D5E14042-7BF6-4E24-8B01-2F453E8154D7" ' +
        ' id="RealTimePlayOcx" width="100%" height="100%" ' +
        ' name="RealTimePlayOcx">' +
        '<param name="theme" value="blue">' +
        '<param name="showType" value="1">' +
        '</object>'


}

function initVideo() {

    //  var script = document.createElement("script");
    // //创建language标签
    // script.setAttribute('language', 'javascript')
    // //创建for标签
    // script.setAttribute('for', 'RealTimePlayOcx')
    // //创建event标签
    // script.event = "FireSelectWindow(lWndIndex)";
    // //创建script 内容
    // script.innerHTML = "\n alert()";

    // document.getElementsByTagName("head")[0].appendChild(script);


    document.getElementById('div').innerHTML = '<object classid="clsid:D5E14042-7BF6-4E24-8B01-2F453E8154D7" ' +
        ' id="RealTimePlayOcx" width="100%" height="100%" ' +
        ' name="RealTimePlayOcx">' +
        '<param name="theme" value="blue">' +
        '<param name="showType" value="1">' +
        '</object>'
}



function MyViewport_beforerender(sender) {



    var addMask = function() {

        var dh = vmd.DomHelper
        // 创建新的dom元素并加入到el中
        var videoEl=div.el;
        videoEl.setStyle("background",'#000');
       // videoEl.setStyle(opacity,0.5);
        var pos = videoEl.getRegion()
        var width = videoEl.getWidth();
        var height = videoEl.getHeight();

        var videwMask = Ext.get('videomask');
        if(!videwMask) {

            var d = dh.append(Ext.getBody(), {
                tag: 'iframe',
                id: 'videomask',
                cls: 'my-list',
                frameborder: 1,
                scrolling: 'no',
                style: 'position:absolute'

            }, true);

            d.setHeight(height);
            d.setWidth(width);
            d.setTop(pos.top);
            d.setLeft(pos.left);
        } else {
            videwMask.show()
        }
    }
    var hideMask = function() {
        var videoEl=div.el;
        videoEl.setStyle('background','#fff')
        var videwMask = Ext.get('videomask');
        if(videwMask) videwMask.hide()
    }

    // Ext.getBody().on('mousewheel', function(e) {
    //     var delta = e.getWheelDelta(); //

    //     console.log(delta)
    //     addMask()
       
    //     //
    //     Ext.defer(function(){
            
    //       hideMask()
    //     },500)

    // });

}

function button_click(sender, e) {

    // 创建一个新窗口（有url指向） 
    var newWin = new vmd.window({
        url: '/modules/eQ9ULgcVb1/hwB72m1spu/hwCRpgxXIx.html',
        title: '遮挡模拟',
        id: 'testWin',
        enableLoading: true, //启用进度加载
        enableIframe: true, //启用iframe弹窗遮罩解决ocx遮挡问题
        width: 500,
        height: 500,
        auto: false, //auto为true 自动适应窗口，配合offset使用
        params: {} //url中追加的编码的参数，json格式 
    })


    newWin.show(); //窗口显示

    newWin.on('hide', function() {
        //alert(111)
        initVideo()
    })

}


function button1_click(sender, e) {
    // var myMask = new vmd.LoadMask(vmd.getBody(), {
    //     msg: "进度加载中，请稍后"
    // });
    // myMask.show();

    var dh = vmd.DomHelper
    // 创建新的dom元素并加入到el中
    var pos = div.el.getRegion()
    var width = div.el.getWidth();
    var height = div.el.getHeight();

    var videwMask = Ext.get('videomask');
    
    div.el.applyStyles({'background':'red',"opacity":0.5});
    if(!videwMask) {
       
        var d = dh.append(Ext.getBody(), {
            tag: 'iframe',
            id: 'videomask',
            cls: 'my-list',
            frameborder: 1,
            scrolling: 'no',
            style: 'position:absolute'

        }, true);

        d.setHeight(height);
        d.setWidth(width);
        d.setTop(pos.top);
        d.setLeft(pos.left);
    } else {
        videwMask.show()
    }

}

function button4_click(sender, e) {
    //
    div.el.setStyle('background','#fff')
    var videwMask = Ext.get('videomask');
    if(videwMask) videwMask.hide()

}
			this.MyViewport_afterrender=MyViewport_afterrender;
		this.MyViewport_beforerender=MyViewport_beforerender;



		this.items=[
			{
				xtype:"panel",
				id:"panel",
				title:"右侧视频ocx控件区",
				header:true,
				border:true,
				height:100,
				x:110,
				y:370,
				region:"center",
				items:[
					{
						xtype:"vmd.div",
						id:"div",
						autoEl:"div",
						border:true,
						backgroundRepeat:"no-repeat",
						backgroundPosition:"top left",
						width:640,
						height:460,
						x:40,
						y:50
					}
				]
			},
			{
				xtype:"panel",
				id:"panel1",
				title:"Panel",
				header:true,
				border:true,
				height:100,
				x:80,
				y:50,
				region:"north",
				width:60,
				hidden:false,
				items:[
					{
						xtype:"vmd.button",
						id:"button",
						text:"点击弹窗",
						type:"(none)",
						size:"small",
						x:810,
						y:330,
						click:"button_click",
						listeners:{
							click:button_click
						}
					},
					{
						xtype:"vmd.button",
						id:"button1",
						text:"打开遮罩层",
						type:"(none)",
						size:"small",
						x:960,
						y:330,
						click:"button1_click",
						listeners:{
							click:button1_click
						}
					},
					{
						xtype:"vmd.button",
						id:"button4",
						text:"关闭遮罩层",
						type:"(none)",
						size:"small",
						click:"button4_click",
						listeners:{
							click:button4_click
						}
					}
				]
			},
			{
				xtype:"panel",
				id:"panel2",
				title:"左侧滚动区域",
				header:true,
				border:true,
				height:100,
				x:210,
				y:210,
				region:"west",
				width:556,
				autoScroll:false,
				layout:"border",
				items:[
					{
						xtype:"vmd.div",
						id:"div2",
						layoutConfig:{
							align:"middle"
						},
						autoEl:"div",
						border:true,
						backgroundRepeat:"no-repeat",
						backgroundPosition:"top left",
						width:400,
						height:91,
						region:"north",
						layout:"hbox",
						items:[
							{
								xtype:"label",
								id:"label",
								text:"方案一：将控件放到iframe里后演示效果",
								style:"font-weight: bold;font-size: 25px"
							}
						]
					},
					{
						xtype:"vmd.div",
						id:"div1",
						autoEl:"div",
						border:true,
						backgroundRepeat:"no-repeat",
						backgroundPosition:"top left",
						width:400,
						height:2000,
						region:"center",
						autoScroll:true,
						items:[
							{
								xtype:"vmd.div",
								id:"div3",
								autoEl:"div",
								border:true,
								backgroundRepeat:"no-repeat",
								backgroundPosition:"top left",
								width:400,
								height:1550,
								autoScroll:true,
								items:[
									{
										xtype:"vmd.button",
										id:"button2",
										text:"button",
										type:"(none)",
										size:"small"
									},
									{
										xtype:"vmd.button",
										id:"button3",
										text:"button",
										type:"(none)",
										size:"small"
									}
								]
							}
						]
					}
				]
			}
		]
		this.callParent();
		var me = this;vmd.core.moduleInit(this.items, this);
	}
})
        Ext.onReady(function () {
            Ext.create('vmd.module.MyViewport', {
                renderTo: document.body
            })


        })

      </script>
</head>
<body>
</body>
</html>
