{"vmdversion":"vmd2.0.5.200306","vmdlayout":"{\"components\":[{\"cid\":\"viewport\",\"id\":\"MainViewport\",\"layoutConfig\":{},\"userConfig\":{\"layout\":\"border\",\"afterrender\":\"MainViewport_afterrender\"},\"cn\":[{\"cid\":\"tabpanel\",\"id\":\"hwMyTabs\",\"layoutConfig\":{},\"userConfig\":{\"region\":\"center\",\"activeTab\":0,\"tabchange\":\"hwMyTabs_tabchange\",\"cls\":\"aaaaa\"},\"cn\":[{\"cid\":\"panel\",\"id\":\"panel2\",\"layoutConfig\":{},\"userConfig\":{\"title\":\"VMD2.0\",\"layout\":\"border\",\"afterrender\":\"panel2_afterrender\"},\"cn\":[{\"cid\":\"container\",\"id\":\"hwDiv\",\"layoutConfig\":{},\"userConfig\":{\"x\":140,\"y\":90,\"region\":\"center\",\"width\":620,\"layout\":\"absolute\",\"style\":\"font-size:14px;\"},\"cn\":[{\"cid\":\"label\",\"id\":\"hwLabel3\",\"layoutConfig\":{},\"userConfig\":{\"text\":\"上一版本：\",\"x\":30,\"y\":60,\"style\":\"font-size:14px;\"}},{\"cid\":\"textfield\",\"id\":\"hwText\",\"layoutConfig\":{},\"userConfig\":{\"x\":140,\"y\":55,\"beforerender\":\"hwText_beforerender\",\"afterrender\":\"hwText_afterrender\",\"readOnly\":true}},{\"cid\":\"label\",\"id\":\"hwLabel5\",\"layoutConfig\":{},\"userConfig\":{\"x\":30,\"y\":110,\"text\":\"要发布的版本号：\"}},{\"cid\":\"textfield\",\"id\":\"hwText1\",\"layoutConfig\":{},\"userConfig\":{\"x\":140,\"y\":105,\"afterrender\":\"hwText1_afterrender\"}},{\"cid\":\"label\",\"id\":\"hwLabel6\",\"layoutConfig\":{},\"userConfig\":{\"x\":30,\"y\":160,\"text\":\"更新日志：\"}},{\"cid\":\"vmdButton\",\"id\":\"button\",\"layoutConfig\":{},\"userConfig\":{\"x\":300,\"y\":90,\"text\":\"发布新版本\",\"size\":\"large\",\"type\":\"primary\",\"click\":\"button_click\",\"width\":130}},{\"cid\":\"vmdRichTextEditor\",\"id\":\"hwRichTextEditor\",\"layoutConfig\":{},\"userConfig\":{\"x\":40,\"y\":190,\"width\":750,\"height\":300,\"zIndex\":100,\"aftershow\":\"hwRichTextEditor_aftershow\",\"afterrender\":\"hwRichTextEditor_afterrender\"}},{\"cid\":\"vmdButton\",\"id\":\"button1\",\"layoutConfig\":{},\"userConfig\":{\"x\":450,\"y\":90,\"text\":\"其它依赖信息\",\"size\":\"large\",\"type\":\"primary\",\"click\":\"button1_click\",\"width\":130}},{\"cid\":\"label\",\"id\":\"hwLabel\",\"layoutConfig\":{},\"userConfig\":{\"x\":610,\"y\":90,\"text\":\"包含数据服务接口、数据库脚本、复合组件等资源及功能的更新\",\"width\":210,\"style\":\"color:red;\"}},{\"cid\":\"vmdButton\",\"id\":\"button10\",\"layoutConfig\":{},\"userConfig\":{\"x\":300,\"y\":40,\"size\":\"large\",\"text\":\"发布vmd2.0.6.200119的镜像\",\"width\":280,\"type\":\"primary\",\"click\":\"button10_click\"}}]},{\"cid\":\"container\",\"id\":\"hwDiv1\",\"layoutConfig\":{},\"userConfig\":{\"x\":370,\"y\":200,\"region\":\"east\",\"width\":250,\"layout\":\"fit\"},\"cn\":[{\"cid\":\"panel\",\"id\":\"panel\",\"layoutConfig\":{},\"userConfig\":{\"title\":\"历史版本\",\"layout\":\"vbox\",\"style\":\"font-size:14px;\",\"afterrender\":\"panel_afterrender\"},\"cn\":[{\"cid\":\"label\",\"id\":\"hwLabel4\",\"layoutConfig\":{},\"userConfig\":{\"text\":\"历史版本只提供全量包下载\",\"style\":\"font-size:14px;color:red;\"}}]}]}]},{\"cid\":\"panel\",\"id\":\"panel3\",\"layoutConfig\":{},\"userConfig\":{\"title\":\"数据服务\",\"layout\":\"absolute\",\"style\":\"font-size: 14px\",\"afterrender\":\"panel3_afterrender\"},\"cn\":[{\"cid\":\"label\",\"id\":\"hwLabel7\",\"layoutConfig\":{},\"userConfig\":{\"x\":30,\"y\":60,\"text\":\"上一版本：\"}},{\"cid\":\"label\",\"id\":\"hwLabel8\",\"layoutConfig\":{},\"userConfig\":{\"x\":30,\"y\":110,\"text\":\"要发布的版本：\",\"height\":20}},{\"cid\":\"textfield\",\"id\":\"hwText2\",\"layoutConfig\":{},\"userConfig\":{\"x\":140,\"y\":50,\"readOnly\":true}},{\"cid\":\"textfield\",\"id\":\"hwText3\",\"layoutConfig\":{},\"userConfig\":{\"x\":140,\"y\":100}},{\"cid\":\"vmdButton\",\"id\":\"button2\",\"layoutConfig\":{},\"userConfig\":{\"x\":320,\"y\":90,\"text\":\"发布新版本\",\"size\":\"large\",\"type\":\"primary\",\"click\":\"button2_click\"}},{\"cid\":\"vmdButton\",\"id\":\"button3\",\"layoutConfig\":{},\"userConfig\":{\"x\":460,\"y\":90,\"text\":\"上传数据服务\",\"size\":\"large\",\"type\":\"primary\",\"click\":\"button3_click\"}},{\"cid\":\"label\",\"id\":\"hwLabel9\",\"layoutConfig\":{},\"userConfig\":{\"x\":30,\"y\":160,\"height\":20,\"text\":\"更新日志:\"}},{\"cid\":\"vmdRichTextEditor\",\"id\":\"hwRichTextEditor1\",\"layoutConfig\":{},\"userConfig\":{\"x\":40,\"y\":190,\"width\":750,\"height\":300,\"zIndex\":100}}]},{\"cid\":\"panel\",\"id\":\"panel4\",\"layoutConfig\":{},\"userConfig\":{\"title\":\"工作流\",\"layout\":\"absolute\",\"style\":\"font-size: 14px\"},\"cn\":[{\"cid\":\"label\",\"id\":\"hwLabel10\",\"layoutConfig\":{},\"userConfig\":{\"x\":30,\"y\":60,\"text\":\"上一版本：\"}},{\"cid\":\"label\",\"id\":\"hwLabel11\",\"layoutConfig\":{},\"userConfig\":{\"x\":30,\"y\":110,\"text\":\"要发布的版本：\"}},{\"cid\":\"label\",\"id\":\"hwLabel12\",\"layoutConfig\":{},\"userConfig\":{\"x\":30,\"y\":160,\"text\":\"更新日志：\"}},{\"cid\":\"vmdRichTextEditor\",\"id\":\"hwRichTextEditor2\",\"layoutConfig\":{},\"userConfig\":{\"x\":40,\"y\":190,\"width\":750,\"zIndex\":100}},{\"cid\":\"textfield\",\"id\":\"hwText4\",\"layoutConfig\":{},\"userConfig\":{\"x\":140,\"y\":55,\"readOnly\":true}},{\"cid\":\"textfield\",\"id\":\"hwText5\",\"layoutConfig\":{},\"userConfig\":{\"x\":140,\"y\":105}},{\"cid\":\"vmdButton\",\"id\":\"button4\",\"layoutConfig\":{},\"userConfig\":{\"x\":320,\"y\":90,\"text\":\"发布新版本\",\"size\":\"large\",\"type\":\"primary\",\"click\":\"button4_click\"}},{\"cid\":\"vmdButton\",\"id\":\"button5\",\"layoutConfig\":{},\"userConfig\":{\"x\":460,\"y\":90,\"text\":\"上传工作流\",\"size\":\"large\",\"type\":\"primary\",\"click\":\"button5_click\"}}]},{\"cid\":\"panel\",\"id\":\"panel5\",\"layoutConfig\":{},\"userConfig\":{\"title\":\"消息中心\",\"layout\":\"absolute\",\"style\":\"font-size: 14px\"},\"cn\":[{\"cid\":\"label\",\"id\":\"hwLabel13\",\"layoutConfig\":{},\"userConfig\":{\"x\":30,\"y\":60,\"text\":\"上一版本:\"}},{\"cid\":\"label\",\"id\":\"hwLabel14\",\"layoutConfig\":{},\"userConfig\":{\"x\":30,\"y\":110,\"text\":\"要发布的版本：\"}},{\"cid\":\"label\",\"id\":\"hwLabel15\",\"layoutConfig\":{},\"userConfig\":{\"x\":30,\"y\":160,\"text\":\"更新日志：\"}},{\"cid\":\"vmdRichTextEditor\",\"id\":\"hwRichTextEditor3\",\"layoutConfig\":{},\"userConfig\":{\"x\":40,\"y\":190,\"width\":750,\"zIndex\":100}},{\"cid\":\"textfield\",\"id\":\"hwText8\",\"layoutConfig\":{},\"userConfig\":{\"x\":140,\"y\":105}},{\"cid\":\"textfield\",\"id\":\"hwText9\",\"layoutConfig\":{},\"userConfig\":{\"x\":140,\"y\":55,\"readOnly\":true}},{\"cid\":\"vmdButton\",\"id\":\"button8\",\"layoutConfig\":{},\"userConfig\":{\"x\":320,\"y\":90,\"size\":\"large\",\"type\":\"primary\",\"text\":\"发布新版本\",\"click\":\"button8_click\"}},{\"cid\":\"vmdButton\",\"id\":\"button9\",\"layoutConfig\":{},\"userConfig\":{\"x\":460,\"y\":90,\"text\":\"上传消息中心\",\"size\":\"large\",\"type\":\"primary\",\"click\":\"button9_click\"}}]},{\"cid\":\"panel\",\"id\":\"panel6\",\"layoutConfig\":{},\"userConfig\":{\"title\":\"文档中心\",\"layout\":\"absolute\",\"style\":\"font-size: 14px\"},\"cn\":[{\"cid\":\"label\",\"id\":\"hwLabel16\",\"layoutConfig\":{},\"userConfig\":{\"x\":30,\"y\":60,\"text\":\"上一版本：\"}},{\"cid\":\"label\",\"id\":\"hwLabel17\",\"layoutConfig\":{},\"userConfig\":{\"x\":30,\"y\":110,\"text\":\"要发布的版本：\"}},{\"cid\":\"textfield\",\"id\":\"hwText6\",\"layoutConfig\":{},\"userConfig\":{\"x\":140,\"y\":55,\"readOnly\":true}},{\"cid\":\"textfield\",\"id\":\"hwText7\",\"layoutConfig\":{},\"userConfig\":{\"x\":140,\"y\":105}},{\"cid\":\"vmdButton\",\"id\":\"button6\",\"layoutConfig\":{},\"userConfig\":{\"x\":320,\"y\":90,\"text\":\"发布新版本\",\"size\":\"large\",\"type\":\"primary\",\"click\":\"button6_click\"}},{\"cid\":\"vmdButton\",\"id\":\"button7\",\"layoutConfig\":{},\"userConfig\":{\"x\":460,\"y\":90,\"text\":\"上传文档中心\",\"size\":\"large\",\"type\":\"primary\",\"click\":\"button7_click\"}},{\"cid\":\"label\",\"id\":\"hwLabel18\",\"layoutConfig\":{},\"userConfig\":{\"x\":30,\"y\":160,\"text\":\"更新日志:\"}},{\"cid\":\"vmdRichTextEditor\",\"id\":\"hwRichTextEditor4\",\"layoutConfig\":{},\"userConfig\":{\"x\":40,\"y\":190,\"width\":750,\"zIndex\":100}}]}]},{\"cid\":\"container\",\"id\":\"hwDiv2\",\"layoutConfig\":{\"align\":\"center\",\"pack\":\"center\"},\"userConfig\":{\"region\":\"north\",\"height\":76,\"layout\":\"vbox\"},\"cn\":[{\"cid\":\"label\",\"id\":\"hwLabel19\",\"layoutConfig\":{},\"userConfig\":{\"text\":\"vmd2.0版本自动化版本发布\",\"width\":271,\"style\":\"font-size: 20px;\"}},{\"cid\":\"label\",\"id\":\"hwLabel20\",\"layoutConfig\":{},\"userConfig\":{\"text\":\"VMD2.0.4.190706\",\"margins\":\"10 0 0 0\"}}]},{\"cid\":\"container\",\"id\":\"div\",\"layoutConfig\":{},\"userConfig\":{\"region\":\"west\",\"width\":0,\"layout\":\"absolute\"},\"cn\":[{\"cid\":\"vmd.ux.Uploader\",\"id\":\"hwUploader\",\"layoutConfig\":{},\"userConfig\":{\"x\":130,\"y\":20,\"hidden\":true}}]}]},{\"cid\":\"vmddataset\",\"id\":\"数据\",\"layoutConfig\":{},\"userConfig\":{}},{\"cid\":\"vmdvariable\",\"id\":\"变量\",\"layoutConfig\":{},\"userConfig\":{}},{\"cid\":\"vmdsubviewport\",\"id\":\"SubView_Window\",\"layoutConfig\":{},\"userConfig\":{}}]}","vmdevents":"function hwText_beforerender(sender) {}\n\nfunction hwText_afterrender(sender) {\n    hwText.setValue(\"2.0.4.190627\")\n}\n\nfunction hwText1_afterrender(sender) {\n    var myDate = new Date();\n    hwText1.setValue(\"vmd2.0.6.\" + myDate.format('ymd'))\n}\n\nvar hwFao = new HwFao(vmd.MicService.getReportIp(), \"version\");\nvar hwFao1 = new HwFao(vmd.MicService.getReportIp(), \"vmd\");\n\nfunction button_click(sender, e) {\n    var path = hwText1.getValue();\n    var myMask = new Ext.LoadMask(Ext.getBody(), {\n        msg: \"正在发布新版本\" + path + \",请稍后...\",\n        msgCls: 'z-index:10000;'\n    });\n    myMask.show();\n    var str = hwRichTextEditor.getContent() || \" \"\n    var wlist = \"\";\n    var warr = [];\n    var p = function() {\n        //将版本号写到版本文件中\n        hwFao.write(\"VMD2.0.4/NewVersion.txt\", hwText1.getValue(), function() {\n            hwFao.write(\"VMD2.0.4/白.txt\", wlist, function() {\n                hwFao1.write(\"version.txt\", hwText1.getValue(), function() {\n                    hwFao1.write(\"update_show.txt\", str, function() { //调用服务，发布新版本\n                        $.support.cors = true;\n                        $.ajax({\n                            url: \"http://www.hanweikeji.com:10052/create_public_files\",\n                            type: \"post\",\n                            dataType: 'json',\n                            contentType: 'application/json',\n                            success: function(data) {\n                                myMask.hide()\n                                hwFao.write(\"VMD2.0.4/\" + hwText1.getValue() + \"/system/vmdVersion.json\", 'vmdVerionInfo:{\"ideVersion\":\"' + hwText1.getValue().replace('vmd', '') + '\",\"publish\":true}', function() {})\n                                alert(\"发布新版本成功！\")\n                                document.location.reload()\n                            },\n                            error: function(returndata) {\n                                myMask.hide()\n                                alert(\"发布新版本失败！\" + JSON.stringify(returndata))\n                            }\n\n                        });\n                    }, function() {})\n                })\n            }, function() {})\n            hwFao1.write(\"vmdVersion.json\", 'vmdVerionInfo:{\"ideVersion\":\"' + hwText1.getValue().replace('vmd', '') + '\",\"publish\":false}', function() {})\n        }, function() {})\n        //写更新日志\n        hwFao.write(\"VMD2.0.4/update.txt\", str, function() {}, function() {})\n    }\n    //写白名单\n    hwDas.get(\"CDEServcie/expProject/getwhitelist\", {}, {}, function(res) {\n        for (var i = 0; i < res.data[0].datas.length; i++) {\n            warr.push(res.data[0].datas[i].path)\n        }\n        wlist = warr.join(\"\\r\\n\")\n        p()\n    }, function() {})\n    updateIDE();\n    updateRun();\n}\n\nfunction button1_click(sender, e) {\n    uploadFun(\"VMD2.0.4\\\\数据服务接口\", function(fileList) {\n        if (fileList.length > 0) {\n            hwFao.write(\"VMD2.0.4\\\\数据服务接口\\\\newFile.txt\", fileList[0].title, function() {}, function() {})\n        }\n    })\n}\n\nfunction button3_click(sender, e) {\n    uploadFun(\"数据访问服务\\\\\" + hwText3.getValue(), function(fileList) {\n        if (fileList.length > 0) {\n            hwFao.write(\"数据访问服务\\\\newFile.txt\", fileList[0].title, function() {}, function() {})\n        }\n    })\n}\n\n\nfunction MainViewport_afterrender(sender) {}\n\nfunction uploadFun(path, callback) {\n    var uploader = hwUploader.getUploader();\n    var uploaderwin = new vmd.window({\n        items: hwUploader,\n        auto: false,\n        height: 500,\n        width: 655,\n        maximizable: false,\n        resizable: false,\n        closeAction: 'hide',\n        title: \"文件上传\"\n    })\n    hwUploader.show()\n    uploaderwin.show();\n    uploaderwin.hide(); //上传接口\n    uploader.upload(vmdSettings.dataServiceIp, path, uploaderwin, function(fileList) {\n        if (callback) {\n            callback.apply(me, [fileList])\n        }\n        //上传成功回调\n    }, \"version\")\n}\n\nfunction button5_click(sender, e) {\n    uploadFun(\"工作流\\\\\" + hwText5.getValue(), function(fileList) {\n        if (fileList.length > 0) {\n            hwFao.write(\"工作流\\\\newFile.txt\", fileList[0].title, function() {}, function() {})\n        }\n    })\n}\n\nfunction button9_click(sender, e) {\n    uploadFun(\"消息中心\\\\\" + hwText8.getValue(), function(fileList) {\n        if (fileList.length > 0) {\n            hwFao.write(\"消息中心\\\\newFile.txt\", fileList[0].title, function() {}, function() {})\n        }\n    })\n}\n\nfunction button7_click(sender, e) {\n    uploadFun(\"文档中心\\\\\" + hwText7.getValue(), function(fileList) {\n        if (fileList.length > 0) {\n            hwFao.write(\"文档中心\\\\newFile.txt\", fileList[0].title, function() {}, function() {})\n        }\n    })\n}\n\nfunction panel2_afterrender(sender) {\n    hwFao.read(\"VMD2.0.4/NewVersion.txt\", function(result) {\n        hwText.setValue(result.data)\n        hwLabel20.setText(result.data)\n        button10.setText(\"发布\" + result.data + \"的docker镜像\")\n    }, function() {})\n}\n\nfunction hwRichTextEditor_aftershow(sender, value, text) {\n    hwFao.read(\"VMD2.0.4/update.txt\", function(result) {\n        hwRichTextEditor.setContent(result.data)\n    }, function() {})\n}\n\nfunction hwRichTextEditor_afterrender(sender) {}\n\nfunction panel3_afterrender(sender) {}\n//设置默认值\nfunction hwMyTabs_tabchange(sender, tab) {\n    if (tab.id == \"panel3\" && !tab.isRender) {\n        hwFao.read(\"数据访问服务/NewVersion.txt\", function(result) {\n            hwText2.setValue(result.data)\n        }, function() {})\n        hwFao.read(\"数据访问服务/update.txt\", function(result) {\n            hwRichTextEditor1.setContent(result.data)\n        }, function() {})\n    }\n    if (tab.id == \"panel4\" && !tab.isRender) {\n        hwFao.read(\"工作流/NewVersion.txt\", function(result) {\n            hwText4.setValue(result.data)\n        }, function() {})\n        hwFao.read(\"工作流/update.txt\", function(result) {\n            hwRichTextEditor2.setContent(result.data)\n        }, function() {})\n    }\n    if (tab.id == \"panel5\" && !tab.isRender) {\n        hwFao.read(\"消息中心/NewVersion.txt\", function(result) {\n            hwText9.setValue(result.data)\n        }, function() {})\n        hwFao.read(\"消息中心/update.txt\", function(result) {\n            hwRichTextEditor3.setContent(result.data)\n        }, function() {})\n    }\n    if (tab.id == \"panel6\" && !tab.isRender) {\n        hwFao.read(\"文档中心/NewVersion.txt\", function(result) {\n            hwText6.setValue(result.data)\n        }, function() {})\n        hwFao.read(\"文档中心/update.txt\", function(result) {\n            hwRichTextEditor4.setContent(result.data)\n        }, function() {})\n    }\n    tab.isRender = true\n}\n//数据访问服务 发布\nfunction button2_click(sender, e) {\n    var str = hwRichTextEditor1.getContent() || \" \"\n    hwFao.write(\"数据访问服务/NewVersion.txt\", hwText3.getValue(), function() {}, function() {})\n    hwFao.write(\"数据访问服务/update.txt\", str, function() {}, function() {})\n}\n\n//工作流 发布\nfunction button4_click(sender, e) {\n    var str = hwRichTextEditor2.getContent() || \" \"\n    hwFao.write(\"工作流/NewVersion.txt\", hwText5.getValue(), function() {}, function() {})\n    hwFao.write(\"工作流/update.txt\", str, function() {}, function() {})\n}\n\n//消息中心 发布\nfunction button8_click(sender, e) {\n    var str = hwRichTextEditor3.getContent() || \" \"\n    hwFao.write(\"消息中心/NewVersion.txt\", hwText8.getValue(), function() {}, function() {})\n    hwFao.write(\"消息中心/update.txt\", str, function() {}, function() {})\n}\n\n//文档中心 发布\nfunction button6_click(sender, e) {\n    var str = hwRichTextEditor4.getContent() || \" \"\n    hwFao.write(\"文档中心/NewVersion.txt\", hwText7.getValue(), function() {}, function() {})\n    hwFao.write(\"文档中心/update.txt\", str, function() {}, function() {})\n}\n\nfunction panel_afterrender(sender) {\n    var hwFao = new HwFao(vmdSettings.dataServiceIp, \"version\"); //地址:端口和存储标识(服务管理员分配)\n    hwFao.getDirs(\"vmd2.0.4\", 'Dir', function(result) {\n        if (result.data && result.data.length > 0) {\n            for (var i = 0; i < result.data.length; i++) {\n                if (result.data[i].type == 'Dir' && result.data[i].name.indexOf('vmd2.0') >= 0) {\n                    var cpanel = new Ext.Panel({\n                        height: 45,\n                        width: 300,\n                        layout: \"hbox\",\n                        border: false,\n                        items: [{\n                                xtype: \"label\",\n                                id: \"MyLabel\",\n                                width: 150,\n                                text: result.data[i].name,\n                                style: 'font-size:14px;font-weight:bold;',\n                                margins: '10 10 10 10'\n                            },\n                            {\n                                xtype: 'vmd.button',\n                                icon: 'document',\n                                text: '下载',\n                                width: 70,\n                                type: 'text',\n                                style: 'margin-left:10px',\n                                downName: result.data[i].name + \"_full.tar.gz\",\n                                handler: function(e) {\n                                    var path = \"/version/VMD2.0.4/\" + this.downName;\n                                    window.open(path, '_self')\n                                }\n                            }\n                        ]\n                    })\n                    panel.add(cpanel);\n                }\n            }\n        }\n        panel.doLayout()\n    }, function(msg) {\n        Tips.tips(\"获取文件数据失败\", \"error\");\n    });\n}\nvar verReplaceFn = function(str) {\n    str = str.replace(/(<script.*?><\\/script>)|(<link.*\\s+href=(?:\"[^\"]*\"|'[^']*')[^<]*>)/g,\n        function(codestr) {\n\n            var pref = '';\n            if (codestr.indexOf('.js') != -1) pref = '.js';\n            if (codestr.indexOf('.css') != -1) pref = '.css';\n\n            codestr = codestr.replace(/((\\.js)|(\\.css))(\\?ver=[vmd\\d\\.]+)*/g,\n                pref + '?ver=' + hwText1.getValue());\n            return codestr;\n        })\n    return str;\n}\n\nvar Version = {\n    config: 'config.js',\n    designPath: 'design/default.html',\n    modulePreviewPath: 'run/default.html',\n    reportPreviewPath: 'run/report.html',\n    report2_2PreviewPath: 'run/report2_2.html',\n    chartPreviewPath: 'run/chart.html',\n    reportchartPreviewPath: 'run/reportchart.html',\n    verInfo: {},\n    previewState: {\n        module: false,\n        // report: false,\n        report2_2: false,\n        chart: false\n    },\n    updatePreviewVer: function(path, callback) {\n        vmd.getFileStr(path, function(data) {\n\n            var str;\n            str = verReplaceFn(data);\n            vmd.saveVmd(path, str, function() {\n                callback && callback();\n            })\n        })\n    }\n}\n\nfunction updateIDE(sender, e) {\n    var path = Version.designPath;\n    var cfgpath = Version.config;\n    vmd.getFileStr(path, function(data) {\n        var str;\n        str = verReplaceFn(data);\n        vmd.saveVmd(path, str, function() {})\n    })\n\n    vmd.getFileStr(cfgpath, function(data) {\n\n        var str;\n        var versionstr = 'vmdSettings.vmdVersion=\"{_ver}\"';\n\n        var vmdVersion = versionstr.format({\n            _ver: hwText1.getValue()\n        })\n\n        str = data.replace(/vmdSettings.vmdVersion\\s*=\\s*\"[\\w.:\\d]+\"/g, vmdVersion);\n\n        vmd.saveVmd(cfgpath, str)\n\n    })\n\n}\n\n\nfunction updateRun(sender, e) {\n    for (var key in Version.previewState) {\n\n        Version.previewState[key] = false;\n    }\n\n    Version.updatePreviewVer(Version.modulePreviewPath, function() {\n\n        Version.previewState.module = true;\n    })\n    // Version.updatePreviewVer(Version.reportPreviewPath, function() {\n\n    //     Version.previewState.report = true;\n    // })\n    Version.updatePreviewVer(Version.report2_2PreviewPath, function() {\n\n        Version.previewState.report2_2 = true;\n    })\n    Version.updatePreviewVer(Version.chartPreviewPath, function() {\n\n        Version.previewState.chart = true;\n    })\n    Version.updatePreviewVer(Version.reportchartPreviewPath, function() {\n\n        Version.previewState.reportchart = true;\n    })\n    vmd.taskRunner(function() {\n        var state = true;\n        for (var key in Version.previewState) {\n\n            state *= Version.previewState[key];\n        }\n        return state;\n\n    }, function() {})\n}\n\n\nvar imageServer = \"\";\nvar imageFileService = \"\";\nvar ver_path = \"\";\nvar imageList = [];\n\nfunction getImageInfo() {\n    hwFao1.read(\"imageService.txt\", function(result) {\n            var imageConfig = JSON.parse(result.data)\n            imageServer = imageConfig.imageServiceIp || result.data\n            if (!imageServer) {\n                myMask.hide();\n                Ext.Msg.alert(\"提示\", \"请先配置镜像服务地址后再操作！\", function() {})\n                return;\n            }\n            //通过镜像服务获取文件服务地址\n            hwDas.ajax({\n                url: \"http://\" + imageServer + \"/VMDCI/initService\",\n                type: 'get',\n                timeout: 20000,\n                success: function(data) {\n                    if (!data.result) {\n                        myMask.hide();\n                        Ext.Msg.alert(\"提示\", \"获取镜像服务所需的文件服务地址失败！\", function() {});\n                        return;\n                    }\n                    imageFileService = data.data\n                    if (!imageFileService) {\n                        myMask.hide();\n                        Ext.Msg.alert(\"提示\", \"获取镜像服务所需的文件服务地址失败！\", function() {});\n                        return;\n                    }\n                    //获取镜像列表\n\n\n\n\n                },\n                error: function(returndata) {\n                    myMask.hide();\n                    Ext.Msg.alert(\"提示\", JSON.stringify(returndata), function() {});\n                }\n            })\n        },\n        function() {\n            myMask.hide();\n            Ext.Msg.alert(\"提示\", \"请先配置镜像服务地址后再操作！\", function() {})\n        })\n\n    //获取版本发布的文件的存储目录 \n    hwDas.ajax({\n        url: \"http://\" + (vmdSettings.vmdFileServiceIp || vmdSettings.dataServiceIp) + \"/FasService/File/version/getmarkpath\",\n        type: 'get',\n        timeout: 20000,\n        success: function(data) {\n            ver_path = data.data;\n        },\n        error: function(data) {\n            myMask.hide();\n            Ext.Msg.alert(\"提示\", \"获取版本文件发布路径失败！\", function() {});\n            //获取版本发布的文件的存储目录  \n        }\n    })\n}\ngetImageInfo()\n//生成镜像\nfunction button10_click(sender, e) {\n\n    if (!imageFileService || !imageServer || !ver_path) {\n        Ext.Msg.alert(\"提示\", \"获取镜像服务或镜像文件服务地址或vmd版本发布存储目录失败！请从镜像配置中配置后再刷新页面！\")\n        return\n    }\n\n    var myMask = new Ext.LoadMask(Ext.getBody(), {\n        msg: \"正在发布新版本\" + hwText.getValue() + \"的镜像,请稍后...\",\n        msgCls: 'z-index:10000;'\n    });\n    myMask.show();\n    //获取镜像的服务地址\n    var ExpModulesInfo = {\n        fileSerIp: imageFileService,\n        imageSerIp: imageServer,\n        image_ver: hwText.getValue(),\n        vmd_verPath: ver_path,\n        imageType: 1,\n        vmdToken: Cookie.get(\"hwToken\"),\n        info: hwRichTextEditor.getContent() || \"\"\n    }\n    //获取镜像列表\n    var checkImage = function() {\n        vmd.ajax({\n            url: \"http://\" + imageServer + \"/VMDCI/searchImage/vmdrun:\" + hwText.getValue(),\n            type: 'post',\n            timeout: 20000,\n            success: function(data) {\n                if (data && data.result) {\n                    deleteImage(data.data || []);\n                } else {\n                    myMask.hide();\n                    Ext.Msg.alert(\"提示\", \"发布失败！检索镜像失败！\" + data.msg || data.data)\n                }\n            },\n            error: function() {\n                myMask.hide();\n                Ext.Msg.alert(\"提示\", \"发布失败！\")\n            }\n        })\n    }\n    var deleteImage = function(imageTag) {\n        if (imageTag.length <= 0) {\n            createfunction();\n        } else {\n            vmd.ajax({\n                url: \"http://\" + imageServer + \"/VMDCI/deleteImage/\" + imageTag[0].ImageName,\n                type: 'post',\n                timeout: 20000,\n                success: function(data) {\n                    if (data && data.result) {\n                        createfunction();\n                    } else {\n                        myMask.hide();\n                        Ext.Msg.alert(\"提示\", \"发布失败！初始化镜像任务失败！\" + data.msg || data.data)\n                    }\n                },\n                error: function() {\n                    myMask.hide();\n                    Ext.Msg.alert(\"提示\", \"发布失败！\")\n                }\n            })\n        }\n    }\n\n    var createfunction = function() {\n        hwDas.ajax({\n            url: \"http://\" + imageServer + \"/VMDCI/vmdrun/\" + hwText.getValue(),\n            type: 'post',\n            timeout: 20000,\n            success: function(data) {\n                if ((data && data.result) || (data && data.data.indexOf(\"服务器已有相同任务目录\") >= 0)) {\n                    imagePublish();\n                } else {\n                    myMask.hide();\n                    Ext.Msg.alert(\"提示\", \"发布失败！初始化镜像任务失败！\" + data.msg || data.data)\n                }\n            },\n            error: function() {\n                myMask.hide();\n                Ext.Msg.alert(\"提示\", \"发布失败，初始化镜像任务失败！\")\n            }\n        })\n    }\n\n\n    var imagePublish = function() {\n        //后台提取打包文件\n        vmd.ajax({\n            url: \"/expandimp/api/ImagePublish\",\n            type: 'post',\n            timeout: 10 * 60 * 1000,\n            data: ExpModulesInfo,\n            success: function(result) {\n                if (result && result.type == \"success\") {\n                    buildImage()\n                } else {\n                    myMask.hide();\n                    Ext.Msg.alert(\"提示\", \"提取上传vmd基础文件失败！\" + result.msg || result.data + \"\")\n                }\n            },\n            error: function(msg) {\n                myMask.hide();\n                Ext.Msg.alert(\"提示\", \"提取上传vmd基础文件失败！\")\n            }\n        })\n    }\n\n\n    var buildImage = function() {\n        vmd.ajax({\n            url: \"http://\" + imageServer + \"/VMDCI/vmdrun/build/\" + hwText.getValue(),\n            type: 'post',\n            timeout: 10 * 60 * 1000,\n            data: {\n                BuildContent: hwText.getValue() + '.tar.gz',\n                BuildAuthor: vmd.getUserId(),\n                BuildImage: \"vmdrun:\" + hwText.getValue()\n            },\n            success: function(data) {\n                if (data && data.result) {\n                    var imagehwFao = new HwFao(imageFileService, \"vmdcicd\");\n                    //获取历史版本的更新日志信息\n                    imagehwFao.write(\"data/vmd/\" + hwText.getValue() + \"/update.txt\", hwRichTextEditor.getContent() || \" \", function(result) {}, function() {})\n                    myMask.hide();\n                    Ext.Msg.alert(\"提示\", \"发布成功！\")\n                } else {\n                    myMask.hide();\n                    Ext.Msg.alert(\"提示\", \"创建镜像失败！\")\n                }\n            },\n            error: function(msg) {\n                myMask.hide();\n                Ext.Msg.alert(\"提示\", \"创建镜像失败！\")\n            }\n        })\n    }\n    \n    checkImage()\n    \n}","vmdcss":".aaaaa .x-tab-strip-top .x-tab-strip-active .x-tab-right\n{\n    background-color: #42b983\n}\n.aaaaa .x-tab-strip-active span.x-tab-strip-text {\n\tcolor:white;\n    font-weight:bold;\n}\n","vmdprops":"\"\"","type":"module","vmdresource":"{\"components\":[{\"cid\":\"vmdrescsss\",\"layoutConfig\":{},\"userConfig\":{}},{\"cid\":\"vmdresjss\",\"layoutConfig\":{},\"userConfig\":{},\"cn\":[{\"cid\":\"resjs\",\"id\":\"project.config.js\",\"layoutConfig\":{},\"userConfig\":{}}]},{\"cid\":\"vmdresimgs\",\"layoutConfig\":{},\"userConfig\":{}}]}"}