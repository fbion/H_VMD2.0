{"vmdversion":"vmd2.0.5.190906","vmdlayout":"{\"components\":[{\"cid\":\"viewport\",\"id\":\"MyViewport\",\"layoutConfig\":{},\"userConfig\":{\"layout\":\"absolute\",\"afterrender\":\"MyViewport_afterrender\"},\"cn\":[{\"cid\":\"vmdButton\",\"id\":\"button\",\"layoutConfig\":{},\"userConfig\":{\"x\":80,\"y\":90,\"size\":\"large\",\"text\":\"IDE设计主界面版本发布\",\"type\":\"primary\",\"click\":\"button_click\"}},{\"cid\":\"textfield\",\"id\":\"hwText\",\"layoutConfig\":{},\"userConfig\":{\"x\":160,\"y\":40,\"width\":140,\"cls\":\"font-15\"}},{\"cid\":\"label\",\"id\":\"label\",\"layoutConfig\":{},\"userConfig\":{\"x\":80,\"y\":40,\"text\":\"当前版本号：\",\"cls\":\"font-15\"}},{\"cid\":\"vmdButton\",\"id\":\"button1\",\"layoutConfig\":{},\"userConfig\":{\"x\":80,\"y\":160,\"size\":\"large\",\"text\":\"IDE预览界面版本发布\",\"type\":\"info\",\"click\":\"button1_click\"}}]},{\"cid\":\"vmddataset\",\"id\":\"数据集\",\"layoutConfig\":{},\"userConfig\":{}},{\"cid\":\"vmdvariable\",\"id\":\"变量\",\"layoutConfig\":{},\"userConfig\":{}},{\"cid\":\"vmdsubviewport\",\"id\":\"SubView_Window\",\"layoutConfig\":{},\"userConfig\":{}}]}","vmdevents":"var verReplaceFn = function(str) {\n    // var linkReg = /(<link.*\\s+href=(?:\"[^\"]*\"|'[^']*')[^<]*>)/g;\n    // var scriptReg = /<script.*?><\\/script>/g;\n    str = str.replace(/(<script.*?><\\/script>)|(<link.*\\s+href=(?:\"[^\"]*\"|'[^']*')[^<]*>)/g,\n        function(codestr) {\n\n            var pref = '';\n            if(codestr.indexOf('.js') != -1) pref = '.js';\n            if(codestr.indexOf('.css') != -1) pref = '.css';\n\n            codestr = codestr.replace(/((\\.js)|(\\.css))(\\?ver=[vmd\\d\\.]+)*/g,\n                pref + '?ver=' + hwText.getValue());\n            return codestr;\n        })\n\n    return str;\n}\n\nvar Version = {\n    config: 'config.js',\n    updateVerPath: 'system/updateVer.txt',\n    designPath: 'design/default.html',\n    modulePreviewPath: 'run/default.html',\n    reportPreviewPath: 'run/report.html',\n    report2_2PreviewPath: 'run/report2_2.html',\n    chartPreviewPath: 'run/chart.html',\n    verInfo: {},\n    previewState: {\n        module: false,\n        // report: false,\n        report2_2: false,\n        chart: false\n    },\n    updateVer: function() {\n        this.verInfo.ideVersion = hwText.getValue();\n        var str = Ext.encode(this.verInfo);\n        vmd.saveVmd(Version.updateVerPath, str)\n    },\n    updatePreviewVer: function(path, callback) {\n        vmd.getFileStr(path, function(data) {\n\n            var str;\n            str = verReplaceFn(data);\n            vmd.saveVmd(path, str, function() {\n\n                callback && callback();\n            })\n\n\n        })\n    }\n\n\n}\n\nfunction button_click(sender, e) {\n\n    var path = Version.designPath;\n    var verpath = Version.updateVerPath;\n    var cfgpath = Version.config;\n    vmd.getFileStr(path, function(data) {\n\n        var str;\n        str = verReplaceFn(data);\n        vmd.saveVmd(path, str, function() {\n\n            vmd.tip('发布成功')\n        })\n\n        Version.updateVer();\n\n\n    })\n\n    vmd.getFileStr(cfgpath, function(data) {\n\n        var str;\n        var versionstr = 'vmdSettings.vmdVersion=\"{_ver}\"';\n     \n        var vmdVersion = versionstr.format({\n            _ver:  hwText.getValue()\n        })\n       \n        str = data.replace(/vmdSettings.vmdVersion\\s*=\\s*\"[\\w.:\\d]+\"/g, vmdVersion);\n           \n        vmd.saveVmd(cfgpath, str)\n        \n    })\n\n}\n\n\nfunction button1_click(sender, e) {\n    for(var key in Version.previewState) {\n\n        Version.previewState[key] = false;\n    }\n\n    Version.updatePreviewVer(Version.modulePreviewPath, function() {\n\n        Version.previewState.module = true;\n    })\n    // Version.updatePreviewVer(Version.reportPreviewPath, function() {\n\n    //     Version.previewState.report = true;\n    // })\n    Version.updatePreviewVer(Version.report2_2PreviewPath, function() {\n\n        Version.previewState.report2_2 = true;\n    })\n    Version.updatePreviewVer(Version.chartPreviewPath, function() {\n\n        Version.previewState.chart = true;\n    })\n    vmd.taskRunner(function() {\n        var state = true;\n        for(var key in Version.previewState) {\n\n            state *= Version.previewState[key];\n        }\n        return state;\n\n    }, function() {\n        vmd.tip('发布成功')\n        Version.updateVer();\n\n    })\n\n\n}\n\nfunction MyViewport_afterrender(sender) {\n\n    vmd.getFileStr(Version.updateVerPath, function(data) {\n\n        var info = Ext.decode(data)\n        if(info) {\n\n            Version.verInfo = info;\n            hwText.setValue(Version.verInfo.ideVersion || '2.0.3')\n        }\n\n    })\n\n\n}","vmdcss":"","vmdprops":"\"\"","type":"module","vmdresource":"{\"components\":[{\"cid\":\"vmdrescsss\",\"layoutConfig\":{},\"userConfig\":{}},{\"cid\":\"vmdresjss\",\"layoutConfig\":{},\"userConfig\":{},\"cn\":[{\"cid\":\"resjs\",\"id\":\"project.config.js\",\"layoutConfig\":{},\"userConfig\":{}}]},{\"cid\":\"vmdresimgs\",\"layoutConfig\":{},\"userConfig\":{}}]}"}