{"vmdversion":"vmd2.0.7.200328","vmdlayout":"{\"components\":[{\"cid\":\"uxpanel\",\"id\":\"MiningIndex\",\"layoutConfig\":{},\"userConfig\":{\"layout\":\"fit\",\"header\":false,\"width\":280,\"height\":1000,\"autoScroll\":true,\"autoHeight\":true,\"beforerender\":\"MiningIndex_beforerender\"},\"cn\":[{\"cid\":\"panel\",\"id\":\"panel2\",\"layoutConfig\":{},\"userConfig\":{\"layout\":\"auto\",\"autoHeight\":true,\"border\":false,\"header\":false,\"autoScroll\":true,\"height\":1000},\"cn\":[{\"cid\":\"panel\",\"id\":\"panel\",\"layoutConfig\":{},\"userConfig\":{\"x\":0,\"y\":0,\"height\":158,\"border\":false,\"header\":false,\"layout\":\"absolute\",\"width\":280},\"cn\":[{\"cid\":\"checkbox\",\"id\":\"isShow\",\"layoutConfig\":{},\"userConfig\":{\"boxLabel\":\"显示\",\"x\":10,\"y\":10,\"checked\":true,\"BindValue\":\"show\",\"id\":\"isShow\",\"Name\":\"seriesIsShow\"}},{\"cid\":\"checkbox\",\"id\":\"isEidt\",\"layoutConfig\":{},\"userConfig\":{\"x\":180,\"y\":10,\"boxLabel\":\"编辑\",\"checked\":true,\"id\":\"isEidt\",\"hidden\":true}},{\"cid\":\"label\",\"id\":\"hwLabel\",\"layoutConfig\":{},\"userConfig\":{\"x\":10,\"y\":45,\"height\":20,\"text\":\"名称\"}},{\"cid\":\"textfield\",\"id\":\"miningName\",\"layoutConfig\":{},\"userConfig\":{\"x\":60,\"y\":40,\"width\":190,\"cls\":\"text-input\",\"BindValue\":\"nameText\",\"id\":\"miningName\"}},{\"cid\":\"vmdComlist\",\"id\":\"mingingType\",\"layoutConfig\":{},\"userConfig\":{\"x\":60,\"y\":75,\"width\":190,\"cls\":\"text-input\",\"BindValue\":\"wellType\",\"id\":\"mingingType\",\"afterrender\":\"mingingType_afterrender\",\"Name\":\"isOnRander\"}},{\"cid\":\"label\",\"id\":\"hwLabel1\",\"layoutConfig\":{},\"userConfig\":{\"x\":10,\"y\":80,\"height\":20,\"text\":\"类型\"}},{\"cid\":\"vmd.ux.NumberInput\",\"id\":\"miningZ\",\"layoutConfig\":{},\"userConfig\":{\"x\":175,\"y\":115,\"width\":70,\"BindValue\":\"z\",\"id\":\"miningZ\",\"Name\":\"isOnRander\"}},{\"cid\":\"vmdComlist\",\"id\":\"mingingPos\",\"layoutConfig\":{},\"userConfig\":{\"x\":60,\"y\":115,\"width\":60,\"cls\":\"text-input\",\"id\":\"mingingPos\",\"afterrender\":\"mingingPos_afterrender\",\"BindValue\":\"position\",\"Name\":\"isOnRander\"}},{\"cid\":\"label\",\"id\":\"hwLabel2\",\"layoutConfig\":{},\"userConfig\":{\"x\":10,\"y\":113,\"height\":30,\"text\":\"相对井位位置\",\"width\":40}},{\"cid\":\"label\",\"id\":\"hwLabel5\",\"layoutConfig\":{},\"userConfig\":{\"x\":140,\"y\":120,\"height\":20,\"text\":\"层级\",\"width\":40}},{\"cid\":\"checkbox\",\"id\":\"isToopTip\",\"layoutConfig\":{},\"userConfig\":{\"x\":160,\"y\":10,\"boxLabel\":\"数据提示框\",\"checked\":true,\"BindValue\":\"toopTip.show\",\"id\":\"isToopTip\"}},{\"cid\":\"checkbox\",\"id\":\"hwCheckboxShowLegend\",\"layoutConfig\":{},\"userConfig\":{\"boxLabel\":\"配置图例\",\"x\":70,\"y\":10,\"checked\":false,\"BindValue\":\"showLegend\",\"id\":\"hwCheckboxShowLegend\",\"Name\":\"isOnRander\"}}]},{\"cid\":\"panel\",\"id\":\"panel4\",\"layoutConfig\":{},\"userConfig\":{\"x\":0,\"y\":160,\"height\":155,\"title\":\"渐进式加载\",\"layout\":\"absolute\",\"width\":279},\"cn\":[{\"cid\":\"label\",\"id\":\"hwLabel7\",\"layoutConfig\":{},\"userConfig\":{\"text\":\"启用阈值\",\"x\":10,\"y\":40}},{\"cid\":\"vmd.ux.NumberInput\",\"id\":\"hwNumberInput\",\"layoutConfig\":{},\"userConfig\":{\"x\":70,\"y\":35,\"width\":100,\"BindValue\":\"progressiveThreshold\"}},{\"cid\":\"label\",\"id\":\"hwLabel8\",\"layoutConfig\":{},\"userConfig\":{\"x\":10,\"y\":75,\"text\":\"单次加载数据量\",\"width\":50}},{\"cid\":\"vmd.ux.NumberInput\",\"id\":\"hwNumberInput1\",\"layoutConfig\":{},\"userConfig\":{\"x\":70,\"y\":75,\"width\":100,\"BindValue\":\"progressive\"}},{\"cid\":\"label\",\"id\":\"hwLabel9\",\"layoutConfig\":{},\"userConfig\":{\"x\":180,\"y\":40,\"height\":30,\"text\":\"超过此数据量时启用渐进式加载\",\"width\":90,\"style\":\"font-size: 10px;    color: red;\"}},{\"cid\":\"checkbox\",\"id\":\"hwCheckbox\",\"layoutConfig\":{},\"userConfig\":{\"x\":10,\"y\":5,\"boxLabel\":\"启用\",\"check\":\"hwCheckbox_check\"}}]},{\"cid\":\"panel\",\"id\":\"storPanel\",\"layoutConfig\":{},\"userConfig\":{\"x\":0,\"y\":310,\"height\":172,\"title\":\"数据\",\"layout\":\"absolute\",\"id\":\"storPanel\",\"width\":279},\"cn\":[{\"cid\":\"label\",\"id\":\"hwLabel3\",\"layoutConfig\":{},\"userConfig\":{\"text\":\"数据集\",\"x\":10,\"y\":15}},{\"cid\":\"vmdComlist\",\"id\":\"storeData\",\"layoutConfig\":{},\"userConfig\":{\"x\":70,\"y\":10,\"width\":150,\"cls\":\"text-input\",\"id\":\"storeData\",\"BindValue\":\"dataMapping.source\",\"selectChanged\":\"storeData_selectChanged\"}},{\"cid\":\"label\",\"id\":\"hwLabel4\",\"layoutConfig\":{},\"userConfig\":{\"text\":\"字段绑定\",\"x\":10,\"y\":55}},{\"cid\":\"vmd.ux.FieldFormlist\",\"id\":\"hwFieldFormlist\",\"layoutConfig\":{},\"userConfig\":{\"x\":60,\"y\":55,\"width\":220,\"BindValue\":\"dataMapping.fields\"}}]},{\"cid\":\"panel\",\"id\":\"panel3\",\"layoutConfig\":{},\"userConfig\":{\"title\":\"指标\",\"width\":280,\"layout\":\"absolute\",\"height\":82,\"afterrender\":\"panel3_afterrender\",\"x\":0,\"y\":480},\"cn\":[{\"cid\":\"vmd.ux.FontSeting\",\"id\":\"hwFontSeting\",\"layoutConfig\":{},\"userConfig\":{\"fontStyleIsShow\":true,\"width\":220,\"x\":60,\"y\":5,\"BindValue\":\"font\",\"Name\":\"isOnRander\"}},{\"cid\":\"label\",\"id\":\"hwLabel6\",\"layoutConfig\":{},\"userConfig\":{\"x\":10,\"y\":10,\"text\":\"字体\"}}]},{\"cid\":\"panel\",\"id\":\"panel1\",\"layoutConfig\":{},\"userConfig\":{\"x\":0,\"y\":560,\"height\":400,\"title\":\"指标\",\"layout\":\"fit\",\"autoScroll\":true,\"autoHeight\":true,\"header\":false},\"cn\":[{\"cid\":\"vmd.ux.AccordionTabs\",\"id\":\"hwAccordionTabs\",\"layoutConfig\":{},\"userConfig\":{\"width\":280,\"height\":400,\"delIndex\":\"hwAccordionTabs_delIndex\",\"nameChang\":\"hwAccordionTabs_nameChang\"}}]}]}]}]}","vmdevents":"var page = this;\nvar viewModel;\nvar oriData = null;\nvar miningIndexData;\nvar sereis = null;\n\nfunction init(data) {\n    //console.log(data);\n    miningIndexData = data;\n    viewModel.bind(miningIndexData)\n    if (miningIndexData.indexs) {\n        series = miningIndexData.indexs[0].series;\n    }\n    // 数据集列表绑定数据\n    setStoreData();\n    hwAccordionTabs.initTabs(miningIndexData.dataMapping.source, miningIndexData.indexs)\n    hwFieldFormlist.bindData(miningIndexData.dataMapping);\n    hwNumberInput.setDisabled(!miningIndexData.isProgressive);\n    hwNumberInput1.setDisabled(!miningIndexData.isProgressive);\n    \n}\n\nfunction MiningIndex_beforerender(sender) {\n    //初始化\n    viewModel = new vmd.base.ViewModel(page);\n    //增加观察\n    viewModel.addObserver();\n    //实现接口\n    viewModel.onValueChange = function(sender, newValue, vm) {\n        viewModel.set(sender.BindValue, newValue);\n        xds.activePropPanel.fireEvent('DataValueChange', sender, newValue, vm, true)\n    }\n}\n\n\n// 数据赋值\nfunction setStoreData(data) {\n    var myStore = getDatasetNames();\n    var store = new vmd.data.Store({\n        data: myStore,\n        fields: ['id', 'text']\n    })\n    storeData.store = store;\n    storeData.valueField = 'id';\n    storeData.displayField = 'id';\n    storeData.dropDownFields = 'text';\n    storeData.queryField = 'text';\n    for (var i = 0; i < myStore.length; i++) {\n        if (myStore[i].id === miningIndexData && miningIndexData.dataMapping.source) {\n            storeData.setValue(miningIndexData.dataMapping.source)\n        }\n    }\n}\n\nfunction mingingType_afterrender(sender) {\n    var datas = [{\n            id: '柱形开采指标',\n            text: '柱形开采指标'\n        },\n        {\n            id: '伞形开采指标',\n            text: '伞形开采指标'\n        },\n        // {\n        //     id: '水井伞形开采指标',\n        //     text: '水井伞形开采指标'\n        // }\n    ];\n    var store = new vmd.data.Store({\n        data: datas,\n        fields: ['id', 'text']\n    })\n    mingingType.store = store;\n    mingingType.valueField = 'id';\n    mingingType.displayField = 'text';\n}\n\nfunction mingingPos_afterrender(sender) {\n    var datas = [{\n        id: '左',\n        text: '左'\n    }, {\n        id: '右',\n        text: '右'\n    }, {\n        id: '中',\n        text: '中'\n    }, {\n        id: '上',\n        text: '上'\n    }, {\n        id: '下',\n        text: '下'\n    }, {\n        id: '左上',\n        text: '左上'\n    }, {\n        id: '右上',\n        text: '右上'\n    }];\n    var store = new vmd.data.Store({\n        data: datas,\n        fields: ['id', 'text']\n    })\n    mingingPos.store = store;\n    mingingPos.valueField = 'id';\n    mingingPos.displayField = 'text';\n}\n//获取可视化中定义的所有数据集\nfunction getDatasetNames() {\n    var names = [];\n    var storeRoot = xds.vmd.getRootNode(\"dataset\");\n    if (storeRoot) {\n        storeRoot.eachChild(function(item) {\n            //console.log(xds.vmd.getStoreByDsName(item.id, true))\n            var obj = {\n                id: item.id,\n                text: item.id,\n                child: []\n            }\n            if (item.childNodes && item.childNodes.length > 0) {\n                item.childNodes.forEach(function(value, i) {\n                    obj.child.push({\n                        id: value.text,\n                        text: value.text\n                    })\n                })\n            }\n            names.push(obj)\n        }, this);\n    }\n    return names;\n}\n\n\n\nfunction storeData_selectChanged(sender, combo, record, index) {\n    miningIndexData.dataMapping.source = combo.value;\n    hwFieldFormlist.bindData(miningIndexData.dataMapping);\n    hwAccordionTabs.initTabs(combo.value, miningIndexData.indexs)\n\n}\n\nfunction hwAccordionTabs_delIndex(sender, indexId) {\n    if (miningIndexData.indexs.length === 1) {\n        vmd.alert('请至少保留一项指标')\n        return false;\n    }\n    Ext.Msg.confirm('提示', '确认删除该指标吗?', function(bnt) {\n        if (bnt === 'yes') {\n            for (var i = 0; i < miningIndexData.indexs.length; i++) {\n                if (miningIndexData.indexs[i].id === indexId) {\n                    miningIndexData.indexs.splice(i, 1);\n                    i--;\n                }\n            }\n            for (var i = 0; i < miningIndexData.indexs.length; i++) {\n                for (var j = 0; j < miningIndexData.indexs[i].series.indexs.length; j++) {\n                    var m = miningIndexData.indexs[i].series.indexs[j]\n                    if (m.id === indexId) {\n                        miningIndexData.indexs[i].series.indexs.splice(j, 1);\n                        j--;\n                    }\n                }\n            }\n            hwAccordionTabs.initTabs(miningIndexData.dataMapping.source, miningIndexData.indexs);\n            xds.activePropPanel.fireEvent('DataValueChange', 'addLayer', 'null', miningIndexData, true)\n        }\n    })\n\n}\n\nfunction addIndex_click(sender, e) {\n\n}\n\nfunction panel3_afterrender(sender) {\n    var el = this.header.insertFirst({\n        tag: 'div',\n        cls: 'vmd-icon-plus',\n        style: 'position:absolute;right:20px'\n    })\n    el.on('click', function(e) {\n        stopPP(e)\n        Ext.Msg.confirm('提示', '确认新增指标?', function(bnt) {\n            if (bnt === 'yes') {\n                Ext.require([\n                    'vmd.d.webchart.util.Index'\n                ], function() {\n                    var newIndex = new vmd.d.webchart.util.Index(series, {\n                        \"id\": vmd.getGuid(),\n                        \"field\": \"\",\n                        \"name\": \"新指标\",\n                        \"shortName\": \"\",\n                        \"company\": \"\",\n                        \"color\": \"rgb(255,255,255)\",\n                        \"isShow\": true,\n                        \"companyIsShow\": false,\n                        \"labelIsShow\": false\n                    });\n                    miningIndexData.indexs.push(newIndex)\n                    hwAccordionTabs.initTabs(miningIndexData.dataMapping.source, miningIndexData.indexs);\n                    //xds.activePropPanel.fireEvent('DataValueChange', 'addLayer', 'null', miningIndexData, true)\n                })\n\n            }\n        })\n\n    })\n}\n\n\n\nfunction hwAccordionTabs_nameChang(sender, index, value) {\n    sender.items.items[index].setTitle(value)\n}\n\nfunction hwCheckbox_check(sender, checked) {\n    hwNumberInput.setDisabled(!checked);\n    hwNumberInput1.setDisabled(!checked);\n}","vmdcss":".text-input{\n    border: 1px solid #ddd;\n}","vmdprops":"\"\"","type":"ux","vmdcmpdeps":[],"vmdevents_controller":"","vmdinterface":"{\"components\":[{\"cid\":\"vmduxprops\",\"layoutConfig\":{},\"userConfig\":{}},{\"cid\":\"vmduxmethods\",\"id\":\"方法\",\"layoutConfig\":{},\"userConfig\":{},\"cn\":[{\"cid\":\"uxmethod\",\"id\":\"init\",\"layoutConfig\":{},\"userConfig\":{\"id\":\"init\",\"zhname\":\"\",\"bindCmp\":\"\",\"bindValue\":\"\",\"isPublic\":\"on\",\"desc\":\"\",\"uxcid\":\"\",\"params\":\"data\",\"code\":\"//直接填写方法内容\\ninit(data)\",\"returnType\":\"\"}}]},{\"cid\":\"vmduxevents\",\"id\":\"事件\",\"layoutConfig\":{},\"userConfig\":{}}]}","vmdresource":"{\"components\":[{\"cid\":\"vmdrescsss\",\"layoutConfig\":{},\"userConfig\":{}},{\"cid\":\"vmdresjss\",\"layoutConfig\":{},\"userConfig\":{},\"cn\":[{\"cid\":\"resjs\",\"id\":\"controller.js\",\"layoutConfig\":{},\"userConfig\":{}}]},{\"cid\":\"vmdresimgs\",\"layoutConfig\":{},\"userConfig\":{}}]}"}