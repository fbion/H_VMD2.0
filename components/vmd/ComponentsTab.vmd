{"vmdversion":"2.0.3.0920","vmdlayout":"{\"components\":[{\"cid\":\"uxpanel\",\"id\":\"ComponentsTab\",\"layoutConfig\":{},\"userConfig\":{\"layout\":\"fit\",\"header\":false,\"width\":580,\"height\":200,\"beforerender\":\"ComponentsTab_beforerender\"},\"cn\":[{\"cid\":\"tabpanel\",\"id\":\"MyTabs\",\"layoutConfig\":{},\"userConfig\":{\"height\":320,\"width\":580,\"afterrender\":\"MyTabs_afterrender\",\"activeTab\":1,\"x\":0,\"y\":10,\"tabchange\":\"MyTabs_tabchange\"},\"cn\":[{\"cid\":\"panel\",\"id\":\"panel\",\"layoutConfig\":{},\"userConfig\":{\"title\":\"待办信息\",\"html\":\"\",\"width\":580,\"autoScroll\":false,\"height\":320,\"autoHeight\":false,\"layout\":\"fit\"},\"cn\":[{\"cid\":\"grid\",\"id\":\"MyGrid1\",\"layoutConfig\":{},\"userConfig\":{\"height\":320,\"border\":false,\"header\":false,\"beforerender\":\"MyGrid1_beforerender\",\"x\":\"\",\"enableHdMenu\":true,\"disableHeaderClick\":true,\"disabled\":false,\"hideHeaders\":true,\"hidden\":false,\"style\":\"overflow-x: hidden;\",\"width\":580,\"ctCls\":\"\",\"cls\":\"panalflow\"},\"cn\":[{\"cid\":\"gridcolumn\",\"layoutConfig\":{},\"userConfig\":{\"header\":\"名称\",\"dataIndex\":\"name\",\"align\":\"left\",\"width\":418,\"css\":\"padding-left: 10px;\"},\"name\":\"name\"},{\"cid\":\"gridcolumn\",\"layoutConfig\":{},\"userConfig\":{\"header\":\"createddate\",\"dataIndex\":\"createddate\",\"align\":\"left\",\"width\":200},\"name\":\"createddate\"},{\"cid\":\"gridcolumn\",\"layoutConfig\":{},\"userConfig\":{\"header\":\"id\",\"dataIndex\":\"id\",\"align\":\"left\",\"width\":\"\",\"hidden\":true,\"resizable\":false},\"name\":\"id\"},{\"cid\":\"gridcolumn\",\"layoutConfig\":{},\"userConfig\":{\"header\":\"url\",\"dataIndex\":\"url\",\"align\":\"left\",\"width\":\"\",\"hidden\":true,\"resizable\":false},\"name\":\"url\"}]}]},{\"cid\":\"panel\",\"id\":\"panel1\",\"layoutConfig\":{},\"userConfig\":{\"title\":\"已办信息\",\"html\":\"\",\"border\":false,\"header\":true,\"height\":193},\"cn\":[{\"cid\":\"grid\",\"id\":\"MyGrid\",\"layoutConfig\":{},\"userConfig\":{\"height\":320,\"enableHdMenu\":true,\"disableHeaderClick\":true,\"hideHeaders\":true,\"header\":false,\"border\":false,\"beforerender\":\"MyGrid_beforerender\",\"width\":580},\"cn\":[{\"cid\":\"gridcolumn\",\"layoutConfig\":{},\"userConfig\":{\"header\":\"名称\",\"dataIndex\":\"name\",\"align\":\"left\",\"width\":418,\"css\":\"padding-left: 10px;\"},\"name\":\"name\"},{\"cid\":\"gridcolumn\",\"layoutConfig\":{},\"userConfig\":{\"header\":\"时间\",\"dataIndex\":\"createddate\",\"align\":\"left\",\"width\":200,\"resizable\":false},\"name\":\"createddate\"},{\"cid\":\"gridcolumn\",\"layoutConfig\":{},\"userConfig\":{\"header\":\"id\",\"dataIndex\":\"id\",\"align\":\"center\",\"width\":500,\"resizable\":false,\"hidden\":true},\"name\":\"id\"},{\"cid\":\"gridcolumn\",\"layoutConfig\":{},\"userConfig\":{\"header\":\"url\",\"dataIndex\":\"url\",\"align\":\"center\",\"width\":500,\"resizable\":false,\"hidden\":true},\"name\":\"url\"}]}]}]}]}]}","vmdevents":"var page = this;\nhwMSC.host = vmd.workspace.msgIp;\nvar usermodel = {};\nvar lb = 'db';\n// 创建待办数据集。\nvar store1 = new Ext.data.JsonStore({\n    proxy: new Ext.data.MemoryProxy(),\n    fields: [\"appid\", \"xh\", \"taskid\", \"name\", \"createddate\", \"flownode\", \"flowinst\", \"tasktype\", \"fromkey\", \"tasklink\", \"businesskey\"]\n})\n// 创建已办数据集。\nvar store2 = new Ext.data.JsonStore({\n    proxy: new Ext.data.MemoryProxy(),\n    fields: [\"appid\", \"xh\", \"taskid\", \"name\", \"createddate\", \"flownode\", \"flowinst\", \"tasktype\", \"fromkey\", \"tasklink\", \"businesskey\"]\n})\n//组件加载完事件\nfunction MyTabs_afterrender(sender) {\n    var el = MyTabs.el.dom.childNodes[0].childNodes[0].childNodes[0].childNodes[1].id;\n    vmd(\"#\" + el + \"\").after(\"<li class='x-tab-edge' style='width:400px;' id='eweu'><a class='x-tab-right' href='#'><span class='x-tab-strip-inner' style='margin:7px 0 0 0;'><span class='x-tab-strip-text' style='color:#000;float:right;' onclick='more();'>+更多</span></span></a></li>\");\n}\n//待办数据集\nfunction MyGrid1_beforerender(sender) {\n    this.store = store1\n}\n\n\n//已办数据集。\nfunction MyGrid_beforerender(sender) {\n    this.store = store2;\n    // console.log(MyGrid1.el.dom.childNodes[1])//MyGrid1.el.dom.childNodes[1].innerHtml(\"无待办信息！\");\n}\n//更多按钮点击事件\nwindow.more = function() {\n    //页面跳转\n    if(lb == 'db') {\n        var win = new vmd.window({\n            url: './hwa623b009.html?lb=' + lb,\n            auto: false,\n            title: \"待办数据\",\n            width: '700px',\n            style: 'border:0px !important',\n            align: 'center',\n        });\n    } else {\n        var win = new vmd.window({\n            url: './hwa623b009.html?lb=' + lb,\n            auto: false,\n            title: \"已办数据\",\n            width: '700px',\n            style: 'border:0px !important',\n            align: 'center',\n        });\n    }\n    win.show();\n}\n//获取用户信息\nfunction loadUserInfo(callback) {\n    debugger;\n    if(usermodel && usermodel.login) {\n        callback()\n    } else {\n        //获取用户角色信息 \n        vmd.webBase.getUserRoleInfo(function(res, model) {\n            /* var modelRoleid = [],\n                 modelRolename = [];*/\n            usermodel.roleids = \"\";\n            usermodel.rolenames = \"\";\n            if(model && model.length > 0) {\n                usermodel.login = model[0].userlogin;\n                usermodel.name = model[0].username;\n                usermodel.userid = model[0].userid;\n                for(var i = 0; i < model.length; i++) {\n                    if(usermodel.roleids) {\n                        usermodel.roleids = usermodel.roleids + \",\" + model[i].roleid;\n                    } else {\n                        usermodel.roleids = model[i].roleid;\n                    }\n                    if(usermodel.rolenames) {\n                        usermodel.rolenames = usermodel.rolenames + \",\" + model[i].rolename;\n                    } else {\n                        usermodel.rolenames = model[i].rolename;\n                    }\n                    /*modelRoleid.push(model[i].roleid);\n                    modelRolename.push(model[i].rolename);*/\n                }\n            }\n            if(callback && typeof callback === \"function\") {\n                callback()\n            }\n            /* //获取用户岗位信息\n             vmd.webBase.getUserPositionInfo(function(result, mod) {\n                 var roleIdList = [],\n                     roleNameList = [];\n                 if(mod && mod.length > 0) {\n                     for(var i = 0; i < mod.length; i++) {\n                         //根据岗位获取角色\n                         var dwid = mod[i].positionid;\n                         var hwDao = new HwDao(vmd.workspace.dataServiceIp, 'webxpt');\n                         var url = 'platform/v1/positionRole';\n                         hwDao.get(url, {}, {\n                             positionid: dwid\n                         }, function(res) {\n                             if(res.isSucceed) {\n                                 if(res.data && res.data[0].datas.length > 0) {\n                                     var data = res.data[0].datas;\n                                     for(var i = 0; i < data.length; i++) {\n                                         roleIdList.push(data[i].roleid);\n                                         roleNameList.push(data[i].rolename);\n                                     }\n                                     //用户角色与岗位角色取并集\n                                     var roleid = mergeArray(modelRoleid, roleIdList);\n                                     var rolename = mergeArray(modelRolename, roleNameList);\n                                     usermodel.roleids = roleid.join(',');\n                                     usermodel.rolenames = rolename.join(',');\n                                 }\n                                  if(callback && typeof callback === \"function\") {\n                                      callback()\n                                  }\n                             } else {\n                                 alert(res.errMsg);\n                             }\n                         }, function(res) {\n                             alert(res);\n                         });\n                     }\n                 } else {\n                     usermodel.roleids = modelRoleid.join(',');\n                     usermodel.rolenames = modelRolename.join(',');\n                     if(callback && typeof callback === \"function\") {\n                         callback()\n                     }\n                 }\n             })*/\n        })\n\n    }\n}\n//用户角色与岗位角色取并集\n/*function mergeArray(arr1, arr2) {\n    var arr = [];\n    for(var i = 0; i < arr1.length; i++) {\n        arr.push(arr1[i]);\n    }\n    var dup;\n    for(var i = 0; i < arr2.length; i++) {\n        dup = false;\n        for(var j = 0; j < arr1.length; j++) {\n            if(arr2[i] == arr1[j]) {\n                dup = true;\n                break;\n            }\n        }\n        if(!dup) {\n            arr.push(arr2[i]);\n        }\n    }\n    return arr;\n}\n*/\n//加载待办数据\nwindow.loadStoreDb = function() {\n    var DbList = [];\n    hwMSC.taskTodoGet(usermodel.login, usermodel.roleids, 1, 9, function(data) {\n        if(data && data.msg) {\n            var dataJson = vmd.decode(data.msg);\n            if(dataJson.length > 0) {\n                for(var i = 0; i < dataJson.length; i++) {\n\n                    var itemObj = {\n                        xh: i + 1,\n                        appid: dataJson[i].appId,\n                        taskid: dataJson[i].flow_task_id,\n                        name: \"<a href='#' onclick='rowLink(\" + i + \");'>\" + dataJson[i].title + \"</a>\",\n                        createddate: dataJson[i].row_create_date,\n                        flownode: dataJson[i].flow_node_id,\n                        flowinst: dataJson[i].flow_inst_id,\n                        tasktype: dataJson[i].task_type,\n                        fromkey: dataJson[i].from_key,\n                        tasklink: dataJson[i].task_link,\n                        businesskey: dataJson[i].business_key\n                    }\n\n                    DbList.push(itemObj);\n                }\n                store1.loadData(DbList);\n            } else {\n                panel.el.dom.childNodes[0].innerText = \"您当前无待办信息！\";\n            }\n        } else {\n            panel.el.dom.childNodes[0].innerText = \"您当前无待办信息！\";\n        }\n    }, function() {\n        //alert(arguments);\n        panel.el.dom.childNodes[0].innerText = \"查询您的待办信息异常，请刷新界面重试！\";\n    })\n}\n//加载已办数据\nwindow.loadStoreYb = function() {\n    var YbList = [];\n    hwMSC.taskDoGet(usermodel.login, 1, 9, function(data) {\n        if(data && data.msg) {\n            var dataJson = vmd.decode(data.msg);\n            if(dataJson.length > 0) {\n                for(var i = 0; i < dataJson.length; i++) {\n                    var itemObj = {\n                        xh: i + 1,\n                        appid: dataJson[i].appId,\n                        taskid: dataJson[i].task_id,\n                        name: \"<a href='#' onclick='rowLink(\" + i + \");'>\" + dataJson[i].title + \"</a>\",\n                        createddate: dataJson[i].row_create_date,\n                        flownode: dataJson[i].flow_node_id,\n                        flowinst: dataJson[i].flow_inst_id,\n                        tasktype: dataJson[i].task_type,\n                        fromkey: dataJson[i].from_key,\n                        tasklink: dataJson[i].task_link,\n                        businesskey: dataJson[i].business_key\n                    }\n                    YbList.push(itemObj);\n                }\n                store2.loadData(YbList);\n            } else {\n                panel1.el.dom.childNodes[0].innerText = \"您当前无已办信息！\";\n            }\n        } else {\n            panel1.el.dom.childNodes[0].innerText = \"您当前无已办信息！\";\n        }\n    }, function() {\n        panel.el.dom.childNodes[0].innerText = \"查询您的已办信息异常，请刷新界面重试！\";\n    })\n}\n\n\n//点击跳转\nwindow.rowLink = function(id) {\n    var rowdata = lb == \"db\" ? MyGrid1.getStore().data.items[id].data : MyGrid.getStore().data.items[id].data;\n    var tokenparam = vmd.Cookie.get(\"hwToken\") || vmd.getUrlParam('hwToken');\n\n    if(rowdata) {\n        if(tokenparam) {\n            tokenparam = \"&hwToken=\" + tokenparam;\n        }\n        var linkparam = 'lb=' + lb + '&taskid=' + rowdata.taskid + '&taskId=' + rowdata.taskid + '&flowinstid=' + rowdata.flowinst + \"&flownodeid=\" + rowdata.flownode + \"&businesskey=\" + rowdata.businesskey + tokenparam;\n        if(rowdata.fromkey) {\n            //查询模块路径\n            vmd.webBase.getModuleInfo(rowdata.fromkey, '', function(res, model) {\n\n                if(model && model[0].abspath) {\n                    window.open('' + model[0].abspath + (model[0].abspath.indexOf('&') != -1 ? '&' : '?') + linkparam, '_blank')\n                }\n            })\n        } else if(rowdata.tasklink) {\n            window.open('' + rowdata.tasklink + (rowdata.tasklink.indexOf('&') != -1 ? '&' : '?') + linkparam, '_blank')\n        } else {\n            alert(\"当前未配置超链接地址！\");\n        }\n    }\n\n}\n\n//tab切换事件\nfunction MyTabs_tabchange(sender, tab) {\n    if(tab.title == '待办信息') {\n        lb = 'db';\n        loadUserInfo(loadStoreDb);\n    } else if(tab.title == '已办信息') {\n        lb = 'yb';\n        loadUserInfo(loadStoreYb);\n\n    }\n}\n\nfunction ComponentsTab_beforerender(sender) {\n    var hwToken = vmd.getUrlParam('hwToken');\n    if(hwToken) {\n        vmd.Cookie.set('hwToken', hwToken);\n    }\n}","vmdcss":".info a {\r\n    \r\n   text-decoration:none; \r\n}\r\n.info a:link {\r\n    color: #3284ff; text-decoration:none;\r\n    \r\n}\r\na{\r\n     color: #3284ff !important;\r\n}\r\n.info a:active:{\r\n    color: red;\r\n    } \r\n.info a:visited {\r\n    color:purple;text-decoration:none;\r\n    \r\n} \r\n.info a:hover {\r\n    color: red; text-decoration:underline;\r\n    \r\n} \r\n.x-grid3-scroller {\r\noverflow: hidden\r\n}\r\n.x-window-mc {\r\n    border-width: 0px !important;\r\n    margin: 0 auto;\r\n}\r\n.x-viewport body {\r\n    overflow: hidden;\r\n    margin-top: 10px;\r\n}","vmdprops":"\"\"","type":"ux","vmdinterface":"{\"components\":[{\"cid\":\"vmduxprops\",\"layoutConfig\":{},\"userConfig\":{},\"cn\":[{\"cid\":\"uxprop\",\"id\":\"ip\",\"layoutConfig\":{},\"userConfig\":{\"id\":\"ip\",\"zhname\":\"数据服务\",\"bindCmp\":\"MyTabs\",\"bindValue\":\"ip\",\"isPublic\":\"on\",\"desc\":\"数据服务\",\"uxcid\":\"tabpanel\",\"group\":\"\",\"cmptype\":\"string\",\"cmpsettings\":\"{\\\"isMulti\\\":false,\\\"data\\\":\\\"\\\"}\"}},{\"cid\":\"uxprop\",\"id\":\"callCode\",\"layoutConfig\":{},\"userConfig\":{\"id\":\"callCode\",\"zhname\":\"授权码\",\"bindCmp\":\"MyTabs\",\"bindValue\":\"callCode\",\"isPublic\":\"on\",\"desc\":\"授权码\",\"uxcid\":\"tabpanel\",\"group\":\"\",\"cmptype\":\"string\",\"cmpsettings\":\"{\\\"isMulti\\\":false,\\\"data\\\":\\\"\\\"}\"}},{\"cid\":\"uxprop\",\"id\":\"url\",\"layoutConfig\":{},\"userConfig\":{\"id\":\"url\",\"zhname\":\"数据服务地址\",\"bindCmp\":\"MyTabs\",\"bindValue\":\"url\",\"isPublic\":\"on\",\"desc\":\"数据服务地址\",\"uxcid\":\"tabpanel\",\"group\":\"\",\"cmptype\":\"string\",\"cmpsettings\":\"{\\\"isMulti\\\":false,\\\"data\\\":\\\"\\\"}\"}},{\"cid\":\"uxprop\",\"id\":\"hwip\",\"layoutConfig\":{},\"userConfig\":{\"id\":\"hwip\",\"desc\":\"获取待办已办ip\",\"zhname\":\"待办已办ip\",\"isPublic\":\"on\",\"radio_utMS\":\"string\",\"bindCmp\":\"MyTabs\",\"bindValue\":\"hwip\",\"uxcid\":\"tabpanel\",\"cmptype\":\"string\",\"cmpsettings\":\"{\\\"isMulti\\\":false,\\\"data\\\":\\\"\\\"}\"}}]},{\"cid\":\"vmduxmethods\",\"id\":\"方法\",\"layoutConfig\":{},\"userConfig\":{}},{\"cid\":\"vmduxevents\",\"id\":\"事件\",\"layoutConfig\":{},\"userConfig\":{}}]}"}