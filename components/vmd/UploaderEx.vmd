{"vmdversion":"vmd2.0.6.200119","vmdlayout":"{\"components\":[{\"cid\":\"uxpanel\",\"id\":\"UploaderEx\",\"layoutConfig\":{},\"userConfig\":{\"layout\":\"fit\",\"header\":false,\"width\":718,\"height\":550,\"afterrender\":\"UploaderEx_afterrender\"},\"cn\":[{\"cid\":\"panel\",\"id\":\"panel\",\"layoutConfig\":{},\"userConfig\":{\"x\":170,\"y\":110,\"html\":\"<iframe width=\\\"100%\\\" height=\\\"100%\\\" scrolling=\\\"no\\\" frameborder=0></iframe>\",\"header\":false,\"afterrender\":\"panel_afterrender\"}}]},{\"cid\":\"vmddataset\",\"id\":\"数据\",\"layoutConfig\":{},\"userConfig\":{}}]}","vmdevents":"var page = this;\n\nfunction intuploader() {\n    var iframe = Ext.getDom(page.el.child('iframe'));\n    if (!iframe) return\n    iframe.src = vmd.virtualPath + '/js/plugins/file/index.html';\n    iframe.onload = function() {\n\n\n        page.uploadframe = iframe;\n        iframe.contentWindow.uploaderInit(function(uploader) {\n            page.fireEvent('loaded', page, uploader)\n            page.uploader = uploader;\n\n            //兼容upload2\n            page.uploader.upload2 = upload;\n            //第一次加载\n            if (page._doUploader) {\n                page._doUploader();\n            }\n\n        }, {\n            fileNumLimit: page.fileNumLimit,\n            mimeTypes: page.mineTypes,\n            host: vmdSettings.dataServiceIp,\n            virtualPath: vmd.virtualPath\n        })\n    }\n\n}\n\nfunction UploaderEx_afterrender(sender) {\n    //加载样式及脚本\n\n    // vmd.loadCss(vmd.virtualPath+'/lib/webuploader/webuploader.css');\n    // vmd.loadCss(vmd.virtualPath+'/js/plugins/file/file.css');\n    // $LAB.script(vmd.virtualPath+'/lib/webuploader/webuploader.min.js')\n    // .script(vmd.virtualPath+'/js/plugins/file/file.js')\n    // .wait(function(){\n\n    //     window.uploaderInit(function(uploader){\n    //         page.fireEvent('loaded',page,uploader)\n    //         page.uploader=uploader;\n    //     },{\n    //         fileNumLimit:page.fileNumLimit,\n    //         mimeTypes:page.mineTypes\n    //     })\n\n    // })\n\n\n    //intuploader()\n\n\n}\n\nfunction setDirUpload(isEnableDirUpload) {\n    if (isEnableDirUpload) {\n        //能够上传文件夹\n        page.uploader.isEnableDirUpload = true;\n        //vmd('.webuploader-element-invisible').attr('webkitdirectory', '').attr('directory', '');\n        vmd(iframeScope.document).find('.webuploader-element-invisible').attr('webkitdirectory', '').attr('directory', '');\n\n    } else {\n        //只能上传文件\n        page.uploader.isEnableDirUpload = false;\n        //vmd('.webuploader-element-invisible').removeAttr('webkitdirectory').removeAttr('directory');\n        vmd(iframeScope.document).find('.webuploader-element-invisible').removeAttr('webkitdirectory').removeAttr('directory');\n\n    }\n\n}\n\nfunction upload(title, savedir, callback, hwcode, host) {\n\n    var me = this;\n\n    //  var Uploader=this._scope;\n\n    var filetype;\n    // if (!Uploader) return;\n    if (Ext.isObject(title)) {\n        var _upload = Ext.clone(title);\n        title = _upload.title;\n        savedir = _upload.savedir;\n        callback = _upload.callback;\n        hwcode = _upload.hwcode;\n        host = _upload.host;\n       \n        if(_upload.url) host=_upload.url;\n    }\n    if (page.uploadframe) {\n        var iframeScope = page.uploadframe.contentWindow;\n\n        //  iframeScope.utils.options['fileAllowFiles'] = filetype || iframeScope.utils.getOpt('fileAllowFiles')\n    }\n\n    if (!page.win) {\n\n        page.win = new vmd.window({\n            items: page,\n            auto: false,\n            height: 500,\n            width: 655,\n            maximizable: false,\n            resizable: false,\n            closeAction: 'hide',\n            title: title || \"文件上传\"\n        })\n        intuploader()\n    }\n\n\n\n    page.show()\n\n    page.win.show();\n    page.win.hide();\n\n    page._doUploader = function() {\n\n        var iframeScope = page.uploadframe.contentWindow;\n        //上传接口\n        hwcode = hwcode || iframeScope.utils.hwcode;\n        page.uploader.uploader.on('ready', function(file) {\n\n            vmd(iframeScope.document).find('#filePickerReady .webuploader-element-invisible').click()\n\n        })\n\n        page.uploader.upload(host, savedir, page.win, callback, hwcode);\n        //page.uploader.upload(null, savedir, page.win, callback, hwcode);\n        //注册事件\n        page.uploader.uploader.on('fileQueued', function(file) {\n\n        })\n\n    }\n    //自动触发\n    page.uploadframe && page._doUploader()\n\n\n\n}\n\n\nfunction panel_afterrender(sender) {\n\n}","vmdcss":"","vmdprops":"\"\"","type":"ux","vmdinterface":"{\"components\":[{\"cid\":\"vmduxprops\",\"layoutConfig\":{},\"userConfig\":{},\"cn\":[{\"cid\":\"uxprop\",\"id\":\"mineTypes\",\"layoutConfig\":{},\"userConfig\":{\"id\":\"mineTypes\",\"zhname\":\"\",\"bindCmp\":\"panel\",\"bindValue\":\"mineTypes\",\"isPublic\":\"on\",\"desc\":\"上传类型\",\"uxcid\":\"panel\",\"group\":\"\",\"cmptype\":\"combo\",\"cmpsettings\":\"{\\\"isMulti\\\":true,\\\"data\\\":\\\"[{\\\\n    text: '.xls',\\\\n    value: '.xls'\\\\n}, {\\\\n    text: '.xlsx',\\\\n    value: '.xlsx'\\\\n}, {\\\\n    text: '.doc',\\\\n    value: '.doc'\\\\n}, {\\\\n    text: '.docx',\\\\n    value: '.docx'\\\\n}, {\\\\n    text: '.exe',\\\\n    value: '.exe'\\\\n}, {\\\\n    text: '.jpeg',\\\\n    value: '.jpeg'\\\\n}, {\\\\n    text: '.jpg',\\\\n    value: '.jpg'\\\\n}, {\\\\n    text: '.png',\\\\n    value: '.png'\\\\n}, {\\\\n    text: '.txt',\\\\n    value: '.txt'\\\\n}, {\\\\n    text: '.ppt',\\\\n    value: '.ppt'\\\\n}, {\\\\n    text: '.pptx',\\\\n    value: '.pptx'\\\\n}, {\\\\n    text: '.pdf',\\\\n    value: '.pdf'\\\\n}, {\\\\n    text: '.xml',\\\\n    value: '.xml'\\\\n}, {\\\\n    text: '.zip',\\\\n    value: '.zip'\\\\n}, {\\\\n    text: '.rar',\\\\n    value: '.rar'\\\\n}, {\\\\n    text: '.js',\\\\n    value: '.js'\\\\n}, {\\\\n    text: '.json',\\\\n    value: '.json'\\\\n}, {\\\\n    text: '.html',\\\\n    value: '.html'\\\\n}, {\\\\n    text: '.htm',\\\\n    value: '.htm'\\\\n}, {\\\\n    text: '.css',\\\\n    value: '.css'\\\\n}]\\\"}\",\"radio_5KRC\":\"combo\",\"combo_multi\":\"on\"}},{\"cid\":\"uxprop\",\"id\":\"fileNumLimit\",\"layoutConfig\":{},\"userConfig\":{\"id\":\"fileNumLimit\",\"zhname\":\"\",\"bindCmp\":\"panel\",\"bindValue\":\"fileNumLimit\",\"isPublic\":\"on\",\"desc\":\"上传文件的个数\",\"uxcid\":\"panel\",\"group\":\"\",\"cmptype\":\"number\",\"cmpsettings\":\"{\\\"isMulti\\\":true,\\\"data\\\":\\\"\\\"}\"}}]},{\"cid\":\"vmduxmethods\",\"id\":\"方法\",\"layoutConfig\":{},\"userConfig\":{},\"cn\":[{\"cid\":\"uxmethod\",\"id\":\"getUploader\",\"layoutConfig\":{},\"userConfig\":{\"id\":\"getUploader\",\"zhname\":\"\",\"bindCmp\":\"\",\"bindValue\":\"\",\"isPublic\":\"on\",\"desc\":\"\",\"uxcid\":\"\",\"params\":\"\",\"code\":\"//直接填写方法内容\\nthis.uploader._scope = this;\\nreturn this.uploader\\n\",\"returnType\":\"对象\"}},{\"cid\":\"uxmethod\",\"id\":\"enableDirUpload\",\"layoutConfig\":{},\"userConfig\":{\"id\":\"enableDirUpload\",\"zhname\":\"\",\"bindCmp\":\"\",\"bindValue\":\"\",\"isPublic\":\"on\",\"desc\":\"\",\"uxcid\":\"\",\"params\":\"\",\"code\":\"//直接填写方法内容\\nsetDirUpload(true)\",\"returnType\":\"\"}},{\"cid\":\"uxmethod\",\"id\":\"disableDirUpload\",\"layoutConfig\":{},\"userConfig\":{\"id\":\"disableDirUpload\",\"zhname\":\"\",\"bindCmp\":\"\",\"bindValue\":\"\",\"isPublic\":\"on\",\"desc\":\"\",\"uxcid\":\"\",\"params\":\"\",\"code\":\"//直接填写方法内容\\nsetDirUpload(false)\",\"returnType\":\"\"}},{\"cid\":\"uxmethod\",\"id\":\"upload\",\"layoutConfig\":{},\"userConfig\":{\"id\":\"upload\",\"zhname\":\"\",\"bindCmp\":\"\",\"bindValue\":\"\",\"isPublic\":\"on\",\"desc\":\"\",\"uxcid\":\"\",\"params\":\"title,savedir,callback,hwcode,host\",\"code\":\"//直接填写方法内容\\nupload(title, savedir, callback, hwcode,host)\",\"returnType\":\"\"}}]},{\"cid\":\"vmduxevents\",\"id\":\"事件\",\"layoutConfig\":{},\"userConfig\":{},\"cn\":[{\"cid\":\"uxevent\",\"id\":\"loaded\",\"layoutConfig\":{},\"userConfig\":{\"id\":\"loaded\",\"zhname\":\"\",\"bindCmp\":\"\",\"bindValue\":\"\",\"isPublic\":\"\",\"desc\":\"组件初始化完成\",\"uxcid\":\"\",\"params\":\"uploader\",\"code\":\"\"}}]}]}","vmdresource":"{\"components\":[{\"cid\":\"vmdrescsss\",\"layoutConfig\":{},\"userConfig\":{}},{\"cid\":\"vmdresjss\",\"layoutConfig\":{},\"userConfig\":{},\"cn\":[{\"cid\":\"resjs\",\"id\":\"controller.js\",\"layoutConfig\":{},\"userConfig\":{}}]},{\"cid\":\"vmdresimgs\",\"layoutConfig\":{},\"userConfig\":{}}]}"}