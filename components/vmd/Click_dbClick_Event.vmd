{"vmdversion":"vmd2.0.5.191031","vmdlayout":"{\"components\":[{\"cid\":\"uxpanel\",\"id\":\"Click_dbClick_Event\",\"layoutConfig\":{},\"userConfig\":{\"layout\":\"absolute\",\"header\":false,\"width\":320,\"height\":621,\"beforerender\":\"Click_dbClick_Event_beforerender\"},\"cn\":[{\"cid\":\"label\",\"id\":\"label\",\"layoutConfig\":{},\"userConfig\":{\"x\":20,\"y\":15,\"text\":\"click：\"}},{\"cid\":\"label\",\"id\":\"label1\",\"layoutConfig\":{},\"userConfig\":{\"x\":5,\"y\":45,\"text\":\"dblclick：\",\"hidden\":false}},{\"cid\":\"textfield\",\"id\":\"buttoneve_dbClick\",\"layoutConfig\":{},\"userConfig\":{\"x\":60,\"y\":40,\"width\":190,\"id\":\"buttoneve_dbClick\",\"afterrender\":\"eve_dbClick_afterrender\",\"hidden\":false}},{\"cid\":\"textfield\",\"id\":\"buttoneve_click\",\"layoutConfig\":{},\"userConfig\":{\"x\":60,\"y\":10,\"width\":180,\"id\":\"buttoneve_click\",\"afterrender\":\"eve_click_afterrender\"}},{\"cid\":\"vmdAceEditor\",\"id\":\"hub\",\"layoutConfig\":{},\"userConfig\":{\"x\":320,\"y\":0,\"width\":320,\"height\":260,\"id\":\"hub\",\"hidden\":true}},{\"cid\":\"vmdButton\",\"id\":\"button\",\"layoutConfig\":{},\"userConfig\":{\"x\":260,\"y\":10,\"text\":\"\",\"icon\":\"delete\",\"width\":30,\"click\":\"button_click\"}},{\"cid\":\"vmdButton\",\"id\":\"button1\",\"layoutConfig\":{},\"userConfig\":{\"x\":260,\"y\":40,\"text\":\"\",\"icon\":\"delete\",\"width\":30,\"click\":\"button1_click\",\"hidden\":false}}]}]}","vmdevents":"function eve_click_afterrender(sender) {\r\n    // var hot = parent.sheetHot;\r\n    sender.el.on('dblclick', function() {\r\n        var canWrite = false;\r\n        var cell = sheetHot.dealInvert()[0];\r\n        var mArr = sheetHot.getPlugin('MergeCells').mergedCellsCollection.mergedCells;\r\n        var sel = sheetHot.dealInvert()[0];\r\n        var count = 0;\r\n        if (mArr.length > 0) {\r\n            for (var x = 0; x < mArr.length; x++) {\r\n                for (var i = sel.sr; i < sel.er + 1; i++) {\r\n                    for (var n = sel.sc; n < sel.ec + 1; n++) {\r\n                        if (mArr[x].row == i && mArr[x].col == n) {\r\n                            count++;\r\n                            if (count == 1) no = x;\r\n                        }\r\n                    }\r\n                }\r\n            }\r\n            if (count == 1) {\r\n                if (mArr[no].row + mArr[no].rowspan - 1 == sel.er && mArr[no].col + mArr[no].colspan - 1 == sel.ec) {\r\n                    canWrite = true;\r\n                }\r\n            }\r\n        }\r\n        if (canWrite || (cell.sr == cell.er && cell.sc == cell.ec)) {\r\n            var editor = new vmd.comp.Ace({\r\n                id: \"ace_code\"\r\n            });\r\n            init_def_platformControlData();\r\n            var aceWin = new vmd.window({\r\n                title: \"事件编辑\",\r\n                id: \"aceWin\",\r\n                url: vmd.virtualPath + vmd.vmdCodePath + \"?\" + Date.parse(new Date()),\r\n                offset: [100, 100],\r\n                modal: true,\r\n                maximizable: true,\r\n                maskStyle: 'opacity:0.7',\r\n                layout: 'border',\r\n                draggable: false,\r\n                listeners: {\r\n                    move: function(me, x, y) {\r\n                        this.moveZone(me, x, y);\r\n                    }\r\n                }\r\n            });\r\n            aceWin.closeFn = function() {\r\n                //修复ace tooltip还存在的问题\r\n                Ext.select('.Ace-Tern-tooltip').remove();\r\n                var val = aceWin.val;\r\n                if (aceWin.script == val) {\r\n                    return;\r\n                }\r\n                Ext.Msg.confirm(\"提示\", \"脚本已改变是否保存?\", function(btn) {\r\n\r\n                    if (btn == 'no') return;\r\n                    var click_label = sender;\r\n                    if (val.trim()) {\r\n                        // var ori = xds.vmd.events;\r\n                        xds.vmd.events = val;\r\n                        // var func = xds.vmd.events.replaceAll(ori, '');\r\n                        var name = ('' + sheetHot.rootScope.viewerNode.id + '_' + sheetHot.numToEng(cell.sc) + (cell.sr + 1) + '_buttonclick').toLowerCase()\r\n                        sender.setValue(name)\r\n                        sheetHot.changeAttributeInfo(cell.sr, cell.sc, 'buttoneve_click', name)\r\n                        // addEventForDesignerCmp(vmd.report, name, func)\r\n                        var temp = sheetHot.getCellMeta(cell.sr, cell.sc).cellAttributeInfo;\r\n                        temp.cell_ButtonInfo.buttoneve_click.value = name;\r\n\r\n                    } else {\r\n                        click_label = undefined;\r\n                        delete xds.vmd.events\r\n                    }\r\n                })\r\n            }\r\n            //mafei 在ide-automachjs中\r\n            init_def_platformControlData();\r\n            aceWin.on('close', aceWin.closeFn, this)\r\n            //当前拖拽组件\r\n            window.setTimeout(function() {\r\n                window.setTimeout(function() {\r\n                    //代码编辑器初始化\r\n                    if (typeof rowIndex == \"number\") {\r\n                        aceWin.aceline = rowIndex;\r\n                    }\r\n                }, 150)\r\n                var code = xds.vmd.events;\r\n                var eventName = ('' + sheetHot.rootScope.viewerNode.id + '_' + sheetHot.numToEng(cell.sc) + (cell.sr + 1) + '_buttonclick').toLowerCase();\r\n                // var me = \r\n                var getdefaulteventname = function() {\r\n                    return \"function(sender,grid,cell,rId,cInd,params\" + \"){\\n\" + \"\\n} \\n\";\r\n                }\r\n                var m = getdefaulteventname(),\r\n                    code = code ? code : \"\",\r\n                    replaceStr = \"function {0}{1}\",\r\n                    regex = new RegExp(\"function\\\\s+\" + eventName + \"\\\\s*?\\\\(\");\r\n                if (eventName && code.search(regex) == -1) {\r\n                    var e = m.trim().replace(\"function\", \"\"),\r\n                        i = String.format(replaceStr, eventName, e);\r\n                    code += (code ? \"\\n\\n\" : \"\") + i\r\n                }\r\n                aceWin.script = code;\r\n                aceWin.val = code;\r\n                aceWin.show();\r\n                //进度提示\r\n                var myMask = new Ext.LoadMask(aceWin.el, {\r\n                    msg: \"数据加载中,请稍后...\",\r\n                    msgCls: 'z-index:10000;'\r\n                });\r\n                myMask.show();\r\n                aceWin.loading = myMask;\r\n                //  aceWin.update(\"<iframe  id='iframe_page' src='\" + vmd.virtualPath + vmd.vmdCodePath + \"?\" + Date.parse(new Date()) + \"' width=600 height=900 frameborder=0  ></iframe>\")\r\n                var scriptArr = code.split(\"\\n\"),\r\n                    rowIndex = null;\r\n                Ext.each(scriptArr,\r\n                    function(o, p) {\r\n                        if (o.search(regex) != -1) {\r\n                            rowIndex = p + 2;\r\n                            return false\r\n                        }\r\n                    });\r\n            }, 50)\r\n        } else {\r\n            alert('请选择单个单元格设置事件')\r\n        }\r\n    })\r\n}\r\n\r\nfunction eve_dbClick_afterrender(sender) {\r\n    var hot = parent.sheetHot;\r\n    sender.el.on('dblclick', function() {\r\n        var canWrite = false;\r\n        var cell = sheetHot.dealInvert()[0];\r\n        var mArr = sheetHot.getPlugin('MergeCells').mergedCellsCollection.mergedCells;\r\n        var sel = sheetHot.dealInvert()[0];\r\n        var count = 0;\r\n        if (mArr.length > 0) {\r\n            for (var x = 0; x < mArr.length; x++) {\r\n                for (var i = sel.sr; i < sel.er + 1; i++) {\r\n                    for (var n = sel.sc; n < sel.ec + 1; n++) {\r\n                        if (mArr[x].row == i && mArr[x].col == n) {\r\n                            count++;\r\n                            if (count == 1) no = x;\r\n                        }\r\n                    }\r\n                }\r\n            }\r\n            if (count == 1) {\r\n                if (mArr[no].row + mArr[no].rowspan - 1 == sel.er && mArr[no].col + mArr[no].colspan - 1 == sel.ec) {\r\n                    canWrite = true;\r\n                }\r\n            }\r\n        }\r\n        if (canWrite || (cell.sr == cell.er && cell.sc == cell.ec)) {\r\n            var editor = new vmd.comp.Ace({\r\n                id: \"ace_code\"\r\n            });\r\n            init_def_platformControlData();\r\n            var aceWin = new vmd.window({\r\n                title: \"事件编辑\",\r\n                id: \"aceWin\",\r\n                url: vmd.virtualPath + vmd.vmdCodePath + \"?\" + Date.parse(new Date()),\r\n                offset: [100, 100],\r\n                modal: true,\r\n                maximizable: true,\r\n                maskStyle: 'opacity:0.7',\r\n                layout: 'border',\r\n                draggable: false,\r\n                listeners: {\r\n                    move: function(me, x, y) {\r\n                        this.moveZone(me, x, y);\r\n                    }\r\n                }\r\n            });\r\n            aceWin.closeFn = function() {\r\n                //修复ace tooltip还存在的问题\r\n                Ext.select('.Ace-Tern-tooltip').remove();\r\n                var val = aceWin.val;\r\n                if (aceWin.script == val) {\r\n                    return;\r\n                }\r\n                Ext.Msg.confirm(\"提示\", \"脚本已改变是否保存?\", function(btn) {\r\n                    if (btn == 'no') return;\r\n                    var click_label = sender;\r\n                    if (val.trim()) {\r\n                        // var ori = xds.vmd.events;\r\n                        xds.vmd.events = val;\r\n                        // var func = xds.vmd.events.replaceAll(ori, '');\r\n                        var name = ('' + sheetHot.rootScope.viewerNode.id + '_' + sheetHot.numToEng(cell.sc) + (cell.sr + 1) + '_buttondblclick').toLowerCase()\r\n                        sender.setValue(name)\r\n                        sheetHot.changeAttributeInfo(cell.sr, cell.sc, 'buttoneve_dbClick', name)\r\n                        // addEventForDesignerCmp(vmd.report, name, func)\r\n                        \r\n                        var temp = sheetHot.getCellMeta(cell.sr, cell.sc).cellAttributeInfo;\r\n                        temp.cell_ButtonInfo.buttoneve_dbClick.value = name;\r\n                        // cell_ButtonInfo.eve_dbClick.value\r\n                    } else {\r\n                        click_label = undefined;\r\n                        delete xds.vmd.events\r\n                    }\r\n                })\r\n            }\r\n            //mafei 在ide-automachjs中\r\n            init_def_platformControlData();\r\n            aceWin.on('close', aceWin.closeFn, this)\r\n            //当前拖拽组件\r\n            window.setTimeout(function() {\r\n                window.setTimeout(function() {\r\n                    //代码编辑器初始化\r\n                    if (typeof rowIndex == \"number\") {\r\n                        aceWin.aceline = rowIndex;\r\n                    }\r\n                }, 150)\r\n                var code = xds.vmd.events;\r\n                var eventName = ('' + sheetHot.rootScope.viewerNode.id + '_' + sheetHot.numToEng(cell.sc) + (cell.sr + 1) + '_buttondblclick').toLowerCase();\r\n                // var me = \r\n                var getdefaulteventname = function() {\r\n                    return \"function(sender,grid,cell,rId,cInd,nValue,oValue\" + \"){\\n\" + \"\\n} \\n\";\r\n                }\r\n                var m = getdefaulteventname(),\r\n                    code = code ? code : \"\",\r\n                    replaceStr = \"function {0}{1}\",\r\n                    regex = new RegExp(\"function\\\\s+\" + eventName + \"\\\\s*?\\\\(\");\r\n                if (eventName && code.search(regex) == -1) {\r\n                    var e = m.trim().replace(\"function\", \"\"),\r\n                        i = String.format(replaceStr, eventName, e);\r\n                    code += (code ? \"\\n\\n\" : \"\") + i\r\n                }\r\n                aceWin.script = code;\r\n                aceWin.val = code;\r\n                aceWin.show();\r\n                //进度提示\r\n                var myMask = new Ext.LoadMask(aceWin.el, {\r\n                    msg: \"数据加载中,请稍后...\",\r\n                    msgCls: 'z-index:10000;'\r\n                });\r\n                myMask.show();\r\n                aceWin.loading = myMask;\r\n                //  aceWin.update(\"<iframe  id='iframe_page' src='\" + vmd.virtualPath + vmd.vmdCodePath + \"?\" + Date.parse(new Date()) + \"' width=600 height=900 frameborder=0  ></iframe>\")\r\n                var scriptArr = code.split(\"\\n\"),\r\n                    rowIndex = null;\r\n                Ext.each(scriptArr,\r\n                    function(o, p) {\r\n                        if (o.search(regex) != -1) {\r\n                            rowIndex = p + 2;\r\n                            return false\r\n                        }\r\n                    });\r\n            }, 50)\r\n        } else {\r\n            alert('请选择单个单元格设置事件')\r\n        }\r\n    })\r\n}\r\n\r\nfunction setInfo(info) {\r\n    debugger\r\n    buttoneve_click.setValue(info.buttoneve_click.value)\r\n    buttoneve_dbClick.setValue(info.buttoneve_dbClick.value)\r\n}\r\n\r\nfunction button_click(sender, e) {\r\n    var hot = sheetHot;\r\n    var cell = hot.dealInvert()[0];\r\n    if (cell.sr == cell.er && cell.sc == cell.ec) {\r\n        buttoneve_click.setValue('')\r\n        hot.changeAttributeInfo(cell.sr, cell.sc, 'buttoneve_click', '')\r\n    } else {\r\n        alert('请选择单个单元格以删除事件')\r\n    }\r\n}\r\n\r\nfunction button1_click(sender, e) {\r\n    var hot = sheetHot;\r\n    var cell = hot.dealInvert()[0];\r\n    if (cell.sr == cell.er && cell.sc == cell.ec) {\r\n\r\n        buttoneve_dbClick.setValue('')\r\n        hot.changeAttributeInfo(cell.sr, cell.sc, 'buttoneve_dblclick', '')\r\n    } else {\r\n        alert('请选择单个单元格以删除事件')\r\n    }\r\n}\r\n\r\nfunction Click_dbClick_Event_beforerender(sender) {\r\n\r\n}","vmdcss":"","vmdprops":"\"\"","type":"ux","vmdevents_controller":"Ext.define('vmd.ux.click_dbClick_Event.Controller', {\n    xtype: 'vmd.ux.click_dbClick_Event.Controller',\n    constructor: function(options) {\n        \n    }\n})","vmdinterface":"{\"components\":[{\"cid\":\"vmduxprops\",\"layoutConfig\":{},\"userConfig\":{}},{\"cid\":\"vmduxmethods\",\"id\":\"方法\",\"layoutConfig\":{},\"userConfig\":{},\"cn\":[{\"cid\":\"uxmethod\",\"id\":\"setInfo\",\"layoutConfig\":{},\"userConfig\":{\"id\":\"setInfo\",\"params\":\"info\",\"desc\":\"\",\"isPublic\":\"on\",\"code\":\"//直接填写方法内容\\nsetInfo(info)\",\"returnType\":\"\"}}]},{\"cid\":\"vmduxevents\",\"id\":\"事件\",\"layoutConfig\":{},\"userConfig\":{}}]}","vmdresource":"{\"components\":[{\"cid\":\"vmdrescsss\",\"layoutConfig\":{},\"userConfig\":{}},{\"cid\":\"vmdresjss\",\"layoutConfig\":{},\"userConfig\":{},\"cn\":[{\"cid\":\"resjs\",\"id\":\"controller.js\",\"layoutConfig\":{},\"userConfig\":{}}]},{\"cid\":\"vmdresimgs\",\"layoutConfig\":{},\"userConfig\":{}}]}"}