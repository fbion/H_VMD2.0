{"vmdversion":"2.0.3.0701","vmdlayout":"{\"components\":[{\"cid\":\"uxpanel\",\"id\":\"OcxVideoPlayBack\",\"layoutConfig\":{},\"userConfig\":{\"layout\":\"anchor\",\"header\":false,\"width\":886,\"height\":591,\"afterrender\":\"OcxVideoPlayBack_afterrender\"},\"cn\":[{\"cid\":\"panel\",\"id\":\"panel2\",\"layoutConfig\":{},\"userConfig\":{\"region\":\"west\",\"header\":false,\"border\":false,\"hidden\":false,\"anchor\":\"100% 100%\",\"layout\":\"border\"},\"cn\":[{\"cid\":\"panel\",\"id\":\"panel\",\"layoutConfig\":{},\"userConfig\":{\"x\":100,\"y\":90,\"region\":\"center\",\"header\":false,\"height\":547,\"layout\":\"border\",\"border\":false},\"cn\":[{\"cid\":\"container\",\"id\":\"div3\",\"layoutConfig\":{},\"userConfig\":{\"anchor\":\"100% 100%\",\"html\":\"<object classid=\\\"clsid:61978326-6772-4595-9EC3-D23C5CD5E61F\\\" width=\\\"100%\\\" height=\\\"100%\\\" id=\\\"PlayBackOCX\\\" name=\\\"PlayBackOCX\\\">\\r\\n    <param name=\\\"theme\\\" value=\\\"blue\\\">\\r\\n</object>\",\"border\":false,\"hidden\":false,\"region\":\"center\"}}]},{\"cid\":\"panel\",\"id\":\"panel1\",\"layoutConfig\":{\"align\":\"middle\",\"pack\":\"end\"},\"userConfig\":{\"region\":\"south\",\"header\":false,\"height\":30,\"layout\":\"hbox\",\"border\":false},\"cn\":[{\"cid\":\"container\",\"id\":\"div\",\"layoutConfig\":{\"align\":\"middle\",\"pack\":\"start\"},\"userConfig\":{\"layout\":\"hbox\",\"height\":30,\"width\":420,\"border\":false},\"cn\":[{\"cid\":\"vmdButton\",\"id\":\"button1\",\"layoutConfig\":{},\"userConfig\":{\"text\":\"首 页\",\"margins\":\"0 10 0 0\",\"click\":\"button1_click\"}},{\"cid\":\"vmdButton\",\"id\":\"button2\",\"layoutConfig\":{},\"userConfig\":{\"text\":\"上一页\",\"margins\":\"0 10 0 0\",\"click\":\"button2_click\"}},{\"cid\":\"vmdButton\",\"id\":\"button3\",\"layoutConfig\":{},\"userConfig\":{\"text\":\"下一页\",\"margins\":\"0 10 0 0\",\"click\":\"button3_click\"}},{\"cid\":\"vmdButton\",\"id\":\"button4\",\"layoutConfig\":{},\"userConfig\":{\"text\":\"尾 页\",\"margins\":\"0 10 0 0\",\"click\":\"button4_click\"}},{\"cid\":\"label\",\"id\":\"label\",\"layoutConfig\":{},\"userConfig\":{\"html\":\"&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;\",\"margins\":\"0 10 0 0 \"}},{\"cid\":\"label\",\"id\":\"label2\",\"layoutConfig\":{},\"userConfig\":{\"text\":\"到第\",\"margins\":\"0 5 0 0\"}},{\"cid\":\"vmd.ux.PageCheck\",\"id\":\"PageCheck\",\"layoutConfig\":{},\"userConfig\":{\"margins\":\"0 5 0 0 \"}},{\"cid\":\"label\",\"id\":\"label3\",\"layoutConfig\":{},\"userConfig\":{\"text\":\"页\",\"margins\":\"0 5 0 0 \"}},{\"cid\":\"vmdButton\",\"id\":\"button5\",\"layoutConfig\":{},\"userConfig\":{\"text\":\"确定\",\"width\":30,\"size\":\"mini\",\"margins\":\"0 5 0 0 \",\"click\":\"button5_click\"}}]}]}]},{\"cid\":\"panel\",\"id\":\"panel3\",\"layoutConfig\":{},\"userConfig\":{\"region\":\"center\",\"header\":false,\"border\":false,\"layout\":\"border\",\"hidden\":true,\"anchor\":\"100% 100%\"},\"cn\":[{\"cid\":\"container\",\"id\":\"div_error\",\"layoutConfig\":{},\"userConfig\":{\"region\":\"center\",\"width\":614,\"height\":386,\"id\":\"div_error\",\"border\":false,\"style\":\"font-size: 16px;font-family: '微软雅黑';\"},\"cn\":[{\"cid\":\"vmdButton\",\"id\":\"button\",\"layoutConfig\":{},\"userConfig\":{\"type\":\"text\",\"hidden\":true,\"click\":\"button_click\",\"text\":\"请点击此处下载控件，安装时请关闭浏览器\",\"style\":\"font-size: 16px;font-family: '微软雅黑';\"}}]},{\"cid\":\"container\",\"id\":\"div2\",\"layoutConfig\":{},\"userConfig\":{\"region\":\"west\",\"width\":230,\"border\":false}},{\"cid\":\"container\",\"id\":\"div4\",\"layoutConfig\":{},\"userConfig\":{\"region\":\"east\",\"width\":100,\"border\":false}},{\"cid\":\"container\",\"id\":\"div5\",\"layoutConfig\":{},\"userConfig\":{\"region\":\"north\",\"height\":230,\"border\":false}},{\"cid\":\"container\",\"id\":\"div6\",\"layoutConfig\":{},\"userConfig\":{\"region\":\"south\",\"height\":300,\"width\":200,\"border\":false}}]}]}]}","vmdevents":"//操作时间：2018.8.6\n//操作人：焦欣欣\n//功能：视频功能\nvar tree_nodes; //= '966f1583-794d-4640-aee4-c6a71f91e118,966f1583-794d-4640-aee4-c6a71f91e117,966f1583-794d-4640-aee4-c6a71f91e116'; // 树形节点\nvar suoding; //锁定\nvar ggbj = 1; //更改布局\nvar totalPage = 0; //监控点总页数\nvar sumCount = 0; //监控点总个数\nvar pageSize; //每页显示几个监控点\nvar currentPage = 1; //当前页\nvar lunBoTime = 1; //轮播时间\nvar page = this;\n//setValue方法 是马飞写的\n// function setValue(val){\n//     alert(val)\n//     //举个例子，刚才那个page就是复合组建的对象，为加牢一个属性checkedNode\n//     page.checkedNode=val;\n//     refreshVideo()\n// }\n\n\n\n//视频回放页面\nfunction get_shipinhuifang_val(tree_nodes, buju, iszd, type) {\n    // alert('jxx=' + tree_nodes + '布局：' + buju + '重点：' + iszd + '重点类型：' + type)\n    page.tree_nodes = tree_nodes;\n    page.ggbj = buju;\n    page.iszd = iszd;\n    page.type = type;\n    refreshVideo();\n}\n\n//弹一下，看是否得到值\nfunction refreshVideo() {\n    //判断是从主页面进入的、还是从轮播进入的、回放页面进入的\n\n    IEVersion();\n    currentPage = 1;\n    PageCheck.set_val(currentPage); //跳转页\n\n    //获取当前登陆人id\n    var url = \"XXHTS/monitor/rtmonitor/SPJK/songNanshouye/getLoginName/getLoginName\";\n    hwDas.get(url, \"\", \"\", function(res) {\n        if(res.isSucceed) {\n            window.login_id = res.data[0][\"datas\"][0][\":loginname\"];\n        } else {\n            Ext.MessageBox.alert('失败信息', res.errMsg); //alert(\"失败信息：\" + res.errMsg);\n        }\n    });\n    //window.login_id = 'dbadmin';\n\n    //加载js文件\n    // vmd.loadCss(bootPATH + 'lib/webuploader/webuploader.css');\n    // vmd.loadCss(bootPATH + 'js/plugins/file/file.css');\n    $LAB.script(bootPATH + 'components/ux/ocxvideocontent/js/jkl-dumper.js')\n        .script(bootPATH + 'components/ux/ocxvideocontent/js/ObjTree.js')\n        .wait(function() {\n            //加载成功\n            initData(currentPage);\n        })\n    //   debugger;\n    //不要把业务逻辑耦合到组件内部，要尽量多的以属性、方法、和事件的形式 \n    //==========================事件start==================================\n    // var script = document.createElement(\"script\");\n    // //创建language标签\n    // script.setAttribute('language', 'javascript')\n    // //创建for标签\n    // script.setAttribute('for', 'RealTimePlayOcx')\n    // //创建event标签\n    // script.event = \"FireSelectWindow(xmlParament,lWndIndex)\";\n    // //创建script 内容\n    // script.innerHTML = \"alert('FireCatchPicParam('+xmlParament+','+lWndIndex +')');\";\n\n    // document.getElementsByTagName(\"head\")[0].appendChild(script);\n\n    //==========================end==================================\n\n    //initGetVideoInfoById(tree_nodes);//不分页\n\n}\n\n\nfunction OcxVideoPlayBack_afterrender(sender) {\n\n}\n\n//计算总页数\nfunction GetTotalPage(sumCount, pageSize) {\n    totalPage = 0;\n    if(sumCount !== undefined) {\n        if(sumCount / pageSize > parseInt(sumCount / pageSize)) {\n            totalPage = parseInt(sumCount / pageSize) + 1;\n        } else {\n            totalPage = parseInt(sumCount / pageSize);\n        }\n    }\n    return totalPage;\n}\n//初始化得到监控点数据\nfunction initData(currentPage) {\n    button1.disable();\n    button2.disable();\n    button3.disable();\n    button4.disable();\n    button5.disable();\n    suoding = page.suoding; //锁定\n    //PlayBackOCX.GetWndNum()  获取布局个数  1，4，9，16\n    //alert('jxx==' + page.ggbj);\n    if(page.ggbj !== undefined && page.ggbj !== '') {\n        ggbj = page.ggbj //== PlayBackOCX.GetWndNum() ? page.ggbj : PlayBackOCX.GetWndNum(); //更改布局\n    } else {\n        ggbj = 1 //== PlayBackOCX.GetWndNum() ? 4 : PlayBackOCX.GetWndNum(); //更改布局\n    }\n    ggbj = 4;\n    pageSize = ggbj;\n    if(page.tree_nodes !== undefined && page.tree_nodes !== '') {\n        tree_nodes = page.tree_nodes; //树形节点\n        var arr = tree_nodes.split(',');\n        sumCount = arr.length;\n        totalPage = GetTotalPage(sumCount, pageSize);\n        label.setText('共' + totalPage + '页');\n    } else {\n        tree_nodes = '';\n        label.setText('共' + totalPage + '页');\n    }\n    var startRow = (currentPage - 1) * pageSize; //开始显示的监控点\n    var endRow = currentPage * pageSize; //结束显示的监控点\n    initGetVideoInfoByIdpage(tree_nodes, startRow, endRow);\n}\n\n//根据树节点选择的id或者初始化得到重点井的监控点id   获取到监控点所有信息\nfunction initGetVideoInfoByIdpage(val, startRow, endRow) {\n   // debugger\n    var PlayBackOCX = document.getElementById(\"PlayBackOCX\");\n    //PlayBackOCX.SetWndNum(ggbj);\n\n    hwDas.ajax({\n        das: {\n            idedas: true\n        },\n        url: \"XXHTS/monitor/rtmonitor/SPJK/video/getVideoInfoById\",\n        type: 'get',\n        params: {\n            equipment_id: val\n        },\n        success: function(result) {\n            if(result.data[0].datas.length > 0) //从数据库里查询出来的监控点的数据\n            {\n                endRow = result.data[0].datas.length < endRow ? result.data[0].datas.length : endRow;\n               // debugger;\n                for(var i = startRow; i < endRow; i++) {\n                    var j; //为了显示视频的速度快些，对间隔时间进行了处理\n                    if(i == 0)\n                        j = 1;\n                    else\n                        j = (i - (startRow - 1));\n                    (function(i) {\n                        setTimeout(function() {\n                            //回放页面\n                            getHuiFangDataInfo(result, i);\n                            if(i == (endRow - 1)) {\n                                button1.enable();\n                                button2.enable();\n                                button3.enable();\n                                button4.enable();\n                                button5.enable();\n                            }\n                        }, j * 1000);\n                    })(i)\n                }\n\n            } else //从数据库里查询出空数据\n            {\n                return;\n            }\n        },\n        error: function(msg) {\n            Ext.Msg.alert(\"提示\", \"失败信息：\" + msg);\n            return;\n        }\n    })\n}\n//得到回放的数据信息\nfunction getHuiFangDataInfo(result, i) {\n    var CAMERAID = result.data[0].datas[i][\"cameraid\"]; //监控点id\n    var EQUIPMENT_NAME = result.data[0].datas[i][\"equipment_name\"]; //监控点名称\n    var VRMURL = result.data[0].datas[i][\"vrmurl\"]; //VRM的URL地址。回放该字段必填\n    var CAMERAINDEXCODE = result.data[0].datas[i][\"cameraindexcode\"]; //级联预览字段\n    var BEGINTIME = result.data[0].datas[i][\"begintime\"]; //录像回放开始时间。回放该字段必填\n    var ENDTIME = result.data[0].datas[i][\"endtime\"]; //录像回放结束时间。回放该字段必填\n    var RECORDTYPE = result.data[0].datas[i][\"recordtype\"]; //录像类型。回放该字段必填\n    var str = {\n        Parament: [{\n            CameraID: CAMERAID,\n            CameraName: EQUIPMENT_NAME,\n            VRMUrl: VRMURL,\n            CameraIndexCode: CAMERAINDEXCODE,\n            BeginTime: BEGINTIME,\n            EndTime: ENDTIME,\n            RecordType: RECORDTYPE\n        }]\n    };\n    var json = eval(str);\n    var xmlTree = new XML.ObjTree();\n    var xml = xmlTree.writeXML(json);\n    var result = document.getElementById(\"PlayBackOCX\").SetPlayBackParam(xml);\n    document.getElementById(\"PlayBackOCX\").StartQueryRecord(xml);\n}\n\n//首页\nfunction button1_click(sender, e) {\n    var PlayBackOCX = document.getElementById(\"PlayBackOCX\");\n    PlayBackOCX.StopAllPreview(); //停止所有预览 \n    currentPage = 1;\n    PageCheck.set_val(currentPage); //跳转页\n    initData(currentPage);\n}\n//上一页\nfunction button2_click(sender, e) {\n    var PlayBackOCX = document.getElementById(\"PlayBackOCX\");\n    PlayBackOCX.StopAllPreview(); //停止所有预览 \n    if(currentPage <= 1)\n        currentPage = 1;\n    else\n        currentPage--;\n    PageCheck.set_val(currentPage); //跳转页\n    initData(currentPage);\n}\n//下一页\nfunction button3_click(sender, e) {\n    var PlayBackOCX = document.getElementById(\"PlayBackOCX\");\n    PlayBackOCX.StopAllPreview(); //停止所有预览 \n    if(currentPage >= totalPage)\n        currentPage = totalPage;\n    else\n        currentPage++;\n    PageCheck.set_val(currentPage); //跳转页\n    initData(currentPage);\n}\n//尾页\nfunction button4_click(sender, e) {\n    var PlayBackOCX = document.getElementById(\"PlayBackOCX\");\n    PlayBackOCX.StopAllPreview(); //停止所有预览 \n    currentPage = totalPage;\n    PageCheck.set_val(currentPage); //跳转页\n    initData(currentPage);\n}\n//跳转\nfunction button5_click(sender, e) {\n    var PlayBackOCX = document.getElementById(\"PlayBackOCX\");\n    PlayBackOCX.StopAllPreview(); //停止所有预览 \n    //debugger\n    currentPage = PageCheck.get_val();\n    if(currentPage >= totalPage) {\n        currentPage = totalPage;\n        PageCheck.set_val(currentPage);\n    }\n    initData(currentPage);\n}\n\n//判断是否下载注册过ocx\nfunction IsRegionOcx() {\n    if(document.all.PlayBackOCX.object == null) { //搜索注册表是否存在classid为D5E14042-7BF6-4E24-8B01-2F453E8154D7的数据\n        //document.getElementById(div_error.id).innerHTML = '请点击此处下载控件，安装时请关闭浏览器';\n        panel3.show();\n        panel2.hide();\n        button.show();\n        return;\n    } else {\n        //alert(\"已经注册\");\n    }\n}\n//判断是否是ie内核浏览\nfunction IEVersion() {\n    var userAgent = navigator.userAgent; //取得浏览器的userAgent字符串  \n    var isIE = userAgent.indexOf(\"compatible\") > -1 && userAgent.indexOf(\"MSIE\") > -1; //判断是否IE<11浏览器  \n    var isEdge = userAgent.indexOf(\"Edge\") > -1 && !isIE; //判断是否IE的Edge浏览器  \n    var isIE11 = userAgent.indexOf('Trident') > -1 && userAgent.indexOf(\"rv:11.0\") > -1;\n    if(isIE) {\n        var reIE = new RegExp(\"MSIE (\\\\d+\\\\.\\\\d+);\");\n        reIE.test(userAgent);\n        var fIEVersion = parseFloat(RegExp[\"$1\"]);\n        if(fIEVersion == 7) {\n            return 7;\n        } else if(fIEVersion == 8) {\n            return 8;\n        } else if(fIEVersion == 9) {\n            return 9;\n        } else if(fIEVersion == 10) {\n            return 10;\n        } else {\n            return 6; //IE版本<=7\n        }\n        panel3.hide();\n        panel2.show();\n        IsRegionOcx();\n    } else if(isEdge) {\n        panel3.hide();\n        panel2.show();\n        IsRegionOcx();\n        return; //edge\n    } else if(isIE11) {\n        panel3.hide();\n        panel2.show();\n        IsRegionOcx();\n        return; //IE11  \n    } else {\n        document.getElementById(div_error.id).innerHTML = '当前视频控件只支持IE内核的浏览器，建议使用IE浏览器进行操作'\n        //或者\n        // div_error.el.dom.innerHTML='当前视频控件只支持IE内核的浏览器，建议用IE浏览器进行操作'\n        //以上两种都可以\n        panel3.show();\n        panel2.hide();\n        return -1; //不是ie浏览器\n    }\n}\n\nfunction button_click(sender, e) {\n    //bootPATH + 'components/ux/ocxvideocontent/js/ObjTree.js'\n    window.open(bootPATH + 'components/ux/ocxvideocontent/ocx/cmsocx.exe', '_self')\n}","vmdcss":".page-cls {\n    margin-left: 10px;\n}","vmdprops":"\"\"","type":"ux","vmdinterface":"{\"components\":[{\"cid\":\"vmduxprops\",\"layoutConfig\":{},\"userConfig\":{}},{\"cid\":\"vmduxmethods\",\"id\":\"方法\",\"layoutConfig\":{},\"userConfig\":{},\"cn\":[{\"cid\":\"uxmethod\",\"id\":\"get_val\",\"layoutConfig\":{},\"userConfig\":{\"id\":\"get_val\",\"zhname\":\"\",\"bindCmp\":\"\",\"bindValue\":\"\",\"isPublic\":\"on\",\"desc\":\"sign:标识是从主页面进入的就为空，如果从轮播进入的就是lb\",\"uxcid\":\"\",\"params\":\"tree_nodes,buju,suoding,iszd,type,sign\",\"code\":\"//直接填写方法内容\\nget_val(tree_nodes,buju,suoding,iszd,type,sign)\",\"returnType\":\"\"}},{\"cid\":\"uxmethod\",\"id\":\"get_lunbo_val\",\"layoutConfig\":{},\"userConfig\":{\"id\":\"get_lunbo_val\",\"zhname\":\"\",\"bindCmp\":\"\",\"bindValue\":\"\",\"isPublic\":\"on\",\"desc\":\"树节点、布局、锁定、是否是重点：1重点  0导航、重点下边的类别、标识：主页面进入还是轮播页面进入、轮播时间\",\"uxcid\":\"\",\"params\":\"tree_nodes,buju,suoding,iszd,type,sign,lunbotime\",\"code\":\"//直接填写方法内容\\nget_lunbo_val(tree_nodes,buju,suoding,iszd,type,sign,lunbotime)\",\"returnType\":\"\"}},{\"cid\":\"uxmethod\",\"id\":\"get_shipinhuifang_val\",\"layoutConfig\":{},\"userConfig\":{\"id\":\"get_shipinhuifang_val\",\"zhname\":\"\",\"bindCmp\":\"\",\"bindValue\":\"\",\"isPublic\":\"on\",\"desc\":\"树节点、布局、标识：主页面进入、轮播页面进入、回放页面进入\",\"uxcid\":\"\",\"params\":\"tree_nodes,buju,iszd,type\",\"code\":\"//直接填写方法内容\\nget_shipinhuifang_val(tree_nodes,buju,iszd,type)\",\"returnType\":\"\"}}]},{\"cid\":\"vmduxevents\",\"id\":\"事件\",\"layoutConfig\":{},\"userConfig\":{}}]}"}