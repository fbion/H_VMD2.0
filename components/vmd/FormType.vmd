{"vmdversion":"vmd2.0.4.190810","vmdlayout":"{\"components\":[{\"cid\":\"uxpanel\",\"id\":\"FormType\",\"layoutConfig\":{},\"userConfig\":{\"layout\":\"fit\",\"header\":false,\"width\":300,\"height\":700,\"autoScroll\":true},\"cn\":[{\"cid\":\"panel\",\"id\":\"panel\",\"layoutConfig\":{},\"userConfig\":{\"title\":\"配置\",\"layout\":\"border\",\"header\":false},\"cn\":[{\"cid\":\"panel\",\"id\":\"panel5\",\"layoutConfig\":{},\"userConfig\":{\"region\":\"center\",\"layout\":\"border\",\"header\":false},\"cn\":[{\"cid\":\"container\",\"id\":\"div\",\"layoutConfig\":{},\"userConfig\":{\"width\":482,\"height\":42,\"layout\":\"hbox\",\"border\":false,\"region\":\"north\"},\"cn\":[{\"cid\":\"vmdButton\",\"id\":\"button\",\"layoutConfig\":{},\"userConfig\":{\"text\":\"字段选择\",\"margins\":\"5 5 0 5\",\"click\":\"button_click\",\"type\":\"text\"}},{\"cid\":\"vmdButton\",\"id\":\"button1\",\"layoutConfig\":{},\"userConfig\":{\"margins\":\"5 0 0 60\",\"text\":\"\",\"width\":30,\"type\":\"text\",\"click\":\"button1_click\",\"iconcls\":\"icon-arrow-up\"}},{\"cid\":\"vmdButton\",\"id\":\"button2\",\"layoutConfig\":{},\"userConfig\":{\"margins\":\"5 0 0 5\",\"text\":\"\",\"height\":\"\",\"width\":30,\"type\":\"text\",\"click\":\"button2_click\",\"iconcls\":\"icon-arrow-down\"}},{\"cid\":\"vmdButton\",\"id\":\"button4\",\"layoutConfig\":{},\"userConfig\":{\"text\":\"\",\"icon\":\"delete\",\"type\":\"text\",\"style\":\"color: red\",\"margins\":\"5 0 0 \",\"click\":\"button4_click\"}},{\"cid\":\"vmdButton\",\"id\":\"button3\",\"layoutConfig\":{},\"userConfig\":{\"text\":\"应用到网格格式\",\"type\":\"text\",\"margins\":\"5 0 5 5 \",\"click\":\"button3_click\"}}]},{\"cid\":\"panel\",\"id\":\"panel2\",\"layoutConfig\":{},\"userConfig\":{\"region\":\"center\",\"header\":false,\"layout\":\"fit\",\"border\":false,\"autoScroll\":true},\"cn\":[{\"cid\":\"grid\",\"id\":\"MyGrid\",\"layoutConfig\":{},\"userConfig\":{\"region\":\"center\",\"beforerender\":\"MyGrid_beforerender\",\"celldblclick\":\"MyGrid_celldblclick\",\"hideHeaders\":true,\"disableHeaderClick\":true,\"title\":\"已选字段\",\"afterrender\":\"MyGrid_afterrender\"},\"cn\":[{\"cid\":\"gridcolumn\",\"layoutConfig\":{},\"userConfig\":{\"header\":\"Column 1\",\"dataIndex\":\"mixName\",\"width\":300},\"name\":\"mixName\"}]}]}]},{\"cid\":\"panel\",\"id\":\"panel6\",\"layoutConfig\":{},\"userConfig\":{\"region\":\"north\",\"header\":false,\"height\":65,\"layout\":\"border\",\"style\":\"padding-top: 5px\"},\"cn\":[{\"cid\":\"container\",\"id\":\"div2\",\"layoutConfig\":{\"align\":\"middle\",\"pack\":\"start\"},\"userConfig\":{\"region\":\"center\",\"width\":299,\"height\":32,\"border\":false,\"layout\":\"hbox\",\"hidden\":false},\"cn\":[{\"cid\":\"label\",\"id\":\"label\",\"layoutConfig\":{},\"userConfig\":{\"text\":\"列数：\",\"margins\":\"0 0 0 5 \"}},{\"cid\":\"vmd.ux.ClickText\",\"id\":\"formColumn\",\"layoutConfig\":{},\"userConfig\":{\"id\":\"formColumn\",\"plus\":\"formColumn_plus\",\"minus\":\"formColumn_minus\",\"readOnly\":true}}]},{\"cid\":\"container\",\"id\":\"div1\",\"layoutConfig\":{\"align\":\"middle\"},\"userConfig\":{\"layout\":\"hbox\",\"height\":28,\"region\":\"north\",\"border\":false,\"hidden\":false},\"cn\":[{\"cid\":\"label\",\"id\":\"label3\",\"layoutConfig\":{},\"userConfig\":{\"margins\":\"0 0 0 5\",\"text\":\"标题对齐:\"}},{\"cid\":\"radiogroup\",\"id\":\"grid_display\",\"layoutConfig\":{},\"userConfig\":{\"height\":30,\"margins\":\"0 0 0 5\",\"id\":\"grid_display\",\"change\":\"grid_display_change\",\"width\":205},\"cn\":[{\"cid\":\"radio\",\"id\":\"r_left\",\"layoutConfig\":{},\"userConfig\":{\"boxLabel\":\"左对齐\",\"fieldLabel\":\"\",\"width\":60,\"checked\":false,\"inputValue\":\"1\",\"id\":\"r_left\"}},{\"cid\":\"radio\",\"id\":\"r_center\",\"layoutConfig\":{},\"userConfig\":{\"fieldLabel\":\"\",\"boxLabel\":\"居中\",\"inputValue\":\"3\",\"width\":50,\"id\":\"r_center\"}},{\"cid\":\"radio\",\"id\":\"r_right\",\"layoutConfig\":{},\"userConfig\":{\"boxLabel\":\"右对齐\",\"inputValue\":\"2\",\"width\":60,\"fieldLabel\":\"\",\"checked\":true,\"id\":\"r_right\"}}]}]}]}]}]}]}","vmdevents":"var page = this;\r\n\r\npage.controller = new vmd.ux.formType.Controller(this)\r\n\r\npage.selectedField = new Ext.data.JsonStore({\r\n    proxy: new Ext.data.MemoryProxy(),\r\n    fields: ['mixName']\r\n});\r\n\r\nvar util = new ide.ext.DataInputUtils(page, 'form')\r\n\r\nfunction button_click(sender, e) {\r\n    util.clickFieldsSelect()\r\n}\r\n\r\nfunction MyGrid_beforerender(sender) {\r\n    this.ddGroup = 'griddd';\r\n    this.enableDragDrop = true;\r\n    sender.store = page.selectedField;\r\n    MyGrid.on('cellclick', function(sender, rowindex, cellindex) {\r\n        page.selNo = rowindex;\r\n        var gv = MyGrid.getView();\r\n        var row = gv.getRow(rowindex);\r\n        Ext.get(row).removeClass('x-grid3-row-selected')\r\n        currow = gv.getRow(rowindex);\r\n        Ext.get(currow).addClass('x-grid3-row-selected')\r\n    })\r\n\r\n}\r\n\r\nfunction MyGrid_celldblclick(sender, rowIndex, columnIndex, e) {\r\n    util.celldbclick()\r\n}\r\n\r\nfunction grid_display_change(sender, checked) {\r\n    if (!checked)\r\n        return;\r\n    page.controller.settings.titleSite = checked.inputValue || '2';\r\n    //grid_display.setValue(page.controller.settings.titleSite)\r\n    page.fireEvent('settingChangeEvents');\r\n    //page.controller.settings.displayMode = checked.inputValue\r\n    //    page.fireEvent('settingChangeEvents')\r\n}\r\n\r\nfunction button1_click(sender, e) {\r\n    util.moveUp()\r\n}\r\n\r\nfunction button2_click(sender, e) {\r\n    util.moveDown()\r\n}\r\n\r\nfunction MyGrid_afterrender(sender) {\r\n    var store = this.store\r\n    var ddrow = new Ext.dd.DropTarget(MyGrid.container, {\r\n        ddGroup: 'griddd',\r\n        copy: false,\r\n        notifyEnter: function(ddSource, e, data) {},\r\n        notifyDrop: function(ddSource, e, data) {\r\n\r\n            var list = page.controller.settings.fields;\r\n            // 选中了多少行\r\n            var rows = data.selections;\r\n            // 拖动到第几行\r\n            var index = ddSource.getDragData(e).rowIndex;\r\n            if (typeof(index) == \"undefined\") {\r\n                return;\r\n            }\r\n            // 修改store\r\n            for (i = 0; i < rows.length; i++) {\r\n                var rowData = rows[i];\r\n                lindex = store.indexOf(rowData)\r\n                temp = list[lindex]\r\n                list.remove(list[lindex])\r\n                list.splice(index, 0, temp);\r\n                if (!this.copy) store.remove(rowData);\r\n                store.insert(index, rowData);\r\n            }\r\n\r\n            page.selected = Ext.pluck(store.data.items, 'json')\r\n            page.selectedField.loadData(page.selected)\r\n\r\n\r\n            page.fireEvent('settingChangeEvents')\r\n        }\r\n    });\r\n}\r\n\r\n\r\nfunction formColumn_plus(sender) {\r\n    page.controller.settings.formColumn = parseInt(page.controller.settings.formColumn) + 1;\r\n    formColumn.setValue(page.controller.settings.formColumn)\r\n    page.fireEvent('settingChangeEvents')\r\n}\r\n\r\nfunction formColumn_minus(sender) {\r\n    // var tmp = page.controller.settings.formColumn;\r\n    parseInt(page.controller.settings.formColumn) < 2 ? page.controller.settings.formColumn = 1 : page.controller.settings.formColumn -= 1;\r\n    formColumn.setValue(page.controller.settings.formColumn)\r\n    page.fireEvent('settingChangeEvents')\r\n}\r\n\r\nfunction MyTabs_afterrender(sender) {\r\n    // sender.header.setDisplayed(false)\r\n}\r\n\r\nfunction button3_click(sender, e) {\r\n    util.copyToAnother()\r\n}\r\n\r\nfunction button4_click(sender, e) {\r\n    util.delete()\r\n}","vmdcss":"","vmdprops":"\"\"","type":"ux","vmdevents_controller":"//grid\nExt.define('vmd.ux.formType.Controller', {\n    xtype: 'vmd.ux.formType.Controller',\n    constructor: function(options) {\n\n        this.scope = options;\n        this.settings = new vmd.ux.formType.settings(options);\n        this.events = new vmd.ux.formType.events(options);\n    },\n    setValue: function(jsonConfig) {\n        if (jsonConfig) {\n            //设置值和事件\n            this.settings.setValue(jsonConfig.settings);\n            this.events.setValue(jsonConfig.events);\n            //取得的已选字段\n            var temp = [];\n            for (var i = 0; i < jsonConfig.settings.fields.length; i++) {\n                temp.push(jsonConfig.settings.fields[i].dictionary)\n            }\n            this.scope.selectedField.loadData(temp)\n            //grid层需要展示赋值的\n            this.scope.formColumn.setValue(this.settings.formColumn)\n            //grid层需要展示赋值的\n            debugger\n            this.scope.grid_display.setValue(this.settings.titleSite)\n        }\n    },\n    serialize: function() {\n        var json = {\n            settings: this.settings.serialize(),\n            events: this.events.serialize()\n        }\n        return json;\n    }\n})\n\n//grid-settings\nExt.define('vmd.ux.formType.settings', {\n    xtype: 'vmd.ux.formType.settings',\n    constructor: function(options) {\n        this.formColumn = '3'\n        this.fields = [];\n        this.titleSite =\"right\";\n    },\n    setValue: function(jsonConfig) {\n        if (jsonConfig) {\n            this.formColumn = jsonConfig.formColumn;\n            this.fields = jsonConfig.fields;\n            this.titleSite = jsonConfig.titleSite;\n        }\n    },\n    serialize: function() {\n        var temp = [];\n        for (var i = 0; i < this.fields.length; i++) {\n            var tmp\n            if (this.fields[i] && this.fields[i].fieldsConfig && this.fields[i].fieldsConfig.hasOwnProperty('scope')) {\n                tmp = {\n                    fieldsConfig: this.fields[i].fieldsConfig.serialize(),\n                    dictionary: this.fields[i].dictionary\n                }\n            } else {\n                tmp = this.fields[i]\n            }\n            //删除数据字典中的role规则\n            if (tmp.dictionary) {\n                delete tmp.dictionary.rule;\n                delete tmp.dictionary.rules;\n                delete tmp.dictionary.xml;\n            }\n            temp.push(tmp)\n        }\n        var json = {\n            formColumn: this.formColumn,\n            titleSite: this.titleSite,\n            fields: temp,\n            issave: true\n        }\n        return json;\n    }\n})\n\n//grid-events\nExt.define('vmd.ux.formType.events', {\n    xtype: 'vmd.ux.formType.events',\n    constructor: function(options) {\n        this.scope = options;\n        this.rowChange = '';\n        this.rowClick = '';\n    },\n    setValue: function(jsonConfig) {\n        this.rowChange = jsonConfig.rowChange;\n        this.rowClick = jsonConfig.rowClick;\n    },\n    serialize: function() {\n        var json = {\n            rowChange: this.rowChange,\n            rowClick: this.rowClick\n        }\n        return json;\n    }\n})\n\n//grid-events\nExt.define('vmd.ux.formType.settings.fieldSettings', {\n    xtype: 'vmd.ux.formType.settings.fieldSettings',\n    constructor: function(options) {\n        this.scope = options;\n\n        this.dictionary;\n        this.fieldsConfig;\n    },\n    setValue: function(jsonConfig) {\n        if (jsonConfig) {\n            this.dictionary = jsonConfig.dictionary;\n            this.fieldsConfig = jsonConfig.fieldsConfig.serialize();\n        }\n    },\n    serialize: function() {\n\n        var temp = {};\n        if (this.fieldsConfig) {\n            temp = this.fieldsConfig.serialize();\n        }\n        var json = {\n            dictionary: this.dictionary,\n            fieldsConfig: temp\n        }\n        return json;\n    }\n})\n\n\nfunction setEvent(sender, eventName, param) {\n    sender.el.on('dblclick', function() {\n        var editor = new vmd.comp.Ace({\n            id: \"ace_code\"\n        });\n        // init_def_platformControlData();\n        var aceWin = new vmd.window({\n            title: \"事件编辑\",\n            id: \"aceWin\",\n            url: vmd.virtualPath + vmd.vmdCodePath + \"?\" + Date.parse(new Date()),\n            offset: [100, 100],\n            modal: true,\n            maximizable: true,\n            maskStyle: 'opacity:0.7',\n            layout: 'border',\n            draggable: false,\n            listeners: {\n                move: function(me, x, y) {\n                    this.moveZone(me, x, y);\n                }\n            }\n        });\n        aceWin.closeFn = function() {\n            //修复ace tooltip还存在的问题\n            Ext.select('.Ace-Tern-tooltip').remove();\n            var val = aceWin.val;\n            if (aceWin.script == val) {\n                return;\n            }\n            Ext.Msg.confirm(\"提示\", \"脚本已改变是否保存?\", function(btn) {\n                if (btn == 'no') return;\n                var click_label = sender;\n                if (val.trim()) {\n                    xds.vmd.events = val;\n                    sender.setValue(eventName)\n                    // 返回给对象\n                } else {\n                    click_label = undefined;\n                    delete xds.vmd.events\n                }\n            })\n        }\n        //mafei 在ide-automachjs中\n        // init_def_platformControlData();\n        aceWin.on('close', aceWin.closeFn, this)\n        //当前拖拽组件\n        window.setTimeout(function() {\n            window.setTimeout(function() {\n                //代码编辑器初始化\n                if (typeof rowIndex == \"number\") {\n                    aceWin.aceline = rowIndex;\n                }\n            }, 150)\n            var code = parent.xds.vmd.events;\n            // var me = \n            var getdefaulteventname = function() {\n                if (param != '') {\n                    return \"function(sender\" + \"){\\n\" + \"\\n} \\n\";\n                } else {\n                    return \"function(sender,\" + param + \"){\\n\" + \"\\n} \\n\";\n                }\n            }\n            var m = getdefaulteventname(),\n                code = code ? code : \"\",\n                replaceStr = \"function {0}{1}\",\n                regex = new RegExp(\"function\\\\s+\" + eventName + \"\\\\s*?\\\\(\");\n            if (eventName && code.search(regex) == -1) {\n                var e = m.trim().replace(\"function\", \"\"),\n                    i = String.format(replaceStr, eventName, e);\n                code += (code ? \"\\n\\n\" : \"\") + i\n            }\n            aceWin.script = code;\n            aceWin.val = code;\n            aceWin.show();\n            //进度提示\n            var myMask = new Ext.LoadMask(aceWin.el, {\n                msg: \"数据加载中,请稍后...\",\n                msgCls: 'z-index:10000;'\n            });\n            myMask.show();\n            aceWin.loading = myMask;\n            //  aceWin.update(\"<iframe  id='iframe_page' src='\" + vmd.virtualPath + vmd.vmdCodePath + \"?\" + Date.parse(new Date()) + \"' width=600 height=900 frameborder=0  ></iframe>\")\n            var scriptArr = code.split(\"\\n\"),\n                rowIndex = null;\n            Ext.each(scriptArr,\n                function(o, p) {\n                    if (o.search(regex) != -1) {\n                        rowIndex = p + 2;\n                        return false\n                    }\n                });\n        }, 50)\n    })\n}","vmdinterface":"{\"components\":[{\"cid\":\"vmduxprops\",\"layoutConfig\":{},\"userConfig\":{}},{\"cid\":\"vmduxmethods\",\"id\":\"方法\",\"layoutConfig\":{},\"userConfig\":{},\"cn\":[{\"cid\":\"uxmethod\",\"id\":\"serialize\",\"layoutConfig\":{},\"userConfig\":{\"id\":\"serialize\",\"zhname\":\"\",\"bindCmp\":\"\",\"bindValue\":\"\",\"isPublic\":\"on\",\"desc\":\"\",\"uxcid\":\"\",\"params\":\"info\",\"code\":\"page.controller.serialize();\",\"returnType\":\"\"}},{\"cid\":\"uxmethod\",\"id\":\"setInfo\",\"layoutConfig\":{},\"userConfig\":{\"id\":\"setInfo\",\"zhname\":\"\",\"bindCmp\":\"\",\"bindValue\":\"\",\"isPublic\":\"on\",\"desc\":\"\",\"uxcid\":\"\",\"params\":\"info\",\"code\":\"page.controller.setValue(info)\",\"returnType\":\"\"}},{\"cid\":\"uxmethod\",\"id\":\"initDefault\",\"layoutConfig\":{},\"userConfig\":{\"id\":\"initDefault\",\"zhname\":\"\",\"bindCmp\":\"\",\"bindValue\":\"\",\"isPublic\":\"on\",\"desc\":\"\",\"uxcid\":\"\",\"params\":\"\",\"code\":\"//直接填写方法内容\\ninit()\",\"returnType\":\"\"}}]},{\"cid\":\"vmduxevents\",\"id\":\"事件\",\"layoutConfig\":{},\"userConfig\":{},\"cn\":[{\"cid\":\"uxevent\",\"id\":\"copyGridToForm\",\"layoutConfig\":{},\"userConfig\":{\"id\":\"copyGridToForm\",\"zhname\":\"\",\"bindCmp\":\"\",\"bindValue\":\"\",\"isPublic\":\"\",\"desc\":\"\",\"uxcid\":\"\",\"params\":\"\",\"code\":\"\"}},{\"cid\":\"uxevent\",\"id\":\"compareDataSet\",\"layoutConfig\":{},\"userConfig\":{\"id\":\"compareDataSet\",\"zhname\":\"\",\"bindCmp\":\"\",\"bindValue\":\"\",\"isPublic\":\"\",\"desc\":\"\",\"uxcid\":\"\",\"params\":\"sender,value\",\"code\":\"\"}},{\"cid\":\"uxevent\",\"id\":\"settingChangeEvents\",\"layoutConfig\":{},\"userConfig\":{\"id\":\"settingChangeEvents\",\"params\":\"\",\"desc\":\"\"}}]}]}","vmdresource":"{\"components\":[{\"cid\":\"vmdrescsss\",\"layoutConfig\":{},\"userConfig\":{},\"cn\":[{\"cid\":\"rescss\",\"id\":\"components/ux/gridtype/1.0/css/icons.css\",\"layoutConfig\":{},\"userConfig\":{\"id\":\"components/ux/gridtype/1.0/css/icons.css\",\"path\":\"components/ux/gridtype/1.0/css/icons.css\",\"absolutePath\":\"{{vmduxpath}}/components/ux/gridtype/1.0/css/icons.css\",\"ext\":\"css\"}}]},{\"cid\":\"vmdresjss\",\"layoutConfig\":{},\"userConfig\":{},\"cn\":[{\"cid\":\"resjs\",\"id\":\"controller.js\",\"layoutConfig\":{},\"userConfig\":{}}]},{\"cid\":\"vmdresimgs\",\"layoutConfig\":{},\"userConfig\":{}}]}"}