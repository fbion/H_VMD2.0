{"vmdversion":"2.0.3.0710","vmdlayout":"{\"components\":[{\"cid\":\"uxpanel\",\"id\":\"ProjectAuthority\",\"layoutConfig\":{},\"userConfig\":{\"layout\":\"absolute\",\"header\":false,\"width\":728,\"height\":363,\"beforerender\":\"ProjectAuthority_beforerender\"},\"cn\":[{\"cid\":\"panel\",\"id\":\"panelProjectAuthority\",\"layoutConfig\":{},\"userConfig\":{\"id\":\"panelProjectAuthority\",\"layout\":\"absolute\",\"title\":\"权限分配\",\"width\":730,\"height\":360,\"header\":false},\"cn\":[{\"cid\":\"panel\",\"id\":\"panelOrganization\",\"layoutConfig\":{},\"userConfig\":{\"width\":230,\"height\":360,\"header\":true,\"id\":\"panelOrganization\",\"border\":true,\"layout\":\"absolute\",\"title\":\"组织机构\",\"x\":10,\"y\":0},\"cn\":[{\"cid\":\"vmdTreeEx\",\"id\":\"treeOrganization\",\"layoutConfig\":{},\"userConfig\":{\"width\":230,\"height\":325,\"id\":\"treeOrganization\",\"x\":-1,\"y\":0,\"style\":\"font-family: Microsoft YaHei;    font-size: 14px;\"}}]},{\"cid\":\"panel\",\"id\":\"panelMembers\",\"layoutConfig\":{},\"userConfig\":{\"x\":250,\"y\":0,\"width\":230,\"header\":true,\"height\":360,\"layout\":\"absolute\",\"id\":\"panelMembers\",\"title\":\"成员\"},\"cn\":[{\"cid\":\"vmdDataView\",\"id\":\"hwDataViewMembers\",\"layoutConfig\":{},\"userConfig\":{\"x\":0,\"y\":0,\"width\":230,\"id\":\"hwDataViewMembers\",\"tpl\":\"<ul>\\n    <tpl for=\\\".\\\">\\n        <li class='info serverlist-info'> {name} </li>\\n    </tpl>\\n</ul>\",\"data\":\"var data = [{\\n    \\\"workspace_id\\\": \\\"0000000001\\\",\\n    \\\"name\\\": \\\"马飞\\\",\\n    \\\"remark\\\": \\\"test\\\"\\n}, {\\n    \\\"workspace_id\\\": \\\"0000000002\\\",\\n    \\\"name\\\": \\\"成兵\\\",\\n    \\\"remark\\\": \\\"test\\\"\\n}, {\\n    \\\"workspace_id\\\": \\\"0000000003\\\",\\n    \\\"name\\\": \\\"孙广蔚\\\",\\n    \\\"remark\\\": \\\"test\\\"\\n}, {\\n    \\\"workspace_id\\\": \\\"0000000004\\\",\\n    \\\"name\\\": \\\"李份\\\",\\n    \\\"remark\\\": \\\"test\\\"\\n}, {\\n    \\\"workspace_id\\\": \\\"0000000005\\\",\\n    \\\"name\\\": \\\"刘志伟\\\",\\n    \\\"remark\\\": \\\"test\\\"\\n}, {\\n    \\\"workspace_id\\\": \\\"0000000006\\\",\\n    \\\"name\\\": \\\"黄娜娜\\\",\\n    \\\"remark\\\": \\\"test\\\"\\n}];\\nreturn data;\",\"style\":\"font-family: Microsoft YaHei;    font-size: 13px;    padding: 5px 5px 5px 5px;\",\"height\":330}}]},{\"cid\":\"panel\",\"id\":\"panelRole\",\"layoutConfig\":{},\"userConfig\":{\"width\":230,\"x\":490,\"y\":0,\"height\":360,\"id\":\"panelRole\",\"title\":\"角色\",\"layout\":\"absolute\"},\"cn\":[{\"cid\":\"checkboxgroup\",\"id\":\"hwCheckboxGroup\",\"layoutConfig\":{},\"userConfig\":{\"x\":10,\"y\":10,\"width\":220,\"height\":320,\"autoScroll\":true,\"vertical\":true,\"columns\":1},\"cn\":[{\"cid\":\"checkbox\",\"id\":\"hwCheckbox\",\"layoutConfig\":{},\"userConfig\":{\"boxLabel\":\"工区编辑角色\",\"fieldLabel\":\"\",\"checked\":true}},{\"cid\":\"checkbox\",\"id\":\"hwCheckbox1\",\"layoutConfig\":{},\"userConfig\":{\"fieldLabel\":\"\",\"boxLabel\":\"工区删除角色\"}},{\"cid\":\"checkbox\",\"id\":\"hwCheckbox2\",\"layoutConfig\":{},\"userConfig\":{\"fieldLabel\":\"\",\"boxLabel\":\"项目添加移除角色\",\"checked\":true}},{\"cid\":\"checkbox\",\"id\":\"hwCheckbox4\",\"layoutConfig\":{},\"userConfig\":{\"boxLabel\":\"项目新建角色\",\"fieldLabel\":\"\"}}]}]},{\"cid\":\"vmdButton\",\"id\":\"button\",\"layoutConfig\":{},\"userConfig\":{\"x\":675,\"y\":1,\"text\":\"...\",\"type\":\"text\",\"width\":30,\"style\":\"font-family: 'Microsoft YaHei';    font-size: 16px;    color: #000;\"}}]}]},{\"cid\":\"vmddataset\",\"id\":\"数据集\",\"layoutConfig\":{},\"userConfig\":{}}]}","vmdevents":"var page = this;\nvar workspaceId = \"\";\n// var workspaceId = \"00000000-0000-0000-0000-000000000000\";\nvar ifNewWorkSpace = false; // 是否是新建工区\nvar ifBaseInfoSaved = false; // 基本信息是否已保存\n// 工作流服务地址下拉列表数据\nvar workflowStoreRecords = null;\n// 数据服务的服务地址下拉列表数据\nvar dataserviceStoreRecords = null;\n\nfunction panelTabInfo_afterrender(sender) {\n\n    // 2018.05.23 考虑到切换工区后就不会触发afterrender方法，所以把数据查询加载放到tabchange事件中了\n    // queryDataInfo();\n}\n\nfunction panelTabWorkflow_afterrender(sender) {\n\n}\n\nfunction panelTabDataService_afterrender(sender) {\n\n}\n\nfunction panelTabResource_afterrender(sender) {\n\n    // TabWorkSpaceResource.iSetWorkSpaceId(workspaceId);\n}\n\nfunction TabsWorkSpaceInfo_tabchange(sender, tab) {\n\n    var tabId = tab.id;\n    var tabIndexInfo = tabId.indexOf(\"panelTabInfo\"); // 基于0开始,找不到返回-1\n    var tabIndexWorkFlow = tabId.indexOf(\"panelTabWorkflow\"); // 基于0开始,找不到返回-1\n    var tabIndexDataService = tabId.indexOf(\"panelTabDataService\"); // 基于0开始,找不到返回-1\n    var tabIndexResource = tabId.indexOf(\"panelTabResource\"); // 基于0开始,找不到返回-1\n\n    // 基本信息\n    if(tabIndexInfo > -1) {\n        queryDataInfo();\n    } else if(tabIndexWorkFlow > -1) {\n        queryWorkFlow();\n    } else if(tabIndexDataService > -1) {\n        queryDataService();\n    } else if(tabIndexResource > -1) {\n\n        TabWorkSpaceResource.iSetWorkSpaceId(workspaceId);\n        TabWorkSpaceResource.iTabChangeResource();\n    }\n}\n\nfunction queryDataInfo() {\n\n    // workspaceId = \"18a7a702-1077-4b44-9e35-6e289da389d9\";\n\n    if(workspaceId === null || workspaceId === undefined || workspaceId === '') {\n        return;\n    }\n    if(panelTabInfo.ifDataLoaded) {\n        return;\n    }\n    hwDas.get(\n        \"DataServiceWorkSpace/WorkSpaceInfo/WorkSpaceInfo\", {}, {\n            \"workspaceid\": workspaceId\n        },\n        function(result) {\n            // 根据获取的数据赋值基本信息Tab页\n            if(null === result && undefined === result) {\n                return;\n            }\n\n            if(null != result.data && undefined != result.data) {\n                if(result.data.length > 0) {\n                    if(null != result.data[0].datas && undefined != result.data[0].datas) {\n                        if(result.data[0].datas.length > 0) {\n                            hwTextWorkSpaceName.setValue(result.data[0].datas[0].name);\n                            hwTextWorkSpaceAlias.setValue(result.data[0].datas[0].alias_short_name);\n                            hwTextAreaWorkSpaceDescription.setValue(result.data[0].datas[0].remark);\n                            hwTextCreatedTime.setValue(result.data[0].datas[0].row_created_date)\n                            hwTextModifiedTime.setValue(result.data[0].datas[0].row_changed_date);\n\n                        } else {\n                            hwTextWorkSpaceName.setValue(\"\");\n                            hwTextWorkSpaceAlias.setValue(\"\");\n                            hwTextAreaWorkSpaceDescription.setValue(\"\");\n                            hwTextCreatedTime.setValue('')\n                            hwTextModifiedTime.setValue('');\n                        }\n                    }\n                }\n            }\n\n            panelTabInfo.ifDataLoaded = true;\n        },\n        function(msg) {\n            // Tips.tips(\"查询失败！\", \"error\");\n            // Ext.Msg.alert(\"提示\", \"查询工区信息失败！\");\n        });\n}\n\nfunction queryWorkFlow() {\n    // workspaceId = \"326c3fa0-1e02-4402-b2c2-42659a50e0b0\";\n\n    if(workspaceId === null || workspaceId === undefined || workspaceId === '') {\n        return;\n    }\n    if(panelTabWorkflow.ifDataLoaded) {\n        return;\n    }\n    hwDas.get(\n        \"DataServiceWorkSpace/WorkSpaceInfo/ServiceAddress\", {}, {\n            \"workspaceid\": workspaceId,\n            \"servicetype\": 3\n        },\n        function(result) {\n            // 根据获取的数据赋值基本信息Tab页\n            if(null === result && undefined === result) {\n                return;\n            }\n\n            if(null != result.data && undefined != result.data) {\n                if(result.data.length > 0) {\n                    if(null != result.data[0].datas && undefined != result.data[0].datas) {\n                        if(result.data[0].datas.length > 0) {\n                            comlistWorkflowAddress.setValue(result.data[0].datas[0].address);\n                            comlistWorkflowAddress.serviceId = result.data[0].datas[0].id;\n                        } else {\n                            comlistWorkflowAddress.setValue(\"\");\n                            comlistWorkflowAddress.serviceId = undefined;\n                        }\n                    }\n                }\n            }\n\n            panelTabWorkflow.ifDataLoaded = true;\n        },\n        function(msg) {\n            // Ext.Msg.alert(\"提示\", \"查询工区信息失败！\");\n        });\n}\n\nfunction queryDataService() {\n    // workspaceId = \"20e05c41-96ab-46f7-aaa6-d9a177ee9323\";\n\n    if(workspaceId === null || workspaceId === undefined || workspaceId === '') {\n        return;\n    }\n    if(panelTabDataService.ifDataLoaded) {\n        return;\n    }\n    hwDas.get(\n        \"DataServiceWorkSpace/WorkSpaceInfo/ServiceAddress\", {}, {\n            \"workspaceid\": workspaceId,\n            \"servicetype\": 4\n        },\n        function(result) {\n            // 根据获取的数据赋值基本信息Tab页\n            if(null === result && undefined === result) {\n                return;\n            }\n\n            if(null != result.data && undefined != result.data) {\n                if(result.data.length > 0) {\n                    if(null != result.data[0].datas && undefined != result.data[0].datas) {\n                        if(result.data[0].datas.length > 0) {\n                            comlistDataServiceAddress.setValue(result.data[0].datas[0].address);\n                            comlistDataServiceAddress.serviceId = result.data[0].datas[0].id;\n                        } else {\n                            comlistDataServiceAddress.setValue(\"\");\n                            comlistDataServiceAddress.serviceId = undefined;\n                        }\n                    }\n                }\n            }\n            panelTabDataService.ifDataLoaded = true;\n        },\n        function(msg) {\n            // Ext.Msg.alert(\"提示\", \"查询工区信息失败！\");\n        });\n}\n\nfunction saveData(lastId, refreshStore) {\n\n    var flag = 0; // 0: insert, 1:update;\n    if(!ifNewWorkSpace) {\n        flag = 1;\n    }\n    // if(workspaceId !== null && workspaceId !== undefined && workspaceId !== '') {\n    //     flag = 1;\n    // }\n\n    // if(0 === flag) {\n    //     workspaceId = vmd.util.guid();\n    // }\n\n    // var tmpTab = TabsWorkSpaceInfo.getActiveTab();\n    // 基本信息\n    if(panelTabInfo.ifDataLoaded) {\n        saveDataInfo(workspaceId, flag, lastId, refreshStore);\n        ifBaseInfoSaved = true;\n    }\n    debugger\n    if(panelTabWorkflow.ifDataLoaded) {\n        saveWorkFlow(workspaceId, flag, refreshStore);\n    }\n    debugger\n    if(panelTabDataService.ifDataLoaded) {\n        saveDataService(workspaceId, flag, refreshStore);\n    }\n\n\n    // var tabId = TabsWorkSpaceInfo.activeTab.id;\n    // var tabIndexInfo = tabId.indexOf(\"panelTabInfo\"); // 基于0开始,找不到返回-1\n    // var tabIndexWorkFlow = tabId.indexOf(\"panelTabWorkflow\"); // 基于0开始,找不到返回-1\n    // var tabIndexDataService = tabId.indexOf(\"panelTabDataService\"); // 基于0开始,找不到返回-1\n    // var tabIndexResource = tabId.indexOf(\"panelTabResource\"); // 基于0开始,找不到返回-1\n    // if(tabIndexInfo > -1) {\n    //     saveDataInfo(workspaceId, flag, lastId, refreshStore);\n    // } else if(tabIndexWorkFlow > -1) {\n    //     saveWorkFlow(workspaceId, flag, refreshStore);\n    // } else if(tabIndexDataService > -1) {\n    //     saveDataService(workspaceId, flag, refreshStore);\n    // } else if(tabIndexResource > -1) {\n    //     Tips.tips(\"保存成功！\", \"success\");\n    // }\n\n\n    ifNewWorkSpace = false;\n}\n\n// function saveData(lastId, refreshStore) {\n\n//     var flag = 0; // 0: insert, 1:update;\n//     if(!ifNewWorkSpace) {\n//         flag = 1;\n//     }\n//     // 基本信息\n//     saveDataInfo(workspaceId, flag, lastId, refreshStore);\n//     ifBaseInfoSaved = true;\n//     ifNewWorkSpace = false;\n// }\n\nfunction saveFlow(refreshStore) {\n\n    var flag = 0; // 0: insert, 1:update;\n    if(!ifNewWorkSpace) {\n        flag = 1;\n    }\n    // 基本信息\n\n    saveWorkFlow(workspaceId, flag, refreshStore);\n\n    ifNewWorkSpace = false;\n}\n\nfunction saveService(refreshStore) {\n\n    var flag = 0; // 0: insert, 1:update;\n    if(!ifNewWorkSpace) {\n        flag = 1;\n    }\n    // 基本信息\n    saveDataService(workspaceId, flag, refreshStore);\n\n    ifNewWorkSpace = false;\n}\n\n\n// flag 0:insert, 1:update\nfunction saveDataInfo(id, flag, lastId, refreshStore) {\n    debugger\n    // var myDate = new Date();\n    // myDate.toLocaleString(); //获取日期与时间\n    if(0 == flag) {\n\n        var workspaceName = hwTextWorkSpaceName.getValue();\n        if(workspaceName == null || workspaceName == undefined || workspaceName == '') {\n            workspaceName = \"我的工区\";\n        }\n        var workspaceAlias = hwTextWorkSpaceAlias.getValue();\n\n        if(workspaceAlias === null || workspaceAlias === undefined || workspaceAlias === '') {\n            workspaceAlias = workspaceName;\n        }\n        hwDas.add(\n            \"DataServiceWorkSpace/WorkSpaceInfo/WorkSpaceInfo\", {}, {}, [{\n                'workspaceid': id,\n                'lastid': lastId,\n                'workspacename': workspaceName,\n                'isactive': 0,\n                'modifydate': hwTextCreatedTime.getValue(),\n                'createddate': hwTextModifiedTime.getValue(),\n                'aliasid': vmd.util.guid(),\n                'aliaslongname': workspaceAlias,\n                'aliasshortname': workspaceAlias,\n                'remark': hwTextAreaWorkSpaceDescription.getValue()\n            }],\n            function(result) {\n                if(refreshStore) {\n                    refreshStore(id);\n                }\n                Tips.tips(\"保存成功！\", \"success\");\n                // Ext.Msg.alert(\"提示\", \"保存工区信息成功！\")\n                ifBaseInfoSaved = true; // 基本信息是否已保存\n            },\n            function(msg) {\n                Tips.tips(\"保存失败！\", \"error\");\n                // Ext.Msg.alert(\"提示\", \"保存工区信息失败！\")\n            }\n        );\n    } else {\n        hwDas.edit(\n            \"DataServiceWorkSpace/WorkSpaceInfo/WorkSpaceInfo\", {}, {}, [{\n                'workspaceid': id,\n                'name': hwTextWorkSpaceName.getValue(),\n                'aliaslongname': hwTextWorkSpaceAlias.getValue(),\n                'aliasshortname': hwTextWorkSpaceAlias.getValue(),\n                'modifydate': Ext.Date.dateFormat(new Date(), 'Y-m-d H:i:s'),\n                'remark': hwTextAreaWorkSpaceDescription.getValue()\n            }],\n            function(result) {\n                if(refreshStore) {\n                    refreshStore();\n                }\n                Tips.tips(\"保存成功！\", \"success\");\n                // Ext.Msg.alert(\"提示\", \"保存工区信息成功！\")\n            },\n            function(msg) {\n                Tips.tips(\"保存失败！\", \"error\");\n                // Ext.Msg.alert(\"提示\", \"保存工区信息失败！\")\n            }\n        );\n    }\n}\n\n\n// id:工区id； flag：0，新建工区；1：更新工区；refreshStore：回调函数刷新数据集\nfunction saveWorkFlow(id, flag, refreshStore) {\n    debugger\n    var workflowAddr = comlistWorkflowAddress.getText();\n    if(!workflowAddr) {\n        return\n    }\n    var wfData = storeWorkflowList.data.items;\n    var serviceId = '';\n    var ifAddrExisted = false;\n    if(workflowStoreRecords) {\n        for(var i = 0; i < workflowStoreRecords.length; i++) {\n            if(workflowStoreRecords[i].address == workflowAddr) {\n                ifAddrExisted = true;\n                serviceId = workflowStoreRecords[i].id;\n                comlistWorkflowAddress.serviceId = serviceId;\n                break;\n            }\n        }\n    }\n\n    // 地址不存在,就向服务地址表中增加一条记录\n    if(!ifAddrExisted) {\n        serviceId = vmd.util.guid();\n        comlistWorkflowAddress.serviceId = serviceId;\n        addWorkflowAddr(serviceId, workflowAddr);\n    }\n    // 如果地址已经存在，就向工区服务地址关系表中保存数据（插入或更新）\n    saveWorkflowAddr(id, serviceId, 3, workflowAddr, refreshStore);\n}\n\n\n// 向服务地址表RESOURCE_SERVICEADDRESS中插入一条地址记录\nfunction saveWorkflowAddr(wsId, addrId, type, address, refreshStore) {\n\n    hwDas.save(\n        \"DataServiceWorkSpace/WorkSpaceInfo/WfDsAddr\", {}, {}, [{\n            'workspaceid': wsId,\n            'addressid': addrId,\n            'type': type\n        }],\n        function(result) {\n            Tips.tips(\"保存成功！\", \"success\");\n\n            vmd.workspace.workflowIp = address;\n            // if(parent.vmd.workspace.workspaceid == id) {\n            //     if(addr != parent.vmd.workspace.workflowIp) {\n            //         // 更新主页面的工作流信息\n            //         refreshStore();\n            //     }\n            // }\n        },\n        function(msg) {\n            Tips.tips(\"保存失败！\", \"error\");\n        }\n    );\n}\n\n\n// 向服务地址表RESOURCE_SERVICEADDRESS中插入一条地址记录\nfunction addWorkflowAddr(id, address) {\n\n    hwDas.add(\n        \"DataServiceWorkSpace/WorkSpaceInfo/WfDsAddr\", {}, {}, [{\n            'id': id,\n            'name': \"工作流服务地址\",\n            'addr': address,\n            'type': 3,\n            'remark': \"工作流服务地址\"\n        }],\n        function(result) {\n            // Tips.tips(\"保存成功！\", \"success\");\n        },\n        function(msg) {\n            // Tips.tips(\"保存失败！\", \"error\");\n        }\n    );\n}\n\n\n// function saveWorkFlow(id, flag, refreshStore) {\n//     debugger\n//     var workflowAddr = comlistWorkflowAddress.getText();\n//     if(!workflowAddr) {\n//         return\n//     }\n//     var wfData = storeWorkflowList.data.items;\n//     var serviceId = '';\n//     var ifAddrExisted = false;\n//     // if(wfData.length == 0) {\n//     //     serviceId = '';\n//     // } else {\n//     //     wfData.forEach(function(item, index) {\n//     //         if(comlistWorkflowAddress.getText() == item.data.address) {\n//     //             serviceId = comlistWorkflowAddress.getValue();\n//     //             ifAddrExisted = true;\n//     //         }\n//     //     })\n//     //     if(!ifAddrExisted) {\n//     //         serviceId = '';\n//     //     }\n//     // }\n\n//     // 新建工区\n//     if(0 == flag) {\n\n//         // if(!ifBaseInfoSaved) {\n//         //     saveDataInfo(id, flag, refreshStore);\n//         // }\n//         // var serviceId = vmd.util.guid();\n//         // comlistWorkflowAddress.serviceId = serviceId;\n//         hwDas.add(\n//             \"DataServiceWorkSpace/WorkSpaceInfo/ServiceAddress\", {}, {}, [{\n//                 'workspaceid': id,\n//                 'serviceaddressid': serviceId,\n//                 'serviceaddressname': \"工作流服务地址\",\n//                 'serviceaddress': workflowAddr,\n//                 'serviceaddresstype': 3,\n//                 'serviceaddressremark': \"工作流服务地址\"\n//             }],\n//             function(result) {\n//                 Tips.tips(\"保存成功！\", \"success\");\n//                 vmd.workspace.workflowIp = comlistWorkflowAddress.getText();\n//                 // if(parent.vmd.workspace.workspaceid == id) {\n//                 //     if(addr != parent.vmd.workspace.workflowIp) {\n//                 //         // 更新主页面的工作流信息\n//                 //         refreshStore();\n//                 //     }\n//                 // }\n//                 // Ext.Msg.alert(\"提示\", \"保存工作流服务地址信息成功！\")\n//             },\n//             function(msg) {\n//                 Tips.tips(\"保存失败！\", \"error\");\n//                 // Ext.Msg.alert(\"提示\", \"保存工作流服务地址信息失败！\")\n//             }\n//         );\n//     } else { // 更新工区\n\n//         if(serviceId == '') {\n//             var serviceId = vmd.util.guid();\n//             // comlistWorkflowAddress.serviceId = serviceId;\n//             // var addr = comlistWorkflowAddress.getText();\n//             hwDas.add(\n//                 \"DataServiceWorkSpace/WorkSpaceInfo/ServiceAddress\", {}, {}, [{\n//                     'workspaceid': id,\n//                     'serviceaddressid': serviceId,\n//                     'serviceaddressname': \"工作流服务地址\",\n//                     'serviceaddress': workflowAddr,\n//                     'serviceaddresstype': 3,\n//                     'serviceaddressremark': \"工作流服务地址\"\n//                 }],\n//                 function(result) {\n\n//                     Tips.tips(\"保存成功！\", \"success\");\n//                     vmd.workspace.workflowIp = workflowAddr;\n//                     // if(parent.vmd.workspace.workspaceid == id) {\n//                     //     if(addr != parent.vmd.workspace.workflowIp) {\n//                     //         // 更新主页面的工作流信息\n//                     //         refreshStore();\n//                     //     }\n//                     // }\n\n//                     // Ext.Msg.alert(\"提示\", \"保存工作流服务地址信息成功！\")\n//                 },\n//                 function(msg) {\n//                     Tips.tips(\"保存失败！\", \"error\");\n//                     // Ext.Msg.alert(\"提示\", \"保存工作流服务地址信息失败！\")\n//                 }\n//             );\n//         } else {\n//             // var addr =comlistWorkflowAddress.getText() ;\n//             hwDas.edit(\n//                 \"DataServiceWorkSpace/WorkSpaceInfo/ServiceAddress\", {}, {}, [{\n//                     'serviceaddressid': serviceId,\n//                     'name': \"工作流服务地址\",\n//                     'serviceaddress': workflowAddr,\n//                     'remark': \"工作流服务地址\"\n//                 }],\n//                 function(result) {\n\n//                     Tips.tips(\"保存成功！\", \"success\");\n//                     vmd.workspace.workflowIp = workflowAddr;\n//                     // if(parent.vmd.workspace.workspaceid == id) {\n//                     //     if(addr != parent.vmd.workspace.workflowIp) {\n//                     //         // 更新主页面的工作流信息\n//                     //         refreshStore();\n//                     //     }\n//                     // }\n//                     // updateWorkflow(id, addr);\n\n//                     // Ext.Msg.alert(\"提示\", \"保存工作流服务地址信息成功！\")\n//                 },\n//                 function(msg) {\n//                     Tips.tips(\"保存失败！\", \"error\");\n//                     // Ext.Msg.alert(\"提示\", \"保存工作流服务地址信息失败！\")\n//                 }\n//             );\n//         }\n//     }\n\n// }\n\nfunction updateWorkflow(id, addr) {\n\n    // if(parent.vmd.workspace.workspaceid == id) {\n    //     if(addr != parent.vmd.workspace.workflowIp) {\n    //         // 更新主页面的工作流信息\n    //         if(parent.reloadWorkflowCategory) {\n    //             parent.reloadWorkflowCategory();\n    //         }\n    //     }\n    // }\n\n    /////////////////////////////////////////////////////////\n    // vmd.workspace = {\n    //     workflowIp: '',\n    //     dataServiceIp: '',\n    //     workspaceid: ''\n    // }\n}\n\nfunction updateDataService(id, addr) {\n    // if(parent.vmd.workspace.workspaceid == id) {\n    //     if(addr != parent.vmd.workspace.dataServiceIp) {\n    //         // 更新主页面的数据服务\n    //         if(parent.reloadDataServiceCategory) {\n    //             parent.reloadDataServiceCategory();\n    //         }\n    //     }\n    // }\n}\n\n\nfunction saveDataService(id, flag, refreshStore) {\n    debugger\n    var dataserviceAddr = comlistDataServiceAddress.getText();\n    if(!dataserviceAddr) {\n        return\n    }\n    // var serveData = storeDataService.data.items;\n    var serviceId = '';\n    var ifAddrExisted = false;\n    if(dataserviceStoreRecords) {\n        for(var i = 0; i < dataserviceStoreRecords.length; i++) {\n            if(dataserviceStoreRecords[i].address == dataserviceAddr) {\n                ifAddrExisted = true;\n                serviceId = dataserviceStoreRecords[i].id;\n                comlistDataServiceAddress.serviceId = serviceId;\n                break;\n            }\n        }\n    }\n\n    // 地址不存在,就向服务地址表中增加一条记录\n    if(!ifAddrExisted) {\n        serviceId = vmd.util.guid();\n        comlistDataServiceAddress.serviceId = serviceId;\n        addDataServiceAddr(serviceId, dataserviceAddr);\n    }\n    // 如果地址已经存在，就向工区服务地址关系表中保存数据（插入或更新）\n    saveDataServiceAddr(id, serviceId, 4, dataserviceAddr, refreshStore);\n}\n\n// 向服务地址表RESOURCE_SERVICEADDRESS中插入一条地址记录\nfunction saveDataServiceAddr(wsId, addrId, type, address, refreshStore) {\n\n    hwDas.save(\n        \"DataServiceWorkSpace/WorkSpaceInfo/WfDsAddr\", {}, {}, [{\n            'workspaceid': wsId,\n            'addressid': addrId,\n            'type': type\n        }],\n        function(result) {\n            Tips.tips(\"保存成功！\", \"success\");\n\n            vmd.workspace.dataServiceIp = address;\n            // if(parent.vmd.workspace.workspaceid == id) {\n            //     if(addr != parent.vmd.workspace.dataServiceIp) {\n            //         // 更新主页面的工作流信息\n            //         refreshStore();\n            //     }\n            // }\n        },\n        function(msg) {\n            Tips.tips(\"保存失败！\", \"error\");\n        }\n    );\n}\n\n\n// 向服务地址表RESOURCE_SERVICEADDRESS中插入一条地址记录\nfunction addDataServiceAddr(id, address) {\n\n    hwDas.add(\n        \"DataServiceWorkSpace/WorkSpaceInfo/WfDsAddr\", {}, {}, [{\n            'id': id,\n            'name': \"数据服务地址\",\n            'addr': address,\n            'type': 4,\n            'remark': \"数据服务地址\"\n        }],\n        function(result) {\n            // Tips.tips(\"保存成功！\", \"success\");\n        },\n        function(msg) {\n            // Tips.tips(\"保存失败！\", \"error\");\n        }\n    );\n}\n\n// function saveDataService(id, flag, refreshStore) {\n//     debugger\n//     if(!comlistDataServiceAddress.getText()) {\n//         return\n//     }\n//     var serveData = storeDataService.data.items;\n//     var serviceId = '',\n//         isHas = false;\n//     if(serveData.length > 0) {\n//         serveData.forEach(function(item, index) {\n//             if(comlistWorkflowAddress.getText() == item.data.address) {\n//                 serviceId = comlistWorkflowAddress.getValue();\n//                 isHas = true;\n//             }\n//         })\n//         if(!isHas) {\n//             serviceId = '';\n//         }\n//     } else {\n//         serviceId = '';\n//     }\n//     if(0 == flag) {\n\n//         if(!ifBaseInfoSaved) {\n//             saveDataInfo(id, flag, refreshStore);\n//         }\n\n//         var serviceId = vmd.util.guid();\n//         // comlistDataServiceAddress.serviceId = serviceId;\n//         hwDas.add(\n//             \"DataServiceWorkSpace/WorkSpaceInfo/ServiceAddress\", {}, {}, [{\n//                 'workspaceid': id,\n//                 'serviceaddressid': serviceId,\n//                 'serviceaddressname': \"数据服务地址\",\n//                 'serviceaddress': comlistDataServiceAddress.getText(),\n//                 'serviceaddresstype': 4,\n//                 'serviceaddressremark': \"数据服务地址\"\n//             }],\n//             function(result) {\n//                 Tips.tips(\"保存成功！\", \"success\");\n//                 vmd.workspace.dataServiceIp = comlistDataServiceAddress.getText()\n//                 if(parent.vmd.workspace.workspaceid == id) {\n//                     if(addr != parent.vmd.workspace.dataServiceIp) {\n//                         // 更新主页面的数据服务\n//                         refreshStore();\n//                     }\n//                 }\n//                 // Ext.Msg.alert(\"提示\", \"保存数据服务地址信息成功！\");\n//             },\n//             function(msg) {\n//                 Tips.tips(\"保存失败！\", \"error\");\n//                 // Ext.Msg.alert(\"提示\", \"保存数据流服务地址信息失败！\");\n//             }\n//         );\n//     } else {\n\n//         if(serviceId == '') {\n//             var serviceId = vmd.util.guid();\n//             // comlistDataServiceAddress.serviceId = serviceId;\n//             var addr = comlistDataServiceAddress.getText();\n//             hwDas.add(\n//                 \"DataServiceWorkSpace/WorkSpaceInfo/ServiceAddress\", {}, {}, [{\n//                     'workspaceid': id,\n//                     'serviceaddressid': serviceId,\n//                     'serviceaddressname': \"数据服务地址\",\n//                     'serviceaddress': addr,\n//                     'serviceaddresstype': 4,\n//                     'serviceaddressremark': \"数据服务地址\"\n//                 }],\n//                 function(result) {\n\n//                     Tips.tips(\"保存成功！\", \"success\");\n//                     vmd.workspace.dataServiceIp = comlistDataServiceAddress.getText()\n//                         // if(parent.vmd.workspace.workspaceid == id) {\n//                         //     if(addr != parent.vmd.workspace.dataServiceIp) {\n//                         //         // 更新主页面的数据服务\n//                         //         refreshStore();\n//                         //     }\n//                         // }\n//                         // Ext.Msg.alert(\"提示\", \"保存数据服务地址信息成功！\");\n//                 },\n//                 function(msg) {\n//                     Tips.tips(\"保存失败！\", \"error\");\n//                     // Ext.Msg.alert(\"提示\", \"保存数据流服务地址信息失败！\");\n//                 }\n//             );\n//         } else {\n//             // var addr = comlistDataServiceAddress.getText();\n//             hwDas.edit(\n//                 \"DataServiceWorkSpace/WorkSpaceInfo/ServiceAddress\", {}, {}, [{\n//                     'serviceaddressid': serviceId,\n//                     'name': \"数据服务地址\",\n//                     'serviceaddress': comlistDataServiceAddress.getText(),\n//                     'remark': \"数据服务地址\"\n//                 }],\n//                 function(result) {\n//                     Tips.tips(\"保存成功！\", \"success\");\n//                     vmd.workspace.dataServiceIp = comlistDataServiceAddress.getText()\n//                         // if(parent.vmd.workspace.workspaceid == id) {\n//                         //     if(addr != parent.vmd.workspace.dataServiceIp) {\n//                         //         // 更新主页面的数据服务\n//                         //         refreshStore();\n//                         //     }\n//                         // }\n//                         // Ext.Msg.alert(\"提示\", \"保存数据服务地址信息成功！\")\n//                 },\n//                 function(msg) {\n//                     Tips.tips(\"保存失败！\", \"error\");\n//                     // Ext.Msg.alert(\"提示\", \"保存数据流服务地址信息失败！\")\n//                 }\n//             );\n//         }\n//     }\n// }\n\n// 新建工区\nfunction newWorkSpace(id) {\n    // var nowTime = new Date().toLocaleString();\n    var nowTime = new Date().getFullYear() + '-' + (parseFloat(new Date().getMonth()) + 1) + '-' + new Date().getDate() +\n        ' ' + new Date().getHours() + ':' + new Date().getMinutes() + ':' + new Date().getSeconds();\n    ifNewWorkSpace = true;\n    ifBaseInfoSaved = false; // 基本信息是否已保存\n    workspaceId = id;\n    clearAll();\n    hwTextCreatedTime.setValue(nowTime);\n    hwTextModifiedTime.setValue(nowTime);\n    setIfDataLoaded(true);\n    // 将当前活动Tab页切换到基本信息Tab页\n    TabsWorkSpaceInfo.setActiveTab(panelTabInfo);\n}\n\n// 设置数据是否已加载\nfunction setIfDataLoaded(bVar) {\n\n    panelTabInfo.ifDataLoaded = bVar;\n    panelTabWorkflow.ifDataLoaded = bVar;\n    panelTabDataService.ifDataLoaded = bVar;\n    TabWorkSpaceResource.iSetIfDataLoaded(bVar);\n}\n\n// 清空所有\nfunction clearAll() {\n\n    clearBaseInfo();\n    clearWorkflow();\n    clearDataService();\n    clearResource();\n}\n\n// 清空所有\nfunction clearBaseInfo() {\n    hwTextWorkSpaceName.setValue(\"\");\n    hwTextWorkSpaceAlias.setValue(\"\");\n    hwTextCreatedTime.setValue(\"\");\n    hwTextModifiedTime.setValue(\"\");\n    hwTextAreaWorkSpaceDescription.setValue(\"\");\n}\n\n// 清空所有\nfunction clearWorkflow() {\n    comlistWorkflowAddress.setValue(\"\");\n    comlistWorkflowAddress.serviceId = undefined;\n}\n\n// 清空所有\nfunction clearDataService() {\n\n    comlistDataServiceAddress.setValue(\"\");\n    comlistDataServiceAddress.serviceId = undefined;\n}\n\n// 清空所有\nfunction clearResource() {\n    TabWorkSpaceResource.iClearAll();\n}\n\nfunction queryWorkSpaceInfo(id) {\n    workspaceId = id;\n    // 将当前活动Tab页切换到基本信息Tab页\n    // TabsWorkSpaceInfo.setActiveTab(panelTabInfo);\n    queryDataInfo();\n    // queryWorkFlow();\n    // queryDataService();\n    // TabWorkSpaceResource.iSetWorkSpaceId(workspaceId);\n}\n\nfunction TabsWorkSpaceInfo_afterrender(sender) {\n\n    // sgw2018.05.17:此处会自动生成ID导致无法添加新的工区信息，所以注释掉\n    // if(workspaceId !== null && workspaceId !== undefined && workspaceId !== '') {\n    //     return;\n    // }\n    // workspaceId = vmd.util.guid();\n    // TabWorkSpaceResource.iSetWorkSpaceId(workspaceId);\n}\n\nfunction TabWorkSpaceResource_beforerender(sender) {\n\n    // console.log(\"第一层的组件TabWorkSpaceResource_beforerender\");\n\n    // this.iSetDataStore(page.dataStore);\n}\n\nfunction ProjectAuthority_beforerender(sender) {\n\n    // console.log(\"第一层的ProjectAuthority_beforerender\");\n}\n\nfunction TabsWorkSpaceInfo_beforerender(sender) {\n    panelTabInfo.ifDataLoaded = false;\n    panelTabWorkflow.ifDataLoaded = false;\n    panelTabDataService.ifDataLoaded = false;\n}\n\n// 选中工区变化了\nfunction changeWorkSpace(id) {\n    workspaceId = id;\n    var tabId = TabsWorkSpaceInfo.activeTab.id;\n    var tabIndexInfo = tabId.indexOf(\"panelTabInfo\"); // 基于0开始,找不到返回-1\n    var tabIndexWorkFlow = tabId.indexOf(\"panelTabWorkflow\"); // 基于0开始,找不到返回-1\n    var tabIndexDataService = tabId.indexOf(\"panelTabDataService\"); // 基于0开始,找不到返回-1\n    var tabIndexResource = tabId.indexOf(\"panelTabResource\"); // 基于0开始,找不到返回-1\n\n    // 基本信息\n    if(tabIndexInfo > -1) {\n        queryDataInfo();\n    } else if(tabIndexWorkFlow > -1) {\n        queryWorkFlow();\n    } else if(tabIndexDataService > -1) {\n        queryDataService();\n    } else if(tabIndexResource > -1) {\n        TabWorkSpaceResource.iSetWorkSpaceId(workspaceId);\n        TabWorkSpaceResource.iTabChangeResource();\n    }\n}\n\nfunction comlistWorkflowAddress_selectChanged(sender, combo, record, index) {\n    comlistWorkflowAddress.serviceId = record.data.id;\n}\n\nfunction comlistDataServiceAddress_selectChanged(sender, combo, record, index) {\n    comlistDataServiceAddress.serviceId = record.data.id;\n}","vmdcss":"","vmdprops":"\"\"","type":"ux","vmdinterface":"{\"components\":[{\"cid\":\"vmduxprops\",\"layoutConfig\":{},\"userConfig\":{},\"cn\":[{\"cid\":\"uxprop\",\"id\":\"storeWorkflow\",\"layoutConfig\":{},\"userConfig\":{\"id\":\"storeWorkflow\",\"zhname\":\"\",\"bindCmp\":\"comlistWorkflowAddress\",\"bindValue\":\"store\",\"isPublic\":\"on\",\"desc\":\"工作流下拉列表绑定的数据集\",\"uxcid\":\"vmdComlist\",\"group\":\"\"}},{\"cid\":\"uxprop\",\"id\":\"storeDataService\",\"layoutConfig\":{},\"userConfig\":{\"id\":\"storeDataService\",\"desc\":\"数据服务下拉列表绑定的数据集\",\"zhname\":\"\",\"isPublic\":\"on\",\"bindCmp\":\"comlistDataServiceAddress\",\"bindValue\":\"store\",\"uxcid\":\"vmdComlist\"}}]},{\"cid\":\"vmduxmethods\",\"id\":\"方法\",\"layoutConfig\":{},\"userConfig\":{},\"cn\":[{\"cid\":\"uxmethod\",\"id\":\"iSaveData\",\"layoutConfig\":{},\"userConfig\":{\"id\":\"iSaveData\",\"zhname\":\"\",\"bindCmp\":\"\",\"bindValue\":\"\",\"isPublic\":\"on\",\"desc\":\"保存数据的接口\",\"uxcid\":\"\",\"params\":\"lastId, refreshStore\",\"code\":\"//直接填写方法内容\\nsaveData(lastId,refreshStore);\",\"returnType\":\"数字\"}},{\"cid\":\"uxmethod\",\"id\":\"iSetWorkSpaceId\",\"layoutConfig\":{},\"userConfig\":{\"id\":\"iSetWorkSpaceId\",\"zhname\":\"\",\"bindCmp\":\"\",\"bindValue\":\"\",\"isPublic\":\"on\",\"desc\":\"设置工区的ID\",\"uxcid\":\"\",\"params\":\"id\",\"code\":\"//直接填写方法内容\\nworkspaceId = id;\",\"returnType\":\"无\"}},{\"cid\":\"uxmethod\",\"id\":\"iSetDataStore\",\"layoutConfig\":{},\"userConfig\":{\"id\":\"iSetDataStore\",\"zhname\":\"\",\"bindCmp\":\"\",\"bindValue\":\"\",\"isPublic\":\"on\",\"desc\":\"\",\"uxcid\":\"\",\"params\":\"store\",\"code\":\"//直接填写方法内容\\nthis.dataStore = store;\",\"returnType\":\"无\"}},{\"cid\":\"uxmethod\",\"id\":\"iGetWorkSpaceName\",\"layoutConfig\":{},\"userConfig\":{\"id\":\"iGetWorkSpaceName\",\"zhname\":\"\",\"bindCmp\":\"\",\"bindValue\":\"\",\"isPublic\":\"on\",\"desc\":\"获取工区名称\",\"uxcid\":\"\",\"params\":\"\",\"code\":\"//直接填写方法内容\\nreturn hwTextWorkSpaceName.getValue();\",\"returnType\":\"字符串\"}},{\"cid\":\"uxmethod\",\"id\":\"iClearAll\",\"layoutConfig\":{},\"userConfig\":{\"id\":\"iClearAll\",\"zhname\":\"\",\"bindCmp\":\"\",\"bindValue\":\"\",\"isPublic\":\"on\",\"desc\":\"清空组件中所有数据\",\"uxcid\":\"\",\"params\":\"\",\"code\":\"//直接填写方法内容\\nclearAll();\",\"returnType\":\"无\"}},{\"cid\":\"uxmethod\",\"id\":\"iNewWorkSpace\",\"layoutConfig\":{},\"userConfig\":{\"id\":\"iNewWorkSpace\",\"zhname\":\"\",\"bindCmp\":\"\",\"bindValue\":\"\",\"isPublic\":\"on\",\"desc\":\"新建工区\",\"uxcid\":\"\",\"params\":\"id\",\"code\":\"//直接填写方法内容\\nnewWorkSpace(id);\",\"returnType\":\"无\"}},{\"cid\":\"uxmethod\",\"id\":\"iQueryWorkSpaceInfo\",\"layoutConfig\":{},\"userConfig\":{\"id\":\"iQueryWorkSpaceInfo\",\"zhname\":\"\",\"bindCmp\":\"\",\"bindValue\":\"\",\"isPublic\":\"on\",\"desc\":\"传入工区ID,查询工区信息，显示到Tab页上\",\"uxcid\":\"\",\"params\":\"id\",\"code\":\"//直接填写方法内容\\nqueryWorkSpaceInfo(id);\",\"returnType\":\"无\"}},{\"cid\":\"uxmethod\",\"id\":\"iSetIfDataLoaded\",\"layoutConfig\":{},\"userConfig\":{\"id\":\"iSetIfDataLoaded\",\"zhname\":\"\",\"bindCmp\":\"\",\"bindValue\":\"\",\"isPublic\":\"on\",\"desc\":\"设置数据是否已加载\",\"uxcid\":\"\",\"params\":\"bVar\",\"code\":\"//直接填写方法内容\\nsetIfDataLoaded(bVar);\",\"returnType\":\"无\"}},{\"cid\":\"uxmethod\",\"id\":\"iChangeWorkSpace\",\"layoutConfig\":{},\"userConfig\":{\"id\":\"iChangeWorkSpace\",\"zhname\":\"\",\"bindCmp\":\"\",\"bindValue\":\"\",\"isPublic\":\"on\",\"desc\":\"改变了选择工区\",\"uxcid\":\"\",\"params\":\"id\",\"code\":\"//直接填写方法内容\\nchangeWorkSpace(id);\",\"returnType\":\"无\"}},{\"cid\":\"uxmethod\",\"id\":\"isSaveFlow\",\"layoutConfig\":{},\"userConfig\":{\"id\":\"isSaveFlow\",\"zhname\":\"\",\"bindCmp\":\"\",\"bindValue\":\"\",\"isPublic\":\"on\",\"desc\":\"\",\"uxcid\":\"\",\"params\":\"callback\",\"code\":\"//直接填写方法内容\\nsaveFlow(callback)\",\"returnType\":\"\"}},{\"cid\":\"uxmethod\",\"id\":\"isSaveService\",\"layoutConfig\":{},\"userConfig\":{\"id\":\"isSaveService\",\"zhname\":\"\",\"bindCmp\":\"\",\"bindValue\":\"\",\"isPublic\":\"on\",\"desc\":\"\",\"uxcid\":\"\",\"params\":\"callback\",\"code\":\"//直接填写方法内容\\nsaveService(callback)\",\"returnType\":\"\"}},{\"cid\":\"uxmethod\",\"id\":\"iSetWorkflowStoreRecords\",\"layoutConfig\":{},\"userConfig\":{\"id\":\"iSetWorkflowStoreRecords\",\"params\":\"records\",\"desc\":\"设置工作流下拉列表的数据（非重复）\",\"hwCheckbox\":\"无\",\"isPublic\":\"on\",\"code\":\"//直接填写方法内容\\nworkflowStoreRecords = records;\",\"returnType\":\"无\"}},{\"cid\":\"uxmethod\",\"id\":\"iSetDataServiceStoreRecords\",\"layoutConfig\":{},\"userConfig\":{\"id\":\"iSetDataServiceStoreRecords\",\"params\":\"records\",\"desc\":\"设置数据服务下拉列表的数据（非重复）\",\"hwCheckbox\":\"无\",\"isPublic\":\"on\",\"code\":\"//直接填写方法内容\\ndataserviceStoreRecords = records;\",\"returnType\":\"无\"}}]},{\"cid\":\"vmduxevents\",\"id\":\"事件\",\"layoutConfig\":{},\"userConfig\":{}}]}"}