{"vmdversion":"2.0.4.190627","vmdlayout":"{\"components\":[{\"cid\":\"uxpanel\",\"id\":\"TabProjectInfo\",\"layoutConfig\":{},\"userConfig\":{\"layout\":\"fit\",\"header\":false,\"width\":609,\"height\":422,\"beforerender\":\"TabProjectInfo_beforerender\",\"afterrender\":\"TabProjectInfo_afterrender\",\"style\":\"font-size: 14px\"},\"cn\":[{\"cid\":\"tabpanel\",\"id\":\"TabsProjectInfo\",\"layoutConfig\":{},\"userConfig\":{\"x\":0,\"y\":0,\"width\":610,\"height\":420,\"id\":\"TabsProjectInfo\",\"activeTab\":0,\"tabchange\":\"TabsProjectInfo_tabchange\",\"afterrender\":\"TabsProjectInfo_afterrender\"},\"cn\":[{\"cid\":\"panel\",\"id\":\"panelTabInfo\",\"layoutConfig\":{},\"userConfig\":{\"title\":\"基本信息\",\"id\":\"panelTabInfo\",\"layout\":\"absolute\",\"width\":436,\"height\":270,\"beforerender\":\"panelTabInfo_beforerender\"},\"cn\":[{\"cid\":\"label\",\"id\":\"label\",\"layoutConfig\":{},\"userConfig\":{\"x\":20,\"y\":15,\"text\":\"项目名称：\",\"height\":20}},{\"cid\":\"textfield\",\"id\":\"hwTextProjectName\",\"layoutConfig\":{},\"userConfig\":{\"x\":90,\"y\":10,\"width\":470,\"id\":\"hwTextProjectName\",\"blankText\":\"\",\"emptyText\":\"我的项目\"}},{\"cid\":\"textfield\",\"id\":\"hwTextCreateTime\",\"layoutConfig\":{},\"userConfig\":{\"x\":90,\"y\":100,\"width\":470,\"readOnly\":false,\"id\":\"hwTextCreateTime\",\"disabled\":true}},{\"cid\":\"label\",\"id\":\"label1\",\"layoutConfig\":{},\"userConfig\":{\"x\":20,\"y\":105,\"text\":\"创建时间：\"}},{\"cid\":\"label\",\"id\":\"label2\",\"layoutConfig\":{},\"userConfig\":{\"x\":20,\"y\":165,\"text\":\"修改时间：\"}},{\"cid\":\"textfield\",\"id\":\"hwTextModifiedTime\",\"layoutConfig\":{},\"userConfig\":{\"x\":90,\"y\":160,\"width\":470,\"readOnly\":false,\"id\":\"hwTextModifiedTime\",\"disabled\":true}},{\"cid\":\"label\",\"id\":\"label3\",\"layoutConfig\":{},\"userConfig\":{\"x\":43,\"y\":190,\"text\":\"    说明：\",\"height\":20}},{\"cid\":\"textarea\",\"id\":\"hwTextAreaProjectDescription\",\"layoutConfig\":{},\"userConfig\":{\"x\":90,\"y\":190,\"width\":470,\"height\":90,\"id\":\"hwTextAreaProjectDescription\"}},{\"cid\":\"label\",\"id\":\"label6\",\"layoutConfig\":{},\"userConfig\":{\"x\":32,\"y\":75,\"text\":\"创建人：\",\"height\":16}},{\"cid\":\"label\",\"id\":\"label7\",\"layoutConfig\":{},\"userConfig\":{\"x\":32,\"y\":135,\"text\":\"修改人：\"}},{\"cid\":\"textfield\",\"id\":\"hwTextCreateBy\",\"layoutConfig\":{},\"userConfig\":{\"x\":90,\"y\":70,\"width\":470,\"id\":\"hwTextCreateBy\",\"readOnly\":false,\"disabled\":true}},{\"cid\":\"textfield\",\"id\":\"hwTextModifiedBy\",\"layoutConfig\":{},\"userConfig\":{\"x\":90,\"y\":130,\"width\":470,\"id\":\"hwTextModifiedBy\",\"beforerender\":\"hwTextModifiedBy_beforerender\",\"readOnly\":false,\"disabled\":true}},{\"cid\":\"label\",\"id\":\"label4\",\"layoutConfig\":{},\"userConfig\":{\"x\":20,\"y\":45,\"text\":\"项目别名：\",\"height\":20}},{\"cid\":\"textfield\",\"id\":\"hwTextProjectAlias\",\"layoutConfig\":{},\"userConfig\":{\"x\":90,\"y\":40,\"width\":470,\"id\":\"hwTextProjectAlias\"}}]},{\"cid\":\"panel\",\"id\":\"panelTabWorkflow\",\"layoutConfig\":{},\"userConfig\":{\"title\":\"工作流\",\"id\":\"panelTabWorkflow\",\"layout\":\"fit\"},\"cn\":[{\"cid\":\"checkboxgroup\",\"id\":\"workflowChkgroup\",\"layoutConfig\":{},\"userConfig\":{\"x\":10,\"y\":0,\"vertical\":true,\"width\":600,\"height\":390,\"columns\":2,\"id\":\"workflowChkgroup\",\"afterrender\":\"workflowChkgroup_afterrender\",\"beforerender\":\"workflowChkgroup_beforerender\",\"store\":\"\",\"autoScroll\":true}}]},{\"cid\":\"panel\",\"id\":\"panelTabDataService\",\"layoutConfig\":{},\"userConfig\":{\"title\":\"数据服务\",\"id\":\"panelTabDataService\",\"layout\":\"border\"},\"cn\":[{\"cid\":\"container\",\"id\":\"div\",\"layoutConfig\":{},\"userConfig\":{\"style\":\"\",\"autoWidth\":false,\"autoHeight\":false,\"height\":35,\"width\":609,\"layout\":\"auto\",\"region\":\"north\"},\"cn\":[{\"cid\":\"vmdButton\",\"id\":\"delService\",\"layoutConfig\":{},\"userConfig\":{\"text\":\"删除\",\"id\":\"delService\",\"type\":\"text\",\"icon\":\"icon-minus\",\"style\":\"position: relative;    margin-right: 20px;    float: right;    top: 4px;    font-size: 14px;\",\"click\":\"delService_click\"}},{\"cid\":\"vmdButton\",\"id\":\"addService\",\"layoutConfig\":{},\"userConfig\":{\"text\":\"添加\",\"style\":\"position: relative;    margin-right: 20px;    float: right;    top: 4px;    font-size: 14px;\",\"id\":\"addService\",\"icon\":\" icon-plus\",\"type\":\"text\",\"click\":\"addService_click\"}}]},{\"cid\":\"checkboxgroup\",\"id\":\"chkGrpDataService\",\"layoutConfig\":{},\"userConfig\":{\"width\":595,\"vertical\":false,\"columns\":3,\"id\":\"chkGrpDataService\",\"beforerender\":\"chkGrpDataService_beforerender\",\"height\":355,\"x\":15,\"y\":40,\"autoScroll\":true,\"region\":\"center\"}}]},{\"cid\":\"panel\",\"id\":\"panelTabResource\",\"layoutConfig\":{},\"userConfig\":{\"id\":\"panelTabResource\",\"title\":\"资源\",\"layout\":\"border\",\"disabled\":false},\"cn\":[{\"cid\":\"container\",\"id\":\"div1\",\"layoutConfig\":{},\"userConfig\":{\"region\":\"north\",\"layout\":\"absolute\",\"height\":38},\"cn\":[{\"cid\":\"vmdButton\",\"id\":\"button\",\"layoutConfig\":{},\"userConfig\":{\"x\":10,\"y\":5,\"type\":\"text\",\"icon\":\"icon-plus\",\"text\":\"资源选择\",\"click\":\"button_click\",\"style\":\"font-size: 14px;\"}},{\"cid\":\"vmdButton\",\"id\":\"button1\",\"layoutConfig\":{},\"userConfig\":{\"x\":90,\"y\":5,\"text\":\"删除\",\"type\":\"text\",\"icon\":\"icon-minus\",\"click\":\"button1_click\",\"style\":\"font-size: 14px;\"}},{\"cid\":\"vmdButton\",\"id\":\"button2\",\"layoutConfig\":{},\"userConfig\":{\"x\":150,\"y\":5,\"text\":\"上移\",\"icon\":\"icon-arrow-up\",\"type\":\"text\",\"click\":\"button2_click\",\"style\":\"font-size: 14px;\"}},{\"cid\":\"vmdButton\",\"id\":\"button3\",\"layoutConfig\":{},\"userConfig\":{\"x\":210,\"y\":5,\"text\":\"下移\",\"type\":\"text\",\"icon\":\"icon-arrow-down\",\"click\":\"button3_click\",\"style\":\"font-size: 14px;\"}}]},{\"cid\":\"vmdTreeEx\",\"id\":\"tree\",\"layoutConfig\":{},\"userConfig\":{\"x\":40,\"y\":200,\"region\":\"center\",\"afterrender\":\"tree_afterrender\",\"hideRoot\":true,\"folderImg\":\"/img/public/folderClosed.gif\",\"nodedraggable\":false,\"leafImg\":\"/img/public/u772.png\",\"style\":\"font-size: 14px;\",\"cls\":\"restree\"}}]}]},{\"cid\":\"vmdMenu\",\"id\":\"res_menu\",\"layoutConfig\":{},\"userConfig\":{\"afterrender\":\"hwMenu_afterrender\",\"id\":\"res_menu\"},\"cn\":[{\"cid\":\"vmdMenuItem\",\"id\":\"hwMenuItem\",\"layoutConfig\":{},\"userConfig\":{\"text\":\"Menu Item\",\"hidden\":false}},{\"cid\":\"vmdMenuItem\",\"id\":\"hwMenuItem1\",\"layoutConfig\":{},\"userConfig\":{\"text\":\"Menu Item\",\"hidden\":false}},{\"cid\":\"vmdMenuItem\",\"id\":\"hwMenuItem2\",\"layoutConfig\":{},\"userConfig\":{\"text\":\"Menu Item\",\"hidden\":false}}]}]},{\"cid\":\"vmddataset\",\"id\":\"数据集\",\"layoutConfig\":{},\"userConfig\":{}}]}","vmdevents":"var page = this;\nvar projectId = vmd.getUrlParam(\"id\");\nvar objInfoId = \"\"; // 项目ID\nvar workspaceId = \"\"; // 工区ID\nvar workflowAddress = \"\"; // 工作流服务地址\nvar applyType = 1;\nvar login = Ext.util.Cookies.get('userName');\nvar storeWorkflow = new Ext.data.JsonStore({\n    proxy: new Ext.data.MemoryProxy(),\n    fields: ['label', 'value', 'checked']\n});\nvar storeDataService = new Ext.data.JsonStore({\n    proxy: new Ext.data.MemoryProxy(),\n    fields: ['label', 'value', 'checked']\n});\n\nfunction TabsProjectInfo_tabchange(sender, tab) {\n    var tabId = tab.id;\n    var tabIndexInfo = tabId.indexOf(\"panelTabInfo\"); // 基于0开始,找不到返回-1\n    var tabIndexWorkFlow = tabId.indexOf(\"panelTabWorkflow\"); // 基于0开始,找不到返回-1\n    var tabIndexDataService = tabId.indexOf(\"panelTabDataService\"); // 基于0开始,找不到返回-1\n    var tabIndexResource = tabId.indexOf(\"panelTabResource\"); // 基于0开始,找不到返回-1\n    // 基本信息\n    if (tabIndexInfo > -1) {\n        queryDataInfo();\n    } else if (tabIndexWorkFlow > -1) {\n        queryWorkFlow();\n    } else if (tabIndexDataService > -1) {\n        queryDataService();\n    }\n}\n\nfunction queryDataInfo() {\n    if (objInfoId === null || objInfoId === undefined || objInfoId === '') {\n        return;\n    }\n    if (panelTabInfo.ifDataLoaded) {\n        return;\n    }\n    hwDas.get(\n        \"DataServiceWorkSpace/projectInfo/ProjectBaseInfo\", {}, {\n            \"projectid\": objInfoId\n        },\n        function(result) {\n            // 根据获取的数据赋值基本信息Tab页\n            if (null === result && undefined === result) {\n                return;\n            }\n            if (null != result.data && undefined != result.data) {\n                if (result.data.length > 0) {\n                    if (null != result.data[0].datas && undefined != result.data[0].datas) {\n                        if (result.data[0].datas.length > 0) {\n                            hwTextProjectName.setValue(result.data[0].datas[0].project_name);\n                            hwTextProjectAlias.setValue(result.data[0].datas[0].alias_short_name);\n                            hwTextCreateBy.setValue(result.data[0].datas[0].row_created_by);\n                            hwTextCreateTime.setValue(result.data[0].datas[0].row_created_date);\n                            hwTextModifiedBy.setValue(result.data[0].datas[0].row_changed_by);\n                            hwTextModifiedTime.setValue(result.data[0].datas[0].row_changed_date);\n                            hwTextAreaProjectDescription.setValue(result.data[0].datas[0].description);\n                        }\n                    }\n                }\n            }\n            panelTabInfo.ifDataLoaded = true;\n            // Tips.tips(\"查询成功！\", \"success\");\n        },\n        function(msg) {\n            Tips.tips(\"查询失败！\", \"error\");\n            // Ext.Msg.alert(\"提示\", \"查询项目信息失败！\");\n        });\n}\n\nfunction queryWorkFlow() {\n    // objInfoId = \"326c3fa0-1e02-4402-b2c2-42659a50e0b0\";\n    if (objInfoId === null || objInfoId === undefined || objInfoId === '') {\n        return;\n    }\n    if (panelTabWorkflow.ifDataLoaded) {\n        return;\n    }\n    var urlService = \"http://\" + (parent.vmd.workspace.workflowIp || vmdSettings.workflowIp) + \"/activiti-rest/service/repository/categorys/root?info=kermit&size=100\";\n    // 获取根节点下的文件夹节点信息\n    hwDas.ajax({\n        url: urlService,\n        type: 'get',\n        params: {},\n        success: function(result) {\n            // 列表数据加载完成后，查询项目服务分类关系表（PROJECT_SERVICECATEGORY）\n            // 获取选中的工作流，并设置节点选中\n            hwDas.get(\n                \"DataServiceWorkSpace/projectInfo/ProjcetServiceCategory\", {}, {\n                    \"projectid\": objInfoId,\n                    \"type\": 0\n                },\n                function(resultChecked) {\n                    // 根据获取的数据赋值基本信息Tab页\n                    if (null === resultChecked && undefined === resultChecked) {\n                        return;\n                    }\n                    if (null != resultChecked.data && undefined != resultChecked.data) {\n                        if (resultChecked.data.length > 0) {\n                            // 获取数据后解析形成树形节点；\n                            var arrDataTmp = [];\n                            for (var i = 0; i < result.data.length; i++) {\n                                var ifChecked = false;\n                                if (null != resultChecked.data[0].datas && undefined != resultChecked.data[0].datas) {\n                                    // SERVICE_CATEGORY_ID\n                                    for (var j = 0; j < resultChecked.data[0].datas.length; j++) {\n                                        if (result.data[i].id == resultChecked.data[0].datas[j].service_category_id) {\n                                            ifChecked = true;\n                                        }\n                                    }\n                                }\n                                var objTmp = {\n                                    label: result.data[i].name,\n                                    value: result.data[i].id,\n                                    checked: ifChecked\n                                };\n                                arrDataTmp.push(objTmp);\n                            }\n                            storeWorkflow.loadData(arrDataTmp);\n                        }\n                    }\n                    // Tips.tips(\"查询成功！\", \"success\");\n                },\n                function(msg) {\n                    // 获取数据后解析形成树形节点；\n                    var arrDataTmp = [];\n                    for (var i = 0; i < result.data.length; i++) {\n                        var objTmp = {\n                            label: result.data[i].name,\n                            value: result.data[i].id,\n                            checked: false\n                        };\n                        arrDataTmp.push(objTmp);\n                    }\n                    storeWorkflow.loadData(arrDataTmp);\n                    // Tips.tips(\"查询失败！\", \"error\");\n                });\n            panelTabWorkflow.ifDataLoaded = true;\n            // workflowChkgroup.panel.doLayout();\n        },\n        error: function(msg) {\n            // Tips.tips(\"查询失败！\", \"error\");\n            // myMask.hide();\n            // Ext.Msg.alert(\"提示\", \"获取模块信息失败\", function() {})\n        }\n    });\n}\n\nfunction queryDataService() {\n    if (objInfoId === null || objInfoId === undefined || objInfoId === '') {\n        return;\n    }\n    if (panelTabDataService.ifDataLoaded) {\n        return;\n    }\n    var urlparam = {\n        host: parent.vmd.workspace.dataServiceIp || vmdSettings.dataServiceIp,\n        url: \"DataService/Service/Project\"\n    }\n    hwDas.get(urlparam, {}, {\n            develop: \"true\"\n        }, function(result) {\n            // 列表数据加载完成后，查询项目服务分类关系表（PROJECT_SERVICECATEGORY）\n            // 获取选中的数据服务，并设置节点选中\n            hwDas.get(\n                \"DataServiceWorkSpace/projectInfo/ProjcetServiceCategory\", {}, {\n                    \"projectid\": objInfoId,\n                    \"type\": 1\n                },\n                function(resultChecked) {\n                    // 根据获取的数据赋值基本信息Tab页\n                    if (null === resultChecked && undefined === resultChecked) {\n                        return;\n                    }\n                    if (null != resultChecked.data && undefined != resultChecked.data) {\n                        if (resultChecked.data.length > 0) {\n                            // 获取数据后解析形成树形节点；\n                            var arrDataTmp = [];\n                            for (var j = 0; j < result.data.length; j++) {\n                                for (var i = 0; i < result.data[j].datas.length; i++) {\n                                    var ifChecked = false;\n                                    if (null != resultChecked.data[0].datas && undefined != resultChecked.data[0].datas) {\n                                        // SERVICE_CATEGORY_ID\n                                        for (var k = 0; k < resultChecked.data[0].datas.length; k++) {\n                                            if (result.data[j].datas[i].id == resultChecked.data[0].datas[k].service_category_id) {\n                                                ifChecked = true;\n                                            }\n                                        }\n                                    }\n                                    var objTmp = {\n                                        label: result.data[j].datas[i].name,\n                                        value: result.data[j].datas[i].id,\n                                        checked: ifChecked\n                                    };\n                                    arrDataTmp.push(objTmp);\n                                }\n                            }\n                            storeDataService.loadData(arrDataTmp);\n                        }\n                    }\n                    panelTabDataService.ifDataLoaded = true;\n                    // Tips.tips(\"查询成功！\", \"success\");\n                },\n                function(msg) {\n                    // 获取数据后解析形成树形节点；\n                    var arrDataTmp = [];\n                    for (var i = 0; i < result.data.length; i++) {\n                        var objTmp = {\n                            label: result.data[i].name,\n                            value: result.data[i].id,\n                            checked: false\n                        };\n                        arrDataTmp.push(objTmp);\n                    }\n                    storeDataService.loadData(arrDataTmp);\n                    // Tips.tips(\"查询失败！\", \"error\");\n                });\n            // workflowChkgroup.panel.doLayout();\n        },\n        function(msg) {\n            // Tips.tips(\"查询失败！\", \"error\");\n            // Ext.Msg.alert(\"提示\", \"数据服务信息获取失败！\", function() {})\n        })\n}\n\nfunction saveData(callback) {\n    var flag = 0; // 0: insert, 1:update;\n    if (objInfoId !== null && objInfoId !== undefined && objInfoId !== '') {\n        flag = 1;\n    }\n    if (0 === flag) {\n        objInfoId = vmd.util.guid();\n    }\n    var tabId = TabsProjectInfo.activeTab.id;\n    var tabIndexInfo = tabId.indexOf(\"panelTabInfo\"); // 基于0开始,找不到返回-1\n    var tabIndexWorkFlow = tabId.indexOf(\"panelTabWorkflow\"); // 基于0开始,找不到返回-1\n    var tabIndexDataService = tabId.indexOf(\"panelTabDataService\"); // 基于0开始,找不到返回-1\n    var tabIndexResource = tabId.indexOf(\"panelTabResource\"); // 基于0开始,找不到返回-1\n    // 基本信息\n    if (panelTabInfo.ifDataLoaded) {\n        saveDataInfo(objInfoId, flag, callback);\n    }\n    if (panelTabWorkflow.ifDataLoaded) {\n        saveWorkFlow(objInfoId, flag, callback);\n    }\n    if (panelTabDataService.ifDataLoaded) {\n        saveDataService(objInfoId, flag, callback);\n    }\n    if (tree.rendered) {\n        saveProjectResource()\n    }\n}\n// flag 0:insert, 1:update\nfunction saveDataInfo(id, flag, callback) {\n    var myDate = new Date();\n    // myDate.toLocaleString(); //获取日期与时间\n    var nameTmp = hwTextProjectName.getValue();\n    var aliasTmp = hwTextProjectAlias.getValue();\n    if (aliasTmp === null || aliasTmp === undefined || aliasTmp === '') {\n        aliasTmp = nameTmp;\n    }\n    hwDas.edit(\n        \"DataServiceWorkSpace/projectInfo/ProjectBaseInfo\", {}, {}, [{\n            'projectid': id,\n            'name': nameTmp,\n            'aliasname': aliasTmp,\n            'changedby': login,\n            'changeddate': myDate.toLocaleString(),\n            'description': hwTextAreaProjectDescription.getValue()\n        }],\n        function(result) {\n            if (callback) {\n                callback(0);\n            }\n            Tips.tips(\"保存成功\", \"success\");\n        },\n        function(msg) {\n            Tips.tips(\"保存失败\", \"error\");\n        }\n    );\n}\n\nfunction saveWorkFlow(id, flag, callback) {\n    // 先删除原来关联的工作流服务分类\n    hwDas.del(\n        \"DataServiceWorkSpace/projectInfo/DelProjectServiceCategory\", {}, {\n            'projectid': id,\n            'type': 0\n        },\n        function(result) {\n            // 保存新选择的关联的工作流服务分类\n            var arrData = [];\n            if (workflowChkgroup.items) {\n                for (var k = 0; k < workflowChkgroup.items.items.length; k++) {\n                    if (workflowChkgroup.items.items[k].checked) {\n                        var objWorkflow = {\n                            'projectid': id,\n                            'servicecategoryid': workflowChkgroup.items.items[k].inputValue,\n                            'type': 0\n                        };\n                        arrData.push(objWorkflow);\n                    }\n                }\n            }\n            hwDas.add(\n                \"DataServiceWorkSpace/projectInfo/ProjcetServiceCategory\", {}, {}, arrData,\n                function(result) {\n                    if (callback) {\n                        callback(1);\n                    }\n                    Tips.tips(\"保存成功！\", \"success\");\n                },\n                function(msg) {\n                    Tips.tips(\"保存失败！\", \"error\");\n                }\n            );\n        },\n        function(msg) {\n            console.log(msg)\n        }\n    );\n}\n\nfunction saveDataService(id, flag, callback) {\n    // 先删除原来关联的数据服务分类\n    hwDas.del(\n        \"DataServiceWorkSpace/projectInfo/DelProjectServiceCategory\", {}, {\n            'projectid': id,\n            'type': 1\n        },\n        function(result) {\n            // 保存新选择的关联的数据服务分类\n            var arrData = [];\n            for (var k = 0; k < chkGrpDataService.items.items.length; k++) {\n                if (chkGrpDataService.items.items[k].checked) {\n                    var objWorkflow = {\n                        'projectid': id,\n                        'servicecategoryid': chkGrpDataService.items.items[k].inputValue,\n                        'type': 1\n                    };\n                    arrData.push(objWorkflow);\n                }\n            }\n            hwDas.add(\n                \"DataServiceWorkSpace/projectInfo/ProjcetServiceCategory\", {}, {}, arrData,\n                function(result) {\n                    if (callback) {\n                        callback(2);\n                    }\n                    Tips.tips(\"保存成功！\", \"success\");\n                },\n                function(msg) {\n                    Tips.tips(\"保存失败！\", \"error\");\n                }\n            );\n        },\n        function(msg) {\n            console.log(msg)\n        }\n    );\n}\n\nfunction saveProjectResource() {\n    if (!projectId)\n        return;\n    hwDas.del(\"CDEServcie/project/getproresource\", {}, {\n        projectid: projectId\n    }, function(result) {\n        hwDas.save(\"CDEServcie/project/getproresource\", {}, {\n            projectid: projectId\n        }, treestroe.getJson(), function(result) {\n            Tips.tips(\"保存成功！\", \"success\");\n        }, function(msg) {\n            Tips.tips(\"保存失败！\", \"error\");\n        })\n    }, function(msg) {\n        Tips.tips(\"保存失败！\", \"error\");\n    })\n}\n\nfunction workflowChkgroup_afterrender(sender) {}\n\nfunction workflowChkgroup_beforerender(sender) {\n    sender.store = storeWorkflow;\n}\n\nfunction chkGrpDataService_beforerender(sender) {\n    sender.store = storeDataService;\n}\n// 设置数据是否已加载\nfunction setIfDataLoaded(bVar) {\n    panelTabInfo.ifDataLoaded = bVar;\n    panelTabWorkflow.ifDataLoaded = bVar;\n    panelTabDataService.ifDataLoaded = bVar;\n}\n\nfunction TabProjectInfo_beforerender(sender) {\n    panelTabInfo.ifDataLoaded = false;\n    panelTabWorkflow.ifDataLoaded = false;\n    panelTabDataService.ifDataLoaded = false;\n}\n\nfunction TabProjectInfo_afterrender(sender) {}\n\nfunction panelTabInfo_beforerender(sender) {}\n\nfunction hwTextModifiedBy_beforerender(sender) {}\n\nfunction delService_click(sender, e) {\n    Ext.Msg.confirm(\"提示!\", \"确定要删除数据服务?删除后不可恢复！！！\", function(btn) {\n        if (btn == \"yes\") {\n            var arrData = [];\n            for (var k = 0; k < chkGrpDataService.items.items.length; k++) {\n                if (chkGrpDataService.items.items[k].checked) {\n                    var objWorkflow = {\n                        'projectid': objInfoId,\n                        'servicecategoryid': chkGrpDataService.items.items[k].inputValue,\n                        'type': 1\n                    };\n                    var objID = {\n                        'id': chkGrpDataService.items.items[k].inputValue\n                    }\n                    arrData.push(objWorkflow);\n                }\n            }\n            var urlparam = {\n                host: vmd.workspace.dataServiceIp || vmdSettings.dataServiceIp,\n                url: \"DataService/Service/Project\"\n            }\n            arrData.forEach(function(item, index) {\n                if (item.servicecategoryid == \"104FPWq2wr\" || item.servicecategoryid == \"eQX5RdNjsW\" || item.servicecategoryid == \"TuKge8jDwF\" || item.servicecategoryid == \"Tv3hLjddZS\") {\n                    Ext.Msg.alert(\"提示\", \"程序数据服务不可删除，请重新选择需要删除的数据服务！\");\n                    return\n                }\n                hwDas.del(\n                    urlparam, {}, {\n                        'id': item.servicecategoryid\n                    },\n                    function(result) {\n                        // 删除数据服务与项目的关联关系\n                        hwDas.del(\n                            \"DataServiceWorkSpace/projectInfo/ProjcetServiceCategory\", {}, item,\n                            function(result) {\n                                if (index == arrData.length - 1) {\n                                    panelTabDataService.ifDataLoaded = false;\n                                    Tips.tips(\"删除成功！\", \"success\");\n                                    queryDataService();\n                                }\n                            },\n                            function(msg) {\n                                Tips.tips(\"删除关联关系失败！\", \"error\");\n                            }\n                        );\n                        // Tips.tips(\"删除成功！\", \"success\");\n                    },\n                    function(msg) {\n                        Tips.tips(\"删除服务失败！\", \"error\");\n                    }\n                );\n            })\n        }\n    })\n}\n\nfunction addService_click(sender, e) {\n    var addServe = function(code, name, remark) {\n        var serviceCode = code;\n        var serviceName = name;\n        var serviceRemark = remark;\n        var urlparam = {\n            host: vmd.workspace.dataServiceIp || vmdSettings.dataServiceIp,\n            url: \"DataService/Service/Project\"\n        }\n        hwDas.add(\n            urlparam, {}, {}, {\n                code: serviceCode,\n                name: serviceName,\n                remark: serviceRemark\n            },\n            function(result) { \n                if (result == \"\") {\n                    return;\n                }\n                if (!result.data) {\n                    return;\n                }\n                if (result.data.length > 0) {\n                    var serviceName = result.data[0].datas.name;\n                    var serviceId = result.data[0].datas.id;\n                    panelTabDataService.ifDataLoaded = false;\n                    // 新建数据服务分类后，同步关联与项目的关系\n                    var objData = {\n                        'projectid': objInfoId,\n                        'servicecategoryid': serviceId,\n                        'type': 1\n                    };\n                    hwDas.add(\n                        \"DataServiceWorkSpace/projectInfo/ProjcetServiceCategory\", {}, {}, objData,\n                        function(result) {\n                            queryDataService();\n                        },\n                        function(msg) {\n                            console.log(msg)\n                        }\n                    );\n                }\n            },\n            function(msg) {\n                Ext.Msg.alert(\"提示\", \"添加服务失败！\");\n            }\n        );\n    }\n    var winForm = new Ext.winDataService(addServe, \"\", \"\", \"\");\n    winForm.show();\n}\n//数据服务录入框\nExt.winDataService = Ext.extend(Ext.Window, {\n    xtype: \"window\",\n    title: \"数据服务\",\n    width: 300,\n    height: 214,\n    layout: \"form\",\n    bodyStyle: 'padding:15px',\n    labelAlign: \"left\",\n    labelWidth: 40,\n    modal: true,\n    constructor: function(callback, code, name, remark) {\n        this.callback = callback;\n        this.valueCode = code;\n        this.valueName = name;\n        this.valueRemark = remark;\n        this.callParent();\n    },\n    initComponent: function() {\n        var me = this;\n        this.fbar = [{\n            text: \"确定\",\n            handler: function() {\n                me.callback(Ext.getCmp('code').getValue(), Ext.getCmp('name').getValue(), Ext.getCmp('remark').getValue());\n                me.close();\n            }\n        }, {\n            text: \"取消\",\n            handler: function() {\n                me.close();\n            }\n        }];\n        this.items = [{\n            id: 'code',\n            xtype: \"textfield\",\n            fieldLabel: \"编码\",\n            anchor: \"100%\",\n            value: this.valueCode\n        }, {\n            id: 'name',\n            xtype: \"textfield\",\n            fieldLabel: \"名称\",\n            anchor: \"100%\",\n            value: this.valueName\n        }, {\n            id: 'remark',\n            xtype: \"textfield\",\n            fieldLabel: \"说明\",\n            anchor: \"100%\",\n            value: this.valueRemark\n        }]\n        Ext.winDataService.superclass.initComponent.call(this);\n    }\n})\n\nfunction TabsProjectInfo_afterrender(sender) {}\n\nfunction button_click(sender, e) {\n    res_menu.showAt(e.xy)\n}\n\nfunction AddResourceMenu() {\n    function _getVirtualPath(ip, path) {\n        return \"http://\" + ip + \"/\" + path + \"/\";\n    };\n    vmd.core.getModuleResourceServices(objInfoId, function(data) {\n        var resmenudata = [];\n        var serverList = data || [];\n        res_menu.removeAll();\n        serverList.forEach(function(item, index) {\n            var getServerList = function() {\n                var list = [];\n                var serverInfo = item.children;\n                if (serverInfo) {\n                    serverInfo.forEach(function(_item) {\n                        var obj = {\n                            text: _item.name,\n                            name: _item.name,\n                            resName: item.name,\n                            resId: item.id,\n                            servId: _item.id,\n                            virtualPath: _getVirtualPath(_item.address, _item.virtualPath),\n                            id: item.id + _item.id,\n                            iconCls: 'ion-server'\n                        }\n                        list.push(obj);\n                    })\n                }\n                return list;\n            }\n            var obj = {\n                text: item.name,\n                name: item.name,\n                virtualPath: _getVirtualPath(item.address, item.virtualPath),\n                id: item.id,\n                iconCls: 'ion-res',\n                menu: new Ext.menu.Menu({\n                    items: getServerList(),\n                    listeners: {\n                        click: function(menu, item, e) {\n                            itemclick(menu, item, e)\n                        }\n                    }\n                })\n            }\n            resmenudata.push(obj);\n        })\n        res_menu.add(resmenudata);\n        res_menu.doLayout();\n        var itemclick = function(menu, item, e) {\n            var win = new parent.vmd.window({\n                url: vmdSettings.resourcePath + \"?serviceid=\" + item.servId + \"&resourceid=\" + item.resId + \"&servername=\" + item.name,\n                title: '<span style=\"color:blue\">' + item.name + '</span>——文件选择（温馨提示：shift多选资源，只支持js、css、图片的选择）',\n                auto: true,\n                enableLoading: true,\n                offset: [100, 100],\n                fbar: [{\n                    text: '确定',\n                    handler: function() {\n                        var selectFiles = Ext.decode(win.postdata);\n                        if (!selectFiles || (Ext.isArray(selectFiles) && selectFiles.length == 0)) {\n                            win.close();\n                            return;\n                        }\n                        //梳理进行分组调用资源树接口进行添加\n                        var _cssData = [],\n                            _jsData = [],\n                            _imgData = [];\n                        selectFiles.forEach(function(data) {\n                            var ext = data.ext;\n                            var serName = data.servName;\n                            var resName = item.resName;\n                            var path = data.path;\n                            var absolutePath = data.ip + \"/\" + path;\n                            var obj = {\n                                id: serName + \"/\" + path,\n                                servName: resName + \"&&\" + serName,\n                                path: path,\n                                absolutePath: absolutePath,\n                                ext: data.ext\n                            };\n                            var node = tree.getNodeById(obj.id);\n                            if (node) return false;\n                            var type;\n                            if (ext == 'js') {\n                                tree.addNode(\"cate_js\", obj.id, path, true)\n                                type = 2\n                            } else if (ext == 'css') {\n                                tree.addNode(\"cate_css\", obj.id, path, true)\n                                type = 0\n                            }\n                            //将添加的资源添加到树对应的数据集中，用于保存使用\n                            var records = vmd.data.Record.create({\n                                'project_id': projectId,\n                                'xh': 5,\n                                'resource_id': vmd.getGuid(),\n                                'path': obj.path,\n                                'type': type,\n                                'resource_server_id': serName,\n                                'resource_server_name': obj.servName,\n                                'resource_server_ip': data.ip\n                            });\n                            treestroe.add(records)\n                            //重新排序，根据树中节点顺序排序\n                            resetxh()\n                        })\n                        win.close();\n                    }\n                }, {\n                    text: '取消',\n                    handler: function() {\n                        win.close()\n                    }\n                }]\n            })\n            parent.proResSelWin = win\n            parent.proResSelWin.show();\n            parent.postdata = null;\n            parent.addEventListener('message', function(messageEvent) {\n                var data = messageEvent.data;\n                win.postdata = data;\n            }, false);\n        }\n    }, function() {\n        vmd.tip('资源加载失败！', 'error');\n    }, true)\n}\n\nfunction hwMenu_afterrender(sender) {\n    AddResourceMenu()\n}\nvar treestroe = new vmd.data.Store({\n    data: [],\n    fields: ['project_id', 'xh', 'resource_id', 'path', 'type', 'resource_server_id', 'resource_server_name', 'resource_server_ip']\n})\n\nfunction tree_afterrender(sender) {\n    var rootNode = tree.getRootNode()\n    tree.addNode(rootNode.id, \"cate_js\", \"js\", false)\n    tree.addNode(rootNode.id, \"cate_css\", \"css\", false)\n    hwDas.get(\"CDEServcie/project/getproresource\", {}, {\n        projectid: projectId\n    }, function(result) {\n        var res_list = result.data[0].datas\n        var storeList=[];\n        res_list.forEach(function(item, index) {\n            if((item.type==\"0\"||item.type==\"2\")&&item.xh) storeList.push(item)\n            if (item.type == \"0\")\n                tree.addNode(\"cate_css\", item.resource_server_id + \"/\" + item.path, item.path, true)\n            if (item.type == \"2\")\n                tree.addNode(\"cate_js\", item.resource_server_id + \"/\" + item.path, item.path, true)\n        })\n        treestroe.loadData(storeList)\n        //展开节点\n        tree.expandAll()\n    }, function() {})\n}\n\nfunction button2_click(sender, e) {\n    var node = tree.getSelNode()\n    if (node.id == \"cate_css\" || node.id == \"cate_js\")\n        return\n    if (!node.previousSibling)\n        return\n    var cnode = tree.nodeCopy(node);\n    node.parentNode.insertBefore(cnode, node.previousSibling)\n    node.remove()\n    cnode.select()\n    resetxh()\n}\n\nfunction button3_click(sender, e) {\n    var node = tree.getSelNode()\n    if (node.id == \"cate_css\" || node.id == \"cate_js\")\n        return\n    if (!node.nextSibling)\n        return\n    var cnode = tree.nodeCopy(node);\n    var nnode = node.nextSibling\n    if (nnode && node.nextSibling) {\n        node.parentNode.insertBefore(cnode, nnode.nextSibling)\n    } else if (nnode) {\n        node.parentNode.insertBefore(cnode)\n    }\n    node.remove()\n    cnode.select()\n    resetxh()\n}\n\nfunction button1_click(sender, e) {\n    var node = tree.getSelNode()\n    if (node.id == \"cate_css\" || node.id == \"cate_js\")\n        return\n    treestroe.each(function(record) {\n        if (record.get(\"resource_server_id\") +\"/\"+record.get(\"path\") == node.id) {\n            treestroe.remove(record)\n        }\n    })\n    node.remove()\n    resetxh()\n}\n//重置序号\nfunction resetxh() {\n    var cssnode = tree.getNodeById(\"cate_css\")\n    var xh = 1;\n    cssnode.childNodes.forEach(function(item, index) {\n        treestroe.each(function(record) {\n            if (record.get(\"resource_server_id\") + \"/\" + record.get(\"path\") == item.id) {\n                record.set(\"xh\", xh)\n                xh++\n            }\n        })\n    })\n    var jsnode = tree.getNodeById(\"cate_js\")\n    var xh = 1;\n    jsnode.childNodes.forEach(function(item, index) {\n        treestroe.each(function(record) {\n            if (record.get(\"resource_server_id\") + \"/\" + record.get(\"path\") == item.id) {\n                record.set(\"xh\", xh)\n                xh++\n            }\n        })\n    })\n}","vmdcss":".restree .vmd-tree-node\n{font-size:14px;}","vmdprops":"\"\"","type":"ux","vmdevents_controller":"Ext.define('vmd.ux.tabProjectInfo.Controller', {\n    xtype: 'vmd.ux.tabProjectInfo.Controller',\n    constructor: function(options) {\n        \n    }\n})","vmdinterface":"{\"components\":[{\"cid\":\"vmduxprops\",\"layoutConfig\":{},\"userConfig\":{}},{\"cid\":\"vmduxmethods\",\"id\":\"方法\",\"layoutConfig\":{},\"userConfig\":{},\"cn\":[{\"cid\":\"uxmethod\",\"id\":\"iSaveData\",\"layoutConfig\":{},\"userConfig\":{\"id\":\"iSaveData\",\"zhname\":\"\",\"bindCmp\":\"\",\"bindValue\":\"\",\"isPublic\":\"on\",\"desc\":\"保存数据接口，保存基本信息、工作流、数据服务的Tab页的信息。\",\"uxcid\":\"\",\"params\":\"callback\",\"code\":\"//直接填写方法内容\\nsaveData(callback);\",\"returnType\":\"无\"}},{\"cid\":\"uxmethod\",\"id\":\"iSetId\",\"layoutConfig\":{},\"userConfig\":{\"id\":\"iSetId\",\"zhname\":\"\",\"bindCmp\":\"\",\"bindValue\":\"\",\"isPublic\":\"on\",\"desc\":\"设置工区、项目的ID\",\"uxcid\":\"\",\"params\":\"id\",\"code\":\"//直接填写方法内容\\nobjInfoId = id;\",\"returnType\":\"无\"}},{\"cid\":\"uxmethod\",\"id\":\"iGetName\",\"layoutConfig\":{},\"userConfig\":{\"id\":\"iGetName\",\"zhname\":\"\",\"bindCmp\":\"\",\"bindValue\":\"\",\"isPublic\":\"on\",\"desc\":\"获取名称\",\"uxcid\":\"\",\"params\":\"\",\"code\":\"//直接填写方法内容\\nreturn hwTextProjectName.getValue();\",\"returnType\":\"字符串\"}},{\"cid\":\"uxmethod\",\"id\":\"iSetIfDataLoaded\",\"layoutConfig\":{},\"userConfig\":{\"id\":\"iSetIfDataLoaded\",\"zhname\":\"\",\"bindCmp\":\"\",\"bindValue\":\"\",\"isPublic\":\"on\",\"desc\":\"设置是否已加载\",\"uxcid\":\"\",\"params\":\"bVar\",\"code\":\"//直接填写方法内容\\nsetIfDataLoaded(bVar);\",\"returnType\":\"无\"}},{\"cid\":\"uxmethod\",\"id\":\"iSetWorkSpaceId\",\"layoutConfig\":{},\"userConfig\":{\"id\":\"iSetWorkSpaceId\",\"zhname\":\"\",\"bindCmp\":\"\",\"bindValue\":\"\",\"isPublic\":\"on\",\"desc\":\"设置工区id\",\"uxcid\":\"\",\"params\":\"id\",\"code\":\"//直接填写方法内容\\nworkspaceId = id;\",\"returnType\":\"无\"}},{\"cid\":\"uxmethod\",\"id\":\"getRegInfo_PtType\",\"layoutConfig\":{},\"userConfig\":{\"id\":\"getRegInfo_PtType\",\"zhname\":\"\",\"bindCmp\":\"\",\"bindValue\":\"\",\"isPublic\":\"on\",\"desc\":\"\",\"uxcid\":\"\",\"params\":\"\",\"code\":\"//直接填写方法内容\\nreturn c_RegRelease.getPtType()||RegRelease.getPtType();\",\"returnType\":\"字符串\"}},{\"cid\":\"uxmethod\",\"id\":\"hideTab\",\"layoutConfig\":{},\"userConfig\":{\"id\":\"hideTab\",\"zhname\":\"\",\"bindCmp\":\"\",\"bindValue\":\"\",\"isPublic\":\"on\",\"desc\":\"\",\"uxcid\":\"\",\"params\":\"index\",\"code\":\"//直接填写方法内容\\nTabsProjectInfo.hideTabStripItem(index)\",\"returnType\":\"\"}},{\"cid\":\"uxmethod\",\"id\":\"getRegInfo_ptdb\",\"layoutConfig\":{},\"userConfig\":{\"id\":\"getRegInfo_ptdb\",\"zhname\":\"\",\"bindCmp\":\"\",\"bindValue\":\"\",\"isPublic\":\"on\",\"desc\":\"\",\"uxcid\":\"\",\"params\":\"ptdb\",\"code\":\"//直接填写方法内容\\nreturn RegRelease.getptdb()\",\"returnType\":\"\"}}]},{\"cid\":\"vmduxevents\",\"id\":\"事件\",\"layoutConfig\":{},\"userConfig\":{}}]}","vmdresource":"{\"components\":[{\"cid\":\"vmdrescsss\",\"layoutConfig\":{},\"userConfig\":{}},{\"cid\":\"vmdresjss\",\"layoutConfig\":{},\"userConfig\":{},\"cn\":[{\"cid\":\"resjs\",\"id\":\"controller.js\",\"layoutConfig\":{},\"userConfig\":{}}]},{\"cid\":\"vmdresimgs\",\"layoutConfig\":{},\"userConfig\":{}}]}"}