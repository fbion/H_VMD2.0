{"vmdversion":"2.0.3.0920","vmdlayout":"{\"components\":[{\"cid\":\"uxpanel\",\"id\":\"AuditList\",\"layoutConfig\":{\"align\":\"center\",\"pack\":\"start\"},\"userConfig\":{\"layout\":\"vbox\",\"header\":false,\"width\":600,\"height\":560},\"cn\":[{\"cid\":\"panel\",\"id\":\"panel\",\"layoutConfig\":{},\"userConfig\":{\"x\":\"\",\"y\":\"\",\"header\":false,\"layout\":\"fit\",\"autoHeight\":false,\"height\":560,\"width\":600},\"cn\":[{\"cid\":\"grid\",\"id\":\"MyGrid\",\"layoutConfig\":{},\"userConfig\":{\"header\":false,\"beforerender\":\"MyGrid_beforerender\",\"cls\":\"hand vmd-grid\",\"height\":600},\"cn\":[{\"cid\":\"gridcolumn\",\"layoutConfig\":{},\"userConfig\":{\"header\":\"id\",\"dataIndex\":\"id\",\"hidden\":true,\"menuDisabled\":true},\"name\":\"id\"},{\"cid\":\"gridcolumn\",\"layoutConfig\":{},\"userConfig\":{\"header\":\"序号\",\"dataIndex\":\"xh\",\"align\":\"center\",\"hidden\":false,\"menuDisabled\":true},\"name\":\"xh\"},{\"cid\":\"gridcolumn\",\"layoutConfig\":{},\"userConfig\":{\"header\":\"名称\",\"dataIndex\":\"name\",\"align\":\"center\",\"css\":\"text-align: left !important;\",\"width\":350},\"name\":\"name\"},{\"cid\":\"gridcolumn\",\"layoutConfig\":{},\"userConfig\":{\"header\":\"时间\",\"dataIndex\":\"date\",\"align\":\"center\",\"menuDisabled\":true,\"width\":140},\"name\":\"date\"},{\"cid\":\"gridcolumn\",\"layoutConfig\":{},\"userConfig\":{\"header\":\"ur\",\"dataIndex\":\"url\",\"align\":\"center\",\"hidden\":true,\"menuDisabled\":true},\"name\":\"url\"}]}]}]}]}","vmdevents":"var page = this;\nhwMSC.host = vmd.workspace.msgIp;\nvar ipServer = {\n    tz: vmd.workspace.dataServiceIp\n}\nvar store5 = new Ext.data.JsonStore({\n    proxy: new Ext.data.MemoryProxy(),\n    fields: [\"id\", \"xh\", \"name\", \"date\", \"url\"]\n});\n//工作流模板节点\nvar objNode = {\n    workFlowNodeCode_workTemp: [\"gdmblcjd2\", \"gdmblcjd3\", \"gdmblcjd4\", \"gdmblcjd5\"], //工单模板\n    workFlowNodeCode_taskTemp: [\"rwmblcjd2\", \"rwmblcjd3\", \"rwmblcjd4\", \"rwmblcjd5\"], //任务模板\n    workFlowNodeCode_task: [\"rwlcjd2\", \"rwlcjd3\", \"rwlcjd4\", \"rwlcjd5\", \"rwlcjd6\"] //任务\n}\n\nfunction MyGrid_beforerender(sender) {\n    this.store = store5;\n    dataList = [];\n    var param = '';\n    var lb = getQueryString(\"lb\");\n    var userLogin = getQueryString(\"userLogin\");\n    var userDwdm = getQueryString(\"userDwdm\");\n    if(lb == 'db') {\n        hwMSC.taskDoGet(userLogin, 1, 0, function(data) {\n        dataList = data;\n        lodaItem(); //加载数据\n    }, function(rel) {\n        alert(rel);\n    })\n    } else {\n        hwMSC.taskTodoGet(userLogin, userDwdm, 1, 0, function(data) {\n            console.log(data);\n            dataList = data;\n            lodaItem(); //加载数据\n        }, function() {\n            alert(arguments);\n        })\n    }\n}\n\n//加载数据\nfunction lodaItem() {\n    var type = getQueryString(\"type\");\n    var data = dataList;\n    var dataModel = [];\n    var jumpUrl = '';\n    for(var i = 0; i < data.length; i++) {\n        switch (type) {\n            case \"rw\": //任务\n                if(data[i].flow_node_id == objNode.workFlowNodeCode_task[0] ||\n                    data[i].flow_node_id == objNode.workFlowNodeCode_task[2] ||\n                    data[i].flow_node_id == objNode.workFlowNodeCode_task[3] ||\n                    data[i].flow_node_id == objNode.workFlowNodeCode_task[4]) {\n                    dataModel.push({\n                        xh: i + 1,\n                        name: \"<a href='#' onclick='rowLink(this);'>\" + data[i].title + \"</a>\",\n                        date: data[i].row_create_date,\n                        url: ipServer.tz + \"/pages/task/orderView.html?flag=view&applyid=\" + data[i].appId + \"&r=\" + Math.random()\n                    });\n                }\n                break;\n            case \"gdmb\": //工单模板\n                if(data[i].flow_node_id == objNode.workFlowNodeCode_workTemp[0] ||\n                    data[i].flow_node_id == objNode.workFlowNodeCode_workTemp[1] ||\n                    data[i].flow_node_id == objNode.workFlowNodeCode_workTemp[2] ||\n                    data[i].flow_node_id == objNode.workFlowNodeCode_workTemp[3]) {\n                    dataModel.push({\n                        xh: i + 1,\n                        name: \"<a href='#' onclick='rowLink(this);'>\" + data[i].title + \"</a>\",\n                        date: data[i].row_create_date,\n                        url: ipServer.tz + \"/pages/workListTemp/workOrderView.html?applyid=\" + data[i].appId +\n                            \"&lcslh=\" + data[i].flow_inst_id + \"&r=\" + Math.random()\n                    });\n                }\n                break;\n            case \"rwmb\": //任务模板\n                if(data[i].flow_node_id == objNode.workFlowNodeCode_taskTemp[0] ||\n                    data[i].flow_node_id == objNode.workFlowNodeCode_taskTemp[1] ||\n                    data[i].flow_node_id == objNode.workFlowNodeCode_taskTemp[2] ||\n                    data[i].flow_node_id == objNode.workFlowNodeCode_taskTemp[3]) {\n                    dataModel.push({\n                        xh: i + 1,\n                        name: \"<a href='#' onclick='rowLink(this);'>\" + data[i].title + \"</a>\",\n                        date: data[i].row_create_date,\n                        url: ipServer.tz + \"/pages/taskTemp/taskTemplateAuditView.html?applyid=\" + data[i].appId +\n                            \"&lcslh=\" + data[i].flow_inst_id + \"&r=\" + Math.random()\n                    });\n                }\n                break;\n            case \"gdmbsp\": //工单模板审批\n                if(data[i].flow_node_id == objNode.workFlowNodeCode_workTemp[0]) { //业务部门领导审批\n                    jumpUrl = ipServer.tz + \"/pages/workListTemp/workOrderApplyApproveBizDepartment.html\";\n                    dataModel = addTodoInfo(dataModel, data[i], jumpUrl, i);\n                } else if(data[i].flow_node_id == objNode.workFlowNodeCode_workTemp[1]) { //生产指挥中心领导审批\n                    jumpUrl = ipServer.tz + \"/pages/workListTemp/workOrderApplyApproveControlCenter.html\";\n                    dataModel = addTodoInfo(dataModel, data[i], jumpUrl, i);\n                }\n                break;\n            case \"rwmbsp\": //任务模板审批\n                if(data[i].flow_node_id == objNode.workFlowNodeCode_taskTemp[0]) { //业务部门审批\n                    jumpUrl = ipServer.tz + \"/pages/taskTemp/taskTemplateApp/busDeparApproval.html\";\n                    dataModel = addTodoInfo(dataModel, data[i], jumpUrl, i);\n                }\n                if(data[i].flow_node_id == objNode.workFlowNodeCode_taskTemp[1]) { //生产指挥中心领导审批\n                    jumpUrl = ipServer.tz + \"/pages/taskTemp/taskTemplateApp/approvalOfcenter.html\";\n                    dataModel = addTodoInfo(dataModel, data[i], jumpUrl, i);\n                }\n                break;\n            case \"mbdqr\": //模板确认\n                if(data[i].flow_node_id == objNode.workFlowNodeCode_workTemp[2]) { //工单模板确认\n                    dataModel.push({\n                        xh: i + 1,\n                        name: data[i].title,\n                        date: data[i].row_create_date,\n                        url: ipServer.tz + \"tempConfirm.html?flag=gdmb&applyid=\" + data[i].appId + \"&taskid=\" + data[i].task_id + \"&r=\" + Math.random()\n                    });\n                }\n                if(data[i].flow_node_id == objNode.workFlowNodeCode_taskTemp[2]) { //任务模板确认\n                    jumpUrl = ipServer.tz + \"/pages/taskTemp/preview.html\";\n                    dataModel = addTodoInfo(dataModel, data[i], jumpUrl, i);\n                }\n                break;\n            case \"cxtz\": //重新提交\n                if(data[i].flow_node_id == objNode.workFlowNodeCode_workTemp[3]) { //工单模板重新提交\n                    jumpUrl = ipServer.tz + \"/pages/workListTemp/workOrderApply.html\";\n                    dataModel = addTodoInfo(dataModel, data[i], jumpUrl, i);\n                }\n                if(data[i].flow_node_id == objNode.workflow_node_idCode_taskTemp[3]) { //任务模板重新提交\n                    jumpUrl = ipServer.tz + \"/pages/taskTemp/taskTemplateApp/taskTemplateApp.html\";\n                    dataModel = addTodoInfo(dataModel, data[i], jumpUrl, i);\n                }\n                break;\n            default:\n                break;\n        }\n    }\n    store5.loadData(dataModel);\n}\n\nfunction addTodoInfo(todoDataModel, todoInfo, jumpUrl, num) {\n    todoDataModel.push({\n        xh: num + 1,\n        name: \"<a href='#' onclick='rowLink(this);'>\" + todoInfo.title + \"</a>\",\n        date: todoInfo.row_create_date,\n        url: jumpUrl + \"?applyid=\" + todoInfo.appId + \"&taskid=\" + todoInfo.task_id +\n            \"&nodeid=\" + todoInfo.flow_node_id + \"&lcslh=\" + todoInfo.flow_inst_id + \"&r=\" + Math.random()\n    });\n    return todoDataModel;\n}\n\n\nwindow.rowLink = function(id) {\n    var tr = $(id).closest('tr'),\n        url = tr.find('td')[4].innerText;\n    window.open(url, '_blank', '');\n}\n\n//页面参数获取方法\nfunction getQueryString(name) {\n    var reg = new RegExp(\"(^|&)\" + name + \"=([^&]*)(&|$)\", \"i\");\n    var r = window.location.search.substr(1).match(reg); //获取url中\"?\"符后的字符串并正则匹配\n    var context = \"\";\n    if(r != null)\n        context = r[2];\n    reg = null;\n    r = null;\n    return context == null || context == \"\" || context == \"undefined\" ? \"\" : context;\n}","vmdcss":".hand a{\r\n   text-decoration:none; \r\n}\r\n.hand a:link {\r\n    color: blue; text-decoration:none;\r\n    \r\n}\r\n.hand a:active:{\r\n    color: red;\r\n    } \r\n/*a:visited {\r\n    color:purple;text-decoration:none;\r\n    \r\n} */\r\n.hand a:hover {\r\n    color: red; text-decoration:underline;\r\n    \r\n} \r\n.x-grid3-hd-row td {\r\n    line-height: 15px;\r\n    vertical-align: middle;\r\n    border-left: 0px solid;\r\n     border-right: 0px solid;\r\n     border: 1px solid #e4e4e4;\r\n}\r\n.x-grid3-scroller {\r\n    overflow-x: hidden;\r\n}\r\n/* =========================================== Grid Panel =========================================== */\r\n/* 表格左右间距 */\r\n.vmd-grid {\r\n   /* padding-left: 5px;\r\n    padding-right: 5px;*/\r\n}\r\n\r\n/* 表格线样式兼容 */\r\n.vmd-grid table {\r\n    border-collapse: collapse;\r\n}\r\n\r\n/* 表头背景色 */\r\n.vmd-grid .x-grid3-header {\r\n    background-color: #f7f7f7;\r\n}\r\n\r\n/* 表头鼠标悬停背景色 */\r\n.vmd-grid .x-grid3-hd-over .x-grid3-hd-inner {\r\n    background-color: #f7f7f7;\r\n}\r\n\r\n/* 表头错位兼容 */\r\n.vmd-grid .x-grid3-header-offset {\r\n    padding: 0;\r\n}\r\n\r\n/* 表头单元格 */\r\n.vmd-grid .x-grid3-header td {\r\n    border: 1px solid #e3e2e8;\r\n    font-size: 14px;\r\n}\r\n\r\n/* 表体单元格 */\r\n.vmd-grid .x-grid3-body td {\r\n    border: 1px solid #e3e2e8;\r\n    border-top-width: 0;\r\n    padding: 0;\r\n    font-size: 14px;\r\n}\r\n\r\n/* 表体行 */\r\n.vmd-grid .x-grid3-row {\r\n    border: none;\r\n}\r\n\r\n/* 表体行鼠标悬停背景色 */\r\n.vmd-grid .x-grid3-row-over {\r\n    background-color: white;\r\n}\r\n\r\n/* 表体行选中背景色 */\r\n.vmd-grid .x-grid3-row-selected {\r\n    background-color: #F5F7FC !important;\r\n}\r\n\r\n/* =========================================== Grid Panel =========================================== */","vmdprops":"\"\"","type":"ux","vmdinterface":"{\"components\":[{\"cid\":\"vmduxprops\",\"layoutConfig\":{},\"userConfig\":{}},{\"cid\":\"vmduxmethods\",\"id\":\"方法\",\"layoutConfig\":{},\"userConfig\":{}},{\"cid\":\"vmduxevents\",\"id\":\"事件\",\"layoutConfig\":{},\"userConfig\":{}}]}"}