{"vmdversion":"vmd2.0.5.191130","vmdlayout":"{\"components\":[{\"cid\":\"uxpanel\",\"id\":\"UserControlInfo1\",\"layoutConfig\":{},\"userConfig\":{\"layout\":\"auto\",\"afterrender\":\"UserControlInfo1_afterrender\",\"height\":\"\",\"width\":600,\"autoScroll\":false,\"autoHeight\":false},\"cn\":[{\"cid\":\"container\",\"id\":\"hwDiv5\",\"layoutConfig\":{},\"userConfig\":{\"layout\":\"absolute\",\"height\":560,\"width\":576,\"border\":false,\"hidden\":true,\"region\":\"center\"},\"cn\":[{\"cid\":\"vmd.ux.UploaderEx\",\"id\":\"upimg\",\"layoutConfig\":{},\"userConfig\":{\"hidden\":true,\"id\":\"upimg\",\"mineTypes\":\".jpeg,.jpg,.png\"}},{\"cid\":\"vmd.ux.UploaderEx\",\"id\":\"upfile\",\"layoutConfig\":{},\"userConfig\":{\"id\":\"upfile\",\"hidden\":true,\"mineTypes\":\".xls,.xlsx,.doc,.docx,.txt,.ppt,.pptx,.pdf\",\"afterrender\":\"upfile_afterrender\"}},{\"cid\":\"label\",\"id\":\"hwLabel1\",\"layoutConfig\":{},\"userConfig\":{\"x\":30,\"y\":160,\"text\":\"*\",\"width\":20,\"style\":\"font-size: 16px;    color: red;\"}},{\"cid\":\"label\",\"id\":\"hwLabel\",\"layoutConfig\":{},\"userConfig\":{\"x\":30,\"y\":120,\"text\":\"*\",\"width\":30,\"style\":\"font-size: 16px;    color: red;\"}},{\"cid\":\"textfield\",\"id\":\"uxName\",\"layoutConfig\":{},\"userConfig\":{\"x\":110,\"y\":160,\"width\":460,\"id\":\"uxName\",\"emptyText\":\"复合组件中文名称，必填\",\"emptyClass\":\"empty_fontcolor\"}},{\"cid\":\"label\",\"id\":\"label\",\"layoutConfig\":{},\"userConfig\":{\"x\":40,\"y\":160,\"height\":20,\"text\":\"中文名称：\"}},{\"cid\":\"vmdButton\",\"id\":\"button3\",\"layoutConfig\":{},\"userConfig\":{\"x\":540,\"y\":198,\"icon\":\"icon-plus\",\"style\":\"color: blue;    border:0;\",\"text\":\"\",\"width\":30,\"click\":\"button3_click\"}},{\"cid\":\"textfield\",\"id\":\"Text_Ver\",\"layoutConfig\":{},\"userConfig\":{\"x\":110,\"y\":200,\"width\":460,\"id\":\"Text_Ver\",\"disabled\":true}},{\"cid\":\"vmdButton\",\"id\":\"button2\",\"layoutConfig\":{},\"userConfig\":{\"x\":380,\"y\":520,\"size\":\"large\",\"type\":\"info\",\"text\":\"发布\",\"click\":\"button2_click\",\"hidden\":true}},{\"cid\":\"label\",\"id\":\"label1\",\"layoutConfig\":{},\"userConfig\":{\"x\":40,\"y\":240,\"text\":\"共享：\"}},{\"cid\":\"checkbox\",\"id\":\"hwCheckbox\",\"layoutConfig\":{},\"userConfig\":{\"x\":110,\"y\":235,\"boxLabel\":\"\"}},{\"cid\":\"label\",\"id\":\"MyLabel\",\"layoutConfig\":{},\"userConfig\":{\"x\":40,\"y\":30,\"text\":\"基础信息\",\"style\":\"color: blue;    font-size: 20px;\"}},{\"cid\":\"label\",\"id\":\"MyLabel1\",\"layoutConfig\":{},\"userConfig\":{\"x\":40,\"y\":80,\"text\":\"编码：\"}},{\"cid\":\"label\",\"id\":\"MyLabel2\",\"layoutConfig\":{},\"userConfig\":{\"x\":40,\"y\":120,\"text\":\"名称：\"}},{\"cid\":\"label\",\"id\":\"MyLabel3\",\"layoutConfig\":{},\"userConfig\":{\"x\":40,\"y\":273,\"text\":\"创建人：\"}},{\"cid\":\"label\",\"id\":\"MyLabel4\",\"layoutConfig\":{},\"userConfig\":{\"x\":40,\"y\":310,\"text\":\"创建时间：\"}},{\"cid\":\"label\",\"id\":\"MyLabel5\",\"layoutConfig\":{},\"userConfig\":{\"x\":40,\"y\":350,\"text\":\"修改人：\"}},{\"cid\":\"label\",\"id\":\"MyLabel6\",\"layoutConfig\":{},\"userConfig\":{\"x\":40,\"y\":390,\"text\":\"修改时间：\"}},{\"cid\":\"label\",\"id\":\"MyLabel7\",\"layoutConfig\":{},\"userConfig\":{\"x\":40,\"y\":430,\"text\":\"说明：\",\"height\":20}},{\"cid\":\"textfield\",\"id\":\"MyField\",\"layoutConfig\":{},\"userConfig\":{\"x\":110,\"y\":80,\"width\":460,\"disabled\":true}},{\"cid\":\"textfield\",\"id\":\"MyField1\",\"layoutConfig\":{},\"userConfig\":{\"x\":110,\"y\":120,\"width\":460,\"invalidText\":\"\",\"allowBlank\":false,\"beforerender\":\"MyField1_beforerender\",\"emptyText\":\"复合组件名称（如:ISIP_ListView）\",\"emptyClass\":\"empty_fontcolor \"}},{\"cid\":\"textfield\",\"id\":\"MyField2\",\"layoutConfig\":{},\"userConfig\":{\"x\":110,\"y\":270,\"width\":460,\"disabled\":true}},{\"cid\":\"textfield\",\"id\":\"MyField3\",\"layoutConfig\":{},\"userConfig\":{\"x\":110,\"y\":310,\"width\":460,\"disabled\":true}},{\"cid\":\"textfield\",\"id\":\"MyField4\",\"layoutConfig\":{},\"userConfig\":{\"x\":110,\"y\":350,\"width\":460,\"disabled\":true}},{\"cid\":\"textfield\",\"id\":\"MyField5\",\"layoutConfig\":{},\"userConfig\":{\"x\":110,\"y\":390,\"width\":460,\"disabled\":true}},{\"cid\":\"textarea\",\"id\":\"MyField7\",\"layoutConfig\":{},\"userConfig\":{\"x\":110,\"y\":430,\"width\":460,\"id\":\"MyField7\",\"allowBlank\":true,\"beforerender\":\"MyField7_beforerender\"}},{\"cid\":\"vmdButton\",\"id\":\"button\",\"layoutConfig\":{},\"userConfig\":{\"x\":380,\"y\":510,\"size\":\"large\",\"type\":\"info\",\"text\":\"保存\",\"click\":\"button_click\"}},{\"cid\":\"vmdButton\",\"id\":\"button1\",\"layoutConfig\":{},\"userConfig\":{\"x\":470,\"y\":510,\"type\":\"info\",\"text\":\"组件设计\",\"size\":\"large\",\"click\":\"button1_click\"}},{\"cid\":\"label\",\"id\":\"MyLabel8\",\"layoutConfig\":{},\"userConfig\":{\"x\":40,\"y\":200,\"text\":\"版本：\"}}]},{\"cid\":\"container\",\"id\":\"hwDiv4\",\"layoutConfig\":{},\"userConfig\":{\"layout\":\"border\",\"height\":120,\"border\":true,\"width\":576,\"autoHeight\":false,\"region\":\"west\"},\"cn\":[{\"cid\":\"container\",\"id\":\"hwDiv1\",\"layoutConfig\":{\"align\":\"top\",\"pack\":\"end\"},\"userConfig\":{\"border\":false,\"layout\":\"hbox\",\"width\":109,\"region\":\"west\",\"y\":5},\"cn\":[{\"cid\":\"label\",\"id\":\"hwLabel2\",\"layoutConfig\":{},\"userConfig\":{\"x\":0,\"y\":0,\"text\":\"组件快照 :\",\"region\":\"center\",\"width\":72}}]},{\"cid\":\"container\",\"id\":\"img_div\",\"layoutConfig\":{},\"userConfig\":{\"id\":\"img_div\",\"layout\":\"auto\",\"height\":110,\"width\":419,\"border\":true,\"autoHeight\":false,\"region\":\"center\",\"y\":5},\"cn\":[{\"cid\":\"container\",\"id\":\"hwDiv\",\"layoutConfig\":{},\"userConfig\":{\"width\":90,\"height\":100,\"layout\":\"absolute\",\"style\":\"float: left;    border: 1px dashed #BBBBBB;    margin-top: 5px;    cursor: pointer;\"},\"cn\":[{\"cid\":\"vmdImg\",\"id\":\"hwImg\",\"layoutConfig\":{},\"userConfig\":{\"width\":40,\"height\":40,\"style\":\"cursor: hand;\",\"click\":\"hwImg_click\",\"x\":24,\"y\":20,\"src\":\"/img/public/aaaaaaa_07.png\",\"afterrender\":\"hwImg_afterrender\"}},{\"cid\":\"label\",\"id\":\"hwLabel4\",\"layoutConfig\":{},\"userConfig\":{\"x\":16,\"y\":70,\"text\":\"点击上传\"}}]}]}]},{\"cid\":\"container\",\"id\":\"hwDiv3\",\"layoutConfig\":{},\"userConfig\":{\"region\":\"east\",\"layout\":\"border\",\"width\":576,\"height\":43,\"border\":false},\"cn\":[{\"cid\":\"container\",\"id\":\"hwDiv2\",\"layoutConfig\":{\"align\":\"top\",\"pack\":\"end\"},\"userConfig\":{\"layout\":\"hbox\",\"width\":109,\"border\":false,\"region\":\"west\",\"height\":43},\"cn\":[{\"cid\":\"label\",\"id\":\"hwLabel3\",\"layoutConfig\":{},\"userConfig\":{\"x\":40,\"y\":20,\"text\":\"组件资料 :\",\"width\":72}}]},{\"cid\":\"container\",\"id\":\"upFile_panel\",\"layoutConfig\":{},\"userConfig\":{\"layout\":\"absolute\",\"region\":\"center\",\"id\":\"upFile_panel\",\"border\":false,\"height\":43},\"cn\":[{\"cid\":\"vmdButton\",\"id\":\"button4\",\"layoutConfig\":{},\"userConfig\":{\"size\":\"(none)\",\"type\":\"(none)\",\"width\":82,\"text\":\"浏览...\",\"icon\":\"(none)\",\"style\":\"background-color: lightgray;    border-radius:0px;\",\"region\":\"west\",\"x\":370,\"y\":5,\"click\":\"button4_click\"}},{\"cid\":\"container\",\"id\":\"txtFiles\",\"layoutConfig\":{},\"userConfig\":{\"x\":0,\"y\":5,\"width\":362,\"height\":34,\"id\":\"txtFiles\",\"autoScroll\":false,\"layout\":\"hbox\",\"autoHeight\":false,\"style\":\"border: 1px dashed #BBBBBB;\"}}]}]}]},{\"cid\":\"vmddataset\",\"id\":\"数据\",\"layoutConfig\":{},\"userConfig\":{}},{\"cid\":\"vmdvariable\",\"id\":\"变量\",\"layoutConfig\":{},\"userConfig\":{}}]}","vmdevents":"var hwTree;\nvar page = this;\n//设置初始化信息  初始化组件的基础信息\nfunction UserControlInfo1_afterrender(sender) {}\n\nfunction toRefresh(Tree) {\n    hwTree = Tree;\n    var tree = hwTree;\n    var newnode = tree.newnode;\n\n    //根据是否时新节点来进行不同设置，新节点默认部分信息，已存在节点自动提取节点上的文件信息\n    if (newnode) {\n        MyField.setValue(newGuid(32));\n        MyField1.setValue(\"\");\n        MyField1.setDisabled(false);\n        MyField2.setValue(Ext.util.Cookies.get('userName'));\n        MyField3.setValue(Ext.Date.dateFormat(new Date(), 'Y-m-d H:i:s'));\n        MyField4.setValue(\"\");\n        MyField5.setValue(\"\");\n        Text_Ver.setValue(\"1.0\");\n        MyField7.setValue(\"\");\n        uxName.setValue(\"\");\n        clearImgAndFile();\n    } else {\n        var selId = tree.getSelectedItemId();\n        var selnode = tree.itemObj[selId];\n        hwCheckbox.setValue(selnode.shared == \"1\" ? true : false);\n        MyField.setValue(selnode.code);\n        MyField1.setValue(selnode.text);\n        MyField1.setDisabled(true); //修改查看信息时，组件名不能修改，只能查看\n        MyField2.setValue(selnode.createuser);\n        MyField3.setValue(selnode.createtime);\n        MyField4.setValue(selnode.changeuser);\n        MyField5.setValue(selnode.changetime);\n        Text_Ver.setValue(selnode.version || \"1.0\");\n        MyField7.setValue(selnode.remark);\n        uxName.setValue(selnode.uxname);\n        //uxName.setDisabled(true);\n        clearImgAndFile();\n        imageLoad(selnode);\n        filesLoad(selnode);\n    }\n\n}\n\nfunction imageLoad(selnode) {\n    var filePath = \"\";\n    if (selnode)\n        filePath = \"components/upload/\" + selnode.text+\"/image\";\n    var hwFao = new HwFao(vmdSettings.dataServiceIp, \"vmd\");\n    hwFao.getDirs(filePath, '', function(result) {\n        if (result && result.data && result.data.length > 0) {\n            var str = \"\";\n            for (var i = 0; i < result.data.length; i++) {\n                var html = document.createElement('div');\n                html.style.width = \"90px\";\n                html.style.height = \"100px\";\n                html.style.display = 'block';\n                html.style.float = \"left\";\n                html.style.marginRight = \"20px\";\n                html.style.marginTop = \"5px\";\n                html.style.border = \"1px solid lightgray\";\n                html.style.cursor = \"pointer\";\n                var image = document.createElement('img');\n                image.setAttribute('src', vmd.virtualPath + \"/\" + filePath + \"/\" + result.data[i].name);\n                image.style.width = \"88px\";\n                image.style.height = \"96px\";\n                image.style.float = \"left\";\n                image.style.border = \"1px soild red !important\";\n                image.style.padding = \"1px\";\n                //image.className = 'addimg';\n                image.innerText = result.data[i].name;\n                //图片点击\n                var imageList = {};\n                var imageListItems = [];\n                var index = -1;\n                var selectedImage;\n                var selectedDiv;\n                image.onclick = function() {\n                    for (var i = 0; i < result.data.length; i++) { //遍历当前的资源，将图片列表信息生成特定格式\n                        var itemData = result.data[i];\n                        var imageListItem = {\n                            msrc: vmd.virtualPath + \"/\" + filePath + \"/\" + result.data[i].name,\n                            src: vmd.virtualPath + \"/\" + filePath + \"/\" + result.data[i].name,\n                            h: 0,\n                            w: 0,\n                            title: result.data[i].name\n                        }\n                        imageListItems.push(imageListItem);\n                        index++; ////获取当前图片在图片列表中的索引\n\n                        if (this.textContent == result.data[i].name) //根据当前点击的项与添加的图片项作对比 记录当前点击图片的index\n                            imageList.index = index;\n                    }\n                    imageList.items = imageListItems;\n                    vmd.showImg(imageList);\n                }\n                vmd(html).on('mouseenter', function() {\n                    vmd(this).find('.wrap').show();\n                    selectedImage = this.firstChild;\n                    selectedDiv = this;\n                });\n                vmd(html).on('mouseleave', function() {\n                    vmd(this).find('.wrap').hide();\n                });\n                html.appendChild(image);\n                var div = document.createElement('div');\n                div.className = \"wrap\"\n                div.style.backgroundColor = \"RGB(103,44,44)\";\n                div.style.width = \"90px\";\n                div.style.height = \"20px\";\n                div.style.position = 'absolute';\n                div.style.display = \"none\";\n                div.style.textAlign = \"right\";\n                div.style.padding = \"2px\";\n                image = document.createElement('img');\n                image.setAttribute('src', '/img/public/aaaaaaa_03.png');\n                image.style.width = '15px';\n                image.style.height = '15px';\n                image.onclick = function() {\n                    Ext.Msg.show({\n                        title: '提示',\n                        msg: '是否要删除服务器上该图片?',\n                        buttons: Ext.Msg.YESNO,\n                        fn: function(result) {\n                            if (result == \"yes\") {\n                                if (selectedImage) {\n                                    var dpath = \"\";\n                                    if (MyField1.getValue())\n                                        dpath =\"components/upload/\"+ MyField1.getValue() + \"/image/\";\n                                    selectedDiv.remove();\n                                    hwDas.remove(\"vmd\", dpath + selectedImage.textContent, function(result) {\n                                        //alert(\"删除成功！\")\n                                        img_div.doLayout();\n                                    }, function() {});\n                                }\n                            }\n                        },\n                        animEl: 'elId',\n                        icon: Ext.MessageBox.QUESTION\n                    });\n                }\n                div.appendChild(image);\n                html.appendChild(div);\n                img_div.el.dom.insertBefore(html, hwDiv.el.dom)\n            }\n            img_div.setHeight(img_div.el.dom.scrollHeight);\n            hwDiv4.setHeight(img_div.el.dom.scrollHeight);\n\n        }\n    }, function() {})\n}\n\nfunction clearImgAndFile() {\n    if (txtFiles.el.dom && txtFiles.el.dom.children && txtFiles.el.dom.children.length > 0) {\n        for (var i = 0; i < txtFiles.el.dom.children.length;) {\n            var currentDiv = txtFiles.el.dom.children[i];\n            currentDiv.remove();\n            i = 0;\n        }\n    }\n    if (img_div.el.dom && img_div.el.dom.children && img_div.el.dom.children.length > 1) {\n        for (var i = 0; i < img_div.el.dom.children.length - 1;) {\n            var currentDiv = img_div.el.dom.children[i];\n            currentDiv.remove();\n            i = 0;\n        }\n    }\n    txtFiles.setHeight(34);\n    upFile_panel.setHeight(43);\n    hwDiv3.setHeight(43);\n    img_div.setHeight(110);\n    hwDiv4.setHeight(120);\n}\n\nfunction filesLoad(selnode) {\n    var filePath = \"\";\n    if (selnode)\n        filePath = \"components/upload/\" + selnode.text+\"/file\";\n    var hwFao = new HwFao(vmdSettings.dataServiceIp, \"vmd\");\n    hwFao.getDirs(filePath, '', function(result) {\n        if (result && result.data && result.data.length > 0) {\n            var str = \"\";\n            var html;\n            for (var i = 0; i < result.data.length; i++) {\n                var pdiv = document.createElement('div');\n                // pdiv.style.float = \"left\";\n                pdiv.style.height = \"20px\";\n                pdiv.style.padding = \"4px\"\n                html = document.createElement('a');\n                html.setAttribute('href', vmd.virtualPath + \"/\" + filePath + \"/\" + result.data[i].name);\n                html.style.display = 'block';\n                html.style.cursor = \"hand\";\n                html.innerText = result.data[i].name;\n                pdiv.appendChild(html);\n                vmd(pdiv).on('mouseenter', function() {\n                    debugger\n                    selectedfImage = this.lastChild;\n                    selectedfDiv = this;\n                    // vmd(this).find('.frap')[0].style.width = selectedfImage.offsetWidth + \"px\";\n                    vmd(this).find('.frap').show();\n                });\n                vmd(pdiv).on('mouseleave', function() {\n                    vmd(this).find('.frap').hide();\n                });\n                var div = document.createElement('div');\n                div.className = \"frap\"\n                div.style.backgroundColor = \"RGB(103,44,44)\";\n                div.style.float = \"right\";\n                div.style.width = \"18px\";\n                div.style.height = \"18px\";\n                // div.style.position = 'absolute';\n                div.style.display = \"none\";\n                // div.style.textAlign = \"right\";\n                div.style.padding = \"4px\";\n                image = document.createElement('img');\n                image.setAttribute('src', '/img/public/aaaaaaa_03.png');\n                image.style.width = '15px';\n                image.style.height = '15px';\n                var selectedfImage;\n                var selectedfDiv;\n                image.onclick = function() {\n                    Ext.Msg.show({\n                        title: '提示',\n                        msg: '是否要删除服务器上该文档?',\n                        buttons: Ext.Msg.YESNO,\n                        fn: function(result) {\n                            if (result == \"yes\") {\n                                if (selectedfImage) {\n                                    var dpath = \"\";\n                                    if (MyField1.getValue())\n                                        dpath = \"components/upload/\"+MyField1.getValue() + \"/file/\";\n                                    selectedfDiv.remove();\n                                    hwDas.remove(\"vmd\", dpath + selectedfImage.textContent, function(result) {\n                                        //alert(\"删除成功！\")\n                                        txtFiles.doLayout()\n                                    }, function() {});\n                                }\n                            }\n                        },\n                        animEl: 'elId',\n                        icon: Ext.MessageBox.QUESTION\n                    });\n                }\n                div.appendChild(image);\n\n                pdiv.insertBefore(div, html);\n\n                txtFiles.el.dom.appendChild(pdiv)\n            }\n            txtFiles.setHeight(txtFiles.el.dom.scrollHeight);\n            upFile_panel.setHeight(txtFiles.el.dom.scrollHeight);\n            hwDiv3.setHeight(txtFiles.el.dom.scrollHeight + 50);\n            // p.parentElement\n        }\n    }, function() {})\n}\n//保存的事件\nfunction button_click(sender) {\n    editId = \"\";\n    //先检测下录入的信息是否全\n    if (!saveCheck()) {\n        return;\n    }\n    //保存模块的基础信息\n    saveModelInfo(\"\", \"\", function() {\n\n        vmd.isCheckFileExist('components/vmd/' + MyField1.getValue() + '.vmd', function(data) {\n            if (data) {\n                vmd.core.updateCmpZhname(MyField1.getValue(), uxName.getValue(), function() {\n                    Ext.Msg.alert(\"提示\", \"保存成功！\")\n                })\n            } else\n                Ext.Msg.alert(\"提示\", \"保存成功！\")\n        }, true);\n    })\n}\neditId = newGuid(10);\n//模块保存按钮操作\n//ver   要保存的版本号\n//edit_reason   发布版本的修改信息\n//callback   回调\nfunction saveModelInfo(ver, edit_reason, callback) {\n    var mytree = hwTree; //获取树\n    var newnode = mytree.newnode; //获取是否为新组件\n    var selId = mytree.getSelectedItemId(); //获取当前选中节点\n    var selnode = mytree.itemObj[selId]; ////获取当前选中节点\n    var selnodepath = selnode.path; //获取路径\n    var id = newGuid(10); //\n    var category_id = selId;\n    //var Project_id = selnode.projectId;\n    // if(selnode.isProject) {\n    //     category_id = \"0\";\n    //     Project_id = selId;\n    // }\n    var codeid = MyField.getValue();\n    var name = MyField1.getValue(); //组件名\n    var remark = MyField7.getValue(); //组件说明\n    var type = \"0\";\n    //判断是否为新节点，进行不同的服务操作\n    //非新节点\n    if (!newnode) {\n        MyField4.setValue(Ext.util.Cookies.get('userName'));\n        MyField5.setValue(Ext.Date.dateFormat(new Date(), 'Y-m-d H:i:s'))\n        //更新模块基础信息\n        hwDas.ajax({\n            das: {\n                idedas: true\n            },\n            url: \"CDEServcie/resource/zygl\",\n            type: 'put',\n            timeout: 5000,\n            params: {},\n            headers: {\n                Ecylogin: Ext.util.Cookies.get('EcyLogin') || Ext.util.Cookies.get('ecyLogin')\n            },\n            data: [{\n                editid: editId,\n                id: selId,\n                // code: selnode.code,\n                // type: '4',\n                uxname: uxName.getValue(),\n                remark: remark,\n                // project_id: Project_id,\n                version: ver || Text_Ver.getValue(),\n                shared: hwCheckbox.getValue() ? \"1\" : \"0\",\n                readdate: Ext.Date.dateFormat(new Date(), 'Y-m-d H:i:s'),\n                //filepath: '/components/vmd/' + name + '.vmd',\n                row_changed_by: MyField4.getValue(),\n                row_changed_date: MyField5.getValue(),\n                edit_reason: edit_reason || \"修改基础信息\"\n            }],\n            success: function(result) {\n                selnode.text = name;\n                selnode.changetime = MyField5.getValue();\n                selnode.changeuser = MyField4.getValue();\n                selnode.uxname = uxName.getValue();\n                selnode.remark = MyField7.getValue();\n                selnode.isModel = true;\n                selnode.version = Text_Ver.getValue();\n                selnode.shared = hwCheckbox.getValue() ? \"1\" : \"0\";\n                mytree.setItemText(selId, name)\n                callback();\n            },\n            error: function(msg) {\n                Ext.Msg.alert(\"提示\", \"保存模块基础信息失败\")\n                return;\n            }\n        })\n    } else { //新节点\n        //新节点先检测是否重名\n        checkName(name, function() {\n            //保存模块基础信息\n            hwDas.ajax({\n                das: {\n                    idedas: true\n                },\n                url: \"CDEServcie/resource/zygl\",\n                type: 'post',\n                timeout: 5000,\n                params: {},\n                headers: {\n                    Ecylogin: Ext.util.Cookies.get('EcyLogin') || Ext.util.Cookies.get('ecyLogin')\n                },\n                data: [{ //要提交的数据\n                    editid: editId,\n                    id: id,\n                    code: codeid,\n                    type: '4',\n                    name: name,\n                    uxname: uxName.getValue(),\n                    remark: remark,\n                    category_id: category_id,\n                    //project_id: Project_id,\n                    shared: hwCheckbox.getValue() ? \"1\" : \"0\",\n                    version: Text_Ver.getValue(),\n                    readdate: Ext.Date.dateFormat(new Date(), 'Y-m-d H:i:s'),\n                    filepath: '/components/vmd/' + name + '.vmd',\n                    row_created_by: MyField2.getValue(),\n                    row_created_date: MyField3.getValue()\n                }],\n                success: function(result) {\n                    //添加成功后需要将节点添加到树上，并设置节点的信息\n                    mytree.insertNewChild(selId, id, name);\n                    mytree.setItemImage2(id, \"tree/model.png\", \"tree/model.png\", \"tree/model.png\")\n                    var treenode = mytree.item(id);\n                    treenode.path = selnodepath + \"/\" + id;\n                    //treenode.projectId = Project_id;\n                    if (treenode) {\n                        treenode.isModel = true;\n                        treenode.text = name;\n                        treenode.createuser = MyField2.getValue();\n                        treenode.createtime = MyField3.getValue();\n                        treenode.changetime = MyField5.getValue();\n                        treenode.changeuser = MyField4.getValue();\n                        treenode.uxname = uxName.getValue();\n                        treenode.remark = remark;\n                        treenode.version = Text_Ver.getValue();\n                        treenode.code = codeid;\n                        treenode.type = '4';\n                        treenode.shared = hwCheckbox.getValue() ? \"1\" : \"0\";\n                        treenode.newnode = true;\n                    }\n                    mytree.itemObj[id] = treenode;\n                    //设置当前节点选中\n                    mytree.selectItem(id, false, false);\n                    mytree.newnode = false; //新节点状态置为false\n                    MyField1.setDisabled(true)\n                    callback();\n                },\n                error: function(msg) {\n                    Ext.Msg.alert(\"提示\", \"保存模块基础信息失败\")\n                    return;\n                }\n            })\n        })\n    }\n}\n//检测组件是否重名\n//name  组件名\n//callback  回调\nfunction checkName(name, callback) {\n    hwDas.ajax({\n        das: {\n            idedas: true\n        },\n        url: \"CDEServcie/resource/info\",\n        type: 'get',\n        timeout: 5000,\n        params: {\n            name: name\n        },\n        success: function(result) {\n            if (result.data[0].datas.length <= 0) {\n                if (callback)\n                    callback()\n            } else {\n                Ext.Msg.alert(\"提示\", \"该组件已存在，请重新命名组件！\")\n                return;\n            }\n        },\n        error: function(msg) {\n            Ext.Msg.alert(\"提示\", \"保存信息失败(检测是否重名出错!)\")\n            return;\n        }\n    })\n}\n\n//组件设计事件\nfunction button1_click(sender) {\n    editId = newGuid(10);\n    var mytree = hwTree;\n    var selId = mytree.getSelectedItemId();\n    var selnode = mytree.itemObj[selId];\n    //设计前先进行录入检测\n    if (!saveCheck()) {\n        return;\n    }\n    var openDesigner = function() {\n        selId = mytree.getSelectedItemId();\n        selnode = mytree.itemObj[selId];\n        var params = {\n            type: \"ux\",\n            path: selnode.text + '.vmd',\n            uxid: selId,\n            name: selnode.text,\n            uxname: selnode.uxname,\n            ver: selnode.version\n        }\n        window.open(vmd.virtualPath + '/design/default.html?' + Ext.urlEncode(params), selnode.text + \" 组件设计\")\n    }\n    //保存组件信息  并打开设计界面\n    var newnode = mytree.newnode;\n    if (newnode)\n        saveModelInfo(\"\", \"\", openDesigner)\n    else\n        openDesigner()\n    //saveModelInfo(\"\", \"\", openDesigner)\n}\n\n//自定义自定义方法\n//返回guid \n//len 长度\nfunction newGuid(len) {\n    var length = 32;\n    if (len)\n        length = len - 2\n    var guid = \"\";\n    arr = ['0', '1', '2', '3', '4', '5', '6', '7', '8', '9', 'a', 'b', 'c', 'd', 'e', 'f', 'g', 'h', 'i', 'j', 'k', 'l', 'm', 'n', 'o', 'p', 'q', 'r', 's', 't', 'u', 'v', 'w', 'x', 'y', 'z', 'A', 'B', 'C', 'D', 'E', 'F', 'G', 'H', 'I', 'J', 'K', 'L', 'M', 'N', 'O', 'P', 'Q', 'R', 'S', 'T', 'U', 'V', 'W', 'X', 'Y', 'Z'];\n    for (var i = 0; i < length; i++) {\n        pos = Math.round(Math.random() * (arr.length - 1));\n        guid += arr[pos];\n    }\n    return \"hw\" + guid;\n}\n\nfunction openSelMode(id, name, path) {\n    //  parent.openSelMode(id, name, path)\n}\n//文本初始化  设置校验规则  正则表达式\nfunction MyField1_beforerender(sender) {\n    MyField1.regex = /^[A-Z][a-zA-Z0-9_]*$/;\n    MyField1.regexText = \"名称须以大写字母开头，且只能包含数字、字母、下划线\";\n}\n\nfunction MyField7_beforerender(sender) {}\n//发布事件处理\nfunction button2_click(sender) {\n    editId = newGuid(10);\n    //调用发布界面\n    publish(function(name, oldver, newver) {\n        //复制文件到发布目录下\n        hwDas.copy(\"vmd\", \"components/ux/\" + name + \"/\" + oldver + \"/\" + name + \".js\", \"components_release/ux/\" + name + \"/\" + newver + \"/\" + name + \".js\", function() {}, function() {\n            Ext.Msg.alert(\"提示\", \"发布组件失败(拷贝文件出错),请重新发布！\")\n        });\n    })\n}\n//发布界面信息填写\n//callback 回调\nfunction publish(callback) {\n    //创建一个form，填写name，备注 \n    //获取当前组件的版本，并生成对应的数据集  当前版本  版本+0.1\n    var mytree = hwTree;\n    var selId = mytree.getSelectedItemId();\n    var selnode = mytree.itemObj[selId];\n    var ver = selnode.version;\n    //创建组件发布的发布信息表单\n    var form = new Ext.form.FormPanel({\n        labelAlign: \"top\",\n        bodyStyle: \"padding: 10px\",\n        border: false,\n        items: [{\n            xtype: \"textarea\", //发布组件的信息  记录修改的内容\n            allowBlank: true,\n            height: 135,\n            name: 'remark',\n            anchor: \"100%\",\n            fieldLabel: \"更新日志\",\n            emptyText: \"请输入组件修改内容或修改日志\"\n        }]\n    })\n    //将表单添加到页面中\n    var win = new Ext.Window({\n        width: 440,\n        height: 260,\n        title: '复合组件版本发布',\n        hidden: false,\n        layout: \"fit\",\n        border: false,\n        modal: true,\n        items: form,\n        fbar: [{\n            text: '确定',\n            handler: function() {\n                if (form.getForm().isValid()) {\n                    var values = form.form.getValues()\n                    /*保存前校验*/\n                    if (values.remark == \"\") {\n                        Ext.Msg.alert(\"提示\", \"升级日志不能为空\")\n                        return false;\n                    }\n                    //保存发布的信息\n                    saveModelInfo(\"\", values.remark, function() {\n                        callback(selnode.text, selnode.version, selnode.version)\n                        win.close()\n                    })\n                }\n            }\n        }, {\n            text: '取消',\n            handler: function() {\n                win.close()\n            }\n        }]\n    });\n    win.show()\n}\n/*\n保存前校验\n*/\nfunction saveCheck() {\n    if (MyField1.getValue() == \"\") {\n        Ext.Msg.alert(\"提示\", \"组件名不能为空\")\n        return false;\n    }\n    if (MyField1.getActiveError() != \"\") {\n        Ext.Msg.alert(\"提示\", MyField1.getActiveError())\n        return false;\n    }\n\n    if (uxName.getValue() == \"\") {\n        Ext.Msg.alert(\"提示\", \"组件中文名不能为空\")\n        return false;\n    }\n    return true;\n}\n//创建新版本\nfunction button3_click(sender) {\n    editId = newGuid(10);\n    var mytree = hwTree;\n    var selId = mytree.getSelectedItemId();\n    var selnode = mytree.itemObj[selId];\n    var ver = selnode.version;\n    f_ver = parseFloat(ver);\n    newver = String((f_ver + 0.1).toFixed(1));\n    Ext.Msg.confirm(\"提示\", \"是否要升级版本号，版本将由\" + ver + \"升级为\" + newver + \",升级版本号之后，历史版本将不可维护，确定要升级么？\", function(type) {\n        if (type == \"yes\") {\n            saveModelInfo(newver, \"版本由\" + ver + \"升级为\" + newver, function() {\n                vmd.core.cmpVerUpdate(selnode.text, ver, newver, function() {\n                    selnode.version = newver;\n                    Text_Ver.setValue(newver);\n                })\n            })\n        } else\n            return;\n    })\n}\n\nfunction button4_click(sender, e) {\n   \n    upfile.upload({\n        title: '上传文件',\n        savedir: \"components/upload/\" + MyField1.getValue()+\"/file\",\n        hwcode: 'vmd',\n        host: vmdSettings.dataServiceIp,\n        callback: function(fileList) {\n            if (fileList && fileList.length > 0) {\n                var str = \"\";\n                var html;\n                for (var i = 0; i < fileList.length; i++) {\n                    var pdiv = document.createElement('div');\n                    // pdiv.style.float = \"left\";\n                    pdiv.style.height = \"20px\";\n                    pdiv.style.padding = \"4px\"\n                    html = document.createElement('a');\n                    html.setAttribute('href', vmd.virtualPath + \"/\" + fileList[i].url);\n                    html.style.display = 'block';\n                    html.style.cursor = \"hand\";\n                    html.innerText = fileList[i].title;\n                    pdiv.appendChild(html);\n                    vmd(pdiv).on('mouseenter', function() {\n                        debugger\n                        selectedfImage = this.lastChild;\n                        selectedfDiv = this;\n                        //vmd(this).find('.frap')[0].style.width = selectedfImage.offsetWidth + \"px\";\n                        vmd(this).find('.frap').show();\n                    });\n                    vmd(pdiv).on('mouseleave', function() {\n                        vmd(this).find('.frap').hide();\n                    });\n                    var div = document.createElement('div');\n                    div.className = \"frap\"\n                    div.style.backgroundColor = \"RGB(103,44,44)\";\n                    div.style.float = \"right\";\n                    div.style.width = \"18px\";\n                    div.style.height = \"18px\";\n                    // div.style.position = 'absolute';\n                    div.style.display = \"none\";\n                    // div.style.textAlign = \"right\";\n                    div.style.padding = \"4px\";\n                    image = document.createElement('img');\n                    image.setAttribute('src', '/img/public/aaaaaaa_03.png');\n                    image.style.width = '15px';\n                    image.style.height = '15px';\n                    var selectedfImage;\n                    var selectedfDiv;\n                    image.onclick = function() {\n                        Ext.Msg.show({\n                            title: '提示',\n                            msg: '是否要删除服务器上该文档?',\n                            buttons: Ext.Msg.YESNO,\n                            fn: function(result) {\n                                if (result == \"yes\") {\n                                    if (selectedfImage) {\n                                        var dpath = \"\";\n                                        if (MyField1.getValue())\n                                            dpath = \"components/upload/\"+MyField1.getValue() + \"/file/\";\n                                        selectedfDiv.remove();\n                                        hwDas.remove(\"vmd\", dpath + selectedfImage.textContent, function(result) {\n                                            //alert(\"删除成功！\")\n                                            txtFiles.doLayout()\n                                        }, function() {});\n                                    }\n                                }\n                            },\n                            animEl: 'elId',\n                            icon: Ext.MessageBox.QUESTION\n                        });\n                    }\n                    div.appendChild(image);\n\n                    pdiv.insertBefore(div, html);\n\n                    txtFiles.el.dom.appendChild(pdiv)\n                }\n                txtFiles.setHeight(txtFiles.el.dom.scrollHeight);\n                upFile_panel.setHeight(txtFiles.el.dom.scrollHeight);\n                hwDiv3.setHeight(txtFiles.el.dom.scrollHeight + 50);\n                // p.parentElement\n            }\n        }\n\n    })\n}\n\n\nfunction hwImg_click(sender) {\n\n    upimg.upload({\n        title: \"上传图片\",\n        savedir: \"components/upload/\" + MyField1.getValue()+\"/image\",\n        hwcode: 'vmd',\n        host: vmdSettings.dataServiceIp,\n        callback: function(fileList) {\n            if (fileList && fileList.length > 0) {\n                var str = \"\";\n                for (var i = 0; i < fileList.length; i++) {\n                    var html = document.createElement('div');\n                    html.style.width = \"90px\";\n                    html.style.height = \"100px\";\n                    html.style.display = 'block';\n                    html.style.float = \"left\";\n                    html.style.marginRight = \"20px\";\n                    html.style.marginTop = \"5px\";\n                    html.style.border = \"1px solid lightgray\";\n                    html.style.cursor = \"pointer\";\n                    var image = document.createElement('img');\n                    image.setAttribute('src', vmd.virtualPath + \"/\" + fileList[i].url);\n                    image.style.width = \"88px\";\n                    image.style.height = \"96px\";\n                    image.style.float = \"left\";\n                    image.style.border = \"1px soild red !important\";\n                    image.style.padding = \"1px\";\n                    //image.className = 'addimg';\n                    image.innerText = fileList[i].title;\n                    //图片点击\n                    var imageList = {};\n                    var imageListItems = [];\n                    var index = -1;\n                    var selectedImage;\n                    var selectedDiv;\n                    image.onclick = function() {\n                        for (var i = 0; i < fileList.length; i++) { //遍历当前的资源，将图片列表信息生成特定格式\n                            var itemData = fileList[i];\n                            var imageListItem = {\n                                msrc: vmd.virtualPath + \"/\" + fileList[i].url,\n                                src: vmd.virtualPath + \"/\" + fileList[i].url,\n                                h: 0,\n                                w: 0,\n                                title: fileList[i].title\n                            }\n                            imageListItems.push(imageListItem);\n                            index++; ////获取当前图片在图片列表中的索引\n\n                            if (this.textContent == fileList[i].title) //根据当前点击的项与添加的图片项作对比 记录当前点击图片的index\n                                imageList.index = index;\n                        }\n                        imageList.items = imageListItems;\n                        vmd.showImg(imageList);\n                    }\n                    vmd(html).on('mouseenter', function() {\n                        vmd(this).find('.wrap').show();\n                        selectedImage = this.firstChild;\n                        selectedDiv = this;\n                    });\n                    vmd(html).on('mouseleave', function() {\n                        vmd(this).find('.wrap').hide();\n                    });\n                    html.appendChild(image);\n                    var div = document.createElement('div');\n                    div.className = \"wrap\"\n                    div.style.backgroundColor = \"RGB(103,44,44)\";\n                    div.style.width = \"88px\";\n                    div.style.height = \"20px\";\n                    div.style.position = 'absolute';\n                    div.style.display = \"none\";\n                    div.style.textAlign = \"right\";\n                    div.style.padding = \"2px\";\n                    image = document.createElement('img');\n                    image.setAttribute('src', '/img/public/aaaaaaa_03.png');\n                    image.style.width = '15px';\n                    image.style.height = '15px';\n                    image.onclick = function() {\n                        Ext.Msg.show({\n                            title: '提示',\n                            msg: '是否要删除服务器上该图片?',\n                            buttons: Ext.Msg.YESNO,\n                            fn: function(result) {\n                                if (result == \"yes\") {\n                                    if (selectedImage) {\n                                        var dpath = \"\";\n                                        if (MyField1.getValue())\n                                            dpath =\"components/upload/\"+ MyField1.getValue() + \"/image/\";\n                                        selectedDiv.remove();\n                                        hwDas.remove(\"vmd\", dpath + selectedImage.textContent, function(result) {\n                                            //alert(\"删除成功！\")\n                                            img_div.doLayout()\n                                        }, function() {});\n                                    }\n                                }\n                            },\n                            animEl: 'elId',\n                            icon: Ext.MessageBox.QUESTION\n                        });\n                    }\n                    div.appendChild(image);\n                    html.appendChild(div);\n                    img_div.el.dom.insertBefore(html, hwDiv.el.dom)\n                }\n                img_div.setHeight(img_div.el.dom.scrollHeight);\n                hwDiv4.setHeight(img_div.el.dom.scrollHeight);\n            }\n        }\n    })\n}\n\nfunction hwImg_afterrender(sender) {\n    vmd(hwDiv.el.dom).on('mouseenter', function() {\n        this.style.cursor = 'hand';\n    })\n    vmd(hwDiv).on('mouseleave', function() {\n        this.style.cursor = 'default';\n    })\n}\n\n\nfunction upfile_beforerender(sender) {\n\n    // upfile.mineTypes = \".doc,.docx,.pdf,.ppt,.pptx,.xls,.xlsx\";\n    // upfile.mimeTypes = \".doc,.docx,.pdf,.ppt,.pptx,.xls,.xlsx\";\n\n}\n\nfunction upimg_beforerender(sender) {\n    //upimg.mineTypes = \".jpeg,.jpg,.png,.gif\";\n    //  upimg.mimeTypes = \".jpeg,.jpg,.png,.gif\";\n}\n\nfunction upfile_afterrender(sender) {\n\n}","vmdcss":".empty_fontcolor{color:#08080857;}","vmdprops":"\"\"","type":"ux","vmdevents_controller":"Ext.define('vmd.ux.userControlInfo.Controller', {\n    xtype: 'vmd.ux.userControlInfo.Controller',\n    constructor: function(options) {\n        \n    }\n})","vmdinterface":"{\"components\":[{\"cid\":\"vmduxprops\",\"layoutConfig\":{},\"userConfig\":{}},{\"cid\":\"vmduxmethods\",\"id\":\"方法\",\"layoutConfig\":{},\"userConfig\":{},\"cn\":[{\"cid\":\"uxmethod\",\"id\":\"refresh\",\"layoutConfig\":{},\"userConfig\":{\"id\":\"refresh\",\"zhname\":\"\",\"bindCmp\":\"\",\"bindValue\":\"\",\"isPublic\":\"on\",\"desc\":\"\",\"uxcid\":\"\",\"params\":\"tree\",\"code\":\"//直接填写方法内容\\n\\ntoRefresh(tree)\",\"returnType\":\"\"}},{\"cid\":\"uxmethod\",\"id\":\"setReadOnly\",\"layoutConfig\":{},\"userConfig\":{\"id\":\"setReadOnly\",\"zhname\":\"\",\"bindCmp\":\"\",\"bindValue\":\"\",\"isPublic\":\"on\",\"desc\":\"\",\"uxcid\":\"\",\"params\":\"\",\"code\":\"//直接填写方法内容\\n\\nbutton.hide();\\nbutton1.hide();\\nbutton2.hide();\\nbutton3.hide();\\nuxName.disable();//(true);\\nhwCheckbox.disable();\\nMyField7.disable();\\nMyField1.disable();\",\"returnType\":\"\"}}]},{\"cid\":\"vmduxevents\",\"id\":\"事件\",\"layoutConfig\":{},\"userConfig\":{}}]}","vmdresource":"{\"components\":[{\"cid\":\"vmdrescsss\",\"layoutConfig\":{},\"userConfig\":{}},{\"cid\":\"vmdresjss\",\"layoutConfig\":{},\"userConfig\":{},\"cn\":[{\"cid\":\"resjs\",\"id\":\"controller.js\",\"layoutConfig\":{},\"userConfig\":{}}]},{\"cid\":\"vmdresimgs\",\"layoutConfig\":{},\"userConfig\":{}}]}"}