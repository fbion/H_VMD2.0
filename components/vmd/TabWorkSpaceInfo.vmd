{"vmdversion":"vmd2.0.5.200306","vmdlayout":"{\"components\":[{\"cid\":\"uxpanel\",\"id\":\"TabWorkSpaceInfo\",\"layoutConfig\":{},\"userConfig\":{\"layout\":\"absolute\",\"header\":false,\"width\":610,\"height\":420,\"beforerender\":\"TabWorkSpaceInfo_beforerender\",\"afterrender\":\"TabWorkSpaceInfo_afterrender\"},\"cn\":[{\"cid\":\"tabpanel\",\"id\":\"TabsWorkSpaceInfo\",\"layoutConfig\":{},\"userConfig\":{\"x\":0,\"y\":0,\"width\":610,\"height\":420,\"id\":\"TabsWorkSpaceInfo\",\"tabchange\":\"TabsWorkSpaceInfo_tabchange\",\"afterrender\":\"TabsWorkSpaceInfo_afterrender\",\"activeTab\":0,\"beforerender\":\"TabsWorkSpaceInfo_beforerender\"},\"cn\":[{\"cid\":\"panel\",\"id\":\"panelTabInfo\",\"layoutConfig\":{},\"userConfig\":{\"title\":\"基本信息\",\"id\":\"panelTabInfo\",\"layout\":\"absolute\",\"width\":436,\"height\":384,\"afterrender\":\"panelTabInfo_afterrender\",\"border\":false},\"cn\":[{\"cid\":\"label\",\"id\":\"label\",\"layoutConfig\":{},\"userConfig\":{\"x\":20,\"y\":15,\"text\":\"工区名称：\"}},{\"cid\":\"textfield\",\"id\":\"hwTextWorkSpaceName\",\"layoutConfig\":{},\"userConfig\":{\"x\":80,\"y\":10,\"width\":520,\"id\":\"hwTextWorkSpaceName\",\"blankText\":\"\",\"emptyText\":\"\"}},{\"cid\":\"textfield\",\"id\":\"hwTextCreatedTime\",\"layoutConfig\":{},\"userConfig\":{\"x\":80,\"y\":70,\"width\":520,\"readOnly\":true,\"id\":\"hwTextCreatedTime\"}},{\"cid\":\"label\",\"id\":\"label1\",\"layoutConfig\":{},\"userConfig\":{\"x\":20,\"y\":75,\"text\":\"创建时间：\"}},{\"cid\":\"label\",\"id\":\"label2\",\"layoutConfig\":{},\"userConfig\":{\"x\":20,\"y\":105,\"text\":\"修改时间：\"}},{\"cid\":\"textfield\",\"id\":\"hwTextModifiedTime\",\"layoutConfig\":{},\"userConfig\":{\"x\":80,\"y\":100,\"width\":520,\"readOnly\":true,\"id\":\"hwTextModifiedTime\"}},{\"cid\":\"label\",\"id\":\"label3\",\"layoutConfig\":{},\"userConfig\":{\"x\":43,\"y\":130,\"text\":\"    说明：\",\"height\":20}},{\"cid\":\"textarea\",\"id\":\"hwTextAreaWorkSpaceDescription\",\"layoutConfig\":{},\"userConfig\":{\"x\":80,\"y\":130,\"width\":520,\"id\":\"hwTextAreaWorkSpaceDescription\",\"height\":90}},{\"cid\":\"label\",\"id\":\"label6\",\"layoutConfig\":{},\"userConfig\":{\"x\":20,\"y\":45,\"text\":\"工区别名：\"}},{\"cid\":\"textfield\",\"id\":\"hwTextWorkSpaceAlias\",\"layoutConfig\":{},\"userConfig\":{\"x\":80,\"y\":40,\"width\":520,\"id\":\"hwTextWorkSpaceAlias\"}}]},{\"cid\":\"panel\",\"id\":\"panelTabWorkflow\",\"layoutConfig\":{},\"userConfig\":{\"title\":\"工作流\",\"id\":\"panelTabWorkflow\",\"layout\":\"absolute\",\"afterrender\":\"panelTabWorkflow_afterrender\"},\"cn\":[{\"cid\":\"label\",\"id\":\"label4\",\"layoutConfig\":{},\"userConfig\":{\"x\":15,\"y\":15,\"text\":\"工作流服务地址：\"}},{\"cid\":\"vmdComlist\",\"id\":\"comlistWorkflowAddress\",\"layoutConfig\":{},\"userConfig\":{\"x\":110,\"y\":10,\"width\":490,\"id\":\"comlistWorkflowAddress\",\"editable\":true,\"selectChanged\":\"comlistWorkflowAddress_selectChanged\"}}]},{\"cid\":\"panel\",\"id\":\"panelTabDataService\",\"layoutConfig\":{},\"userConfig\":{\"title\":\"数据服务\",\"id\":\"panelTabDataService\",\"layout\":\"absolute\",\"afterrender\":\"panelTabDataService_afterrender\"},\"cn\":[{\"cid\":\"label\",\"id\":\"label5\",\"layoutConfig\":{},\"userConfig\":{\"x\":15,\"y\":15,\"text\":\"数据服务地址：\"}},{\"cid\":\"vmdComlist\",\"id\":\"comlistDataServiceAddress\",\"layoutConfig\":{},\"userConfig\":{\"x\":100,\"y\":10,\"width\":500,\"id\":\"comlistDataServiceAddress\",\"editable\":true,\"selectChanged\":\"comlistDataServiceAddress_selectChanged\"}}]},{\"cid\":\"panel\",\"id\":\"panelTabResource\",\"layoutConfig\":{},\"userConfig\":{\"id\":\"panelTabResource\",\"title\":\"资源\",\"layout\":\"absolute\",\"afterrender\":\"panelTabResource_afterrender\"},\"cn\":[{\"cid\":\"vmd.ux.TabWorkSpaceResource\",\"id\":\"TabWorkSpaceResource\",\"layoutConfig\":{},\"userConfig\":{\"x\":0,\"y\":0,\"height\":380,\"beforerender\":\"TabWorkSpaceResource_beforerender\",\"width\":610}}]},{\"cid\":\"panel\",\"id\":\"panelMSG\",\"layoutConfig\":{},\"userConfig\":{\"id\":\"panelMSG\",\"title\":\"消息中心\",\"layout\":\"absolute\"},\"cn\":[{\"cid\":\"vmdComlist\",\"id\":\"comlistMSG\",\"layoutConfig\":{},\"userConfig\":{\"x\":100,\"y\":10,\"width\":500,\"editable\":true,\"selectChanged\":\"comlistMSG_selectChanged\",\"id\":\"comlistMSG\"}},{\"cid\":\"label\",\"id\":\"label7\",\"layoutConfig\":{},\"userConfig\":{\"x\":15,\"y\":15,\"text\":\"消息中心地址：\"}}]}]}]},{\"cid\":\"vmddataset\",\"id\":\"数据\",\"layoutConfig\":{},\"userConfig\":{}}]}","vmdevents":"var page = this;\nvar workspaceId = \"\";\n// var workspaceId = \"00000000-0000-0000-0000-000000000000\";\nvar ifNewWorkSpace = false; // 是否是新建工区\nvar ifBaseInfoSaved = false; // 基本信息是否已保存\nvar ifMSGSaved = false; // 基本信息是否已保存\n// 工作流服务地址下拉列表数据\nvar workflowStoreRecords = null;\nvar msgStoreRecords = null;\n// 数据服务的服务地址下拉列表数据\nvar dataserviceStoreRecords = null;\n// 记录当前是哪一个tab页\nvar tabIndexInfo, tabIndexWorkFlow, tabIndexDataService, tabIndexResource, tabIndexMSG;\n// var workspaceNameOld = \"\";\nfunction panelTabInfo_afterrender(sender) {}\n\nfunction panelTabWorkflow_afterrender(sender) {}\n\nfunction panelTabDataService_afterrender(sender) {}\n\nfunction panelTabResource_afterrender(sender) {}\n\nfunction TabsWorkSpaceInfo_tabchange(sender, tab) {\n    var tabId = tab.id;\n    tabIndexInfo = tabId.indexOf(\"panelTabInfo\"); // 基于0开始,找不到返回-1\n    tabIndexWorkFlow = tabId.indexOf(\"panelTabWorkflow\"); // 基于0开始,找不到返回-1\n    tabIndexDataService = tabId.indexOf(\"panelTabDataService\"); // 基于0开始,找不到返回-1\n    tabIndexResource = tabId.indexOf(\"panelTabResource\"); // 基于0开始,找不到返回-1\n    tabIndexMSG = tabId.indexOf(\"panelMSG\"); // 基于0开始,找不到返回-1\n    // 基本信息\n    if (tabIndexInfo > -1) {\n        queryDataInfo();\n    } else if (tabIndexWorkFlow > -1) {\n        queryWorkFlow();\n    } else if (tabIndexDataService > -1) {\n        queryDataService();\n    } else if (tabIndexResource > -1) {\n        TabWorkSpaceResource.iSetWorkSpaceId(workspaceId);\n        TabWorkSpaceResource.iTabChangeResource();\n    } else if (tabIndexMSG > -1) {\n        queryMSG();\n    }\n}\n\nfunction queryDataInfo() {\n    // workspaceId = \"18a7a702-1077-4b44-9e35-6e289da389d9\";\n    if (workspaceId === null || workspaceId === undefined || workspaceId === '') {\n        return;\n    }\n    if (panelTabInfo.ifDataLoaded) {\n        return;\n    }\n    hwDas.get(\n        \"DataServiceWorkSpace/WorkSpaceInfo/WorkSpaceInfo\", {}, {\n            \"workspaceid\": workspaceId\n        },\n        function(result) {\n            // 根据获取的数据赋值基本信息Tab页\n            if (null === result && undefined === result) {\n                return;\n            }\n            if (null != result.data && undefined != result.data) {\n                if (result.data.length > 0) {\n                    if (null != result.data[0].datas && undefined != result.data[0].datas) {\n                        if (result.data[0].datas.length > 0) {\n                            // workspaceNameOld = result.data[0].datas[0].name;\n                            hwTextWorkSpaceName.setValue(result.data[0].datas[0].name);\n                            hwTextWorkSpaceAlias.setValue(result.data[0].datas[0].alias_short_name);\n                            hwTextAreaWorkSpaceDescription.setValue(result.data[0].datas[0].remark);\n                            hwTextCreatedTime.setValue(result.data[0].datas[0].row_created_date)\n                            hwTextModifiedTime.setValue(result.data[0].datas[0].row_changed_date);\n                        } else {\n                            // workspaceNameOld = \"\";\n                            hwTextWorkSpaceName.setValue(\"\");\n                            hwTextWorkSpaceAlias.setValue(\"\");\n                            hwTextAreaWorkSpaceDescription.setValue(\"\");\n                            hwTextCreatedTime.setValue('')\n                            hwTextModifiedTime.setValue('');\n                        }\n                    }\n                }\n            }\n            panelTabInfo.ifDataLoaded = true;\n        },\n        function(msg) {\n            // Tips.tips(\"查询失败！\", \"error\");\n            // Ext.Msg.alert(\"提示\", \"查询工区信息失败！\");\n        });\n}\n\nfunction queryWorkFlow() {\n    if (workspaceId === null || workspaceId === undefined || workspaceId === '') {\n        return;\n    }\n    if (panelTabWorkflow.ifDataLoaded) {\n        return;\n    }\n    hwDas.get(\n        \"DataServiceWorkSpace/WorkSpaceInfo/ServiceAddress\", {}, {\n            \"workspaceid\": workspaceId,\n            \"servicetype\": 3\n        },\n        function(result) {\n            // 根据获取的数据赋值基本信息Tab页\n            if (null === result && undefined === result) {\n                return;\n            }\n            if (null != result.data && undefined != result.data) {\n                if (result.data.length > 0) {\n                    if (null != result.data[0].datas && undefined != result.data[0].datas) {\n                        if (result.data[0].datas.length > 0) {\n                            comlistWorkflowAddress.setValue(result.data[0].datas[0].address);\n                            comlistWorkflowAddress.serviceId = result.data[0].datas[0].id;\n                        } else {\n                            comlistWorkflowAddress.setValue(\"\");\n                            comlistWorkflowAddress.serviceId = undefined;\n                        }\n                    }\n                }\n            }\n            panelTabWorkflow.ifDataLoaded = true;\n        },\n        function(msg) {\n            // Ext.Msg.alert(\"提示\", \"查询工区信息失败！\");\n        });\n}\n\nfunction queryDataService() {\n    // workspaceId = \"20e05c41-96ab-46f7-aaa6-d9a177ee9323\";\n    if (workspaceId === null || workspaceId === undefined || workspaceId === '') {\n        return;\n    }\n    if (panelTabDataService.ifDataLoaded) {\n        return;\n    }\n    hwDas.get(\n        \"DataServiceWorkSpace/WorkSpaceInfo/ServiceAddress\", {}, {\n            \"workspaceid\": workspaceId,\n            \"servicetype\": 4\n        },\n        function(result) {\n            // 根据获取的数据赋值基本信息Tab页\n            if (null === result && undefined === result) {\n                return;\n            }\n            if (null != result.data && undefined != result.data) {\n                if (result.data.length > 0) {\n                    if (null != result.data[0].datas && undefined != result.data[0].datas) {\n                        if (result.data[0].datas.length > 0) {\n                            comlistDataServiceAddress.setValue(result.data[0].datas[0].address);\n                            comlistDataServiceAddress.serviceId = result.data[0].datas[0].id;\n                        } else {\n                            comlistDataServiceAddress.setValue(\"\");\n                            comlistDataServiceAddress.serviceId = undefined;\n                        }\n                    }\n                }\n            }\n            panelTabDataService.ifDataLoaded = true;\n        },\n        function(msg) {\n            // Ext.Msg.alert(\"提示\", \"查询工区信息失败！\");\n        });\n}\n//20180914 成兵 根据工作流查询方法进行添加\nfunction queryMSG() {\n    if (workspaceId === null || workspaceId === undefined || workspaceId === '') {\n        return;\n    }\n    if (panelMSG.ifDataLoaded) {\n        return;\n    }\n    hwDas.get(\n        \"DataServiceWorkSpace/WorkSpaceInfo/ServiceAddress\", {}, {\n            \"workspaceid\": workspaceId,\n            \"servicetype\": 5\n        },\n        function(result) {\n            // 根据获取的数据赋值基本信息Tab页\n            if (null === result && undefined === result) {\n                return;\n            }\n            if (null != result.data && undefined != result.data) {\n                if (result.data.length > 0) {\n                    if (null != result.data[0].datas && undefined != result.data[0].datas) {\n                        if (result.data[0].datas.length > 0) {\n                            comlistMSG.setValue(result.data[0].datas[0].address);\n                            comlistMSG.serviceId = result.data[0].datas[0].id;\n                        } else {\n                            comlistMSG.setValue(\"\");\n                            comlistMSG.serviceId = undefined;\n                        }\n                    }\n                }\n            }\n            panelMSG.ifDataLoaded = true;\n        },\n        function(msg) {\n            // Ext.Msg.alert(\"提示\", \"查询工区信息失败！\");\n        });\n}\n\nfunction saveData(lastId, refreshStore) {\n    var flag = 0; // 0: insert, 1:update;\n    if (!ifNewWorkSpace) {\n        flag = 1;\n    }\n    // 基本信息\n    if (panelTabInfo.ifDataLoaded && tabIndexInfo > -1) {\n        saveDataInfo(workspaceId, flag, lastId, refreshStore);\n        ifBaseInfoSaved = true;\n    }\n    if (panelTabWorkflow.ifDataLoaded && tabIndexWorkFlow > -1) {\n        saveWorkFlow(workspaceId, flag, refreshStore);\n    }\n    if (panelTabDataService.ifDataLoaded && tabIndexDataService > -1) {\n        saveDataService(workspaceId, flag, refreshStore);\n    }\n    if (panelMSG.ifDataLoaded && tabIndexMSG > -1) {\n        saveMSG(refreshStore);\n    }\n    ifNewWorkSpace = false;\n}\n\nfunction saveFlow(refreshStore) {\n    var flag = 0; // 0: insert, 1:update;\n    if (!ifNewWorkSpace) {\n        flag = 1;\n    }\n    // 基本信息\n    saveWorkFlow(workspaceId, flag, refreshStore);\n    ifNewWorkSpace = false;\n}\n\nfunction saveService(refreshStore) {\n    var flag = 0; // 0: insert, 1:update;\n    if (!ifNewWorkSpace) {\n        flag = 1;\n    }\n    // 基本信息\n    saveDataService(workspaceId, flag, refreshStore);\n    ifNewWorkSpace = false;\n}\n//成兵 20180914 成兵 根据工作流模式添加\nfunction saveMSG(refreshStore) {\n    var flag = 0; // 0: insert, 1:update;\n    if (!ifMSGSaved) {\n        flag = 1;\n    }\n    var msgAddr = comlistMSG.getText();\n    var wfData = storeMSG.data.items;\n    var serviceId = '';\n    var ifAddrExisted = false;\n    if (msgStoreRecords) {\n        for (var i = 0; i < msgStoreRecords.length; i++) {\n            if (msgStoreRecords[i].address == msgAddr) {\n                ifAddrExisted = true;\n                serviceId = msgStoreRecords[i].id;\n                comlistMSG.serviceId = serviceId;\n                break;\n            }\n        }\n    }\n    // 地址不存在,就向服务地址表中增加一条记录\n    if (!ifAddrExisted) {\n        serviceId = vmd.util.guid();\n        comlistMSG.serviceId = serviceId;\n        addMSGAddr(serviceId, msgAddr);\n    }\n    // 如果地址已经存在，就向工区服务地址关系表中保存数据（插入或更新）  5 代表消息中心地址\n    saveMSGAddr(workspaceId, serviceId, 5, msgAddr, refreshStore);\n    ifMSGSaved = false;\n}\n// flag 0:insert, 1:update\nfunction saveDataInfo(id, flag, lastId, refreshStore) {\n\n    // var myDate = new Date();\n    // myDate.toLocaleString(); //获取日期与时间\n    if (0 == flag) {\n        var workspaceName = hwTextWorkSpaceName.getValue();\n        if (workspaceName == null || workspaceName == undefined || workspaceName == '') {\n            workspaceName = \"我的工区\";\n        }\n        var workspaceAlias = hwTextWorkSpaceAlias.getValue();\n        if (workspaceAlias === null || workspaceAlias === undefined || workspaceAlias === '') {\n            workspaceAlias = workspaceName;\n        }\n        hwDas.add(\n            \"DataServiceWorkSpace/WorkSpaceInfo/WorkSpaceInfo\", {}, {}, [{\n                'workspaceid': id,\n                'lastid': lastId,\n                'workspacename': workspaceName,\n                'isactive': 0,\n                'modifydate': hwTextCreatedTime.getValue(),\n                'createddate': hwTextModifiedTime.getValue(),\n                'aliasid': vmd.util.guid(),\n                'aliaslongname': workspaceAlias,\n                'aliasshortname': workspaceAlias,\n                'remark': hwTextAreaWorkSpaceDescription.getValue()\n            }],\n            function(result) {\n                if (refreshStore) {\n                    refreshStore(id);\n                }\n                Tips.tips(\"工区基本信息保存成功！\", \"success\");\n                ifBaseInfoSaved = true; // 基本信息是否已保存\n            },\n            function(msg) {\n                Tips.tips(\"工区基本信息保存失败！\", \"error\");\n            }\n        );\n    } else {\n        // var workspaceNameNew = hwTextWorkSpaceName.getValue();\n        hwDas.edit(\n            \"DataServiceWorkSpace/WorkSpaceInfo/WorkSpaceInfo\", {}, {}, [{\n                'workspaceid': id,\n                'name': hwTextWorkSpaceName.getValue(),\n                'aliaslongname': hwTextWorkSpaceAlias.getValue(),\n                'aliasshortname': hwTextWorkSpaceAlias.getValue(),\n                'modifydate': Ext.Date.dateFormat(new Date(), 'Y-m-d H:i:s'),\n                'remark': hwTextAreaWorkSpaceDescription.getValue()\n            }],\n            function(result) {\n                if (refreshStore) {\n                    refreshStore();\n                }\n                Tips.tips(\"工区基本信息保存成功！\", \"success\");\n            },\n            function(msg) {\n                Tips.tips(\"工区基本信息保存失败！\", \"error\");\n            }\n        );\n    }\n}\n// id:工区id； flag：0，新建工区；1：更新工区；refreshStore：回调函数刷新数据集\nfunction saveWorkFlow(id, flag, refreshStore) {\n\n    var workflowAddr = comlistWorkflowAddress.getText();\n    var wfData = storeWorkflowList.data.items;\n    var serviceId = '';\n    var ifAddrExisted = false;\n    if (workflowStoreRecords) {\n        for (var i = 0; i < workflowStoreRecords.length; i++) {\n            if (workflowStoreRecords[i].address == workflowAddr) {\n                ifAddrExisted = true;\n                serviceId = workflowStoreRecords[i].id;\n                comlistWorkflowAddress.serviceId = serviceId;\n                break;\n            }\n        }\n    }\n    // 地址不存在,就向服务地址表中增加一条记录\n    if (!ifAddrExisted) {\n        serviceId = vmd.util.guid();\n        comlistWorkflowAddress.serviceId = serviceId;\n        addWorkflowAddr(serviceId, workflowAddr);\n    }\n    // 如果地址已经存在，就向工区服务地址关系表中保存数据（插入或更新）\n    saveWorkflowAddr(id, serviceId, 3, workflowAddr, refreshStore);\n}\n// 向服务地址表RESOURCE_SERVICEADDRESS中插入一条地址记录\nfunction saveWorkflowAddr(wsId, addrId, type, address, refreshStore) {\n    var reg = /[\\w\\-]+(\\.[\\w\\-]+)+([\\w\\-\\.,@?^=%&:\\/~\\+#]*[\\w\\-\\@?^=%&\\/~\\+#])?:([0-9]|[1-9]\\d{1,3}|[1-5]\\d{4}|6[0-5]{2}[0-3][0-5])$/;\n    if (address!=''&&!reg.test(address)) {\n        Tips.tips(\"请输入标准工作流服务地址！\", \"error\");\n        return\n    } else {\n        hwDas.save(\n            \"DataServiceWorkSpace/WorkSpaceInfo/WfDsAddr\", {}, {}, [{\n                'workspaceid': wsId,\n                'addressid': addrId,\n                'type': type\n            }],\n            function(result) {\n                Tips.tips(\"工作流服务地址保存成功！\", \"success\");\n                vmd.workspace.workflowIp = address;\n            },\n            function(msg) {\n                Tips.tips(\"工作流服务地址保存失败！\", \"error\");\n            }\n        )\n    }\n}\n// 向服务地址表RESOURCE_SERVICEADDRESS中插入一条地址记录\nfunction addWorkflowAddr(id, address) {\n    var reg = /[\\w\\-]+(\\.[\\w\\-]+)+([\\w\\-\\.,@?^=%&:\\/~\\+#]*[\\w\\-\\@?^=%&\\/~\\+#])?:([0-9]|[1-9]\\d{1,3}|[1-5]\\d{4}|6[0-5]{2}[0-3][0-5])$/;\n    if (address!=''&&!reg.test(address)) {\n        Tips.tips(\"请输入标准工作流服务地址！\", \"error\");\n        return\n    } else {\n        hwDas.add(\n            \"DataServiceWorkSpace/WorkSpaceInfo/WfDsAddr\", {}, {}, [{\n                'id': id,\n                'name': \"工作流服务地址\",\n                'addr': address,\n                'type': 3,\n                'remark': \"工作流服务地址\"\n            }],\n            function(result) {\n                Tips.tips(\"工作流服务地址保存成功！\", \"success\");\n            },\n            function(msg) {\n                Tips.tips(\"工作流服务地址保存失败！\", \"error\");\n            }\n        )\n    }\n}\n// 20180914  chengbing 根据工作流保存模式进行添加  \nfunction saveMSGAddr(wsId, addrId, type, address, refreshStore) {\n    var reg = /[\\w\\-]+(\\.[\\w\\-]+)+([\\w\\-\\.,@?^=%&:\\/~\\+#]*[\\w\\-\\@?^=%&\\/~\\+#])?:([0-9]|[1-9]\\d{1,3}|[1-5]\\d{4}|6[0-5]{2}[0-3][0-5])$/;\n    if (address!=''&&!reg.test(address)) {\n        Tips.tips(\"请输入标准消息中心服务地址！\", \"error\");\n        return\n    } else {\n        hwDas.save(\n            \"DataServiceWorkSpace/WorkSpaceInfo/WfDsAddr\", {}, {}, [{\n                'workspaceid': wsId,\n                'addressid': addrId,\n                'type': type\n            }],\n            function(result) {\n                Tips.tips(\"消息中心服务地址保存成功！\", \"success\");\n                vmd.workspace.workflowIp = address;\n            },\n            function(msg) {\n                Tips.tips(\"消息中心服务地址保存失败！\", \"error\");\n            }\n        )\n    }\n}\n//20180914  chengbing 根据工作流保存模式进行添加  \nfunction addMSGAddr(id, address) {\n    var reg = /[\\w\\-]+(\\.[\\w\\-]+)+([\\w\\-\\.,@?^=%&:\\/~\\+#]*[\\w\\-\\@?^=%&\\/~\\+#])?:([0-9]|[1-9]\\d{1,3}|[1-5]\\d{4}|6[0-5]{2}[0-3][0-5])$/;\n    if (address!=''&&!reg.test(address)) {\n        Tips.tips(\"请输入标准消息中心服务地址！\", \"error\");\n        return\n    } else {\n        hwDas.add(\n            \"DataServiceWorkSpace/WorkSpaceInfo/WfDsAddr\", {}, {}, [{\n                'id': id,\n                'name': \"消息中心地址\",\n                'addr': address,\n                'type': 5,\n                'remark': \"消息中心地址\"\n            }],\n            function(result) {\n                Tips.tips(\"消息中心地址保存成功！\", \"success\");\n            },\n            function(msg) {\n                Tips.tips(\"消息中心地址保存失败！\", \"error\");\n            }\n        )\n    }\n}\n\nfunction updateWorkflow(id, addr) {}\n\nfunction updateDataService(id, addr) {}\n\nfunction saveDataService(id, flag, refreshStore) {\n\n    var dataserviceAddr = comlistDataServiceAddress.getText();\n    var serviceId = '';\n    var ifAddrExisted = false;\n    if (dataserviceStoreRecords) {\n        for (var i = 0; i < dataserviceStoreRecords.length; i++) {\n            if (dataserviceStoreRecords[i].address == dataserviceAddr) {\n                ifAddrExisted = true;\n                serviceId = dataserviceStoreRecords[i].id;\n                comlistDataServiceAddress.serviceId = serviceId;\n                break;\n            }\n        }\n    }\n    // 地址不存在,就向服务地址表中增加一条记录\n    if (!ifAddrExisted) {\n        serviceId = vmd.util.guid();\n        comlistDataServiceAddress.serviceId = serviceId;\n        addDataServiceAddr(serviceId, dataserviceAddr);\n    }\n    // 如果地址已经存在，就向工区服务地址关系表中保存数据（插入或更新）\n    saveDataServiceAddr(id, serviceId, 4, dataserviceAddr, refreshStore);\n}\n// 向服务地址表RESOURCE_SERVICEADDRESS中插入一条地址记录\nfunction saveDataServiceAddr(wsId, addrId, type, address, refreshStore) {\n    var reg = /[\\w\\-]+(\\.[\\w\\-]+)+([\\w\\-\\.,@?^=%&:\\/~\\+#]*[\\w\\-\\@?^=%&\\/~\\+#])?:([0-9]|[1-9]\\d{1,3}|[1-5]\\d{4}|6[0-5]{2}[0-3][0-5])$/;\n    if (address!=''&&!reg.test(address)) {\n        Tips.tips(\"请输入标准的数据服务器地址！\", \"error\");\n        return\n    } else {\n        hwDas.save(\n            \"DataServiceWorkSpace/WorkSpaceInfo/WfDsAddr\", {}, {}, [{\n                'workspaceid': wsId,\n                'addressid': addrId,\n                'type': type\n            }],\n            function(result) {\n                Tips.tips(\"数据服务地址保存成功！\", \"success\");\n            },\n            function(msg) {\n                Tips.tips(\"数据服务地址保存失败！\", \"error\");\n            }\n        )\n    }\n}\n// 向服务地址表RESOURCE_SERVICEADDRESS中插入一条地址记录\nfunction addDataServiceAddr(id, address) {\n    var reg = /[\\w\\-]+(\\.[\\w\\-]+)+([\\w\\-\\.,@?^=%&:\\/~\\+#]*[\\w\\-\\@?^=%&\\/~\\+#])?:([0-9]|[1-9]\\d{1,3}|[1-5]\\d{4}|6[0-5]{2}[0-3][0-5])$/;\n    if (address!=''&&!reg.test(address)) {\n        Tips.tips(\"请输入标准的数据服务器地址！\", \"error\");\n        return\n    } else {\n        hwDas.add(\n            \"DataServiceWorkSpace/WorkSpaceInfo/WfDsAddr\", {}, {}, [{\n                'id': id,\n                'name': \"数据服务地址\",\n                'addr': address,\n                'type': 4,\n                'remark': \"数据服务地址\"\n            }],\n            function(result) {\n                Tips.tips(\"数据服务地址保存成功！\", \"success\");\n            },\n            function(msg) {\n                Tips.tips(\"数据服务地址保存失败！\", \"error\");\n            }\n        )\n    }\n}\n// 新建工区\nfunction newWorkSpace(id) {\n    // var nowTime = new Date().toLocaleString();\n    var nowTime = new Date().getFullYear() + '-' + (parseFloat(new Date().getMonth()) + 1) + '-' + new Date().getDate() +\n        ' ' + new Date().getHours() + ':' + new Date().getMinutes() + ':' + new Date().getSeconds();\n    ifNewWorkSpace = true;\n    ifBaseInfoSaved = false; // 基本信息是否已保存\n    workspaceId = id;\n    clearAll();\n    hwTextCreatedTime.setValue(nowTime);\n    hwTextModifiedTime.setValue(nowTime);\n    setIfDataLoaded(true);\n    // 将当前活动Tab页切换到基本信息Tab页\n    TabsWorkSpaceInfo.setActiveTab(panelTabInfo);\n}\n// 设置数据是否已加载\nfunction setIfDataLoaded(bVar) {\n    panelTabInfo.ifDataLoaded = bVar;\n    panelTabWorkflow.ifDataLoaded = bVar;\n    panelTabDataService.ifDataLoaded = bVar;\n    panelMSG.ifDataLoaded = bVar;\n    TabWorkSpaceResource.iSetIfDataLoaded(bVar);\n}\n// 清空所有\nfunction clearAll() {\n    clearBaseInfo();\n    clearWorkflow();\n    clearDataService();\n    clearResource();\n}\n// 清空所有\nfunction clearBaseInfo() {\n    hwTextWorkSpaceName.setValue(\"\");\n    hwTextWorkSpaceAlias.setValue(\"\");\n    hwTextCreatedTime.setValue(\"\");\n    hwTextModifiedTime.setValue(\"\");\n    hwTextAreaWorkSpaceDescription.setValue(\"\");\n}\n// 清空所有\nfunction clearWorkflow() {\n    comlistWorkflowAddress.setValue(\"\");\n    comlistWorkflowAddress.serviceId = undefined;\n}\n// 清空所有\nfunction clearDataService() {\n    comlistDataServiceAddress.setValue(\"\");\n    comlistDataServiceAddress.serviceId = undefined;\n}\n// 清空所有\nfunction clearResource() {\n    TabWorkSpaceResource.iClearAll();\n}\n\nfunction queryWorkSpaceInfo(id) {\n    workspaceId = id;\n    queryDataInfo();\n}\n\nfunction TabsWorkSpaceInfo_afterrender(sender) {}\n\nfunction TabWorkSpaceResource_beforerender(sender) {}\n\nfunction TabWorkSpaceInfo_beforerender(sender) {\n    // console.log(\"第一层的TabWorkSpaceInfo_beforerender\");\n}\n\nfunction TabsWorkSpaceInfo_beforerender(sender) {\n    panelTabInfo.ifDataLoaded = false;\n    panelTabWorkflow.ifDataLoaded = false;\n    panelTabDataService.ifDataLoaded = false;\n}\n// 选中工区变化了\nfunction changeWorkSpace(id) {\n    workspaceId = id;\n    var tabId = TabsWorkSpaceInfo.activeTab.id;\n    var tabIndexInfo = tabId.indexOf(\"panelTabInfo\"); // 基于0开始,找不到返回-1\n    var tabIndexWorkFlow = tabId.indexOf(\"panelTabWorkflow\"); // 基于0开始,找不到返回-1\n    var tabIndexDataService = tabId.indexOf(\"panelTabDataService\"); // 基于0开始,找不到返回-1\n    var tabIndexResource = tabId.indexOf(\"panelTabResource\"); // 基于0开始,找不到返回-1\n    var tabIndexMSG = tabId.indexOf(\"panelMSG\"); // 基于0开始,找不到返回-1\n    // 基本信息\n    if (tabIndexInfo > -1) {\n        queryDataInfo();\n    } else if (tabIndexWorkFlow > -1) {\n        queryWorkFlow();\n    } else if (tabIndexDataService > -1) {\n        queryDataService();\n    } else if (tabIndexResource > -1) {\n        TabWorkSpaceResource.iSetWorkSpaceId(workspaceId);\n        TabWorkSpaceResource.iTabChangeResource();\n    } else if (tabIndexMSG > -1) {\n        queryMSG()\n    }\n}\n\nfunction comlistWorkflowAddress_selectChanged(sender, combo, record, index) {\n    comlistWorkflowAddress.serviceId = record.data.id;\n}\n\nfunction comlistDataServiceAddress_selectChanged(sender, combo, record, index) {\n    comlistDataServiceAddress.serviceId = record.data.id;\n}\n\nfunction TabWorkSpaceInfo_afterrender(sender) {\n    TabsWorkSpaceInfo.hideTabStripItem(3)\n}\n\nfunction comlistMSG_selectChanged(sender, combo, record, index) {\n    comlistMSG.serviceId = record.data.id;\n}","vmdcss":"","vmdprops":"\"\"","type":"ux","vmdcmpdeps":[],"vmdinterface":"{\"components\":[{\"cid\":\"vmduxprops\",\"layoutConfig\":{},\"userConfig\":{},\"cn\":[{\"cid\":\"uxprop\",\"id\":\"storeWorkflow\",\"layoutConfig\":{},\"userConfig\":{\"id\":\"storeWorkflow\",\"zhname\":\"\",\"bindCmp\":\"comlistWorkflowAddress\",\"bindValue\":\"store\",\"isPublic\":\"on\",\"desc\":\"工作流下拉列表绑定的数据集\",\"uxcid\":\"vmdComlist\",\"group\":\"\"}},{\"cid\":\"uxprop\",\"id\":\"storeDataService\",\"layoutConfig\":{},\"userConfig\":{\"id\":\"storeDataService\",\"zhname\":\"\",\"bindCmp\":\"comlistDataServiceAddress\",\"bindValue\":\"store\",\"isPublic\":\"on\",\"desc\":\"数据服务下拉列表绑定的数据集\",\"uxcid\":\"vmdComlist\",\"group\":\"\"}},{\"cid\":\"uxprop\",\"id\":\"storeMsg\",\"layoutConfig\":{},\"userConfig\":{\"id\":\"storeMsg\",\"desc\":\"消息中心地址\",\"zhname\":\"\",\"isPublic\":\"on\",\"bindCmp\":\"comlistMSG\",\"bindValue\":\"store\",\"uxcid\":\"vmdComlist\"}}]},{\"cid\":\"vmduxmethods\",\"id\":\"方法\",\"layoutConfig\":{},\"userConfig\":{},\"cn\":[{\"cid\":\"uxmethod\",\"id\":\"iSaveData\",\"layoutConfig\":{},\"userConfig\":{\"id\":\"iSaveData\",\"zhname\":\"\",\"bindCmp\":\"\",\"bindValue\":\"\",\"isPublic\":\"on\",\"desc\":\"保存数据的接口\",\"uxcid\":\"\",\"params\":\"lastId, refreshStore\",\"code\":\"//直接填写方法内容\\nsaveData(lastId,refreshStore);\",\"returnType\":\"数字\"}},{\"cid\":\"uxmethod\",\"id\":\"iSetWorkSpaceId\",\"layoutConfig\":{},\"userConfig\":{\"id\":\"iSetWorkSpaceId\",\"zhname\":\"\",\"bindCmp\":\"\",\"bindValue\":\"\",\"isPublic\":\"on\",\"desc\":\"设置工区的ID\",\"uxcid\":\"\",\"params\":\"id\",\"code\":\"//直接填写方法内容\\nworkspaceId = id;\",\"returnType\":\"无\"}},{\"cid\":\"uxmethod\",\"id\":\"iSetDataStore\",\"layoutConfig\":{},\"userConfig\":{\"id\":\"iSetDataStore\",\"zhname\":\"\",\"bindCmp\":\"\",\"bindValue\":\"\",\"isPublic\":\"on\",\"desc\":\"\",\"uxcid\":\"\",\"params\":\"store\",\"code\":\"//直接填写方法内容\\nthis.dataStore = store;\",\"returnType\":\"无\"}},{\"cid\":\"uxmethod\",\"id\":\"iGetWorkSpaceName\",\"layoutConfig\":{},\"userConfig\":{\"id\":\"iGetWorkSpaceName\",\"zhname\":\"\",\"bindCmp\":\"\",\"bindValue\":\"\",\"isPublic\":\"on\",\"desc\":\"获取工区名称\",\"uxcid\":\"\",\"params\":\"\",\"code\":\"//直接填写方法内容\\nreturn hwTextWorkSpaceName.getValue();\",\"returnType\":\"字符串\"}},{\"cid\":\"uxmethod\",\"id\":\"iClearAll\",\"layoutConfig\":{},\"userConfig\":{\"id\":\"iClearAll\",\"zhname\":\"\",\"bindCmp\":\"\",\"bindValue\":\"\",\"isPublic\":\"on\",\"desc\":\"清空组件中所有数据\",\"uxcid\":\"\",\"params\":\"\",\"code\":\"//直接填写方法内容\\nclearAll();\",\"returnType\":\"无\"}},{\"cid\":\"uxmethod\",\"id\":\"iNewWorkSpace\",\"layoutConfig\":{},\"userConfig\":{\"id\":\"iNewWorkSpace\",\"zhname\":\"\",\"bindCmp\":\"\",\"bindValue\":\"\",\"isPublic\":\"on\",\"desc\":\"新建工区\",\"uxcid\":\"\",\"params\":\"id\",\"code\":\"//直接填写方法内容\\nnewWorkSpace(id);\",\"returnType\":\"无\"}},{\"cid\":\"uxmethod\",\"id\":\"iQueryWorkSpaceInfo\",\"layoutConfig\":{},\"userConfig\":{\"id\":\"iQueryWorkSpaceInfo\",\"zhname\":\"\",\"bindCmp\":\"\",\"bindValue\":\"\",\"isPublic\":\"on\",\"desc\":\"传入工区ID,查询工区信息，显示到Tab页上\",\"uxcid\":\"\",\"params\":\"id\",\"code\":\"//直接填写方法内容\\nqueryWorkSpaceInfo(id);\",\"returnType\":\"无\"}},{\"cid\":\"uxmethod\",\"id\":\"iSetIfDataLoaded\",\"layoutConfig\":{},\"userConfig\":{\"id\":\"iSetIfDataLoaded\",\"zhname\":\"\",\"bindCmp\":\"\",\"bindValue\":\"\",\"isPublic\":\"on\",\"desc\":\"设置数据是否已加载\",\"uxcid\":\"\",\"params\":\"bVar\",\"code\":\"//直接填写方法内容\\nsetIfDataLoaded(bVar);\",\"returnType\":\"无\"}},{\"cid\":\"uxmethod\",\"id\":\"iChangeWorkSpace\",\"layoutConfig\":{},\"userConfig\":{\"id\":\"iChangeWorkSpace\",\"zhname\":\"\",\"bindCmp\":\"\",\"bindValue\":\"\",\"isPublic\":\"on\",\"desc\":\"改变了选择工区\",\"uxcid\":\"\",\"params\":\"id\",\"code\":\"//直接填写方法内容\\nchangeWorkSpace(id);\",\"returnType\":\"无\"}},{\"cid\":\"uxmethod\",\"id\":\"isSaveFlow\",\"layoutConfig\":{},\"userConfig\":{\"id\":\"isSaveFlow\",\"zhname\":\"\",\"bindCmp\":\"\",\"bindValue\":\"\",\"isPublic\":\"on\",\"desc\":\"\",\"uxcid\":\"\",\"params\":\"callback\",\"code\":\"//直接填写方法内容\\nsaveFlow(callback)\",\"returnType\":\"\"}},{\"cid\":\"uxmethod\",\"id\":\"isSaveService\",\"layoutConfig\":{},\"userConfig\":{\"id\":\"isSaveService\",\"zhname\":\"\",\"bindCmp\":\"\",\"bindValue\":\"\",\"isPublic\":\"on\",\"desc\":\"\",\"uxcid\":\"\",\"params\":\"callback\",\"code\":\"//直接填写方法内容\\nsaveService(callback)\",\"returnType\":\"\"}},{\"cid\":\"uxmethod\",\"id\":\"iSetWorkflowStoreRecords\",\"layoutConfig\":{},\"userConfig\":{\"id\":\"iSetWorkflowStoreRecords\",\"zhname\":\"\",\"bindCmp\":\"\",\"bindValue\":\"\",\"isPublic\":\"on\",\"desc\":\"设置工作流下拉列表的数据（非重复）\",\"uxcid\":\"\",\"params\":\"records\",\"code\":\"//直接填写方法内容\\nworkflowStoreRecords = records;\",\"returnType\":\"无\"}},{\"cid\":\"uxmethod\",\"id\":\"iSetDataServiceStoreRecords\",\"layoutConfig\":{},\"userConfig\":{\"id\":\"iSetDataServiceStoreRecords\",\"zhname\":\"\",\"bindCmp\":\"\",\"bindValue\":\"\",\"isPublic\":\"on\",\"desc\":\"设置数据服务下拉列表的数据（非重复）\",\"uxcid\":\"\",\"params\":\"records\",\"code\":\"//直接填写方法内容\\ndataserviceStoreRecords = records;\",\"returnType\":\"无\"}},{\"cid\":\"uxmethod\",\"id\":\"isSaveMSG\",\"layoutConfig\":{},\"userConfig\":{\"id\":\"isSaveMSG\",\"params\":\"callback\",\"desc\":\"\",\"isPublic\":\"on\",\"code\":\"//直接填写方法内容\\nsaveMSG(callback)\",\"returnType\":\"\"}}]},{\"cid\":\"vmduxevents\",\"id\":\"事件\",\"layoutConfig\":{},\"userConfig\":{}}]}","vmdresource":"{\"components\":[{\"cid\":\"vmdrescsss\",\"layoutConfig\":{},\"userConfig\":{}},{\"cid\":\"vmdresjss\",\"layoutConfig\":{},\"userConfig\":{},\"cn\":[{\"cid\":\"resjs\",\"id\":\"controller.js\",\"layoutConfig\":{},\"userConfig\":{}}]},{\"cid\":\"vmdresimgs\",\"layoutConfig\":{},\"userConfig\":{}}]}"}