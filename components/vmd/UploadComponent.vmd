{"vmdversion":"2.0.3.0920","vmdlayout":"{\"components\":[{\"cid\":\"uxpanel\",\"id\":\"UploadComponent\",\"layoutConfig\":{\"align\":\"top\",\"pack\":\"start\"},\"userConfig\":{\"layout\":\"hbox\",\"header\":false,\"width\":840,\"height\":\"\",\"html\":\"\",\"afterrender\":\"UploadComponent_afterrender\",\"style\":\"\",\"autoHeight\":true,\"cls\":\"\"},\"cn\":[{\"cid\":\"panel\",\"id\":\"panel\",\"layoutConfig\":{\"align\":\"middle\",\"pack\":\"start\"},\"userConfig\":{\"width\":58,\"height\":29,\"header\":false,\"layout\":\"hbox\",\"autoHeight\":true,\"style\":\"\"},\"cn\":[{\"cid\":\"label\",\"id\":\"label\",\"layoutConfig\":{},\"userConfig\":{\"width\":56,\"height\":23,\"text\":\"附件：\",\"style\":\"font-size:14px;\",\"margins\":\"\"}}]},{\"cid\":\"panel\",\"id\":\"panel1\",\"layoutConfig\":{},\"userConfig\":{\"width\":87,\"height\":28,\"header\":false,\"html\":\"<!--<input type=\\\"file\\\" name=\\\"fileField\\\" id='inputBox' multiple=\\\"multiple\\\" class=\\\"file-sty\\\" />-->\\n<div id=\\\"filePicker\\\" class=\\\"webuploader-container\\\" style=\\\"float: left;height:30px;padding-right: 8px;text-aligin:center;\\\">上传文件</div>\",\"layout\":\"fit\",\"autoScroll\":false,\"autoHeight\":false,\"margins\":\"0 0 0 0\"}},{\"cid\":\"panel\",\"id\":\"panel2\",\"layoutConfig\":{},\"userConfig\":{\"width\":694,\"height\":\"\",\"header\":false,\"autoScroll\":false,\"html\":\"<div id=\\\"iconList\\\" class=\\\"uploader-list\\\">\\n</div>\",\"autoHeight\":true}}]}]}","vmdevents":"var docids = [];\nvar page = this;\nvar ip = vmd.workspace.dataServiceIp;\n\nfunction UploadComponent_afterrender(sender) {\n    label.el.setStyle('font-size', label.fonSize + \"px\");\n\n    var serverurl = hwDas.getuploadurl(\"wdk\", \"\");\n\n    vmd.loadCss(vmd.virtualPath + '/lib/webuploader/webuploader.css');\n    $LAB.script(vmd.virtualPath + '/lib/webuploader/webuploader.js')\n        .wait(function() {\n            var iconUploader = WebUploader.create({\n                // 选完文件后，是否自动上传。\n                auto: true,\n                // swf文件路径\n                swf: vmd.virtualPath + '/lib/webuploader/Uploader.swf',\n                // 文件接收服务端url\n                // server: \"http://www.hanweikeji.com:6602/DasService/FileService/wdk/Down?FilePath=wdk&destName=''\",\n                server: serverurl,\n                // 内部根据当前运行是创建，可能是input元素，也可能是flash.\n                pick: {\n                    id: '#filePicker',\n                    multiple: true\n                },\n\n                fileSingleSizeLimit: 1 * 1024 * 1024, //限制大小1M，单文件\n                // 只允许选择图片文件。\n                accept: {\n                    title: 'text',\n                    extensions: 'pdf,doc,ppt,pptx,docx,xlsx,xls',\n                    //mimeTypes: 'application/pdf,application/msword,application/vnd.ms-excel,application/vnd.ms-powerpoint,application/vnd.openxmlformats-officedocument.presentationml.presentation,application/vnd.openxmlformats-officedocument.wordprocessingml.document,application/vnd.openxmlformats-officedocument.spreadsheetml.sheet'\n                    mimeTypes: '.pdf,.doc,.ppt,.pptx,.docx,.xlsx,.xls'\n                }\n            });\n            // 当有文件添加进来的时候\n            iconUploader.on('fileQueued', function(file) {\n                $('.uploader-list').css(\"display\", \"block\"); //修改display属性为block\n                var $list = $(\"#iconList\");\n                /*$list.html('');*/\n                var $li = $(\n                    '<div id=\"' + file.id + '\" class=\"file-item thumbnail\" style=\"float:left;margin-right:10px;\">' +\n                    '<div class=\"info\" style=\"font-weight: 700;text-align: left;margin-top: 0x;margin-bottom: 5px;margin-left: 5px;line-height: 30px;\">' + file.name +\n                    '&nbsp;<img id=\"img' + file.id + '\" src=\"{资源中心&&资源中心服务器}/images/downLoad.gif\"  style=\"float:right;\"/>' +\n                    '</div>' +\n                    '<div class=\"progress\"><div></div></div>' +\n                    '</div>'\n                );\n                // $list为容器jQuery实例\n                $list.append($li);\n                page.fireEvent('uploadFinish', UploadComponent, 'test');\n\n            });\n            // 文件上传成功，给item添加成功class, 用样式标记上传成功。\n            iconUploader.on('uploadSuccess', function(file, response) {\n                var url = \"platform/v1/doc\";\n                var hwDao = new HwDao(ip, 'webxpt'); //地址:端口和授权码(服务管理员分配)\n                if(response.data.length > 0) {\n                    //保存文件信息到文档库中\n                    var fileInfo = response.data[0];\n                    file.doctype = \"TZGG\"; //标识文档类型\n                    file.docfilenamewithpath = fileInfo.path;\n                    file.name = fileInfo.name;\n                    file.size = fileInfo.size;\n                    file.ext = fileInfo.extend;\n\n                    var $li = $('#' + file.id),\n                        $error = $li.find('div.success');\n                    // 避免重复创建\n                    if(!$error.length) {\n                        $error = $('<div class=\"success\" style=\"margin-left: 5px;\"></div>').appendTo($li);\n                    }\n                    var doc = {\n                        appid: file.appid,\n                        docname: file.name,\n                        docfilenamewithpath: file.docfilenamewithpath,\n                        docfilesize: file.size,\n                        doctype: file.doctype,\n                        docext: file.ext //扩展名\n                    };\n                    hwDao.add(url, {}, {}, doc, function(docd) {\n                        var docObj = {\n                            path: docd.data[0].datas.docfilenamewithpath,\n                            docid: docd.data[0].datas.docid,\n                            docname: docd.data[0].datas.docname\n                        }\n                        //添加删除按钮\n                        $(\"#img\" + file.id).after(\"<a herf='#' style='text-decoration:none;color:red;cursor: pointer;' class='btnspan' onclick=delFile('\" + file.id + \"','\" + docd.data[0].datas.docid + \"')>删除</a>\");\n                        $(\"#img\" + file.id).hide();\n\n                        docids.push(docObj);\n\n\n                    }, function(ert) {\n                        $error.text('上传失败');\n                    });\n                }\n\n            });\n\n            // 文件上传失败，显示上传出错。\n            iconUploader.on('uploadError', function(file) {\n                var $li = $('#' + file.id),\n                    $error = $li.find('div.error');\n\n                // 避免重复创建\n                if(!$error.length) {\n                    $error = $('<div class=\"error\" style=\"margin-left: 5px;\"></div>').appendTo($li);\n                }\n                $error.text('上传失败');\n            });\n        })\n\n}\n\nwindow.delFile = function(id, docid) {\n    $('#' + id).remove();\n    for(var i = 0; i < docids.length; i++) {\n        if(docids[i].docid == docid) {\n            docids.splice(i, 1);\n        }\n    }\n}\n\n\nwindow.getDocId = function() {\n    return docids;\n}\n\nwindow.SetUpDatas = function(param) {\n    var $list = $(\"#iconList\");\n    $list.append(param);\n    page.fireEvent('uploadFinish', UploadComponent, 'test');\n}","vmdcss":".file-sty{\n    margin: 13px 0 0 0;\n}\n.webuploader-pick {\n    position: relative;\n    display: inline-block;\n    cursor: pointer;\n    background: #00b7ee;\n    padding: 5px 10px !important;\n    color: #fff;\n    text-align: center;\n    border-radius: 3px;\n    overflow: hidden;\n}\n.item {\n    font-weight: 700;\n    text-align: left;\n    margin-left: 20px;\n    margin-top: 5px;\n    margin-bottom: 5px;\n    background:url() no-repeat 4px 5px;\n}","vmdprops":"\"\"","type":"ux","vmdinterface":"{\"components\":[{\"cid\":\"vmduxprops\",\"layoutConfig\":{},\"userConfig\":{},\"cn\":[{\"cid\":\"uxprop\",\"id\":\"UpText\",\"layoutConfig\":{},\"userConfig\":{\"id\":\"UpText\",\"zhname\":\"附件上传文本\",\"bindCmp\":\"label\",\"bindValue\":\"text\",\"isPublic\":\"on\",\"desc\":\"附件上传文本\",\"uxcid\":\"label\",\"group\":\"\",\"cmptype\":\"\",\"cmpsettings\":\"{\\\"isMulti\\\":false,\\\"data\\\":\\\"\\\"}\"}},{\"cid\":\"uxprop\",\"id\":\"Upsize\",\"layoutConfig\":{},\"userConfig\":{\"id\":\"Upsize\",\"desc\":\"上传文本字号\",\"zhname\":\"文本字号\",\"isPublic\":\"on\",\"radio_THy8\":\"string\",\"bindCmp\":\"label\",\"bindValue\":\"fonSize\",\"uxcid\":\"label\",\"cmptype\":\"string\",\"cmpsettings\":\"{\\\"isMulti\\\":false,\\\"data\\\":\\\"\\\"}\"}}]},{\"cid\":\"vmduxmethods\",\"id\":\"方法\",\"layoutConfig\":{},\"userConfig\":{},\"cn\":[{\"cid\":\"uxmethod\",\"id\":\"getDocIds\",\"layoutConfig\":{},\"userConfig\":{\"id\":\"getDocIds\",\"zhname\":\"\",\"bindCmp\":\"\",\"bindValue\":\"\",\"isPublic\":\"on\",\"desc\":\"\",\"uxcid\":\"\",\"params\":\"\",\"code\":\"//直接填写方法内容\\ngetDocId();\\nreturn docids;\",\"returnType\":\"对象\"}},{\"cid\":\"uxmethod\",\"id\":\"SetUpData\",\"layoutConfig\":{},\"userConfig\":{\"id\":\"SetUpData\",\"zhname\":\"\",\"bindCmp\":\"\",\"bindValue\":\"\",\"isPublic\":\"on\",\"desc\":\"\",\"uxcid\":\"\",\"params\":\"param\",\"code\":\"//直接填写方法内容\\nSetUpDatas(param);\",\"returnType\":\"\"}}]},{\"cid\":\"vmduxevents\",\"id\":\"事件\",\"layoutConfig\":{},\"userConfig\":{},\"cn\":[{\"cid\":\"uxevent\",\"id\":\"uploadFinish\",\"layoutConfig\":{},\"userConfig\":{\"id\":\"uploadFinish\",\"params\":\"\",\"desc\":\"\"}}]}]}"}