{"vmdversion":"2.0.4.20190331","vmdlayout":"{\"components\":[{\"cid\":\"uxpanel\",\"id\":\"Data_xlk\",\"layoutConfig\":{},\"userConfig\":{\"layout\":\"absolute\",\"header\":false,\"width\":320,\"height\":621,\"afterrender\":\"Data_xlk_afterrender\"},\"cn\":[{\"cid\":\"label\",\"id\":\"label\",\"layoutConfig\":{},\"userConfig\":{\"x\":10,\"y\":15,\"text\":\"类型设置：\"}},{\"cid\":\"label\",\"id\":\"label1\",\"layoutConfig\":{},\"userConfig\":{\"x\":20,\"y\":50,\"text\":\"数据集：\"}},{\"cid\":\"label\",\"id\":\"label2\",\"layoutConfig\":{},\"userConfig\":{\"x\":10,\"y\":85,\"text\":\"保存字段：\"}},{\"cid\":\"vmdComlist\",\"id\":\"data_saveFiled\",\"layoutConfig\":{},\"userConfig\":{\"x\":70,\"y\":80,\"width\":195,\"style\":\"border: 1px solid #dddddd\",\"id\":\"data_saveFiled\",\"beforerender\":\"data_saveFiled_beforerender\",\"selectChanged\":\"data_saveFiled_selectChanged\"}},{\"cid\":\"label\",\"id\":\"label3\",\"layoutConfig\":{},\"userConfig\":{\"x\":10,\"y\":120,\"text\":\"显示字段：\"}},{\"cid\":\"vmdComlist\",\"id\":\"data_myDisplayFiled\",\"layoutConfig\":{},\"userConfig\":{\"x\":70,\"y\":115,\"width\":195,\"style\":\"border: 1px solid #dddddd\",\"id\":\"data_myDisplayFiled\",\"beforerender\":\"data_myDisplayFiled_beforerender\",\"selectChanged\":\"data_myDisplayFiled_selectChanged\"}},{\"cid\":\"radiogroup\",\"id\":\"data_typeSetting\",\"layoutConfig\":{},\"userConfig\":{\"x\":70,\"y\":10,\"id\":\"data_typeSetting\",\"change\":\"data_typeSetting_change\"},\"cn\":[{\"cid\":\"radio\",\"id\":\"hwRadio\",\"layoutConfig\":{},\"userConfig\":{\"boxLabel\":\"数据查询\",\"fieldLabel\":\"\",\"checked\":true,\"inputValue\":\"1\"}},{\"cid\":\"radio\",\"id\":\"hwRadio1\",\"layoutConfig\":{},\"userConfig\":{\"fieldLabel\":\"\",\"boxLabel\":\"自定义\",\"inputValue\":\"0\",\"disabled\":true}}]},{\"cid\":\"vmdComlist\",\"id\":\"data_dataSet\",\"layoutConfig\":{},\"userConfig\":{\"x\":70,\"y\":45,\"width\":195,\"cls\":\"\",\"style\":\"border: 1px solid #ddd;\",\"id\":\"data_dataSet\",\"beforerender\":\"data_dataSet_beforerender\",\"selectChanged\":\"data_dataSet_selectChanged\"}},{\"cid\":\"container\",\"id\":\"div\",\"layoutConfig\":{},\"userConfig\":{\"x\":-1,\"y\":145,\"height\":40,\"width\":320,\"layout\":\"absolute\",\"border\":false},\"cn\":[{\"cid\":\"label\",\"id\":\"label5\",\"layoutConfig\":{},\"userConfig\":{\"x\":10,\"y\":10,\"text\":\"过滤条件：\"}},{\"cid\":\"textfield\",\"id\":\"data_filterCondition\",\"layoutConfig\":{},\"userConfig\":{\"x\":70,\"y\":5,\"width\":180,\"style\":\"border: 1px solid #dddddd\",\"id\":\"data_filterCondition\",\"afterrender\":\"data_filterCondition_afterrender\"}},{\"cid\":\"vmdButton\",\"id\":\"button2\",\"layoutConfig\":{},\"userConfig\":{\"x\":260,\"y\":5,\"width\":28,\"text\":\"...\",\"height\":24,\"click\":\"button2_click\"}}]},{\"cid\":\"container\",\"id\":\"div2\",\"layoutConfig\":{},\"userConfig\":{\"x\":0,\"y\":180,\"height\":40,\"layout\":\"absolute\",\"border\":false},\"cn\":[{\"cid\":\"label\",\"id\":\"label4\",\"layoutConfig\":{},\"userConfig\":{\"x\":0,\"y\":10,\"text\":\"下拉显示列：\"}},{\"cid\":\"textfield\",\"id\":\"data_dropDownDisplayColumn\",\"layoutConfig\":{},\"userConfig\":{\"x\":70,\"y\":5,\"width\":180,\"style\":\"border: 1px solid #dddddd\",\"id\":\"data_dropDownDisplayColumn\",\"readOnly\":true,\"disabled\":false,\"afterrender\":\"data_dropDownDisplayColumn_afterrender\"}},{\"cid\":\"vmdButton\",\"id\":\"button1\",\"layoutConfig\":{},\"userConfig\":{\"x\":260,\"y\":5,\"width\":28,\"text\":\"...\",\"height\":24,\"click\":\"button1_click\"}}]}]}]}","vmdevents":"var page = this;\nvar store = new Ext.data.JsonStore({\n    proxy: new Ext.data.MemoryProxy(),\n    fields: ['name', 'value']\n});\nvar store1 = new Ext.data.JsonStore({\n    proxy: new Ext.data.MemoryProxy(),\n    fields: ['name', 'value']\n});\nvar store2 = new Ext.data.JsonStore({\n    proxy: new Ext.data.MemoryProxy(),\n    fields: ['name', 'value']\n});\n\nfunction Data_xlk_afterrender(sender) {\n    \n    sender.el.dom.childNodes[0].childNodes[0].childNodes[7].onclick = function() {\n        var names = parent.sheetHot.getDatasets();\n        if (names && names.length > 0) {\n            var nameSet = [];\n            for (var i = 0; i < names.length; i++) {\n                nameSet.push({\n                    name: names[i].name,\n                    value: names[i].name\n                })\n            }\n        }\n        if (nameSet) {\n            store.loadData(nameSet);\n        }\n    }\n}\n\nfunction data_dataSet_beforerender(sender) {\n    data_dataSet.store = store;\n    data_dataSet.valueField = 'value'\n    data_dataSet.displayField = 'name'\n    \n   \n}\n\nfunction data_saveFiled_beforerender(sender) {\n    data_saveFiled.store = store1;\n    data_saveFiled.valueField = 'value'\n    data_saveFiled.displayField = 'name'\n}\n\nfunction data_myDisplayFiled_beforerender(sender) {\n    data_myDisplayFiled.store = store2;\n    data_myDisplayFiled.valueField = 'value'\n    data_myDisplayFiled.displayField = 'name'\n}\n\nfunction data_dataSet_selectChanged(sender, combo, record, index) {\n    sender.setValue(record.data.name)\n    var temp = [];\n    var dataSets = parent.sheetHot.getDatasets();\n    for (var i = 0; i < dataSets.length; i++) {\n        if (dataSets[i].name == record.data.name) {\n            for (var n = 0; n < dataSets[i].fields.length; n++) {\n                temp.push({\n                    name: dataSets[i].fields[n],\n                    value: dataSets[i].fields[n]\n                })\n            }\n        }\n    }\n    store2.loadData(temp)\n    store1.loadData(temp)\n    page.fields = temp;\n    data_saveFiled.setValue(\"\");\n    data_myDisplayFiled.setValue(\"\");\n    page.fireEvent('data_dataSet_changed', data_dataSet.getValue())\n}\n\nfunction button2_click(sender, e) {\n    \n    var cell = parent.sheetHot.dealInvert()[0];\n    var sr = cell.sr;\n    var sc = cell.sc;\n    var urlCode = parent.sheetHot.getCellMeta(sr, sc).cellAttributeInfo.contentInfo.cmbType.value;\n    var data = [];\n    var data1 = [];\n    var cell = sheetHot.dealInvert()[0]\n    var meta = sheetHot.getCellMeta(cell.sr, cell.sc);\n    if (urlCode == \"xlwg\") {\n        if (meta && meta.filterInfo_xlwg) {\n            for (var i = 0; i < meta.filterInfo_xlwg.length; i++) {\n                data1.push({\n                    name: meta.filterInfo_xlwg[i].name,\n                    value: meta.filterInfo_xlwg[i].value\n                })\n            }\n        }\n    } else if (urlCode == \"dxan\") {\n        if (meta && meta.filterInfo_dxan) {\n            for (var i = 0; i < meta.filterInfo_dxan.length; i++) {\n                data1.push({\n                    name: meta.filterInfo_dxan[i].name,\n                    value: meta.filterInfo_dxan[i].value\n                })\n            }\n        }\n    } else if (urlCode == \"xlk\") {\n        if (meta && meta.filterInfo_xlk) {\n            for (var i = 0; i < meta.filterInfo_xlk.length; i++) {\n                data1.push({\n                    name: meta.filterInfo_xlk[i].name,\n                    value: meta.filterInfo_xlk[i].value\n                })\n            }\n        }\n    }\n    var index = 0;\n    if (page.fields) {\n        for (var n = 0; n < page.fields.length; n++) {\n            var flag = true\n            for (var k = 0; k < data1.length; k++) {\n                if (page.fields[n].name == data1[k].name) {\n                    flag = false;\n                    break;\n                }\n            }\n            if (flag) {\n                data.push({\n                    name: page.fields[n].name\n                })\n            }\n        }\n    }\n    if (data.length > 0 || data1.length > 0) {\n        if (urlCode == \"xlwg\") {\n            parent.openVisualSelector(data, data1, 'xlwg', true);\n        } else if (urlCode == \"dxan\") {\n            parent.openVisualSelector(data, data1, 'dxan', true);\n        } else if (urlCode == \"xlk\") {\n            parent.openVisualSelector(data, data1, 'xlk', true);\n        }\n    } else {\n        vmd.tip('请先选择拥有字段的数据集', 'error')\n    }\n}\n\nfunction button1_click(sender, e) {\n    var cell = parent.sheetHot.dealInvert()[0];\n    var sr = cell.sr;\n    var sc = cell.sc;\n    var urlCode = parent.sheetHot.getCellMeta(sr, sc).cellAttributeInfo.contentInfo.cmbType.value;\n    var data = [];\n    var data1 = [];\n    var cell = sheetHot.dealInvert()[0]\n    var meta = sheetHot.getCellMeta(cell.sr, cell.sc);\n    // if (urlCode == \"下拉框\") {\n    //     if (meta && meta.dataInfo_xlk) {\n    //         for (var i = 0; i < meta.dataInfo_xlk.length; i++) {\n    //             data1.push({\n    //                 name: meta.dataInfo_xlk[i].name,\n    //                 cnname: meta.dataInfo_xlk[i].cnname,\n    //                 width: meta.dataInfo_xlk[i].width,\n    //                 search: meta.dataInfo_xlk[i].search\n    //             })\n    //         }\n    //     }\n    // } else \n    if (urlCode == \"xlwg\") {\n        if (meta && meta.dataInfo_xlwg) {\n            for (var i = 0; i < meta.dataInfo_xlwg.length; i++) {\n                data1.push({\n                    name: meta.dataInfo_xlwg[i].name,\n                    cnname: meta.dataInfo_xlwg[i].cnname,\n                    width: meta.dataInfo_xlwg[i].width,\n                    search: meta.dataInfo_xlwg[i].search\n                })\n            }\n        }\n    }\n    // else if (urlCode == '下拉网格') {\n    //     if (meta && meta.dataInfo_xlwg) {\n    //         for (var i = 0; i < meta.dataInfo_xlwg.length; i++) {\n    //             data1.push({\n    //                 name: meta.dataInfo_xlwg[i].name,\n    //                 cnname: meta.dataInfo_xlwg[i].cnname,\n    //                 width: meta.dataInfo_xlwg[i].width,\n    //                 search: meta.dataInfo_xlwg[i].search\n    //             })\n    //         }\n    //     }\n    // }\n    var index = 0;\n    if (page.fields) {\n        for (var n = 0; n < page.fields.length; n++) {\n            var flag = true\n            for (var k = 0; k < data1.length; k++) {\n                if (page.fields[n].name == data1[k].name) {\n                    flag = false;\n                    break;\n                }\n            }\n            if (flag) {\n                data.push({\n                    name: page.fields[n].name\n                })\n            }\n        }\n    }\n    if (data.length > 0 || data1.length > 0) {\n        // if (urlCode == \"下拉框\") {\n        //     parent.openVisualSelector(data, data1, 'xlk');\n        // } else \n        if (urlCode == \"xlwg\") {\n            parent.openVisualSelector(data, data1, 'xlwg');\n        }\n        // else if (urlCode == \"下拉网格\") {\n        //     parent.openVisualSelector(data, data1, 'xlwg');\n        // }\n    } else {\n        vmd.tip('请先选择拥有字段的数据集', 'error')\n    }\n}\n\nfunction setInfo(info, type) {\n    page.type = type;\n    if (info) {\n        if (type == 'xlk') {\n            data_filterCondition.setValue(info.xlk_filterCondition.value)\n            data_dropDownDisplayColumn.setValue(info.xlk_dropDownDisplayColumn.value)\n            data_myDisplayFiled.setValue(info.xlk_myDisplayFiled.value)\n            data_saveFiled.setValue(info.xlk_saveFiled.value)\n            data_dataSet.setValue(info.xlk_dataSet.value)\n            data_typeSetting.setValue(1)\n            // data_dropDownDisplayColumn.hide()\n            // data_filterCondition.hide()\n            // button1.hide()\n            // button2.hide()\n        } else if (type == 'dxan') {\n            data_filterCondition.setValue(info.dxan_filterCondition.value)\n            data_dropDownDisplayColumn.setValue(info.dxan_dropDownDisplayColumn.value)\n            data_myDisplayFiled.setValue(info.dxan_myDisplayFiled.value)\n            data_saveFiled.setValue(info.dxan_saveFiled.value)\n            data_dataSet.setValue(info.dxan_dataSet.value)\n            data_typeSetting.setValue(1)\n            data_dropDownDisplayColumn.hide()\n            data_filterCondition.hide()\n            button1.hide()\n            button2.hide()\n            label4.hide()\n            label5.hide()\n        } else\n        if (type == 'ddg') {\n            if (info && info[0]) {\n                data_filterCondition.setValue(info[0].ddg_filterCondition.value)\n                data_dropDownDisplayColumn.setValue(info[0].ddg_dropDownDisplayColumn.value)\n                data_myDisplayFiled.setValue(info[0].ddg_myDisplayFiled.value)\n                data_saveFiled.setValue(info[0].ddg_saveFiled.value)\n                data_dataSet.setValue(info[0].ddg_dataSet.value)\n                data_typeSetting.setValue(1)\n            } else {\n                data_filterCondition.setValue(info.ddg_filterCondition.value)\n                data_dropDownDisplayColumn.setValue(info.ddg_dropDownDisplayColumn.value)\n                data_myDisplayFiled.setValue(info.ddg_myDisplayFiled.value)\n                data_saveFiled.setValue(info.ddg_saveFiled.value)\n                data_dataSet.setValue(info.ddg_dataSet.value)\n                data_typeSetting.setValue(1)\n            }\n        } else {\n            data_filterCondition.setValue(info.fxk_filterCondition.value)\n            data_dropDownDisplayColumn.setValue(info.fxk_dropDownDisplayColumn.value)\n            data_myDisplayFiled.setValue(info.fxk_myDisplayFiled.value)\n            data_saveFiled.setValue(info.fxk_saveFiled.value)\n            data_dataSet.setValue(info.fxk_dataSet.value)\n            data_typeSetting.setValue(1)\n            data_dropDownDisplayColumn.hide()\n            button1.hide()\n            label4.hide()\n        }\n        var temp = [];\n        var dataSets = parent.sheetHot.getDatasets();\n        for (var i = 0; i < dataSets.length; i++) {\n            if (dataSets[i].name == data_dataSet.getValue()) {\n                for (var n = 0; n < dataSets[i].fields.length; n++) {\n                    temp.push({\n                        name: dataSets[i].fields[n],\n                        value: dataSets[i].fields[n]\n                    })\n                }\n            }\n        }\n        store2.loadData(temp)\n        store1.loadData(temp)\n        page.fields = temp;\n    }\n}\n\nfunction data_myDisplayFiled_selectChanged(sender, combo, record, index) {\n    page.fireEvent('data_myDisplayFiled_changed', sender.getValue())\n}\n\nfunction data_typeSetting_change(sender, checked) {\n    page.fireEvent('data_typeSetting_changed', sender.getValue())\n}\n\nfunction data_saveFiled_selectChanged(sender, combo, record, index) {\n    page.fireEvent('data_saveFiled_changed', sender.getValue())\n}\n\nfunction data_dropDownDisplayColumn_afterrender(sender) {\n    sender.on('change', function() {\n        page.fireEvent('data_dropDownDisplayColumn_changed', sender.getValue())\n    })\n}\n\nfunction data_filterCondition_afterrender(sender) {\n    sender.on('change', function() {\n        page.fireEvent('data_filterCondition_changed', sender.getValue())\n    })\n}","vmdcss":"","vmdprops":"\"\"","type":"ux","vmdevents_controller":"Ext.define('vmd.ux.data_xlk.Controller', {\n    xtype: 'vmd.ux.data_xlk.Controller',\n    constructor: function(options) {\n        \n    }\n})","vmdinterface":"{\"components\":[{\"cid\":\"vmduxprops\",\"layoutConfig\":{},\"userConfig\":{}},{\"cid\":\"vmduxmethods\",\"id\":\"方法\",\"layoutConfig\":{},\"userConfig\":{},\"cn\":[{\"cid\":\"uxmethod\",\"id\":\"setInfo\",\"layoutConfig\":{},\"userConfig\":{\"id\":\"setInfo\",\"zhname\":\"\",\"bindCmp\":\"\",\"bindValue\":\"\",\"isPublic\":\"on\",\"desc\":\"\",\"uxcid\":\"\",\"params\":\"info,type\",\"code\":\"setInfo(info,type);\",\"returnType\":\"\"}}]},{\"cid\":\"vmduxevents\",\"id\":\"事件\",\"layoutConfig\":{},\"userConfig\":{},\"cn\":[{\"cid\":\"uxevent\",\"id\":\"data_typeSetting_changed\",\"layoutConfig\":{},\"userConfig\":{\"id\":\"data_typeSetting_changed\",\"zhname\":\"\",\"bindCmp\":\"\",\"bindValue\":\"\",\"isPublic\":\"\",\"desc\":\"\",\"uxcid\":\"\",\"params\":\"type,value\",\"code\":\"\"}},{\"cid\":\"uxevent\",\"id\":\"data_dataSet_changed\",\"layoutConfig\":{},\"userConfig\":{\"id\":\"data_dataSet_changed\",\"zhname\":\"\",\"bindCmp\":\"\",\"bindValue\":\"\",\"isPublic\":\"\",\"desc\":\"\",\"uxcid\":\"\",\"params\":\"type,value\",\"code\":\"\"}},{\"cid\":\"uxevent\",\"id\":\"data_saveFiled_changed\",\"layoutConfig\":{},\"userConfig\":{\"id\":\"data_saveFiled_changed\",\"zhname\":\"\",\"bindCmp\":\"\",\"bindValue\":\"\",\"isPublic\":\"\",\"desc\":\"\",\"uxcid\":\"\",\"params\":\"type,value\",\"code\":\"\"}},{\"cid\":\"uxevent\",\"id\":\"data_myDisplayFiled_changed\",\"layoutConfig\":{},\"userConfig\":{\"id\":\"data_myDisplayFiled_changed\",\"zhname\":\"\",\"bindCmp\":\"\",\"bindValue\":\"\",\"isPublic\":\"\",\"desc\":\"\",\"uxcid\":\"\",\"params\":\"type,value\",\"code\":\"\"}},{\"cid\":\"uxevent\",\"id\":\"data_filterCondition_changed\",\"layoutConfig\":{},\"userConfig\":{\"id\":\"data_filterCondition_changed\",\"params\":\"type,value\",\"desc\":\"\"}}]}]}","vmdresource":"{\"components\":[{\"cid\":\"vmdrescsss\",\"layoutConfig\":{},\"userConfig\":{}},{\"cid\":\"vmdresjss\",\"layoutConfig\":{},\"userConfig\":{},\"cn\":[{\"cid\":\"resjs\",\"id\":\"controller.js\",\"layoutConfig\":{},\"userConfig\":{}}]},{\"cid\":\"vmdresimgs\",\"layoutConfig\":{},\"userConfig\":{}}]}"}